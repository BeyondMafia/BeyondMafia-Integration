{"version":3,"sources":["Constants.jsx","Contexts.jsx","components/Alerts.jsx","utils.jsx","components/Form.jsx","pages/Loading.jsx","components/Dropdown.jsx","components/Nav.jsx","pages/Landing.jsx","pages/Community/Forums/Categories.jsx","components/Modal.jsx","pages/Community/Forums/Board.jsx","pages/Community/Forums/Thread.jsx","pages/Community/Forums/Forums.jsx","pages/Community/Comments.jsx","pages/Play/Join.jsx","pages/Play/Host/Host.jsx","pages/Play/Host/HostMafia.jsx","pages/Play/CreateSetup/CreateSetup.jsx","pages/Play/CreateSetup/CreateMafiaSetup.jsx","pages/Play/Learn/LearnMafia.jsx","pages/Play/Host/HostSplitDecision.jsx","pages/Play/CreateSetup/CreateSplitDecisionSetup.jsx","pages/Play/Learn/LearnSplitDecision.jsx","pages/Play/Host/HostResistance.jsx","pages/Play/CreateSetup/CreateResistanceSetup.jsx","pages/Play/Learn/LearnResistance.jsx","pages/Play/Host/HostOneNight.jsx","pages/Play/CreateSetup/CreateOneNightSetup.jsx","pages/Play/Learn/LearnOneNight.jsx","pages/Play/Play.jsx","components/Roles.jsx","components/Setup.jsx","pages/User/Profile.jsx","pages/User/Settings.jsx","pages/User/Shop.jsx","pages/User/User.jsx","components/Emotes.jsx","json/badWords.js","json/slurs.js","components/Basic.jsx","pages/Game/MafiaGame.jsx","pages/Game/SplitDecisionGame.jsx","pages/Game/ResistanceGame.jsx","pages/Game/OneNightGame.jsx","Socket.js","pages/Game/Game.jsx","pages/Community/UserSearch.jsx","pages/Community/Moderation.jsx","pages/Community/Community.jsx","pages/Auth/LogIn.jsx","pages/Auth/SignUp.jsx","pages/Auth/Auth.jsx","pages/Legal/PrivacyPolicy.jsx","pages/Legal/TermsOfService.jsx","pages/Legal/Legal.jsx","components/Popover.jsx","pages/Chat/Chat.jsx","Main.jsx","index.jsx"],"names":["GameTypes","Lobbies","Alignments","GameStates","RatingThresholds","UserContext","React","createContext","SiteInfoContext","PopoverContext","GameContext","useSiteInfo","initData","useReducer","siteInfo","action","newSiteInfo","type","prop","value","update","$set","text","alerts","length","$push","alertType","id","$splice","index","i","updateSiteInfo","setSiteInfoProp","showAlert","noFade","alertId","Math","random","setTimeout","alert","document","getElementById","style","opacity","fadeAlert","hideAlert","hideAllAlerts","clearCache","cacheVal","Date","now","window","localStorage","setItem","AlertList","props","useContext","map","Alert","onHide","key","className","onClick","useErrorAlert","siteInfoContext","e","message","response","data","hyphenDelimit","roleName","slice","replace","camelCase","string","subStrings","toLowerCase","split","result","charAt","toUpperCase","substring","pad","amt","char","dateToHTMLString","date","day","toLocaleDateString","time","toTimeString","verifyRecaptcha","Promise","res","rej","grecaptcha","ready","execute","process","token","axios","post","console","log","setCaptchaVisible","visible","el","getElementsByClassName","visibility","Form","onChange","event","field","localOnly","target","min","Number","max","ref","formFields","fields","showIf","disabled","deps","fieldWrapperClass","Array","isArray","inverted","label","placeholder","fixed","saveBtn","highlight","select","saveBtnDiffer","confirm","saveBtnOnClick","step","Switch","options","option","ColorPicker","default","alpha","noReset","submitText","onSubmit","useState","picking","setPicking","pickerRef","useRef","useOnOutsideClick","backgroundColor","current","color","disableAlpha","onChangeComplete","hex","HiddenUpload","inputRef","shouldInput","click","children","onFileUpload","files","name","useForm","initialFormFields","initFields","actions","newFormFields","newField","updateFields","updates","push","SearchSelect","setValue","inputValue","setInputValue","optionsVisible","setOptionsVisible","hoveringOptions","setHoveringOptions","matchingOptions","setMatchingOptions","searchSelectRef","optionsRef","useEffect","searchSelectRect","getBoundingClientRect","optionsRect","optionsTop","top","height","innerHeight","filter","includes","onOptionClick","tabIndex","onFocus","onBlur","onInputChange","onKeyDown","onMouseEnter","onMouseLeave","UserSearchSelect","setOptions","idMap","setIdMap","query","setQuery","valueName","setValueName","get","then","newIdMap","userData","user","catch","TextEditor","tab","setTab","selectedTab","onTabChange","classes","generateMarkdownPreview","markdown","resolve","source","LoadingPage","Dropdown","useDropdown","menuVisible","setMenuVisible","dropdownContainerRef","dropdownMenuRef","selOption","selLabel","menuItems","optionId","icon","caret","useLayoutEffect","containerRect","menuRect","menuLeft","left","menuTop","scrollY","menuHorzShift","innerWidith","width","Nav","SubNav","links","link","hide","exact","to","path","showFilter","filterSel","filterOptions","onFilter","filterIcon","PageNav","page","maxPage","range","onNav","noRange","sel","j","list","changed","unshift","pages","updatePages","pageNums","getPageNavFilterArg","newPage","oldPage","pageItems","sortField","filterArg","SearchBar","onInput","LandingPage","Categories","categoryInfo","setCategoryInfo","loaded","setLoaded","errorAlert","sortItems","a","b","position","title","updateForumNavInfo","categories","sort","category","boards","board","newestThreads","thread","NameWithAvatar","small","author","avatar","ViewsAndReplies","viewCount","replyCount","recentReplies","reply","Time","millisec","postDate","description","Modal","show","onBgClick","header","content","footer","Board","boardInfo","setBoardInfo","showCreateModal","setShowCreateModal","newThreadTitle","setNewThreadTitle","newThreadContent","setNewThreadContent","boardPage","setBoardPage","sortType","redirect","setRedirect","boardId","useParams","onBoardPageNav","threads","threadRowsMap","deleted","VoteWidget","item","itemType","itemHolder","setItemHolder","itemKey","locked","pinned","groups","pinnedThreads","CreateThreadModal","setShow","threadTitle","setThreadTitle","threadContent","setThreadContent","perms","createThread","onCancel","Thread","threadInfo","setThreadInfo","showReplyForm","setShowReplyForm","replyContent","setReplyContent","setPage","scrolled","setScrolled","replyFormRef","threadId","location","useLocation","params","URLSearchParams","search","onReplyClick","postInLocked","newContent","quotedContent","join","scrollIntoView","onThreadPageNav","filterProfanity","settings","replies","boardName","Post","postInfo","voteItem","voteItemHolder","setVoteItemHolder","permaLink","onDelete","onRestore","onEdit","onNotifyToggled","replyNotify","onPinToggled","onLockToggled","hasTitle","body","scrollTop","scrollHeight","pageCount","editing","setEditing","editContent","setEditContent","hideDeleted","minSec","pinThreads","lockThreads","deleteAnyPost","deleteOwnPost","editPost","navigator","clipboard","writeText","origin","postReply","restoreDeleted","Forums","info","newInfo","forumNavInfo","ForumNav","render","onVote","itemId","direction","vote","items","newDirection","newItem","voteCount","updateItemVoteCount","newItems","viewsPlural","repliesPlural","Comments","comments","setComments","showInput","setShowInput","postContent","setPostContent","onCommentsPageNav","_page","comment","commentRows","Comment","loggedIn","Join","listType","setListType","games","setGames","history","useHistory","getItem","lobby","setLobby","getGameList","_listType","lobbyNav","_lobby","pathname","indexOf","TopBarLink","ItemList","game","GameRow","refresh","odd","empty","Announcements","linkPath","buttonText","reserved","setReserved","infoRef","popover","buttonClass","status","scheduled","spectating","canSpectateAny","setup","broken","private","gameId","hostId","PlayerCount","Setup","maxRolesCount","ranked","voiceChat","stateLengths","stateName","gameType","guests","readyCheck","JSON","parse","gameTypeOptions","stopPropagation","circles","total","players","announcements","setAnnouncements","onPageNav","announcementRows","announcement","mod","suffix","UserText","linkify","emotify","Host","selSetup","setSelSetup","updateFormFields","onHostGame","setPageCount","searchVal","setSearchVal","setups","setSetups","getSetupList","onFavSetup","favSetup","newSetups","favorite","onEditSetup","onDelSetup","hostButtons","onHostNavClick","SetupRow","onSelect","onFav","onDel","args","append","selIconFormat","favIconFormat","HostMafia","defaults","dayLength","nightLength","extendLength","getFormFieldValue","stringify","CreateSetup","roleSets","closedField","resetFormFields","formFieldValueMods","onCreateSetup","selRoleSet","setSelRoleSet","modifier","setModifier","roleData","newRoleData","roles","closed","roleSet","role","splice","updateRoleData","formFieldChanges","valueMod","alignment","count","RoleCount","RoleSetRow","modifiers","RoleSearch","onAddClick","CreateMafiaSetup","startState","dawn","whispers","leakPercentage","lastWill","mustAct","noReveal","votesInvisible","unique","LearnMafia","PanelGrid","panels","HostSplitDecision","getTime","CreateSplitDecisionSetup","swapAmt","roundAmt","LearnSplitDecision","href","HostResistance","CreateResistanceSetup","firstTeamSize","lastTeamSize","numMissions","teamFailLimit","LearnResistance","CreateOneNightSetup","excessRoles","LearnOneNight","Play","inLobby","setGameType","active","roleRef","hideCount","roleClass","bg","showPopover","showSecondaryHover","onHover","clientY","roleListType","setRoleListType","roleCellRefs","alignButtons","roleCells","roleCellEl","onRoleCellClick","roleCounts","multi","setupRef","overSize","roleNames","Object","keys","GameIcon","SmallRoleList","GameStateIcon","iconName","state","Profile","profileLoaded","setProfileLoaded","setName","setAvatar","banner","setBanner","bio","setBio","oldBio","setOldBio","editingBio","setEditingBio","isFriend","setIsFriend","setSettings","accounts","setAccounts","recentGames","setRecentGames","createdSetups","setCreatedSetups","bustCache","setBustCache","friendsPage","setFriendsPage","setMaxFriendsPage","friends","setFriends","friendRequests","setFriendRequests","Mafia","stats","setStats","setGroups","userId","isSelf","isBlocked","blockedUsers","formData","FormData","onFriendsPageNav","maxFriendsPage","ratings","panelStyle","bannerStyle","backgroundImage","bannerFormat","backgroundSize","statName","stat","round","letter","letters","reverse","recentGamesRows","createdSetupRows","friendRequestRows","_userId","newFriendRequests","u","friendRows","friend","lastActive","itemsOwned","customProfile","Avatar","large","hasImage","edit","onUpload","Badges","blockUserToggle","discord","showDiscord","twitch","showTwitch","steam","showSteam","Settings","settingsLoaded","setSettingsLoaded","accountsLoaded","setAccountsLoaded","disableAllCensors","viewDeleted","siteFields","updateSiteFields","code","reservedNames","prompt","set","nameChange","profileFields","updateProfileFields","textColors","gameFields","updateGameFields","onSettingChange","updateSetting","siteFormFieldChanges","profileFormFieldChanges","gameFormFieldChanges","clear","Shop","shopItems","balance","shopInfo","setShopInfo","desc","price","limit","onBuyItem","User","size","imageUrl","colors","rand","charCodeAt","abs","pow","floor","noLink","newTab","setVisible","preventDefault","StatusIcon","badges","g","badge","rank","Badge","badgeColor","Emote","emoteKey","emote","Emotes","EmoteKeys","itemRows","panel","unit","units","scale","NotificationHolder","notifCount","lOffset","fwdRef","setContent","profChar","linkRegex","_segment","segment","lastIndex","regexRes","exec","flat","avify","playersArray","values","playerNames","player","playerNamesRegex","RegExp","words","test","find","word","k","disablePg13Censor","filterProfanitySegment","badWords","slurs","profanity","regex","replacement","repeat","refs","onOutsideClick","contains","addEventListener","removeEventListener","MafiaGame","updateHistory","stateViewing","updatePlayers","updateStateViewing","self","isSpectator","playBellRef","meetings","states","audioFileNames","stateEvents","audioLoops","audioOverrides","audioVolumes","currentState","loadAudioFiles","review","useSocketListeners","socket","on","playAudio","winners","TopBar","spectatorCount","setLeave","finished","setShowSettingsModal","setRehostId","noLeaveRef","dev","gameName","timer","Timer","timers","ThreePanelLayout","leftPanelContent","PlayerList","activity","SpeechFilter","filters","speechFilters","setFilters","setSpeechFilters","centerPanelContent","TextMeetingLayout","setTyping","agoraClient","localAudioTrack","setActiveVoiceChannel","muted","setMuted","deafened","setDeafened","rightPanelContent","ActionList","LastWillEntry","Notes","SplitDecisionGame","ResistanceGame","OneNightGame","ClientSocket","persistent","WebSocket","configurePing","configureClose","this","heartbeat","clearTimeout","pingTimeout","send","close","PING_INTERVAL","reconnect","listeners","sendQueue","received","setSocket","configureListeners","triggerEvent","terminate","eventName","parseMessage","bind","String","stringifyMessage","readyState","newListeners","Game","GameWrapper","match","leave","setFinished","port","setPort","setToken","connected","setConnected","setSetup","emojis","setEmojis","newHistory","stateIds","prevState","dead","meeting","meetingId","members","$unset","selTab","messages","quote","toMeetingId","votes","voterId","noLog","voteRecord","undefined","t","playerId","newState","useStateViewingReducer","newPlayers","propName","propVal","setSpectatorCount","setIsSpectator","setSelf","setLastWill","newTimers","delay","timerName","intTime","updateTimers","newSettings","propval","votingLog","timestamps","sounds","volume","updateSettings","showSettingsModal","showFirstGameModal","setShowFirstGameModal","from","activeVoiceChannel","rehostId","setDev","playersRef","selfRef","newActivity","typing","newSpeaking","reduce","speaking","updateActivity","activityInterval","setInterval","getVolumeLevel","uid","remoteUsers","forEach","audioTrack","clearInterval","useActivity","audioRef","audioInfo","newAudioInfo","overrides","audioName","pause","currentTime","play","volumes","fileName","Audio","load","loop","loops","updateAudio","audios","useAudio","stopAudio","stopAudios","createAgoraClient","AgoraRTC","createClient","mode","codec","mediaType","subscribe","setVolume","audioContainer","remove","agoraDisconnect","createMicrophoneAudioTrack","publish","error","socketURL","newSocket","Socket","onKeydown","speechInput","activeElName","activeElement","tagName","focus","requestNotificationAccess","timerInterval","names","users","textColor","nameColor","vcToken","agoraConnect","guestId","isBot","pings","will","Notification","permission","hasFocus","context","Provider","SettingsModal","showModal","setShowModal","FirstGameModal","open","StateSwitcher","p","rehost","stateInfo","autoScroll","setAutoScroll","mouseMoved","setMouseMoved","speechDisplayRef","speechMeetings","speech","doAutoScroll","onMessageQuote","senderId","isQuote","quotable","messageId","fromMeetingId","fromState","onMouseMove","tabs","tabId","m","matches","playerName","concat","isUnvote","voter","voterName","voteMsg","getMessagesToDisplay","Message","canSpeak","amMember","canTalk","onScroll","clientHeight","SpeechInput","quotedMessage","contentClass","isMe","msg","meetingName","senderName","onDoubleClick","Timestamp","prefix","hours","getHours","padStart","minutes","getMinutes","seconds","getSeconds","setSpeechInput","speechDropdownOptions","setSpeechDropdownOptions","speechDropdownValue","setSpeechDropdownValue","lastTyped","setLastTyped","typingIn","setTypingIn","clearTyping","setClearTyping","speechAbilities","newDropdownOptions","ability","targets","targetDisplay","targetType","verb","isTyping","autoComplete","maxLength","anonymous","abilityInfo","abilityName","abilityTarget","pop","seedString","playerSeeds","matchedPlayers","every","leftArrowVisible","rigthArrowVisible","SideMenu","scrollable","PlayerRows","stateViewingInfo","alivePlayers","deadPlayers","voting","inputType","ActionSelect","ActionButton","ActionText","useAction","notClickable","getTargetDisplay","member","canVote","selection","actionName","buttons","canUnvote","isCurrentState","instant","formatTimerTime","newWill","modalContent","modalFooter","cancel","notes","setNotes","notesData","removeItem","_notes","requestPermission","UserSearch","userList","setUserList","NewestUsers","viewFlagged","FlaggedUsers","setUsers","userRows","joined","Moderation","groupsPanels","group","viewModActions","ModCommands","ModActions","command","setCommand","argValues","setArgValues","modCommands","useModCommands","commandName","perm","hidden","updateArgValue","arg","optional","maxlength","run","commandRan","ban","modId","expires","toLocaleString","setActions","actionRows","actionArgs","Community","LogIn","email","setEmail","password","setPassword","submitDisabled","setSubmitDisabled","loading","setLoading","showResetPw","setShowResetPw","auth","getAuth","signInWithEmailAndPassword","userCred","getIdToken","idToken","reload","sendEmailVerification","onResetPw","sendPasswordResetEmail","SignUp","passwordConf","setPasswordConf","signedUp","setSignedUp","allowedEmailDomans","emailDomain","createUserWithEmailAndPassword","Auth","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","setPersistence","inMemoryPersistence","PrivacyPolicy","Legal","Popover","popoverRef","triangleRef","sideContentRef","boundingEl","loadingRef","setSideContentVisible","setBoundingEl","boundingRect","popoverRect","triangleLeft","triangleTop","popoverLeft","popoverTop","popoverHorzShift","innerWidth","sideContentVisible","useLeft","x","sideContentMouseY","sideContentTitle","sideContentLoading","sideContent","usePopover","setTitle","setSideContent","setSideContentTitle","setSideContentLoading","setSideContentMouseY","sideload","InfoRow","creator","whisperContent","roleset","rolesByAlignment","roleObj","rolesets","sectionName","parseSetupPopover","descLines","parseRolePopover","playerList","totalPlayers","createTime","startTime","endTime","parseGamePopover","dataMod","_boundingEl","mouseY","Chat","showWindow","setShowWindow","chatInfo","newChatInfo","notifsArray","notifs","notifsTotal","notifsByChannelType","rooms","directs","notifsByChannel","notif","channelId","channelType","all","byChannelType","byChannel","$unshift","channel","newChannels","newDirects","lastMessageDate","newAll","newByChannelType","newByChannel","updateChatInfo","currentTab","setCurrentTab","currentChannelId","setCurrentChannelId","newChannel","updateChannel","newDMUsers","setNewDMUsers","textInput","setTextInput","userSearchVal","setUserSearchVal","messageListRef","oldScrollHeight","onTabClick","scrollTo","manageScroll","roomId","channels","sortDMs","ChannelName","short","public","messageList","onKeyPress","showContextMenu","setShowContextMenu","clickCoords","setClickCoords","messageRef","contextMenuRef","sender","age","messageRect","y","right","onContextMenu","clientX","deleteChatMessage","memberNames","Header","SiteNotifs","showNotifList","setShowNotifList","notifInfo","newNotifInfo","existingNotifIds","newNotifs","unread","updateNotifInfo","nextRestart","setNextRestart","bellRef","notifListRef","getNotifs","viewedNotifs","notifGetInterval","restartMinutes","ceil","listRect","listRight","go","onNotifClick","Footer","year","getYear","Main","setUser","userIndex","useUser","onGameLeave","headers","common","csrf","referrer","nameChanged","inGame","getInfo","onlineInterval","ReactDOM"],"mappings":"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","file":"static/js/main.191ca1cc.chunk.js","sourcesContent":["export const GameTypes = [\"Mafia\", \"Split Decision\", \"Resistance\", \"One Night\"];\r\nexport const Lobbies = [\"Main\", \"Sandbox\", \"Competitive\", \"Games\"];\r\n\r\nexport const Alignments = {\r\n\t\"Mafia\": [\"Village\", \"Mafia\", \"Monsters\", \"Independent\"],\r\n\t\"Split Decision\": [\"Blue\", \"Red\", \"Independent\"],\r\n\t\"Resistance\": [\"Resistance\", \"Spies\"],\r\n\t\"One Night\": [\"Village\", \"Werewolves\", \"Independent\"],\r\n};\r\n\r\nexport const GameStates = {\r\n\t\"Mafia\": [\"Day\", \"Night\"],\r\n\t\"Split Decision\": [\"Initial Round\", \"Hostage Swap\"],\r\n\t\"Resistance\": [\"Team Selection\", \"Team Approval\", \"Mission\"],\r\n\t\"One Night\": [\"Day\", \"Night\"],\r\n};\r\n\r\nexport const RatingThresholds = {\r\n\t\"reads\": {\r\n\t\t\"S\": 0.95,\r\n\t\t\"A\": 0.9,\r\n\t\t\"B\": 0.8,\r\n\t\t\"C\": 0.7,\r\n\t\t\"D\": 0.6,\r\n\t\t\"E\": 0.5,\r\n\t},\r\n\t\"survival\": {\r\n\t\t\"S\": 0.95,\r\n\t\t\"A\": 0.9,\r\n\t\t\"B\": 0.8,\r\n\t\t\"C\": 0.7,\r\n\t\t\"D\": 0.6,\r\n\t\t\"E\": 0.5,\r\n\t},\r\n\t\"participation\": {\r\n\t\t\"S\": 0.95,\r\n\t\t\"A\": 0.9,\r\n\t\t\"B\": 0.8,\r\n\t\t\"C\": 0.7,\r\n\t\t\"D\": 0.6,\r\n\t\t\"E\": 0.5,\r\n\t},\r\n};\r\n\r\nexport const RequiredTotalForStats = 1;\r\n\r\nexport const MaxGameMessageLength = 240;\r\nexport const MaxWillLength = 100;\r\n\r\nexport const MaxGroupNameLength = 20;\r\nexport const MaxCategoryNameLength = 20;\r\nexport const MaxBoardNameLength = 20;\r\nexport const MaxBoardDescLength = 60;\r\nexport const MaxThreadTitleLength = 50;\r\nexport const MaxThreadContentLength = 5000;\r\nexport const MaxReplyLength = 1000;\r\n\r\nexport const MaxChatMessageLength = 240;\r\n\r\nexport const AlertFadeTimeout = 3000;\r\nexport const AlertFadeDuration = 500;\r\n\r\n","import React, { useState, useReducer } from \"react\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { AlertFadeTimeout, AlertFadeDuration } from \"./Constants\";\r\n\r\nexport const UserContext = React.createContext();\r\nexport const SiteInfoContext = React.createContext();\r\nexport const PopoverContext = React.createContext();\r\nexport const GameContext = React.createContext();\r\n\r\nexport function useSiteInfo(initData) {\r\n\tconst [siteInfo, updateSiteInfo] = useReducer((siteInfo, action) => {\r\n\t\tvar newSiteInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"setProp\":\r\n\t\t\t\tif (siteInfo[action.prop] != action.value) {\r\n\t\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\t\t[action.prop]: {\r\n\t\t\t\t\t\t\t$set: action.value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showAlert\":\r\n\t\t\t\tif (typeof action.text == \"function\")\r\n\t\t\t\t\taction.text = action.text(siteInfo.alerts.length);\r\n\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$push: [{ \r\n\t\t\t\t\t\t\ttext: action.text, \r\n\t\t\t\t\t\t\ttype: action.alertType || \"\" ,\r\n\t\t\t\t\t\t\tid: action.id\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAlert\":\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$splice: [[action.index, 1]]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAlertById\":\r\n\t\t\t\tfor (let i = 0; i < siteInfo.alerts.length; i++) {\r\n\t\t\t\t\tif (siteInfo.alerts[i].id == action.id) {\r\n\t\t\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t\t\t$splice: [[i, 1]]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAllAlerts\":\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$set: []\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newSiteInfo || siteInfo;\r\n\t}, initData);\r\n\r\n\tfunction setSiteInfoProp(prop, value) {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"setProp\",\r\n\t\t\tprop,\r\n\t\t\tvalue\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showAlert(text, alertType, noFade) {\r\n\t\tvar alertId = Math.random();\r\n\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"showAlert\",\r\n\t\t\ttext,\r\n\t\t\talertType,\r\n\t\t\tid: alertId\r\n\t\t});\r\n\r\n\t\tif (!noFade)\r\n\t\t\tsetTimeout(() => fadeAlert(alertId), AlertFadeTimeout);\r\n\t}\r\n\r\n\tfunction hideAlert(index) {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"hideAlert\",\r\n\t\t\tindex\r\n\t\t});\r\n\t}\r\n\r\n\tfunction hideAllAlerts() {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"hideAllAlerts\"\r\n\t\t});\r\n\t}\r\n\r\n\tfunction clearCache() {\r\n\t\tvar cacheVal = Date.now();\r\n\t\tsetSiteInfoProp(\"cacheVal\", cacheVal);\r\n\t\twindow.localStorage.setItem(\"cacheVal\", cacheVal);\r\n\t}\r\n\r\n\tfunction fadeAlert(id) {\r\n\t\tvar alert = document.getElementById(`alert-id-${id}`);\r\n\r\n\t\tif (!alert)\r\n\t\t\treturn;\r\n\r\n\t\talert.style.opacity = 0;\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tupdateSiteInfo({\r\n\t\t\t\ttype: \"hideAlertById\",\r\n\t\t\t\tid\r\n\t\t\t});\r\n\t\t}, AlertFadeDuration);\r\n\t}\r\n\r\n\treturn {\r\n\t\t...siteInfo,\r\n\t\tupdate: setSiteInfoProp,\r\n\t\tshowAlert,\r\n\t\thideAlert,\r\n\t\thideAllAlerts,\r\n\t\tclearCache\r\n\t};\r\n}","import React, { useContext } from \"react\";\r\nimport { SiteInfoContext } from \"../Contexts\";\r\n\r\nimport \"../css/alerts.css\";\r\n\r\nexport function AlertList(props) {\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tconst alerts = siteInfo.alerts.map((alert, i) => {\r\n\t\treturn (\r\n\t\t\t<Alert\r\n\t\t\t\tid={alert.id}\r\n\t\t\t\tindex={i}\r\n\t\t\t\ttext={alert.text}\r\n\t\t\t\ttype={alert.type}\r\n\t\t\t\tonHide={siteInfo.hideAlert}\r\n\t\t\t\tkey={alert.id} />\r\n\t\t)\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"alert-list\">\r\n\t\t\t{alerts}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Alert(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tid={`alert-id-${props.id}`}\r\n\t\t\tclassName={`alert alert-${props.type}`}>\r\n\t\t\t<i\r\n\t\t\t\tclassName={`hide-alert fa-times-circle fas`}\r\n\t\t\t\tonClick={() => props.onHide(props.index)} />\r\n\t\t\t{props.text}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport function useErrorAlert(siteInfo) {\r\n\tconst siteInfoContext = useContext(SiteInfoContext);\r\n\tsiteInfo = siteInfo || siteInfoContext;\r\n\r\n\treturn (e) => {\r\n\t\tvar message;\r\n\r\n\t\tif (e && e.response)\r\n\t\t\tmessage = e.response.data;\r\n\t\telse if (e && e.message)\r\n\t\t\tmessage = e.message;\r\n\t\telse if (typeof e == \"string\")\r\n\t\t\tmessage = e;\r\n\t\telse\r\n\t\t\tmessage = \"Error loading data\";\r\n\r\n\t\tif (message.length > 200)\r\n\t\t\tmessage = \"Connection error\";\r\n\r\n\t\tsiteInfo.showAlert(message, \"error\");\r\n\t};\r\n}","import axios from \"axios\";\r\n\r\nexport function hyphenDelimit(roleName) {\r\n\troleName = roleName.slice();\r\n\r\n\tfor (let i = 0; i < roleName.length; i++) {\r\n\t\tif (roleName[i] == \" \")\r\n\t\t\troleName = roleName.replace(\" \", \"-\");\r\n\t}\r\n\r\n\treturn roleName;\r\n}\r\n\r\nexport function capitalize(string) {\r\n\treturn string.charAt(0).toUpperCase() + string.substring(1);\r\n}\r\n\r\nexport function camelCase(string) {\r\n\tlet subStrings = string.toLowerCase().split(\" \");\r\n\tlet result = \"\";\r\n\r\n\tfor (let i = 0; i < subStrings.length; i++) {\r\n\t\tif (i == 0)\r\n\t\t\tresult += subStrings[i];\r\n\t\telse\r\n\t\t\tresult += subStrings[i].charAt(0).toUpperCase() + subStrings[i].substring(1);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function pascalCase(string) {\r\n\tvar parts = string.split(\" \");\r\n\tvar res = \"\";\r\n\r\n\tfor (let i = 0; i < parts.length; i++) {\r\n\t\tlet part = parts[i];\r\n\t\tres += (part[0].toUpperCase() + part.slice(1, part.length));\r\n\t}\r\n\r\n\treturn res;\r\n}\r\n\r\nexport function replaceAll(string, from, to) {\r\n\twhile (string.indexOf(from) != -1)\r\n\t\tstring = string.replace(from, to);\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function pad(value, amt, char) {\r\n\twhile (value.length < amt)\r\n\t\tvalue = char + value;\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function dateToHTMLString(date) {\r\n\tif (!date)\r\n\t\treturn \"\";\r\n\telse if (typeof date == \"string\")\r\n\t\treturn date;\r\n\r\n\tdate = (new Date(date));\r\n\r\n\tvar day = date.toLocaleDateString();\r\n\tvar time = date.toTimeString();\r\n\r\n\tday = day.split(\"/\");\r\n\tday = pad(day[2], 2, \"0\") + \"-\" + pad(day[0], 2, \"0\") + \"-\" + pad(day[1], 2, \"0\");\r\n\r\n\ttime = time.split(\":\");\r\n\ttime = time[0] + \":\" + time[1];\r\n\r\n\tdate = day + \"T\" + time;\r\n\treturn date;\r\n}\r\n\r\nexport async function verifyRecaptcha(action) {\r\n\treturn new Promise((res, rej) => {\r\n\t\twindow.grecaptcha.ready(async () => {\r\n\t\t\ttry {\r\n\t\t\t\tconst token = await window.grecaptcha.execute(process.env.REACT_APP_RECAPTCHA_KEY, { action });\r\n\t\t\t\tawait axios.post(\"/auth/verifyCaptcha\", { token });\r\n\t\t\t\tres(token);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\trej(e);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function setCaptchaVisible(visible) {\r\n\tvar el = document.getElementsByClassName(\"grecaptcha-badge\")[0];\r\n\r\n\tif (el)\r\n\t\tel.style.visibility = visible ? \"visible\" : \"hidden\";\r\n}","import React, { useState, useReducer, useRef, useEffect } from \"react\";\r\nimport { ChromePicker } from \"react-color\";\r\nimport ReactMde from \"react-mde\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport axios from \"axios\";\r\n\r\nimport { useOnOutsideClick } from \"./Basic\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\n\r\nimport \"react-mde/lib/styles/css/react-mde.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-editor.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-toolbar.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-suggestions.css\";\r\n\r\nimport \"../css/form.css\";\r\nimport \"../css/markdown.css\";\r\nimport { dateToHTMLString } from \"../utils\";\r\n\r\nexport default function Form(props) {\r\n\tfunction onChange(event, field, localOnly) {\r\n\t\tvar value = event.target.value;\r\n\r\n\t\tif (field.min != null && Number(value) < field.min)\r\n\t\t\tvalue = field.min;\r\n\t\telse if (field.max != null && Number(value) > field.max)\r\n\t\t\tvalue = field.max;\r\n\r\n\t\tprops.onChange({\r\n\t\t\tref: field.ref,\r\n\t\t\tprop: \"value\",\r\n\t\t\tvalue: value,\r\n\t\t\tlocalOnly\r\n\t\t});\r\n\t}\r\n\r\n\tconst formFields = props.fields.map((field, i) => {\r\n\t\tconst disabled = typeof field.disabled == \"function\" ? field.disabled(props.deps) : field.disabled;\r\n\t\tconst fieldWrapperClass = `field-wrapper ${disabled ? \"disabled\" : \"\"}`;\r\n\t\tvar showIf;\r\n\r\n\t\tif (typeof field.showIf == \"string\")\r\n\t\t\tshowIf = [field.showIf];\r\n\t\telse\r\n\t\t\tshowIf = field.showIf;\r\n\r\n\t\tif (Array.isArray(showIf)) {\r\n\t\t\tfor (let ref of showIf) {\r\n\t\t\t\tlet inverted = ref[0] == \"!\";\r\n\r\n\t\t\t\tif (inverted)\r\n\t\t\t\t\tref = ref.slice(1);\r\n\r\n\t\t\t\tfor (let field of props.fields) {\r\n\t\t\t\t\tif (field.ref == ref && field.type == \"boolean\") {\r\n\t\t\t\t\t\tlet value = field.value == true;\r\n\r\n\t\t\t\t\t\tif ((value ^ inverted) == 0)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (typeof showIf == \"function\")\r\n\t\t\tif (!showIf(props.deps))\r\n\t\t\t\treturn;\r\n\r\n\t\tconst value = typeof field.value == \"function\" ? field.value(props.deps) : field.value;\r\n\r\n\t\tswitch (field.type) {\r\n\t\t\tcase \"text\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype={field.type}\r\n\t\t\t\t\t\t\tvalue={value || \"\"}\r\n\t\t\t\t\t\t\tplaceholder={field.placeholder}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={(e) => !field.fixed && onChange(e, field, field.saveBtn)}\r\n\t\t\t\t\t\t\tonClick={(e) => field.highlight && e.target.select()} />\r\n\t\t\t\t\t\t{field.saveBtn && props.deps[field.saveBtnDiffer] != field.value &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\tlet conf = !field.confirm || window.confirm(field.confirm);\r\n\r\n\t\t\t\t\t\t\t\t\tif (conf) {\r\n\t\t\t\t\t\t\t\t\t\tif (field.saveBtnOnClick)\r\n\t\t\t\t\t\t\t\t\t\t\tfield.saveBtnOnClick(field.value, props.deps);\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tonChange(e, field);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t{field.saveBtn}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"number\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\tvalue={field.value || \"0\"}\r\n\t\t\t\t\t\t\tmin={field.min}\r\n\t\t\t\t\t\t\tmax={field.max}\r\n\t\t\t\t\t\t\tstep={field.step}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={(e) => onChange(e, field)} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"boolean\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"switch-wrapper\">\r\n\t\t\t\t\t\t\t<Switch\r\n\t\t\t\t\t\t\t\tvalue={field.value || false}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"select\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tvalue={field.value || field.options[0].ref}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={e => onChange(e, field)}>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfield.options.map(option => (\r\n\t\t\t\t\t\t\t\t\t<option value={option.value} key={option.value}>\r\n\t\t\t\t\t\t\t\t\t\t{option.label}\r\n\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"range\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"range-wrapper\">\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\t\t\tmin={field.min}\r\n\t\t\t\t\t\t\t\tmax={field.max}\r\n\t\t\t\t\t\t\t\tstep={field.step}\r\n\t\t\t\t\t\t\t\tvalue={field.value}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"color\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<ColorPicker\r\n\t\t\t\t\t\t\tvalue={field.value}\r\n\t\t\t\t\t\t\tdefault={field.default}\r\n\t\t\t\t\t\t\talpha={field.alpha}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t{!field.noReset && field.value != field.default && field.value &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={() => onChange({ target: { value: field.default } }, field)}>\r\n\t\t\t\t\t\t\t\tReset\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"datetime-local\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"datetime-wrapper\">\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\r\n\t\t\t\t\t\t\t\tmin={dateToHTMLString(field.min)}\r\n\t\t\t\t\t\t\t\tmax={dateToHTMLString(field.max)}\r\n\t\t\t\t\t\t\t\tvalue={dateToHTMLString(field.value)}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"form\">\r\n\t\t\t{formFields}\r\n\t\t\t{props.submitText &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\tonClick={props.onSubmit}>\r\n\t\t\t\t\t{props.submitText}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Switch(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`switch ${props.value ? \"on\" : \"\"}`}\r\n\t\t\tonClick={() => !props.disabled && props.onChange({ target: { value: !props.value } })}>\r\n\t\t\t<div className=\"track\" />\r\n\t\t\t<div className=\"thumb\" />\r\n\t\t\t<input\r\n\t\t\t\ttype=\"hidden\"\r\n\t\t\t\tvalue={props.value} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ColorPicker(props) {\r\n\tconst [picking, setPicking] = useState(false);\r\n\tconst pickerRef = useRef();\r\n\tconst value = props.value || props.default;\r\n\tconst disabled = props.disabled;\r\n\r\n\tfunction onClick(e) {\r\n\t\tif (!disabled && e.target == pickerRef.current)\r\n\t\t\tsetPicking(!picking);\r\n\t}\r\n\r\n\tfunction onChangeComplete(color, event) {\r\n\t\tprops.onChange({ target: { value: color.hex } });\r\n\t}\r\n\r\n\tuseOnOutsideClick(pickerRef, () => setPicking(false));\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`color-picker ${disabled ? \"disabled\" : \"\"}`}\r\n\t\t\tstyle={{ backgroundColor: value }}\r\n\t\t\tonClick={onClick}\r\n\t\t\tref={pickerRef}>\r\n\t\t\t{picking &&\r\n\t\t\t\t<ChromePicker\r\n\t\t\t\t\tcolor={value}\r\n\t\t\t\t\tdisableAlpha={!props.alpha}\r\n\t\t\t\t\tonChangeComplete={onChangeComplete} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function HiddenUpload(props) {\r\n\tconst inputRef = useRef();\r\n\r\n\tfunction onClick() {\r\n\t\tvar shouldInput = true;\r\n\r\n\t\tif (props.onClick)\r\n\t\t\tshouldInput = props.onClick();\r\n\r\n\t\tif (shouldInput)\r\n\t\t\tshowFileUploadDialog();\r\n\t}\r\n\r\n\tfunction showFileUploadDialog() {\r\n\t\tinputRef.current.click();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={props.className}\r\n\t\t\tonClick={onClick}>\r\n\t\t\t{props.children}\r\n\t\t\t<input\r\n\t\t\t\tclassName=\"hidden-upload\"\r\n\t\t\t\tref={inputRef}\r\n\t\t\t\ttype=\"file\"\r\n\t\t\t\tonChange={e => props.onFileUpload(e.target.files, props.name)} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useForm(initialFormFields) {\r\n\tconst [initFields] = useState(initialFormFields);\r\n\tconst [fields, updateFields] = useReducer((formFields, actions) => {\r\n\t\tconst newFormFields = [...formFields];\r\n\r\n\t\tif (!Array.isArray(actions))\r\n\t\t\tactions = [actions];\r\n\r\n\t\tfor (let i in newFormFields) {\r\n\t\t\tlet field = newFormFields[i];\r\n\t\t\tlet newField = { ...field };\r\n\r\n\t\t\tfor (let action of actions) {\r\n\t\t\t\tif (field.ref && field.ref == action.ref) {\r\n\t\t\t\t\tif (typeof action.value == \"string\" && field.type == \"boolean\")\r\n\t\t\t\t\t\taction.value = action.value == \"true\";\r\n\r\n\t\t\t\t\tnewField[action.prop] = action.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tnewFormFields[i] = newField;\r\n\t\t}\r\n\r\n\t\treturn newFormFields;\r\n\t}, initialFormFields);\r\n\r\n\tfunction resetFields() {\r\n\t\tvar updates = [];\r\n\r\n\t\tfor (let field of initFields) {\r\n\t\t\tupdates.push({\r\n\t\t\t\tref: field.ref,\r\n\t\t\t\tprop: \"value\",\r\n\t\t\t\tvalue: field.value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tupdateFields(updates);\r\n\t}\r\n\r\n\treturn [fields, updateFields, resetFields];\r\n}\r\n\r\nexport function SearchSelect(props) {\r\n\tconst value = props.value;\r\n\tconst setValue = props.setValue;\r\n\r\n\tconst [inputValue, setInputValue] = useState(\"\");\r\n\tconst [optionsVisible, setOptionsVisible] = useState(false);\r\n\tconst [hoveringOptions, setHoveringOptions] = useState(false);\r\n\tconst [matchingOptions, setMatchingOptions] = useState(props.options);\r\n\tconst searchSelectRef = useRef();\r\n\tconst optionsRef = useRef();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!optionsVisible)\r\n\t\t\treturn;\r\n\r\n\t\tconst searchSelectRect = searchSelectRef.current.getBoundingClientRect();\r\n\t\tconst optionsRect = optionsRef.current.getBoundingClientRect();\r\n\r\n\t\tvar optionsTop = searchSelectRect.top + searchSelectRect.height + 1;\r\n\r\n\t\tif (optionsTop + optionsRect.height > window.innerHeight)\r\n\t\t\toptionsTop = searchSelectRect.top - optionsRect.height - 2;\r\n\r\n\t\toptionsRef.current.style.top = optionsTop + \"px\";\r\n\t\toptionsRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (inputValue == \"\")\r\n\t\t\tsetMatchingOptions(props.options);\r\n\t\telse {\r\n\t\t\tvar options = props.options.filter(option => (\r\n\t\t\t\toption.toLowerCase().includes(inputValue.toLowerCase())\r\n\t\t\t));\r\n\r\n\t\t\tsetMatchingOptions(options);\r\n\t\t}\r\n\t}, [inputValue, props.options]);\r\n\r\n\tconst options = matchingOptions.map(option => (\r\n\t\t<div\r\n\t\t\tclassName=\"option-row\"\r\n\t\t\tonClick={() => onOptionClick(option)}\r\n\t\t\tkey={option}>\r\n\t\t\t{option}\r\n\t\t</div>\r\n\t));\r\n\r\n\tfunction onOptionClick(option) {\r\n\t\tsetValue(option);\r\n\t\tsetInputValue(\"\");\r\n\t\tsetOptionsVisible(false);\r\n\t\tsetHoveringOptions(false);\r\n\r\n\t\tif (props.onChange)\r\n\t\t\tprops.onChange(option);\r\n\t}\r\n\r\n\tfunction onKeyDown(e) {\r\n\t\tif (e.key == \"Enter\") {\r\n\t\t\tsetValue(matchingOptions[0]);\r\n\t\t\tsetInputValue(\"\");\r\n\t\t\tsetOptionsVisible(false);\r\n\t\t\tsetHoveringOptions(false);\r\n\r\n\t\t\tif (props.onChange)\r\n\t\t\t\tprops.onChange(matchingOptions[0]);\r\n\t\t}\r\n\t\telse if (!optionsVisible)\r\n\t\t\tsetOptionsVisible(true);\r\n\t}\r\n\r\n\tfunction onMouseEnterOptionsList() {\r\n\t\tsetHoveringOptions(true);\r\n\t}\r\n\r\n\tfunction onMouseLeaveOptionsList() {\r\n\t\tsetHoveringOptions(false);\r\n\t}\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tsetInputValue(e.target.value);\r\n\r\n\t\tif (props.onInputChange)\r\n\t\t\tprops.onInputChange(e);\r\n\t}\r\n\r\n\tfunction onSelectFocus() {\r\n\t\tsetOptionsVisible(true);\r\n\t}\r\n\r\n\tfunction onSelectBlur() {\r\n\t\tif (hoveringOptions)\r\n\t\t\treturn;\r\n\r\n\t\tsetOptionsVisible(false);\r\n\t\tsetInputValue(\"\");\r\n\t\tsetMatchingOptions(props.options);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"search-select\"\r\n\t\t\ttabIndex=\"0\"\r\n\t\t\tonFocus={onSelectFocus}\r\n\t\t\tonBlur={onSelectBlur}\r\n\t\t\tref={searchSelectRef}>\r\n\t\t\t<input\r\n\t\t\t\tvalue={inputValue}\r\n\t\t\t\tplaceholder={value || props.placeholder}\r\n\t\t\t\tonChange={onInputChange}\r\n\t\t\t\tonKeyDown={onKeyDown} />\r\n\t\t\t<div className=\"icon-wrapper\">\r\n\t\t\t\t<i className=\"fas fa-chevron-down\" />\r\n\t\t\t</div>\r\n\t\t\t{optionsVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"option-list\"\r\n\t\t\t\t\tonMouseEnter={onMouseEnterOptionsList}\r\n\t\t\t\t\tonMouseLeave={onMouseLeaveOptionsList}\r\n\t\t\t\t\tref={optionsRef}>\r\n\t\t\t\t\t{options.length > 0 &&\r\n\t\t\t\t\t\toptions\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{!options.length &&\r\n\t\t\t\t\t\t<div className=\"no-options\">\r\n\t\t\t\t\t\t\tNo Options\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserSearchSelect(props) {\r\n\tconst [options, setOptions] = useState([]);\r\n\tconst [idMap, setIdMap] = useState({});\r\n\tconst [query, setQuery] = useState(\"\");\r\n\tconst [valueName, setValueName] = useState(\"\");\r\n\r\n\tuseEffect(() => {\r\n\t\tif (query.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/searchName?query=${query}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar newIdMap = {};\r\n\r\n\t\t\t\tfor (let userData of res.data)\r\n\t\t\t\t\tnewIdMap[userData.name] = userData.id;\r\n\r\n\t\t\t\tsetIdMap(newIdMap);\r\n\t\t\t\tsetOptions(res.data.map(user => user.name));\r\n\t\t\t})\r\n\t\t\t.catch(useErrorAlert);\r\n\t}, [query]);\r\n\r\n\tfunction setValue(option) {\r\n\t\tsetValueName(option);\r\n\t\tprops.setValue(idMap[option]);\r\n\t}\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tsetQuery(e.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<SearchSelect\r\n\t\t\t{...props}\r\n\t\t\toptions={options}\r\n\t\t\tvalue={valueName}\r\n\t\t\tsetValue={setValue}\r\n\t\t\tonInputChange={onInputChange} />\r\n\t);\r\n}\r\n\r\nexport function TextEditor(props) {\r\n\tconst [tab, setTab] = useState(\"write\");\r\n\r\n\treturn (\r\n\t\t<ReactMde\r\n\t\t\tvalue={props.value}\r\n\t\t\tonChange={props.onChange}\r\n\t\t\tselectedTab={tab}\r\n\t\t\tonTabChange={setTab}\r\n\t\t\tclasses={{ \"preview\": \"md-content\" }}\r\n\t\t\tgenerateMarkdownPreview={\r\n\t\t\t\t(markdown) => Promise.resolve(<ReactMarkdown source={markdown} />)\r\n\t\t\t} />\r\n\t);\r\n}","import React from \"react\";\r\nimport ReactLoading from \"react-loading\";\r\n\r\nexport default function LoadingPage(props) {\r\n\treturn (\r\n\t\t<div className={`loading-page ${props.className || \"\"}`}>\r\n\t\t\t<ReactLoading type=\"bars\" color=\"#ffffff\" />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function LoadingIcon() {\r\n\treturn (\r\n\t\t<div className=\"loading-page\">\r\n\t\t\t<ReactLoading type=\"bars\" color=\"#ffffff\" width=\"50\" height=\"50\" />\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from \"react\";\r\n\r\nimport { useOnOutsideClick } from \"./Basic\";\r\n\r\nexport default function Dropdown(props) {\r\n\tconst [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef] = useDropdown();\r\n\tconst selOption = props.options.filter(option => option == props.value || option.id == props.value)[0];\r\n\tconst selLabel = selOption ? selOption.label || selOption : \"\";\r\n\r\n\tconst menuItems = props.options.map(option => {\r\n\t\tif (option == \"divider\")\r\n\t\t\treturn (<div className=\"dropdown-divider\" />);\r\n\r\n\t\tif (typeof option == \"string\")\r\n\t\t\toption = { id: option, label: option };\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"dropdown-menu-option\"\r\n\t\t\t\tkey={option.id}\r\n\t\t\t\tonClick={() => onMenuItemClick(option.id)}>\r\n\t\t\t\t{option.label} {option.placeholder}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\r\n\tfunction onMenuItemClick(optionId) {\r\n\t\tsetMenuVisible(false);\r\n\t\tprops.onChange(optionId);\r\n\t}\r\n\r\n\tfunction onControlClick() {\r\n\t\tsetMenuVisible(!menuVisible);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`dropdown ${props.className || \"\"}`}\r\n\t\t\tref={dropdownContainerRef}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"dropdown-control\"\r\n\t\t\t\tonClick={onControlClick}>\r\n\t\t\t\t{props.icon}\r\n\t\t\t\t{selLabel}\r\n\t\t\t\t{props.caret &&\r\n\t\t\t\t\t<i className=\"fas fa-caret-down\" />\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t{menuVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"dropdown-menu\"\r\n\t\t\t\t\tref={dropdownMenuRef}>\r\n\t\t\t\t\t{menuItems}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useDropdown() {\r\n\tconst [menuVisible, setMenuVisible] = useState(false);\r\n\tconst dropdownContainerRef = useRef();\r\n\tconst dropdownMenuRef = useRef();\r\n\r\n\tuseOnOutsideClick([dropdownMenuRef, dropdownContainerRef], () => setMenuVisible(false));\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!menuVisible)\r\n\t\t\treturn;\r\n\r\n\t\tconst containerRect = dropdownContainerRef.current.getBoundingClientRect();\r\n\t\tconst menuRect = dropdownMenuRef.current.getBoundingClientRect();\r\n\r\n\t\tvar menuLeft = containerRect.left;\r\n\t\tvar menuTop = containerRect.top + containerRect.height + 1 + window.scrollY;\r\n\t\tvar menuHorzShift = window.innerWidith - (menuLeft + menuRect.width);\r\n\r\n\t\tif (menuTop + menuRect.height - window.scrollY > window.innerHeight)\r\n\t\t\tmenuTop = containerRect.top - menuRect.height - 2;\r\n\r\n\t\tif (menuHorzShift < 0) {\r\n\t\t\tif (menuLeft + menuHorzShift < 0)\r\n\t\t\t\tmenuHorzShift -= (menuLeft + menuHorzShift);\r\n\t\t}\r\n\t\telse \r\n\t\t\tmenuHorzShift = 0;\r\n\r\n\t\tdropdownMenuRef.current.style.left = menuLeft + \"px\";\r\n\t\tdropdownMenuRef.current.style.top = menuTop + \"px\";\r\n\t\tdropdownMenuRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\treturn [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef];\r\n}","import React, { useState, useEffect, useReducer } from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nimport Dropdown from \"./Dropdown\";\r\nimport { camelCase } from \"../utils\";\r\n\r\nimport \"../css/nav.css\"\r\n\r\nexport function Nav(props) {\r\n\treturn (\r\n\t\t<div className=\"nav\">\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SubNav(props) {\r\n\tconst links = props.links.map((link, i) => {\r\n\t\treturn (!link.hide &&\r\n\t\t\t<NavLink\r\n\t\t\t\texact={link.exact}\r\n\t\t\t\tto={link.path}\r\n\t\t\t\tkey={link.path}>\r\n\t\t\t\t{link.text}\r\n\t\t\t</NavLink>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"sub-nav\">\r\n\t\t\t{links}\r\n\t\t\t{props.showFilter &&\r\n\t\t\t\t<div className=\"filter\">\r\n\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\tvalue={props.filterSel}\r\n\t\t\t\t\t\toptions={props.filterOptions}\r\n\t\t\t\t\t\tonChange={props.onFilter}\r\n\t\t\t\t\t\ticon={props.filterIcon}\r\n\t\t\t\t\t\tcaret />\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ButtonGroup(props) {\r\n\tconst sel = camelCase(props.sel);\r\n\tconst buttons = props.buttons.map((button, i) => {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`btn ${sel == camelCase(button) ? \"btn-sel\" : \"\"}`}\r\n\t\t\t\tonClick={() => props.onClick(button)}\r\n\t\t\t\tkey={i}>\r\n\t\t\t\t{button}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"btn-group\">\r\n\t\t\t{buttons}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PageNav(props) {\r\n\tconst page = props.page;\r\n\tconst maxPage = props.maxPage;\r\n\tconst range = props.range || 5;\r\n\tconst onNav = props.onNav;\r\n\tconst inverted = props.inverted;\r\n\tconst noRange = maxPage == null;\r\n\r\n\tconst [pages, updatePages] = useReducer(\r\n\t\t() => {\r\n\t\t\tif (noRange)\r\n\t\t\t\treturn [page];\r\n\r\n\t\t\tvar sel = page <= maxPage ? page : 1;\r\n\t\t\tvar i = sel;\r\n\t\t\tvar j = sel + 1;\r\n\t\t\tvar list = [];\r\n\t\t\tvar changed = true;\r\n\r\n\t\t\twhile (changed) {\r\n\t\t\t\tchanged = false;\r\n\r\n\t\t\t\tif (list.length < range && i >= 1) {\r\n\t\t\t\t\tlist.unshift(i--);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (list.length < range && j <= maxPage) {\r\n\t\t\t\t\tlist.push(j++);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\tmaxPage,\r\n\t\t(pages) => {\r\n\t\t\tif (noRange)\r\n\t\t\t\treturn [1];\r\n\r\n\t\t\tvar list = [];\r\n\r\n\t\t\tfor (let i = 0; i < pages; i++)\r\n\t\t\t\tlist.push(i + 1);\r\n\r\n\t\t\treturn list;\r\n\t\t}\r\n\t);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdatePages();\r\n\t}, [page, range, maxPage]);\r\n\r\n\tfunction onClick(page) {\r\n\t\tif (page >= 1 && (noRange || page <= maxPage))\r\n\t\t\tonNav(page);\r\n\t}\r\n\r\n\tconst pageNums = pages.map(page => {\r\n\t\tvar className = \"page-num\";\r\n\r\n\t\tif (props.page == page)\r\n\t\t\tclassName += \" page-sel\";\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={className}\r\n\t\t\t\tonClick={() => onClick(page)}\r\n\t\t\t\tkey={page}>\r\n\t\t\t\t{page}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className={`page-nav ${inverted ? \"inverted\" : \"\"}`}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"page-nav-left max\"\r\n\t\t\t\tonClick={() => onClick(1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"page-nav-left\"\r\n\t\t\t\tonClick={() => onClick(page - 1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t{pageNums}\r\n\t\t\t<div\r\n\t\t\t\tclassName={`page-nav-right ${noRange ? \"max\" : \"\"}`}\r\n\t\t\t\tonClick={() => onClick(page + 1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t{!noRange &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"page-nav-right max\"\r\n\t\t\t\t\tonClick={() => onClick(maxPage)}>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function getPageNavFilterArg(newPage, oldPage, pageItems, sortField) {\r\n\tvar filterArg;\r\n\r\n\tif (newPage == 1)\r\n\t\tfilterArg = \"last=Infinity\";\r\n\telse if (newPage < oldPage && pageItems.length != 0)\r\n\t\tfilterArg = `first=${pageItems[0][sortField]}`;\r\n\telse if (newPage > oldPage && pageItems.length != 0)\r\n\t\tfilterArg = `last=${pageItems[pageItems.length - 1][sortField]}`;\r\n\telse\r\n\t\treturn;\r\n\r\n\treturn filterArg;\r\n}\r\n\r\nexport function SearchBar(props) {\r\n\tfunction onInput(event) {\r\n\t\tprops.onInput(event.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"search-bar\">\r\n\t\t\t<input\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\tvalue={props.value}\r\n\t\t\t\tplaceholder={props.placeholder}\r\n\t\t\t\tonChange={onInput} />\r\n\t\t\t<div className=\"search-icon\">\r\n\t\t\t\t<i className=\"fas fa-search\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport \"../css/landing.css\"\r\n\r\nexport default function LandingPage(props) {\r\n\treturn (\r\n\t\t<div className=\"span-panel main landing-page\">\r\n\t\t\t<div className=\"banner\">\r\n\t\t\t\t<div className=\"logo\" />\r\n\t\t\t\t<div className=\"characters-circle\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"play-break\">\r\n\t\t\t\t<div className=\"play-btn-wrapper\">\r\n\t\t\t\t\t<Link to=\"/auth/signup\">\r\n\t\t\t\t\t\tPlay Mafia\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"intro\">\r\n\t\t\t\tBeyondMafia is the mafia site that is revolutionary in design, safety, and has a thriving community of users from all walks of life. With competitive and casual live mafia, and other gamemodes like Resistance, you're sure to find something that suits how YOU want to play.\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mafia-features\">\r\n\t\t\t\t<div className=\"chat-mafia\">\r\n\t\t\t\t\t<div className=\"village-character\" />\r\n\t\t\t\t\t<div className=\"feature-title\">Chat Mafia</div>\r\n\t\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\t\t10-20 minute games with a variety of roles! Play wiht classic roles, or try out something different in the Sandbox lobby. You can create your own custom roles, too, using modifiers or by contributing to the open source codebase!\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-mafia\">\r\n\t\t\t\t\t<div className=\"cop-character\" />\r\n\t\t\t\t\t<div className=\"feature-title\">Forum Mafia</div>\r\n\t\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\t\tPlay Mafia in the forums. More features are coming soon with the planned forum game engine!\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"other-games\">\r\n\t\t\t\t<div className=\"other-games-img\" />\r\n\t\t\t\t<div className=\"feature-title\">Other Games</div>\r\n\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\tExplore other Mafia-esque games like Resistance, One Night Ultimate Werewolf, and 2 Rooms and a Boom.\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"play-break\">\r\n\t\t\t\t<div className=\"play-btn-wrapper\">\r\n\t\t\t\t\t<Link to=\"/auth/signup\">\r\n\t\t\t\t\t\tPlay Mafia\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Time } from \"../../../components/Basic\";\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { ViewsAndReplies } from \"./Forums\";\r\n\r\nexport default function Categories(props) {\r\n\tconst [categoryInfo, setCategoryInfo] = useState([]);\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Categories | BeyondMafia\";\r\n\t\tprops.updateForumNavInfo({ action: \"home\" });\r\n\r\n\t\taxios.get(\"/forums/categories\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar categories = res.data.sort(sortItems);\r\n\r\n\t\t\t\tfor (let category of categories)\r\n\t\t\t\t\tcategory.boards = category.boards.sort(sortItems);\r\n\r\n\t\t\t\tsetCategoryInfo(categories);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"home\"\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}, []);\r\n\r\n\tfunction sortItems(a, b) {\r\n\t\treturn a.position - b.position;\r\n\t}\r\n\r\n\tconst categories = categoryInfo.map(category => {\r\n\t\tconst boards = category.boards.map(board => {\r\n\t\t\tconst newestThreads = board.newestThreads.map(thread => (\r\n\t\t\t\t<div className=\"column-item\" key={thread.id}>\r\n\t\t\t\t\t<div className=\"thread-link-wrapper\">\r\n\t\t\t\t\t\t<Link to={`/community/forums/thread/${thread.id}`}>\r\n\t\t\t\t\t\t\t{thread.title}\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={thread.author.id}\r\n\t\t\t\t\t\tname={thread.author.name}\r\n\t\t\t\t\t\tavatar={thread.author.avatar} />\r\n\t\t\t\t\t<div className=\"thread-counts\">\r\n\t\t\t\t\t\t<ViewsAndReplies\r\n\t\t\t\t\t\t\tviewCount={thread.viewCount || 0}\r\n\t\t\t\t\t\t\treplyCount={thread.replyCount || 0} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t));\r\n\r\n\t\t\tconst recentReplies = board.recentReplies.map(reply => (\r\n\t\t\t\t<div className=\"column-item\" key={reply.id}>\r\n\t\t\t\t\t<div className=\"thread-link-wrapper\">\r\n\t\t\t\t\t\t<Link to={`/community/forums/thread/${reply.thread.id}?reply=${reply.id}`}>\r\n\t\t\t\t\t\t\t{reply.thread.title}\r\n\t\t\t\t\t\t</Link>\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={reply.author.id}\r\n\t\t\t\t\t\tname={reply.author.name}\r\n\t\t\t\t\t\tavatar={reply.author.avatar} />\r\n\t\t\t\t\t<div className=\"reply-age\">\r\n\t\t\t\t\t\t<Time millisec={Date.now() - reply.postDate} />\r\n\t\t\t\t\t\t{` ago`}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t));\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"board\" key={board.id}>\r\n\t\t\t\t\t<i className={`fas fa-${board.icon || \"comments\"} board-icon`} />\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tclassName=\"board-info\"\r\n\t\t\t\t\t\tto={`/community/forums/board/${board.id}`}>\r\n\t\t\t\t\t\t<div className=\"board-name\">\r\n\t\t\t\t\t\t\t{board.name}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"board-desc\">\r\n\t\t\t\t\t\t\t{board.description}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<div className=\"forum-column tall\">\r\n\t\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\t\tNewest Thread\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={`column-content ${newestThreads.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t\t{newestThreads.length == 0 &&\r\n\t\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\t\tNo threads yet\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{newestThreads}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"forum-column tall three\">\r\n\t\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\t\tRecent Replies\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={`column-content ${recentReplies.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t\t{recentReplies.length == 0 &&\r\n\t\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\t\tNo replies yet\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{recentReplies}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"span-panel forum-category\" key={category.id}>\r\n\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t{category.name}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"boards\">\r\n\t\t\t\t\t{boards}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn categories;\r\n}","import React, { } from \"react\";\r\n\r\nimport \"../css/modal.css\";\r\n\r\nexport function Modal(props) {\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{props.show &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclassName=\"modal-bg\"\r\n\t\t\t\t\t\tonClick={props.onBgClick} />\r\n\t\t\t\t\t<div className={`modal ${props.className ? props.className : \"\"}`}>\r\n\t\t\t\t\t\t<div className=\"modal-header\">\r\n\t\t\t\t\t\t\t{props.header}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"modal-content\">\r\n\t\t\t\t\t\t\t{props.content}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"modal-footer\">\r\n\t\t\t\t\t\t\t{props.footer}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useParams, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../../components/Nav\";\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Modal } from \"../../../components/Modal\";\r\nimport { VoteWidget, ViewsAndReplies } from \"./Forums\";\r\nimport { TextEditor } from \"../../../components/Form\";\r\nimport { Time } from \"../../../components/Basic\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nexport default function Board(props) {\r\n\tconst [boardInfo, setBoardInfo] = useState({});\r\n\tconst [showCreateModal, setShowCreateModal] = useState(false);\r\n\tconst [newThreadTitle, setNewThreadTitle] = useState(\"\");\r\n\tconst [newThreadContent, setNewThreadContent] = useState(\"\");\r\n\tconst [boardPage, setBoardPage] = useState(1);\r\n\tconst [sortType, setSortType] = useState(\"bumpDate\");\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [redirect, setRedirect] = useState();\r\n\r\n\tconst { boardId } = useParams();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Mafia Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.get(`/forums/board/${boardId}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetBoardInfo(res.data);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tdocument.title = `${res.data.name} | BeyondMafia`;\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"board\",\r\n\t\t\t\t\tid: boardId,\r\n\t\t\t\t\tname: res.data.name\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t\tsetRedirect(\"/community/forums\");\r\n\t\t\t});\r\n\t}, [boardId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (loaded) {\r\n\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\taction: \"board\",\r\n\t\t\t\tid: boardInfo.id,\r\n\t\t\t\tname: boardInfo.name\r\n\t\t\t});\r\n\t\t}\r\n\t}, [loaded, boardInfo]);\r\n\r\n\tfunction onCreateThreadClick() {\r\n\t\tsetShowCreateModal(true);\r\n\t}\r\n\r\n\tfunction onBoardPageNav(page) {\r\n\t\tvar filterArg = getPageNavFilterArg(page, boardPage, boardInfo.threads, sortType);\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/forums/board/${boardId}?sortType=${sortType}&${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.threads.length > 0) {\r\n\t\t\t\t\tsetBoardInfo(res.data);\r\n\t\t\t\t\tsetBoardPage(page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction threadRowsMap(thread) {\r\n\t\tconst recentReplies = thread.recentReplies.map(reply => (\r\n\t\t\t<div className=\"column-item\" key={reply.id}>\r\n\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\tsmall\r\n\t\t\t\t\tid={reply.author.id}\r\n\t\t\t\t\tname={reply.author.name}\r\n\t\t\t\t\tavatar={reply.author.avatar} />\r\n\t\t\t\t<Link\r\n\t\t\t\t\tclassName=\"reply-age\"\r\n\t\t\t\t\tto={`/community/forums/thread/${thread.id}?reply=${reply.id}`}>\r\n\t\t\t\t\t<Time millisec={Date.now() - reply.postDate} />\r\n\t\t\t\t\t{` ago`}\r\n\t\t\t\t</Link>\r\n\t\t\t</div>\r\n\t\t));\r\n\r\n\t\treturn (\r\n\t\t\t<div className={`thread ${thread.deleted ? \"deleted\" : \"\"}`} key={thread.id}>\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={thread}\r\n\t\t\t\t\titemType=\"thread\"\r\n\t\t\t\t\titemHolder={boardInfo}\r\n\t\t\t\t\tsetItemHolder={setBoardInfo}\r\n\t\t\t\t\titemKey=\"threads\" />\r\n\t\t\t\t<div className=\"thread-info\">\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tclassName=\"thread-title\"\r\n\t\t\t\t\t\tto={`/community/forums/thread/${thread.id}`}>\r\n\t\t\t\t\t\t{thread.locked &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{thread.pinned &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-thumbtack\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{thread.title}\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={thread.author.id}\r\n\t\t\t\t\t\tavatar={thread.author.avatar}\r\n\t\t\t\t\t\tname={thread.author.name}\r\n\t\t\t\t\t\tgroups={thread.author.groups} />\r\n\t\t\t\t\t<div className=\"counts\">\r\n\t\t\t\t\t\t<ViewsAndReplies\r\n\t\t\t\t\t\t\tviewCount={thread.viewCount || 0}\r\n\t\t\t\t\t\t\treplyCount={thread.replyCount || 0} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-column\">\r\n\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\tPost Date\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"column-content\">\r\n\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t<Time millisec={Date.now() - thread.postDate} />\r\n\t\t\t\t\t\t\t{` ago`}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-column three\">\r\n\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\tRecent Replies\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className={`column-content ${recentReplies.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t{recentReplies.length == 0 &&\r\n\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\tNo replies yet\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{recentReplies}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tif (redirect)\r\n\t\treturn <Redirect to={redirect} />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tconst threads = boardInfo.threads.map(threadRowsMap);\r\n\tconst pinnedThreads = boardInfo.pinnedThreads.map(threadRowsMap);\r\n\r\n\treturn (\r\n\t\t<div className=\"board-wrapper\">\r\n\t\t\t<CreateThreadModal\r\n\t\t\t\tboardId={boardId}\r\n\t\t\t\tshow={showCreateModal}\r\n\t\t\t\tsetShow={setShowCreateModal}\r\n\t\t\t\tthreadTitle={newThreadTitle}\r\n\t\t\t\tsetThreadTitle={setNewThreadTitle}\r\n\t\t\t\tthreadContent={newThreadContent}\r\n\t\t\t\tsetThreadContent={setNewThreadContent}\r\n\t\t\t\tsetRedirect={setRedirect} />\r\n\t\t\t<div className=\"board-info\">\r\n\t\t\t\t<div className=\"board-title-wrapper\">\r\n\t\t\t\t\t<i className={`fas fa-${boardInfo.icon || \"comments\"} board-icon`} />\r\n\t\t\t\t\t<div className=\"board-title\">\r\n\t\t\t\t\t\t{boardInfo.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"create-thread btn btn-theme\"\r\n\t\t\t\t\tonClick={onCreateThreadClick}\r\n\t\t\t\t\tdisabled={!user.perms.createThread}>\r\n\t\t\t\t\t<i className=\"fas fa-plus\" />\r\n\t\t\t\t\tCreate Thread\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{pinnedThreads.length > 0 &&\r\n\t\t\t\t<div className=\"threads pinned-threads span-panel\">\r\n\t\t\t\t\t{pinnedThreads}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t<PageNav\r\n\t\t\t\tinverted\r\n\t\t\t\tpage={boardPage}\r\n\t\t\t\tonNav={onBoardPageNav} />\r\n\t\t\t<div className=\"threads span-panel\">\r\n\t\t\t\t{threads.length > 0 &&\r\n\t\t\t\t\tthreads\r\n\t\t\t\t}\r\n\t\t\t\t{threads.length == 0 &&\r\n\t\t\t\t\t\"No threads yet\"\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<PageNav\r\n\t\t\t\tinverted\r\n\t\t\t\tpage={boardPage}\r\n\t\t\t\tonNav={onBoardPageNav} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction CreateThreadModal(props) {\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst header = \"Create Thread\";\r\n\r\n\tconst content = (\r\n\t\t<div className=\"form\">\r\n\t\t\t<div className=\"field-wrapper thread-title\">\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tTitle\r\n\t\t\t\t</div>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={props.threadTitle}\r\n\t\t\t\t\tonChange={onTitleChange} />\r\n\t\t\t</div>\r\n\t\t\t<TextEditor\r\n\t\t\t\tvalue={props.threadContent}\r\n\t\t\t\tonChange={props.setThreadContent} />\r\n\t\t</div>\r\n\t);\r\n\r\n\tconst footer = (\r\n\t\t<div className=\"control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"post btn btn-theme\"\r\n\t\t\t\tonClick={onPostThread}>\r\n\t\t\t\tPost\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={onCancel}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tfunction onTitleChange(e) {\r\n\t\tprops.setThreadTitle(e.target.value);\r\n\t}\r\n\r\n\tfunction onCancel() {\r\n\t\tprops.setShow(false);\r\n\t}\r\n\r\n\tfunction onPostThread() {\r\n\t\taxios.post(\"/forums/thread\", {\r\n\t\t\tboard: props.boardId,\r\n\t\t\ttitle: props.threadTitle,\r\n\t\t\tcontent: props.threadContent\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tprops.setShow(false);\r\n\t\t\t\tprops.setRedirect(`/community/forums/thread/${res.data}`);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\tclassName=\"create-thread\"\r\n\t\t\tshow={props.show}\r\n\t\t\tonBgClick={onCancel}\r\n\t\t\theader={header}\r\n\t\t\tcontent={content}\r\n\t\t\tfooter={footer} />\r\n\t);\r\n}","import React, { useState, useEffect, useRef, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Redirect, Link, useParams, useLocation } from \"react-router-dom\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { VoteWidget } from \"./Forums\";\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Time, filterProfanity } from \"../../../components/Basic\";\r\nimport { PageNav } from \"../../../components/Nav\";\r\nimport { TextEditor } from \"../../../components/Form\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nexport default function Thread(props) {\r\n\tconst [threadInfo, setThreadInfo] = useState({});\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [redirect, setRedirect] = useState();\r\n\tconst [showReplyForm, setShowReplyForm] = useState(false);\r\n\tconst [replyContent, setReplyContent] = useState(\"\");\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [scrolled, setScrolled] = useState(false);\r\n\r\n\tconst replyFormRef = useRef();\r\n\tconst { threadId } = useParams();\r\n\tconst location = useLocation();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tconst params = new URLSearchParams(location.search);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Forums | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.get(`/forums/thread/${threadId}?reply=${params.get(\"reply\") || \"\"}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tres.data.content = filterProfanity(res.data.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tfor (let reply of res.data.replies)\r\n\t\t\t\t\treply.content = filterProfanity(reply.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tsetThreadInfo(res.data);\r\n\t\t\t\tsetPage(res.data.page);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"thread\",\r\n\t\t\t\t\tboardId: res.data.board.id,\r\n\t\t\t\t\tboardName: res.data.board.name,\r\n\t\t\t\t\tthreadId: res.data.id,\r\n\t\t\t\t\tthreadTitle: res.data.title\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t\tsetRedirect(\"/community/forums\");\r\n\t\t\t});\r\n\t}, [threadId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (loaded) {\r\n\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\taction: \"boardAndThread\",\r\n\t\t\t\tboardId: threadInfo.board.id,\r\n\t\t\t\tboardName: threadInfo.board.name,\r\n\t\t\t\tthreadId: threadInfo.id,\r\n\t\t\t\tthreadTitle: threadInfo.title\r\n\t\t\t});\r\n\r\n\t\t\tif (scrolled || !params.get(\"reply\"))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar reply = document.getElementById(`reply-${params.get(\"reply\")}`);\r\n\t\t\tsetScrolled(true);\r\n\r\n\t\t\tif (reply)\r\n\t\t\t\treply.scrollIntoView();\r\n\t\t}\r\n\t}, [loaded, threadInfo]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (showReplyForm)\r\n\t\t\treplyFormRef.current.scrollIntoView();\r\n\t}, [showReplyForm]);\r\n\r\n\tfunction onReplyClick(reply) {\r\n\t\tif (threadInfo.locked && !user.perms.postInLocked)\r\n\t\t\treturn;\r\n\r\n\t\tsetShowReplyForm(true);\r\n\r\n\t\tif (reply) {\r\n\t\t\tvar newContent = `${replyContent}\\n\\n> ##### @${reply.author.name}:\\n`;\r\n\t\t\tvar quotedContent = reply.content.split(\"\\n\");\r\n\r\n\t\t\tfor (let i = 0; i < quotedContent.length; i++)\r\n\t\t\t\tquotedContent[i] = `> ${quotedContent[i]}`;\r\n\r\n\t\t\tnewContent = `${newContent}${quotedContent.join(\"\\n\")}\\n\\n`;\r\n\t\t\tsetReplyContent(newContent);\r\n\t\t}\r\n\r\n\t\tif (showReplyForm)\r\n\t\t\treplyFormRef.current.scrollIntoView();\r\n\t}\r\n\r\n\tfunction onPostReply() {\r\n\t\taxios.post(`/forums/reply`, {\r\n\t\t\tthread: threadInfo.id,\r\n\t\t\tcontent: replyContent\r\n\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tonThreadPageNav(Number(res.data));\r\n\t\t\t\tsetReplyContent(\"\");\r\n\t\t\t\tsetShowReplyForm(false);\r\n\r\n\t\t\t\tdocument.body.scrollTop = document.body.scrollHeight;\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostCancel() {\r\n\t\tsetShowReplyForm(false);\r\n\t\tsetReplyContent(\"\");\r\n\t}\r\n\r\n\tfunction onThreadPageNav(page) {\r\n\t\taxios.get(`/forums/thread/${threadId}?page=${page}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tres.data.content = filterProfanity(res.data.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tfor (let reply of res.data.replies)\r\n\t\t\t\t\treply.content = filterProfanity(reply.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tsetPage(page);\r\n\t\t\t\tsetThreadInfo(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onThreadDeleted() {\r\n\t\tsetRedirect(`/community/forums/board/${threadInfo.board.id}`);\r\n\t}\r\n\r\n\tfunction onNotifyToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\treplyNotify: {\r\n\t\t\t\t$set: !threadInfo.replyNotify\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tfunction onPinToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\tpinned: {\r\n\t\t\t\t$set: !threadInfo.pinned\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tfunction onLockToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\tlocked: {\r\n\t\t\t\t$set: !threadInfo.locked\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tif (redirect)\r\n\t\treturn <Redirect to={redirect} />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tconst replies = threadInfo.replies.map(reply => (\r\n\t\t<Post\r\n\t\t\tclassName={`reply ${reply.id == params.get(\"reply\") ? \"sel\" : \"\"}`}\r\n\t\t\tid={`reply-${reply.id}`}\r\n\t\t\tkey={reply.id}\r\n\t\t\tpostInfo={reply}\r\n\t\t\titemType=\"reply\"\r\n\t\t\tvoteItem={reply}\r\n\t\t\tvoteItemHolder={threadInfo}\r\n\t\t\tsetVoteItemHolder={setThreadInfo}\r\n\t\t\titemKey=\"replies\"\r\n\t\t\tlocked={threadInfo.locked}\r\n\t\t\tpermaLink={`/community/forums/thread/${threadId}?reply=${reply.id}`}\r\n\t\t\tonReplyClick={() => onReplyClick(reply)}\r\n\t\t\tonDelete={() => onThreadPageNav(page)}\r\n\t\t\tonRestore={() => onThreadPageNav(page)}\r\n\t\t\tonEdit={() => onThreadPageNav(page)} />\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"thread-wrapper\">\r\n\t\t\t<Post\r\n\t\t\t\tpostInfo={threadInfo}\r\n\t\t\t\titemType=\"thread\"\r\n\t\t\t\tvoteItem={threadInfo}\r\n\t\t\t\tsetVoteItemHolder={setThreadInfo}\r\n\t\t\t\tlocked={threadInfo.locked}\r\n\t\t\t\tonReplyClick={() => onReplyClick()}\r\n\t\t\t\tonDelete={onThreadDeleted}\r\n\t\t\t\tonRestore={() => onThreadPageNav(page)}\r\n\t\t\t\tonEdit={() => onThreadPageNav(page)}\r\n\t\t\t\tonNotifyToggled={onNotifyToggled}\r\n\t\t\t\tonPinToggled={onPinToggled}\r\n\t\t\t\tonLockToggled={onLockToggled}\r\n\t\t\t\thasTitle />\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"reply-form-wrapper\"\r\n\t\t\t\tref={replyFormRef}>\r\n\t\t\t\t{showReplyForm &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"reply-form span-panel\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={replyContent}\r\n\t\t\t\t\t\t\tonChange={setReplyContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onPostReply}>\r\n\t\t\t\t\t\t\t\tPost\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onPostCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"replies-wrapper\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tmaxPage={threadInfo.pageCount}\r\n\t\t\t\t\tonNav={onThreadPageNav} />\r\n\t\t\t\t<div className=\"replies\">\r\n\t\t\t\t\t{replies.length == 0 &&\r\n\t\t\t\t\t\t\"No replies yet\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{replies}\r\n\t\t\t\t</div>\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tmaxPage={threadInfo.pageCount}\r\n\t\t\t\t\tonNav={onThreadPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Post(props) {\r\n\tconst id = props.id;\r\n\tconst postInfo = props.postInfo;\r\n\tconst itemType = props.itemType;\r\n\tconst voteItem = props.voteItem;\r\n\tconst voteItemHolder = props.voteItemHolder;\r\n\tconst setVoteItemHolder = props.setVoteItemHolder;\r\n\tconst itemKey = props.itemKey;\r\n\tconst hasTitle = props.hasTitle;\r\n\tconst permaLink = props.permaLink;\r\n\tconst locked = props.locked;\r\n\tconst onReplyClick = props.onReplyClick;\r\n\tconst onDelete = props.onDelete;\r\n\tconst onRestore = props.onRestore;\r\n\tconst onEdit = props.onEdit;\r\n\tconst onNotifyToggled = props.onNotifyToggled;\r\n\tconst onPinToggled = props.onPinToggled;\r\n\tconst onLockToggled = props.onLockToggled;\r\n\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [editContent, setEditContent] = useState(postInfo.content);\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete this?\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(`/forums/${itemType}/delete`, { [itemType]: postInfo.id })\r\n\t\t\t.then(onDelete)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRestoreClick() {\r\n\t\taxios.post(`/forums/${itemType}/restore`, { [itemType]: postInfo.id })\r\n\t\t\t.then(onRestore)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onEditClick() {\r\n\t\tsetEditing(true);\r\n\t}\r\n\r\n\tfunction onEditSave() {\r\n\t\taxios.post(`/forums/${itemType}/edit`, {\r\n\t\t\t[itemType]: postInfo.id,\r\n\t\t\tcontent: editContent\r\n\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tsetEditing(false);\r\n\t\t\t\tonEdit();\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onEditCancel() {\r\n\t\tsetEditing(false);\r\n\t}\r\n\r\n\tfunction onPermaLinkClick() {\r\n\t\tnavigator.clipboard.writeText(window.location.origin + permaLink);\r\n\t}\r\n\r\n\tfunction onNotifyClick() {\r\n\t\taxios.post(`/forums/thread/notify`, { thread: postInfo.id })\r\n\t\t\t.then(onNotifyToggled)\r\n\t\t\t.catch(() => { });\r\n\t}\r\n\r\n\tfunction onTogglePinnedClick() {\r\n\t\taxios.post(`/forums/thread/togglePinned`, { thread: postInfo.id })\r\n\t\t\t.then(onPinToggled)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onToggleLockedClick() {\r\n\t\taxios.post(`/forums/thread/toggleLocked`, { thread: postInfo.id })\r\n\t\t\t.then(onLockToggled)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tvar content = postInfo.content;\r\n\r\n\tif (postInfo.deleted && user.settings.hideDeleted)\r\n\t\tcontent = \"*deleted*\";\r\n\r\n\treturn (\r\n\t\t<div className={`post span-panel ${postInfo.deleted ? \"deleted\" : \"\"} ${props.className}`} id={id}>\r\n\t\t\t<div className=\"vote-wrapper\">\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={voteItem}\r\n\t\t\t\t\titemType={itemType}\r\n\t\t\t\t\titemHolder={voteItemHolder}\r\n\t\t\t\t\tsetItemHolder={setVoteItemHolder}\r\n\t\t\t\t\titemKey={itemKey} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"main-wrapper\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t<div className=\"heading-left\">\r\n\t\t\t\t\t\t{hasTitle &&\r\n\t\t\t\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t\t\t\t{locked &&\r\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{postInfo.pinned &&\r\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-thumbtack\" />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{postInfo.title}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"post-info\">\r\n\t\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\t\tid={postInfo.author.id}\r\n\t\t\t\t\t\t\t\tname={postInfo.author.name}\r\n\t\t\t\t\t\t\t\tavatar={postInfo.author.avatar}\r\n\t\t\t\t\t\t\t\tgroups={postInfo.author.groups} />\r\n\t\t\t\t\t\t\t<div className=\"post-date\">\r\n\t\t\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\t\t\tmillisec={Date.now() - postInfo.postDate} />\r\n\t\t\t\t\t\t\t\t{\" ago\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"btns-wrapper\">\r\n\t\t\t\t\t\t{!postInfo.deleted &&\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && user.perms.pinThreads &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fas fa-thumbtack ${postInfo.pinned ? \"fa-rotate-180\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onTogglePinnedClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && user.perms.lockThreads &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fas fa-lock${postInfo.locked ? \"-open\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onToggleLockedClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{(user.perms.deleteAnyPost || (user.perms.deleteOwnPost && postInfo.author.id == user.id)) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"fas fa-trash\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onDeleteClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{user.perms.editPost && postInfo.author.id == user.id && (!locked || user.perms.postInLocked) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"fas fa-pencil-alt\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onEditClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && postInfo.author.id == user.id &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fa${postInfo.replyNotify ? \"s\" : \"r\"} fa-bell`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onNotifyClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{permaLink &&\r\n\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\tto={permaLink}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => onPermaLinkClick()}>\r\n\t\t\t\t\t\t\t\t\t\t<i className=\"fas fa-link\" />\r\n\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{user.perms.postReply && (!locked || user.perms.postInLocked) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"reply-btn fas fa-reply\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onReplyClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{postInfo.deleted && user.perms.restoreDeleted &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash-restore\"\r\n\t\t\t\t\t\t\t\tonClick={onRestoreClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{!editing &&\r\n\t\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t\t<ReactMarkdown source={content} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{editing &&\r\n\t\t\t\t\t<div className=\"edit-wrapper\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={editContent}\r\n\t\t\t\t\t\t\tonChange={setEditContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onEditSave}>\r\n\t\t\t\t\t\t\t\tSave\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-third\"\r\n\t\t\t\t\t\t\t\tonClick={onEditCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useReducer, useContext } from \"react\";\r\nimport { NavLink, Switch, Route, Redirect, useParams, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport Categories from \"./Categories\";\r\nimport Board from \"./Board\";\r\nimport Thread from \"./Thread\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nimport \"../../../css/forums.css\";\r\n\r\nexport default function Forums() {\r\n\tconst [forumNavInfo, updateForumNavInfo] = useForumNavInfo();\r\n\r\n\treturn (\r\n\t\t<div className=\"forums\">\r\n\t\t\t<ForumNav forumNavInfo={forumNavInfo} />\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route exact path=\"/community/forums\" render={() => <Categories updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route exact path=\"/community/forums/board/:boardId\" render={() => <Board updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route exact path=\"/community/forums/thread/:threadId\" render={() => <Thread updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route render={() => <Redirect to=\"/community/forums\" />} />\r\n\t\t\t</Switch>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ForumNav(props) {\r\n\tconst forumNavInfo = props.forumNavInfo;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel\">\r\n\t\t\t<div className=\"forum-nav\">\r\n\t\t\t\t<div className=\"path\">\r\n\t\t\t\t\t<NavLink to=\"/community/forums\">\r\n\t\t\t\t\t\t<i className=\"fas fa-home home\" />\r\n\t\t\t\t\t\tForums\r\n\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t{forumNavInfo.board &&\r\n\t\t\t\t\t\t<NavLink to={`/community/forums/board/${forumNavInfo.board.id}`}>\r\n\t\t\t\t\t\t\t<i className=\"fas fa-chevron-right separator\" />\r\n\t\t\t\t\t\t\t{forumNavInfo.board.name}\r\n\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{forumNavInfo.thread &&\r\n\t\t\t\t\t\t<NavLink to={`/community/forums/thread/${forumNavInfo.thread.id}`}>\r\n\t\t\t\t\t\t\t<i className=\"fas fa-chevron-right separator\" />\r\n\t\t\t\t\t\t\t{forumNavInfo.thread.title}\r\n\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction useForumNavInfo() {\r\n\treturn useReducer((info, action) => {\r\n\t\tvar newInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"board\":\r\n\t\t\t\tnewInfo = {\r\n\t\t\t\t\tboard: {\r\n\t\t\t\t\t\tid: action.id,\r\n\t\t\t\t\t\tname: action.name\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"thread\":\r\n\t\t\t\tnewInfo = {\r\n\t\t\t\t\tboard: {\r\n\t\t\t\t\t\tid: action.boardId,\r\n\t\t\t\t\t\tname: action.boardName\r\n\t\t\t\t\t},\r\n\t\t\t\t\tthread: {\r\n\t\t\t\t\t\tid: action.threadId,\r\n\t\t\t\t\t\ttitle: action.threadTitle\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"home\":\r\n\t\t\t\tnewInfo = {};\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newInfo || info;\r\n\t}, {});\r\n}\r\n\r\nexport function VoteWidget(props) {\r\n\tconst item = props.item;\r\n\tconst itemType = props.itemType;\r\n\tconst itemHolder = props.itemHolder;\r\n\tconst setItemHolder = props.setItemHolder;\r\n\tconst itemKey = props.itemKey;\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction updateItemVoteCount(direction, newDirection) {\r\n\t\tvar voteCount = item.voteCount;\r\n\r\n\t\tif (item.vote == 0)\r\n\t\t\tvoteCount += direction;\r\n\t\telse if (item.vote == direction)\r\n\t\t\tvoteCount += -1 * direction;\r\n\t\telse\r\n\t\t\tvoteCount += 2 * direction;\r\n\r\n\t\treturn update(item, {\r\n\t\t\tvote: {\r\n\t\t\t\t$set: newDirection\r\n\t\t\t},\r\n\t\t\tvoteCount: {\r\n\t\t\t\t$set: voteCount\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onVote(itemId, direction) {\r\n\t\tif (!user.perms.vote)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/forums/vote\", {\r\n\t\t\titem: itemId,\r\n\t\t\titemType,\r\n\t\t\tdirection\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar newDirection = Number(res.data);\r\n\t\t\t\tvar newItem = updateItemVoteCount(direction, newDirection);\r\n\t\t\t\tvar items;\r\n\r\n\t\t\t\tif (itemHolder == null) {\r\n\t\t\t\t\tsetItemHolder(newItem);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (itemKey)\r\n\t\t\t\t\titems = itemHolder[itemKey];\r\n\t\t\t\telse\r\n\t\t\t\t\titems = itemHolder;\r\n\r\n\t\t\t\tfor (let i in items) {\r\n\t\t\t\t\tif (items[i].id == itemId) {\r\n\t\t\t\t\t\tvar newItems = items.slice();\r\n\t\t\t\t\t\tnewItems[i] = newItem;\r\n\r\n\t\t\t\t\t\tif (itemKey) {\r\n\t\t\t\t\t\t\tsetItemHolder(update(itemHolder, {\r\n\t\t\t\t\t\t\t\t[itemKey]: {\r\n\t\t\t\t\t\t\t\t\t$set: newItems\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tsetItemHolder(newItems);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"vote-widget\">\r\n\t\t\t<i\r\n\t\t\t\tclassName={`fas fa-arrow-up ${item.vote == 1 && \"sel\"}`}\r\n\t\t\t\tonClick={() => onVote(item.id, 1)} />\r\n\t\t\t{item.voteCount || 0}\r\n\t\t\t<i className={`fas fa-arrow-down ${item.vote == -1 && \"sel\"}`}\r\n\t\t\t\tonClick={() => onVote(item.id, -1)} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ViewsAndReplies(props) {\r\n\tconst viewCount = props.viewCount;\r\n\tconst replyCount = props.replyCount;\r\n\r\n\tconst viewsPlural = viewCount != 1;\r\n\tconst repliesPlural = replyCount != 1;\r\n\r\n\treturn `${viewCount} view${viewsPlural ? \"s\" : \"\"}, ${replyCount} repl${repliesPlural ? \"ies\" : \"y\"}`;\r\n}","import React, { useState, useContext, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { VoteWidget } from \"./Forums/Forums\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\nimport { Time, filterProfanity } from \"../../components/Basic\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { TextEditor } from \"../../components/Form\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport LoadingPage from \"../Loading\";\r\n\r\nimport \"../../css/forums.css\";\r\nimport \"../../css/comments.css\";\r\n\r\nexport default function Comments(props) {\r\n\tconst location = props.location;\r\n\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [comments, setComments] = useState([]);\r\n\tconst [showInput, setShowInput] = useState(false);\r\n\tconst [postContent, setPostContent] = useState(\"\");\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tsetComments([]);\r\n\t\tonCommentsPageNav(1);\r\n\t}, [location]);\r\n\r\n\tfunction onCommentsPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, comments, \"date\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/comment?location=${location}&${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tfor (let comment of res.data)\r\n\t\t\t\t\t\tcomment.content = filterProfanity(comment.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\t\tsetComments(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostSubmit() {\r\n\t\taxios.post(\"/comment\", { content: postContent, location })\r\n\t\t\t.then(() => {\r\n\t\t\t\tonCommentsPageNav(1);\r\n\t\t\t\tsetPostContent(\"\");\r\n\t\t\t\tsetShowInput(false);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostCancel() {\r\n\t\tsetShowInput(false);\r\n\t}\r\n\r\n\tconst commentRows = comments.map(comment => (\r\n\t\t<Comment\r\n\t\t\tcomment={comment}\r\n\t\t\tcomments={comments}\r\n\t\t\tsetComments={setComments}\r\n\t\t\tonDelete={() => onCommentsPageNav(page)}\r\n\t\t\tonRestore={() => onCommentsPageNav(page)}\r\n\t\t\tkey={comment.id} />\r\n\t));\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage className=\"under\" />;\r\n\r\n\treturn (\r\n\t\t<div className=\"comments-wrapper thread-wrapper\">\r\n\t\t\t<div className=\"comments-input-wrapper\">\r\n\t\t\t\t{!showInput && user.loggedIn && user.perms.postReply &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme\"\r\n\t\t\t\t\t\tonClick={() => setShowInput(true)}>\r\n\t\t\t\t\t\tPost Comment\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{showInput &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"reply-form span-panel\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={postContent}\r\n\t\t\t\t\t\t\tonChange={setPostContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onPostSubmit}>\r\n\t\t\t\t\t\t\t\tPost\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onPostCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"comments-page\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onCommentsPageNav} />\r\n\t\t\t\t{comments.length == 0 &&\r\n\t\t\t\t\t\"No comments yet\"\r\n\t\t\t\t}\r\n\t\t\t\t{commentRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onCommentsPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Comment(props) {\r\n\tconst comment = props.comment;\r\n\tconst comments = props.comments;\r\n\tconst setComments = props.setComments;\r\n\tconst onDelete = props.onDelete;\r\n\tconst onRestore = props.onRestore;\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete this?\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(`/comment/delete`, { comment: comment.id })\r\n\t\t\t.then(onDelete)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRestoreClick() {\r\n\t\taxios.post(`/comment/restore`, { comment: comment.id })\r\n\t\t\t.then(onRestore)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tvar content = comment.content;\r\n\r\n\tif (comment.deleted && user.settings.hideDeleted)\r\n\t\tcontent = \"*deleted*\";\r\n\r\n\treturn (\r\n\t\t<div className={`post ${comment.deleted ? \"deleted\" : \"\"} ${props.className || \"\"}`}>\r\n\t\t\t<div className=\"vote-wrapper\">\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={comment}\r\n\t\t\t\t\titemHolder={comments}\r\n\t\t\t\t\tsetItemHolder={setComments}\r\n\t\t\t\t\titemType=\"comment\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"main-wrapper\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t<div className=\"heading-left\">\r\n\t\t\t\t\t\t<div className=\"post-info\">\r\n\t\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\t\tid={comment.author.id}\r\n\t\t\t\t\t\t\t\tname={comment.author.name}\r\n\t\t\t\t\t\t\t\tavatar={comment.author.avatar}\r\n\t\t\t\t\t\t\t\tgroups={comment.author.groups} />\r\n\t\t\t\t\t\t\t<div className=\"post-date\">\r\n\t\t\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\t\t\tmillisec={Date.now() - comment.date} />\r\n\t\t\t\t\t\t\t\t{\" ago\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"btns-wrapper\">\r\n\t\t\t\t\t\t{!comment.deleted && (user.perms.deleteAnyPost || (user.perms.deleteOwnPost && comment.author.id == user.id)) &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash\"\r\n\t\t\t\t\t\t\t\tonClick={onDeleteClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{comment.deleted && user.perms.restoreDeleted &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash-restore\"\r\n\t\t\t\t\t\t\t\tonClick={onRestoreClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t<ReactMarkdown source={content} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useContext, useRef } from \"react\";\r\nimport { Link, Redirect, useLocation, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, PopoverContext, SiteInfoContext } from \"../../Contexts\"\r\nimport Setup from \"../../components/Setup\"\r\nimport { ButtonGroup, getPageNavFilterArg, PageNav, SubNav } from \"../../components/Nav\"\r\nimport { ItemList, Time, UserText } from \"../../components/Basic\"\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { camelCase } from \"../../utils\"\r\nimport LoadingPage from \"../Loading\";\r\nimport LandingPage from \"../Landing\";\r\nimport Comments from \"../Community/Comments\";\r\nimport { Lobbies } from \"../../Constants\";\r\n\r\nimport \"../../css/join.css\";\r\nimport { TopBarLink } from \"./Play\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\n\r\nexport default function Join(props) {\r\n    const defaultLobby = \"All\";\r\n\r\n    const [listType, setListType] = useState(\"All\");\r\n    const [page, setPage] = useState(1);\r\n    const [games, setGames] = useState([]);\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n\r\n    const user = useContext(UserContext);\r\n    const errorAlert = useErrorAlert();\r\n    const params = new URLSearchParams(location.search);\r\n    const [lobby, setLobby] = useState(params.get(\"lobby\") || localStorage.getItem(\"lobby\") || defaultLobby);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(\"lobby\", lobby);\r\n\r\n        if (params.get(\"lobby\") != lobby)\r\n            history.push(location.pathname + `?lobby=${lobby}`);\r\n\r\n        document.title = `Play (${lobby}) | BeyondMafia`;\r\n        getGameList(listType, 1);\r\n    }, [location.pathname, lobby]);\r\n\r\n    function getGameList(_listType, _page) {\r\n        var filterArg = getPageNavFilterArg(_page, page, games, \"endTime\");\r\n\r\n        if (filterArg == null)\r\n            return;\r\n\r\n        filterArg += `&page=${_page}`;\r\n        axios.get(`/game/list?list=${camelCase(_listType)}&lobby=${lobby}&${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length > 0 || _page == 1) {\r\n                    setListType(_listType);\r\n                    setPage(_page);\r\n                    setGames(res.data);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function lobbyNav(_lobby) {\r\n        setLobby(_lobby);\r\n\r\n        if (lobby == _lobby)\r\n            getGameList(listType, page);\r\n    }\r\n\r\n    if (lobby != \"All\" && Lobbies.indexOf(lobby) == -1)\r\n        setLobby(defaultLobby);\r\n\r\n    if (!user.loaded)\r\n        return <LoadingPage />;\r\n\r\n    if (user.loaded && !user.loggedIn)\r\n        return <LandingPage />;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"span-panel main join\">\r\n                <div className=\"left-panel\">\r\n\r\n                </div>\r\n                <div className=\"right-panel\">\r\n                    <div className=\"top-bar lobby-list\">\r\n                        <TopBarLink\r\n                            text=\"All\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"All\")} />\r\n                        <TopBarLink\r\n                            text=\"Main\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Main\")} />\r\n                        <TopBarLink\r\n                            text=\"Sandbox\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Sandbox\")} />\r\n                        <TopBarLink\r\n                            text=\"Competitive\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Competitive\")} />\r\n                        <TopBarLink\r\n                            text=\"Games\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Games\")} />\r\n                    </div>\r\n                    <ItemList\r\n                        className=\"games\"\r\n                        items={games}\r\n                        map={game => (\r\n                            <GameRow\r\n                                game={game}\r\n                                lobby={lobby}\r\n                                refresh={() => getGameList(listType, page)}\r\n                                odd={games.indexOf(game) % 2 == 1}\r\n                                key={game.id} />\r\n                        )}\r\n                        empty=\"No games\" />\r\n                    <PageNav\r\n                        page={page}\r\n                        onNav={(page) => getGameList(listType, page)} />\r\n                </div>\r\n            </div>\r\n            <div className=\"bottom-wrapper\">\r\n                <Comments\r\n                    location={lobby == \"Main\" || lobby == \"All\" ? \"lobby\" : `lobby-${lobby}`} />\r\n                <Announcements />\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport function GameRow(props) {\r\n    const [redirect, setRedirect] = useState(false);\r\n    const [reserved, setReserved] = useState(props.game.reserved);\r\n\r\n    const infoRef = useRef();\r\n    const user = useContext(UserContext);\r\n    const popover = useContext(PopoverContext);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    function onInfoClick(e) {\r\n        e.stopPropagation();\r\n        popover.onClick(\r\n            `/game/${props.game.id}/info`,\r\n            \"game\",\r\n            infoRef.current,\r\n            `Game ${props.game.id}`,\r\n        );\r\n    }\r\n\r\n    var linkPath, buttonText;\r\n    var buttonClass = \"btn \";\r\n\r\n    if (props.small)\r\n        buttonClass += \"btn-small \";\r\n\r\n    switch (props.game.status) {\r\n        case \"Open\":\r\n            linkPath = `/game/${props.game.id}`;\r\n            buttonClass += \"btn-join \";\r\n\r\n            if (props.game.scheduled <= Date.now())\r\n                buttonText = \"Join\";\r\n            break;\r\n        case \"In Progress\":\r\n            if (props.game.spectating || user.perms.canSpectateAny) {\r\n                linkPath = `/game/${props.game.id}`;\r\n                buttonClass += \"btn-spectate \";\r\n                buttonText = \"Spectate\";\r\n            }\r\n            else {\r\n                linkPath = \"/play\";\r\n                buttonClass += \"btn-in-progress \";\r\n                buttonText = \"In Progress\";\r\n            }\r\n            break;\r\n        case \"Finished\":\r\n            linkPath = `/game/${props.game.id}`;\r\n            buttonClass += \"btn-review \";\r\n            buttonText = \"Review\";\r\n            break;\r\n    }\r\n\r\n    function onRehostClick() {\r\n        var stateLengths = {};\r\n\r\n        for (let stateName in props.game.stateLengths)\r\n            stateLengths[stateName] = props.game.stateLengths[stateName] / 60000;\r\n\r\n        var lobby = props.lobby;\r\n\r\n        if (lobby = \"All\")\r\n            lobby = \"Main\";\r\n\r\n        axios.post(\"/game/host\", {\r\n            gameType: props.game.type,\r\n            setup: props.game.setup.id,\r\n            lobby: lobby,\r\n            guests: props.game.guests,\r\n            private: false,\r\n            ranked: props.game.ranked,\r\n            spectating: props.game.spectating,\r\n            voiceChat: props.game.voiceChat,\r\n            readyCheck: props.game.readyCheck,\r\n            stateLengths: stateLengths,\r\n            ...JSON.parse(props.game.gameTypeOptions)\r\n        })\r\n            .then(res => setRedirect(`/game/${res.data}`))\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onReserve() {\r\n        axios.post(\"/game/reserve\", { gameId: props.game.id })\r\n            .then(res => {\r\n                setReserved(!reserved);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onUnreserve() {\r\n        axios.post(\"/game/unreserve\", { gameId: props.game.id })\r\n            .then(res => {\r\n                setReserved(!reserved);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n    function onCancel() {\r\n        axios.post(\"/game/cancel\", { gameId: props.game.id })\r\n            .then(res => {\r\n                siteInfo.showAlert(res.data, \"success\");\r\n                props.refresh();\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    if (!props.game.setup)\r\n        return <></>;\r\n\r\n    return (\r\n        <div className={`row ${props.odd ? \"odd\" : \"\"} game-row`}>\r\n            {/* {!props.small && */}\r\n            <div className=\"btns-wrapper\">\r\n                {(user.loggedIn || props.status == \"Finished\") && !props.game.broken && !props.game.private &&\r\n                    <Link\r\n                        to={linkPath}\r\n                        className={buttonClass}\r\n                        disabled={props.status == \"In Progress\" && !props.game.spectating}>\r\n                        {buttonText}\r\n                    </Link>\r\n                }\r\n                {user.loggedIn && props.game.scheduled > Date.now() && !reserved &&\r\n                    <div\r\n                        className=\"btn btn-theme\"\r\n                        onClick={onReserve}>\r\n                        Reserve\r\n                    </div>\r\n                }\r\n                {user.loggedIn && props.game.scheduled > Date.now() && reserved &&\r\n                    <div\r\n                        className=\"btn btn-theme\"\r\n                        onClick={onUnreserve}>\r\n                        Unreserve\r\n                    </div>\r\n                }\r\n                {props.game.scheduled > Date.now() && user.id == props.game.hostId &&\r\n                    <div\r\n                        className=\"btn btn-theme-sec\"\r\n                        onClick={onCancel}>\r\n                        Cancel\r\n                    </div>\r\n                }\r\n                {props.game.broken &&\r\n                    <i className=\"fas fa-car-crash review-icon\" title=\"Broken\" />\r\n                }\r\n                {props.game.private &&\r\n                    <i className=\"fas fa-lock review-icon\" title=\"Private\" />\r\n                }\r\n            </div>\r\n            {/* } */}\r\n            <div className=\"player-count-wrapper\">\r\n                <PlayerCount game={props.game} />\r\n            </div>\r\n            <div className=\"setup-wrapper\">\r\n                <Setup\r\n                    setup={props.game.setup}\r\n                    maxRolesCount={props.small ? 3 : 5} />\r\n            </div>\r\n            {!props.small &&\r\n                <div className=\"setup-name\">\r\n                    {props.game.setup.name}\r\n                </div>\r\n            }\r\n            <div className=\"game-infos\">\r\n                {props.game.ranked &&\r\n                    <i\r\n                        className=\"ranked fas fa-chart-bar\"\r\n                        title=\"Ranked game\" />\r\n                }\r\n                {props.game.voiceChat &&\r\n                    <i\r\n                        className=\"voice-chat fas fa-microphone\"\r\n                        title=\"Voice chat game\" />\r\n                }\r\n                {props.game.status == \"Finished\" && user.loggedIn && !props.small &&\r\n                    <i\r\n                        className=\"rehost fas fa-redo\"\r\n                        title=\"Rehost\"\r\n                        onClick={onRehostClick} />\r\n                }\r\n                <i\r\n                    className=\"game-info fas fa-info-circle\"\r\n                    ref={infoRef}\r\n                    onClick={onInfoClick} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction PlayerCount(props) {\r\n    const game = props.game;\r\n    const circles = [];\r\n\r\n    for (let i = 0; i < game.setup.total; i++) {\r\n        circles.push(\r\n            <div\r\n                className={`player-circle ${i < game.players ? \"filled\" : \"\"}`}\r\n                key={i} />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"player-count\">\r\n            {circles}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Announcements() {\r\n    const [page, setPage] = useState(1);\r\n    const [announcements, setAnnouncements] = useState([]);\r\n\r\n    const errorAlert = useErrorAlert();\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        onPageNav(1);\r\n    }, []);\r\n\r\n    function onPageNav(_page) {\r\n        var filterArg = getPageNavFilterArg(_page, page, announcements, \"date\");\r\n\r\n        if (filterArg == null)\r\n            return;\r\n\r\n        axios.get(`/mod/announcements?${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length > 0) {\r\n                    setAnnouncements(res.data);\r\n                    setPage(_page);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const announcementRows = announcements.map(announcement => (\r\n        <div className=\"announcement\" key={announcement.id}>\r\n            <div className=\"top-row\">\r\n                <NameWithAvatar\r\n                    id={announcement.mod.id}\r\n                    name={announcement.mod.name}\r\n                    avatar={announcement.mod.avatar} />\r\n                <div className=\"date\">\r\n                    <Time\r\n                        minSec\r\n                        millisec={Date.now() - announcement.date}\r\n                        suffix=\" ago\" />\r\n                </div>\r\n            </div>\r\n            <div className=\"content\">\r\n                <UserText\r\n                    text={announcement.content}\r\n                    settings={user.settings}\r\n                    filterProfanity\r\n                    linkify\r\n                    emotify />\r\n            </div>\r\n        </div>\r\n    ));\r\n\r\n    return (\r\n        <div className=\"announcements box-panel\">\r\n            <div className=\"heading\">\r\n                Announcements\r\n            </div>\r\n            <PageNav\r\n                page={page}\r\n                onNav={onPageNav} />\r\n            {announcementRows}\r\n            <PageNav\r\n                page={page}\r\n                onNav={onPageNav} />\r\n        </div>\r\n    );\r\n} ","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useLocation, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../../Contexts\";\r\nimport { ButtonGroup, PageNav, SearchBar } from \"../../../components/Nav\";\r\nimport Setup from \"../../../components/Setup\";\r\nimport Form from \"../../../components/Form\";\r\nimport { ItemList, filterProfanity } from \"../../../components/Basic\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { camelCase } from \"../../../utils\";\r\n\r\nimport \"../../../css/host.css\";\r\nimport { TopBarLink } from \"../Play\";\r\n\r\nexport default function Host(props) {\r\n    const gameType = props.gameType;\r\n    const selSetup = props.selSetup;\r\n    const setSelSetup = props.setSelSetup;\r\n    const formFields = props.formFields;\r\n    const updateFormFields = props.updateFormFields;\r\n    const onHostGame = props.onHostGame;\r\n\r\n    const [listType, setListType] = useState(\"featured\");\r\n    const [page, setPage] = useState(1);\r\n    const [pageCount, setPageCount] = useState(1);\r\n    const [searchVal, setSearchVal] = useState(\"\");\r\n    const [setups, setSetups] = useState([]);\r\n\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n    const errorAlert = useErrorAlert();\r\n\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(location.search);\r\n\r\n        if (params.get(\"setup\")) {\r\n            getSetupList(\"id\", 1, params.get(\"setup\"));\r\n\r\n            axios.get(`/setup/${params.get(\"setup\")}`)\r\n                .then(res => {\r\n                    res.data.name = filterProfanity(res.data.name, user.settings);\r\n                    setSelSetup(res.data);\r\n                })\r\n                .catch(errorAlert);\r\n        }\r\n        else\r\n            getSetupList(listType, page)\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        updateFormFields({\r\n            ref: \"setup\",\r\n            prop: \"value\",\r\n            value: selSetup.name\r\n        });\r\n    }, [selSetup]);\r\n\r\n    function getSetupList(listType, page, query) {\r\n        axios.get(`/setup/${camelCase(listType)}?gameType=${props.gameType}&page=${page}&query=${query || \"\"}`)\r\n            .then(res => {\r\n                setListType(listType);\r\n                setPage(page);\r\n                setSetups(res.data.setups);\r\n                setPageCount(res.data.pages);\r\n            });\r\n    }\r\n\r\n    function onHostNavClick(listType) {\r\n        setSearchVal(\"\");\r\n        getSetupList(listType, 1);\r\n    }\r\n\r\n    function onSearchInput(query) {\r\n        setSearchVal(query);\r\n\r\n        if (query.length)\r\n            getSetupList(\"search\", 1, query);\r\n        else\r\n            getSetupList(\"featured\", 1);\r\n    }\r\n\r\n    function onPageNav(page) {\r\n        var args = [listType, page];\r\n\r\n        if (searchVal.length)\r\n            args.append(searchVal);\r\n\r\n        getSetupList(...args);\r\n    }\r\n\r\n    function onFavSetup(favSetup) {\r\n        axios.post(\"/setup/favorite\", { id: favSetup.id })\r\n            .catch(errorAlert);\r\n\r\n        var newSetups = [...setups];\r\n\r\n        for (let i in setups) {\r\n            if (setups[i].id == favSetup.id) {\r\n                newSetups[i].favorite = !setups[i].favorite;\r\n                break;\r\n            }\r\n        }\r\n\r\n        setSetups(newSetups);\r\n    }\r\n\r\n    function onEditSetup(setup) {\r\n        history.push(`/play/create?edit=${setup.id}`);\r\n    }\r\n\r\n    function onDelSetup(setup) {\r\n        axios.post(\"/setup/delete\", { id: setup.id })\r\n            .then(() => {\r\n                getSetupList(listType, page);\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const hostButtonLabels = [\"Featured\", \"Popular\", \"Favorites\", \"Yours\"];\r\n    const hostButtons = hostButtonLabels.map(label => (\r\n        <TopBarLink\r\n            text={label}\r\n            sel={listType}\r\n            onClick={() => onHostNavClick(label)}\r\n            key={label} />\r\n    ));\r\n\r\n    return (\r\n        <div className=\"span-panel main host\">\r\n            <div className=\"top-bar\">\r\n                {hostButtons}\r\n                <SearchBar value={searchVal} placeholder=\"Setup Name\" onInput={onSearchInput} />\r\n            </div>\r\n            <ItemList\r\n                items={setups}\r\n                map={setup => (\r\n                    <SetupRow\r\n                        setup={setup}\r\n                        sel={selSetup}\r\n                        listType={listType}\r\n                        onSelect={setSelSetup}\r\n                        onFav={onFavSetup}\r\n                        onEdit={onEditSetup}\r\n                        onDel={onDelSetup}\r\n                        odd={setups.indexOf(setup) % 2 == 1}\r\n                        key={setup.id} />\r\n                )}\r\n                empty=\"No setups\" />\r\n            <PageNav\r\n                page={page}\r\n                maxPage={pageCount}\r\n                onNav={onPageNav} />\r\n            {user.loggedIn &&\r\n                <Form\r\n                    fields={formFields}\r\n                    onChange={updateFormFields}\r\n                    submitText=\"Host\"\r\n                    onSubmit={onHostGame} />\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nfunction SetupRow(props) {\r\n    const user = useContext(UserContext);\r\n\r\n    let selIconFormat = \"far\";\r\n    let favIconFormat = \"far\";\r\n\r\n    if (props.sel.id == props.setup.id)\r\n        selIconFormat = \"fas\";\r\n\r\n    if (props.setup.favorite)\r\n        favIconFormat = \"fas\";\r\n\r\n    return (\r\n        <div className={`row ${props.odd ? \"odd\" : \"\"}`}>\r\n            {user.loggedIn &&\r\n                <i\r\n                    className={`select-setup fa-circle ${selIconFormat}`}\r\n                    onClick={() => props.onSelect(props.setup)} />\r\n            }\r\n            <div className=\"setup-wrapper\">\r\n                <Setup setup={props.setup} />\r\n            </div>\r\n            <div className=\"setup-name\">\r\n                {props.setup.name}\r\n            </div>\r\n            {user.loggedIn &&\r\n                <i\r\n                    className={`setup-btn fav-setup fa-star ${favIconFormat}`}\r\n                    onClick={() => props.onFav(props.setup)} />\r\n            }\r\n            {user.loggedIn && props.listType == \"Yours\" &&\r\n                <i\r\n                    className={`setup-btn edit-setup fa-pen-square fas`}\r\n                    onClick={() => props.onEdit(props.setup)} />\r\n            }\r\n            {user.loggedIn && props.listType == \"Yours\" &&\r\n                <i\r\n                    className={`setup-btn del-setup fa-times-circle fas`}\r\n                    onClick={() => props.onDel(props.setup)} />\r\n            }\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostMafia() {\r\n    const gameType = \"Mafia\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n\r\n    const defaults = JSON.parse(localStorage.getItem(\"mafiaHostOptions\") || null) ||\r\n        { private: false, guests: false, ranked: false, spectating: false, voiceChat: false, scheduled: false, readyCheck: false, dayLength: 10, nightLength: 2, extendLength: 3 };\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\",\r\n            value: defaults.private,\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\",\r\n            value: defaults.guests,\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Ranked\",\r\n            ref: \"ranked\",\r\n            type: \"boolean\",\r\n            value: defaults.ranked,\r\n            showIf: [\"!private\", \"!spectating\", \"!voiceChat\", \"!guests\"]\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\",\r\n            value: defaults.spectating,\r\n            showIf: \"!ranked\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\",\r\n        //     value: defaults.voiceChat,\r\n        //     showIf: \"!ranked\"\r\n        // },\r\n        // {\r\n        //     label: \"Scheduled\",\r\n        //     ref: \"scheduled\",\r\n        //     value: defaults.scheduled,\r\n        //     type: \"boolean\"\r\n        // },\r\n        // {\r\n        //     label: \"Start Date\",\r\n        //     ref: \"startDate\",\r\n        //     type: \"datetime-local\",\r\n        //     showIf: \"scheduled\",\r\n        //     value: Date.now() + (6 * 60 * 1000),\r\n        //     min: Date.now() + (6 * 60 * 1000),\r\n        //     max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        // },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            value: defaults.readyCheck,\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Day Length (minutes)\",\r\n            ref: \"dayLength\",\r\n            type: \"number\",\r\n            value: defaults.dayLength,\r\n            min: 1,\r\n            max: 30\r\n        },\r\n        {\r\n            label: \"Night Length (minutes)\",\r\n            ref: \"nightLength\",\r\n            type: \"number\",\r\n            value: defaults.nightLength,\r\n            min: 1,\r\n            max: 10\r\n        },\r\n        {\r\n            label: \"Extension Length (minutes)\",\r\n            ref: \"extendLength\",\r\n            type: \"number\",\r\n            value: defaults.extendLength,\r\n            min: 1,\r\n            max: 5\r\n        }\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Mafia | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        // var scheduled = getFormFieldValue(\"scheduled\");\r\n        var lobby = getFormFieldValue(\"lobby\");\r\n\r\n        if (lobby == \"All\")\r\n            lobby = \"Main\";\r\n\r\n        if (selSetup.id) {\r\n            axios.post(\"/game/host\", {\r\n                gameType,\r\n                lobby,\r\n                setup: selSetup.id,\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                ranked: getFormFieldValue(\"ranked\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                // scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Day\": getFormFieldValue(\"dayLength\"),\r\n                    \"Night\": getFormFieldValue(\"nightLength\")\r\n                },\r\n                extendLength: getFormFieldValue(\"extendLength\"),\r\n            })\r\n                .then(res => {\r\n                    // if (scheduled) {\r\n                    //     siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                    //     setRedirect(\"/\");\r\n                    // }\r\n                    // else\r\n                    setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n\r\n            defaults.private = getFormFieldValue(\"private\");\r\n            defaults.guests = getFormFieldValue(\"guests\");\r\n            defaults.ranked = getFormFieldValue(\"ranked\");\r\n            defaults.spectating = getFormFieldValue(\"spectating\");\r\n            // defaults.voiceChat = getFormFieldValue(\"voiceChat\");\r\n            // defaults.scheduled = getFormFieldValue(\"scheduled\");\r\n            defaults.readyCheck = getFormFieldValue(\"readyCheck\");\r\n            defaults.dayLength = getFormFieldValue(\"dayLength\");\r\n            defaults.nightLength = getFormFieldValue(\"nightLength\");\r\n            defaults.extendLength = getFormFieldValue(\"extendLength\");\r\n            localStorage.setItem(\"mafiaHostOptions\", JSON.stringify(defaults));\r\n        }\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useState, useEffect, useReducer, useContext } from \"react\";\r\nimport { Redirect, useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../../Contexts\";\r\nimport { RoleCount, RoleSearch } from \"../../../components/Roles\";\r\nimport Form from \"../../../components/Form\";\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nimport \"../../../css/createSetup.css\";\r\n\r\nexport default function CreateSetup(props) {\r\n\tconst gameType = props.gameType;\r\n\tconst formFields = props.formFields;\r\n\tconst updateFormFields = props.updateFormFields;\r\n\tconst closedField = props.closedField;\r\n\tconst resetFormFields = props.resetFormFields;\r\n\tconst formFieldValueMods = props.formFieldValueMods;\r\n\tconst onCreateSetup = props.onCreateSetup;\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [selRoleSet, setSelRoleSet] = useState(0);\r\n\tconst [redirect, setRedirect] = useState(\"\");\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [modifier, setModifier] = useState(\"None\");\r\n\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tconst [roleData, updateRoleData] = useReducer((roleData, action) => {\r\n\t\tvar newRoleData = { ...roleData };\r\n\r\n\t\tif (action.type != \"reset\" && action.type != \"setClosed\") {\r\n\t\t\tnewRoleData.roles = roleData.roles.slice();\r\n\r\n\t\t\tfor (let i in roleData.roles)\r\n\t\t\t\tnewRoleData.roles[i] = { ...roleData.roles[i] }\r\n\t\t}\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"reset\":\r\n\t\t\t\tnewRoleData.roles = [{}];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setClosed\":\r\n\t\t\t\tnewRoleData.closed = action.closed;\r\n\r\n\t\t\t\tif (action.closed)\r\n\t\t\t\t\tnewRoleData.roles = newRoleData.roles.slice(0, 1);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addRole\":\r\n\t\t\t\tvar roleSet = newRoleData.roles[selRoleSet];\r\n\r\n\t\t\t\tif (!roleSet[action.role])\r\n\t\t\t\t\troleSet[action.role] = 0;\r\n\r\n\t\t\t\troleSet[action.role]++;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeRole\":\r\n\t\t\t\tvar roleSet = newRoleData.roles[selRoleSet];\r\n\r\n\t\t\t\tif (roleSet[action.role])\r\n\t\t\t\t\troleSet[action.role]--;\r\n\r\n\t\t\t\tif (roleSet[action.role] < 1)\r\n\t\t\t\t\tdelete roleSet[action.role];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addRoleSet\":\r\n\t\t\t\tnewRoleData.roles.push({});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeRoleSet\":\r\n\t\t\t\tnewRoleData.roles.splice(action.index, 1);\r\n\r\n\t\t\t\tif (action.index == selRoleSet)\r\n\t\t\t\t\tsetSelRoleSet(0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setFromSetup\":\r\n\t\t\t\tnewRoleData.closed = action.closed;\r\n\t\t\t\tnewRoleData.roles = action.roles;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newRoleData;\r\n\t}, { roles: [{}], closed: false });\r\n\r\n\tconst user = useContext(UserContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdateRoleData({ type: \"setClosed\", closed: closedField.value });\r\n\t}, [closedField.value]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (params.get(\"edit\")) {\r\n\t\t\taxios.get(`/setup/${params.get(\"edit\")}`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tvar setup = res.data;\r\n\r\n\t\t\t\t\tsetEditing(true);\r\n\r\n\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\ttype: \"setFromSetup\",\r\n\t\t\t\t\t\troles: JSON.parse(setup.roles),\r\n\t\t\t\t\t\tclosed: setup.closed\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar formFieldChanges = [];\r\n\r\n\t\t\t\t\tfor (let field of formFields) {\r\n\t\t\t\t\t\tif (setup[field.ref]) {\r\n\t\t\t\t\t\t\tlet value = setup[field.ref];\r\n\r\n\t\t\t\t\t\t\tif (formFieldValueMods[field.ref])\r\n\t\t\t\t\t\t\t\tfor (let valueMod of formFieldValueMods[field.ref])\r\n\t\t\t\t\t\t\t\t\tvalue = valueMod(value);\r\n\r\n\t\t\t\t\t\t\tformFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: field.ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: value\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (setup.closed) {\r\n\t\t\t\t\t\tfor (let alignment in setup.count) {\r\n\t\t\t\t\t\t\tformFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: `count-${alignment}`,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: setup.count[alignment]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tupdateFormFields(formFieldChanges);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tfunction onAddRole(role) {\r\n\t\tupdateRoleData({\r\n\t\t\ttype: \"addRole\",\r\n\t\t\trole: `${role.name}:${modifier != \"None\" ? modifier : \"\"}`,\r\n\t\t\talignment: role.alignment\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onModifierChange(e) {\r\n\t\tvar modifier = e.target.value;\r\n\t\tsetModifier(modifier);\r\n\t}\r\n\r\n\tif (editing && !params.get(\"edit\")) {\r\n\t\tsetEditing(false);\r\n\t\tresetFormFields();\r\n\t\tupdateRoleData({ type: \"reset\" });\r\n\t}\r\n\r\n\tvar roleSets;\r\n\r\n\troleSets = roleData.roles.map((roleSet, i) => {\r\n\t\tlet roles = [];\r\n\r\n\t\tfor (let role in roleSet) {\r\n\t\t\troles.push(\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\trole={role}\r\n\t\t\t\t\tcount={roleSet[role]}\r\n\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\t\t\ttype: \"removeRole\",\r\n\t\t\t\t\t\t\t\trole: role\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkey={role} />\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<RoleSetRow\r\n\t\t\t\troles={roles}\r\n\t\t\t\tindex={i}\r\n\t\t\t\tsel={selRoleSet}\r\n\t\t\t\tonClick={() => setSelRoleSet(i)}\r\n\t\t\t\tonDelete={\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\t\ttype: \"removeRoleSet\",\r\n\t\t\t\t\t\t\tindex: i\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tkey={i} />\r\n\t\t);\r\n\t});\r\n\r\n\tvar modifiers = siteInfo.roles ? siteInfo.roles[\"Modifiers\"][gameType] : [];\r\n\r\n\tmodifiers = modifiers.map(modifier => (\r\n\t\t<option value={modifier} key={modifier}>\r\n\t\t\t{modifier}\r\n\t\t</option>\r\n\t));\r\n\r\n\tmodifiers.unshift((\r\n\t\t<option value=\"None\" key={\"None\"}>\r\n\t\t\tNone\r\n\t\t</option>\r\n\t));\r\n\r\n\tif ((params.get(\"edit\") && !editing))\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main create-setup\">\r\n\t\t\t<RoleSearch\r\n\t\t\t\tonAddClick={onAddRole}\r\n\t\t\t\tgameType={gameType} />\r\n\t\t\t{user.loggedIn &&\r\n\t\t\t\t(\r\n\t\t\t\t\t<div className=\"creation-options\">\r\n\t\t\t\t\t\t<Form\r\n\t\t\t\t\t\t\tfields={formFields}\r\n\t\t\t\t\t\t\tonChange={updateFormFields}\r\n\t\t\t\t\t\t\tsubmitText={editing ? \"Edit\" : \"Create\"}\r\n\t\t\t\t\t\t\tonSubmit={() => onCreateSetup(roleData, editing, setRedirect)} />\r\n\t\t\t\t\t\t<div className=\"rolesets-wrapper\">\r\n\t\t\t\t\t\t\t<div className=\"form\">\r\n\t\t\t\t\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t\t\t\tRole Modifier\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tvalue={modifier}\r\n\t\t\t\t\t\t\t\t\t\tonChange={onModifierChange}>\r\n\t\t\t\t\t\t\t\t\t\t{modifiers}\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"rolesets\">\r\n\t\t\t\t\t\t\t\t{roleSets}\r\n\t\t\t\t\t\t\t\t{!roleData.closed && roleData.roles.length < 10 &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"add-roleset fa-plus-circle fas\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => updateRoleData({ type: \"addRoleSet\" })} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\r\n\t\t\t}\r\n\t\t\t{redirect &&\r\n\t\t\t\t<Redirect to={`/play/host/?setup=${redirect}`} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction RoleSetRow(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`roleset ${props.sel == props.index ? \"sel\" : \"\"}`}\r\n\t\t\tonClick={props.onClick}>\r\n\t\t\t{props.roles}\r\n\t\t\t{props.index > 0 &&\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"del-roleset fa-times-circle fas\"\r\n\t\t\t\t\tonClick={props.onDelete} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateMafiaSetup() {\r\n\tconst gameType = \"Mafia\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Day Start\",\r\n\t\t\tref: \"startState\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Dawn\",\r\n\t\t\tref: \"dawn\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Last Wills\",\r\n\t\t\tref: \"lastWill\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Must Act\",\r\n\t\t\tref: \"mustAct\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"No Reveal\",\r\n\t\t\tref: \"noReveal\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Votes Invisible\",\r\n\t\t\tref: \"votesInvisible\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Village Count\",\r\n\t\t\tref: \"count-Village\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"7\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Mafia Count\",\r\n\t\t\tref: \"count-Mafia\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Monsters Count\",\r\n\t\t\tref: \"count-Monsters\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"0\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\r\n\tconst formFieldValueMods = {\r\n\t\tstartState: [\r\n\t\t\tvalue => value == \"Day\"\r\n\t\t]\r\n\t};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Mafia Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: formFields[1].value ? \"Day\" : \"Night\",\r\n\t\t\tdawn: formFields[2].value,\r\n\t\t\twhispers: formFields[3].value,\r\n\t\t\tleakPercentage: Number(formFields[4].value),\r\n\t\t\tlastWill: formFields[5].value,\r\n\t\t\tmustAct: formFields[6].value,\r\n\t\t\tnoReveal: formFields[7].value,\r\n\t\t\tvotesInvisible: formFields[8].value,\r\n\t\t\tunique: formFields[10].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Village\": Number(formFields[11].value),\r\n\t\t\t\t\"Mafia\": Number(formFields[12].value),\r\n\t\t\t\t\"Monsters\": Number(formFields[13].value),\r\n\t\t\t\t\"Independent\": Number(formFields[14].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[9]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\";\r\n\r\nexport default function LearnMafia(props) {\r\n\tconst gameType = \"Mafia\";\r\n\r\n\tvar items = [\r\n\t\t{\r\n\t\t\tname: \"Gun\",\r\n\t\t\ttext: \"Can be shot once during the day to kill a specific player.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Armor\",\r\n\t\t\ttext: \"Saves a player from being killed one time, not including being executed.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Bomb\",\r\n\t\t\ttext: \"When a player is killed while holding a bomb, the player who killed them will also die.\"\r\n\t\t},\r\n\t];\r\n\r\n\tvar mechanics = [\r\n\t\t{\r\n\t\t\tname: \"Whispers\",\r\n\t\t\ttext: \"Allow players to privately contact another player in the town meeting. If the whisper leaks then everyone will see it.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Last Wills\",\r\n\t\t\ttext: \"Allow players to write a message that will be revealed when they die.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Must Act\",\r\n\t\t\ttext: \"Players cannot select 'no one' for their actions.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"No Reveal\",\r\n\t\t\ttext: \"The roles of dead players are not revealed.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Closed Roles\",\r\n\t\t\ttext: \"Roles for each alignment are randomly chosen from the pool of roles in the setup.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Dawn\",\r\n\t\t\ttext: \"No actions can be taken the first night.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Full Moon\",\r\n\t\t\ttext: \"When a Lycan or Werewolf is present in the game, full moons will occur on odd nights.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Eclipse\",\r\n\t\t\ttext: \"Occurs during the day due to certain roles, making all votes and speech anonymous.\"\r\n\t\t},\r\n\t];\r\n\r\n\tvar modifiers = [\r\n\t\t{\r\n\t\t\tname: \"Armed\",\r\n\t\t\ttext: \"Starts with a gun.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Armed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Explosive\",\r\n\t\t\ttext: \"Starts with a bomb.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Explosive\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Armored\",\r\n\t\t\ttext: \"Starts with armor.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Armored\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Exposed\",\r\n\t\t\ttext: \"Starts revealed to everyone.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Exposed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Chameleon\",\r\n\t\t\ttext: \"Appears as a Villager to investigative roles.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Chameleon\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Humble\",\r\n\t\t\ttext: \"Appears as Villager to self with no modifier.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Humble\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Lone\",\r\n\t\t\ttext: \"Does not attend the Mafia or Monsters meeting.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Lone\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Solitary\",\r\n\t\t\ttext: \"Does not attend Cop or Illuminati meetings.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Solitary\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Delayed\",\r\n\t\t\ttext: \"Cannot attend secondary meetings for the first day and night.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Delayed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Even\",\r\n\t\t\ttext: \"Can only attend secondary meetings on even days and nights.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Even\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Odd\",\r\n\t\t\ttext: \"Can only attend secondary meetings on odd days and nights.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Odd\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"One Shot\",\r\n\t\t\ttext: \"Can only perform actions once.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-One-Shot\" />\r\n\t\t},\r\n\t];\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Mafia | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tMafia is a game of social deception where an informed minority (the Mafia) compete against the uniformed majority (the Village).\r\n\t\t\t\t\t\tThe Mafia choose one player to kill each night, and they win the game if they successfully outnumber the non-mafia players at any point.\r\n\t\t\t\t\t\tEveryone votes to execute one person during the day, with the Village aiming to eliminate all mafia members.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn addition to the Village and the Mafia, there are two other alignments: Independent and Monsters. Independents are not aligned with a side and usually have their own unique win condition.\r\n\t\t\t\t\t\tMonsters meet together and win if they reach the majority just like the mafia, but they do not vote to kill someone each night.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAt the beginning of a game, each player is given a role. This role may grant the player special abilities, usually in the form of actions they can take to aid their side.\r\n\t\t\t\t\t\tA list of all roles and their abilities can be found below.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tItems\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={items} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tMechanics\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={mechanics} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tModifiers\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={modifiers} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostSplitDecision() {\r\n    const gameType = \"Split Decision\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\"\r\n        // },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Initial Round Length (minutes)\",\r\n            ref: \"initRoundLength\",\r\n            type: \"number\",\r\n            value: 3,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        {\r\n            label: \"Hostage Swap Length (minutes)\",\r\n            ref: \"hostageSwapLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 1,\r\n            step: 0.1\r\n        },\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Split Decision | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                ranked: getFormFieldValue(\"ranked\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Initial Round\": getFormFieldValue(\"initialRoundLength\"),\r\n                    \"Hostage Swap\": getFormFieldValue(\"hostageSwapLength\")\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateSplitDecisionSetup() {\r\n\tconst gameType = \"Split Decision\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Initial Swap Amount\",\r\n\t\t\tref: \"swapAmt\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"1\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"24\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Round Amount\",\r\n\t\t\tref: \"aroundAmt\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: 3,\r\n\t\t\tmin: 2,\r\n\t\t\tmax: 10\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Blue Count\",\r\n\t\t\tref: \"count-Blue\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Red Count\",\r\n\t\t\tref: \"count-Red\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"1\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\tconst formFieldValueMods = {};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Split Decision Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: \"Round\",\r\n\t\t\tswapAmt: Number(formFields[1].value),\r\n\t\t\troundAmt: Number(formFields[2].value),\r\n\t\t\twhispers: formFields[3].value,\r\n\t\t\tleakPercentage: Number(formFields[4].value),\r\n\t\t\tunique: formFields[6].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Red\": Number(formFields[7].value),\r\n\t\t\t\t\"Blue\": Number(formFields[8].value),\r\n\t\t\t\t\"Independent\": Number(formFields[9].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[5]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnSplitDecision(props) {\r\n\tconst gameType = \"Split Decision\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Split Decision | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on the card game <a href=\"https://www.tuesdayknightgames.com/tworoomsandaboom\" target=\"_blank\">2 Rooms and a Boom</a> by Tudesday Knight Games.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn Split Decision, all players are randomly a split among two rooms, as well as split among two teams: Red and Blue. One player is assigned the role of President, and another is the Bomber.\r\n\t\t\t\t\t\tThe game plays over a series of rounds, and in each round each room will elect a leader. Those leaders will then meet together and choose one or more players (the hostages) to swap between the rooms for the next round.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAs the game progresses the rounds will get shorter and the number of players swapped between rooms will decrease.\r\n\t\t\t\t\t\tIt is the goal of the Red team for the President and the Bomber to end up in the same room after the last round.\r\n\t\t\t\t\t\tIt is the goal of the Blue team for them to end up in different rooms.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostResistance() {\r\n    const gameType = \"Resistance\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\"\r\n        // },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Team Selection Length (minutes)\",\r\n            ref: \"teamSelLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        {\r\n            label: \"Team Approval Length (minutes)\",\r\n            ref: \"teamApprovalLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 2,\r\n            step: 0.1\r\n        },\r\n        {\r\n            label: \"Mission Length (minutes)\",\r\n            ref: \"missionLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 1,\r\n            step: 0.1\r\n        },\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Resistance | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Team Selection\": getFormFieldValue(\"teamSelLength\"),\r\n                    \"Team Approval\": getFormFieldValue(\"teamApprovalLength\"),\r\n                    \"Mission\": getFormFieldValue(\"missionLength\"),\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`)\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateResistanceSetup() {\r\n\tconst gameType = \"Resistance\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"First Team Size\",\r\n\t\t\tref: \"firstTeamSize\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Last Team Size\",\r\n\t\t\tref: \"lastTeamSize\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Number of Missions\",\r\n\t\t\tref: \"numMissions\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"10\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Team Formation Attempts\",\r\n\t\t\tref: \"teamFailLimit\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Resistance Count\",\r\n\t\t\tref: \"count-Resistance\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Spies Count\",\r\n\t\t\tref: \"count-Spies\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"49\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t]);\r\n\tconst formFieldValueMods = {};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Resistance Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: \"Team Selection\",\r\n\t\t\tfirstTeamSize: Number(formFields[1].value),\r\n\t\t\tlastTeamSize: Number(formFields[2].value),\r\n\t\t\tnumMissions: Number(formFields[3].value),\r\n\t\t\tteamFailLimit: Number(formFields[4].value),\r\n\t\t\twhispers: formFields[5].value,\r\n\t\t\tleakPercentage: Number(formFields[6].value),\r\n\t\t\tunique: formFields[8].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Resistance\": Number(formFields[9].value),\r\n\t\t\t\t\"Spies\": Number(formFields[10].value),\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[7]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnResistance(props) {\r\n\tconst gameType = \"Resistance\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Resistance | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on the card game <a href=\"https://www.boardgamegeek.com/boardgame/41114/resistance\" target=\"_blank\">The Resistance</a> by Don Eskridge.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn Resistance, a group of rebels is trying to overthrow the government by completing a series of missions.\r\n\t\t\t\t\t\tHowever, the government has caught word of the plan and has recruited spies to inflitrate the resistance and sabotage the missions.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAt the beginning of each mission a player is selected as the leader and must recruit several group members to the team.\r\n\t\t\t\t\t\tAll players vote on the selected team and if the majority approve then the mission will proceed. Otherwise, a new leader is chosen to make a new team.\r\n\t\t\t\t\t\tIf several leaders are unable to form a team then that mission automatically fails.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tDuring a mission the members of the teams who are spies can choose to either make the mission succeed or fail.\r\n\t\t\t\t\t\tIf at least one team member opts for it to fail then the entire mission will fail, otherwise it will succeed.\r\n\t\t\t\t\t\tThe game continues until a certain number of missions succeed or fail, with the Resistance and the Spies winning respectively.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostMafia() {\r\n    const gameType = \"One Night\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\"\r\n        // },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Day Length (minutes)\",\r\n            ref: \"dayLength\",\r\n            type: \"number\",\r\n            value: 10,\r\n            min: 1,\r\n            max: 30\r\n        },\r\n        {\r\n            label: \"Night Length (minutes)\",\r\n            ref: \"nightLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 10\r\n        }\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host One Night | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Day\": getFormFieldValue(\"dayLength\"),\r\n                    \"Night\": getFormFieldValue(\"nightLength\")\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateOneNightSetup() {\r\n\tconst gameType = \"One Night\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Must Act\",\r\n\t\t\tref: \"mustAct\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Votes Invisible\",\r\n\t\t\tref: \"votesInvisible\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Excess Roles\",\r\n\t\t\tref: \"excessRoles\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"10\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Village Count\",\r\n\t\t\tref: \"count-Village\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"7\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Werewolves Count\",\r\n\t\t\tref: \"count-Werewolves\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"0\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\tconst formFieldValueMods = {\r\n\t\tstartState: [\r\n\t\t\tvalue => value == \"Day\"\r\n\t\t]\r\n\t};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create One Night Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\twhispers: formFields[1].value,\r\n\t\t\tleakPercentage: Number(formFields[2].value),\r\n\t\t\tmustAct: formFields[3].value,\r\n\t\t\tvotesInvisible: formFields[4].value,\r\n\t\t\texcessRoles: formFields[5].value,\r\n\t\t\tunique: formFields[7].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Village\": Number(formFields[8].value),\r\n\t\t\t\t\"Werewolves\": Number(formFields[9].value),\r\n\t\t\t\t\"Independent\": Number(formFields[10].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[6]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnOneNight(props) {\r\n\tconst gameType = \"One Night\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn One Night | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on <a href=\"https://beziergames.com/collections/one-night-ultimate-werewolf\" target=\"_blank\">One Night Ultimate Werewolf</a> by Bezier Games.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tOne Night is a game of logical deduction similar to Mafia, but with only one Night and one Day phase.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tThe Village side must kill one of the Werewolves to win, and Werewolves must kill one of the village. The Village also loses if\r\n\t\t\t\t\t\tthere are no Werewolves present but they kill a Village member.\r\n\t\t\t\t\t\tThe one night is typically eventful; the role you are given at the beginning of the night may not be the card you end up with.\r\n\t\t\t\t\t\tActions will all take place at once at the end of the night. The order of events is given by times in the role descriptions.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useContext, useEffect } from \"react\";\r\nimport { Route, Switch, Redirect, useLocation, useHistory } from \"react-router-dom\";\r\n\r\nimport Join from \"./Join\";\r\n\r\nimport HostMafia from \"./Host/HostMafia\";\r\nimport CreateMafiaSetup from \"./CreateSetup/CreateMafiaSetup\";\r\nimport LearnMafia from \"./Learn/LearnMafia\";\r\n\r\nimport HostSplitDecision from \"./Host/HostSplitDecision\";\r\nimport CreateSplitDecisionSetup from \"./CreateSetup/CreateSplitDecisionSetup\";\r\nimport LearnSplitDecision from \"./Learn/LearnSplitDecision\";\r\n\r\nimport HostResistance from \"./Host/HostResistance\";\r\nimport CreateResistanceSetup from \"./CreateSetup/CreateResistanceSetup\";\r\nimport LearnResistance from \"./Learn/LearnResistance\";\r\n\r\nimport HostOneNight from \"./Host/HostOneNight\";\r\nimport CreateOneNightSetup from \"./CreateSetup/CreateOneNightSetup\";\r\nimport LearnOneNight from \"./Learn/LearnOneNight\";\r\n\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport { GameTypes } from \"../../Constants\";\r\nimport { UserContext } from \"../../Contexts\";\r\n\r\nimport \"../../css/play.css\";\r\n\r\nexport default function Play(props) {\r\n    const defaultGameType = \"Mafia\";\r\n\r\n    const user = useContext(UserContext);\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n    const params = new URLSearchParams(location.search);\r\n    const inLobby = location.pathname == \"/play\";\r\n    const [gameType, setGameType] = useState(params.get(\"game\") || localStorage.getItem(\"gameType\") || defaultGameType);\r\n\r\n    const links = [\r\n        {\r\n            text: \"Play\",\r\n            path: \"/play\",\r\n            exact: true\r\n        },\r\n        {\r\n            text: \"Host\",\r\n            path: `/play/host`,\r\n            hide: !user.loggedIn\r\n        },\r\n        {\r\n            text: \"Create Setup\",\r\n            path: `/play/create`,\r\n            hide: !user.loggedIn\r\n        },\r\n        {\r\n            text: \"Learn\",\r\n            path: `/play/learn`\r\n        }\r\n    ];\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(\"gameType\", gameType);\r\n\r\n        if (!inLobby && !params.get(\"edit\") && params.get(\"game\") != gameType)\r\n            history.push(location.pathname + `?game=${gameType}`);\r\n    }, [location.pathname, gameType]);\r\n\r\n    function onFilterGameType(gameType) {\r\n        setGameType(gameType);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <SubNav\r\n                links={links}\r\n                showFilter={!inLobby}\r\n                filterSel={gameType}\r\n                filterOptions={GameTypes}\r\n                onFilter={onFilterGameType}\r\n                filterIcon={<i className=\"fas fa-gamepad\" />} />\r\n            <div className=\"inner-content play\">\r\n                <Switch>\r\n                    <Route exact path=\"/play\" render={() => <Join />} />\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/host\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <HostMafia />;\r\n                                    case \"Split Decision\":\r\n                                        return <HostSplitDecision />;\r\n                                    case \"Resistance\":\r\n                                        return <HostResistance />;\r\n                                    case \"One Night\":\r\n                                        return <HostOneNight />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/create\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <CreateMafiaSetup />;\r\n                                    case \"Split Decision\":\r\n                                        return <CreateSplitDecisionSetup />;\r\n                                    case \"Resistance\":\r\n                                        return <CreateResistanceSetup />;\r\n                                    case \"One Night\":\r\n                                        return <CreateOneNightSetup />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/learn\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <LearnMafia />;\r\n                                    case \"Split Decision\":\r\n                                        return <LearnSplitDecision />;\r\n                                    case \"Resistance\":\r\n                                        return <LearnResistance />;\r\n                                    case \"One Night\":\r\n                                        return <LearnOneNight />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route render={() => <Redirect to=\"/play\" />} />\r\n                </Switch>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport function TopBarLink(props) {\r\n    const active = props.sel.toLowerCase() == props.text.toLowerCase();\r\n\r\n    return (\r\n        <div\r\n            className={`top-link ${active ? \"active\" : \"\"}`}\r\n            onClick={props.onClick}>\r\n            {props.text}\r\n        </div>\r\n    );\r\n}","import React, { useState, useContext, useRef } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext, PopoverContext } from \"../Contexts\";\r\nimport { ButtonGroup, SearchBar } from \"./Nav\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\nimport { hyphenDelimit } from \"../utils\";\r\nimport { Alignments } from \"../Constants\";\r\nimport LoadingPage from \"../pages/Loading\";\r\nimport { TopBarLink } from \"../pages/Play/Play\";\r\n\r\nexport function RoleCount(props) {\r\n\tconst roleRef = useRef();\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tvar roleName, modifier;\r\n\r\n\tif (typeof props.role == \"string\") {\r\n\t\troleName = props.role.split(\":\")[0];\r\n\t\tmodifier = props.role.split(\":\")[1];\r\n\t}\r\n\telse if (props.role) {\r\n\t\troleName = props.role.name;\r\n\t\tmodifier = props.role.modifier;\r\n\t}\r\n\r\n\tfunction onRoleClick() {\r\n\t\tif (props.onClick)\r\n\t\t\tprops.onClick();\r\n\r\n\t\tif (!roleName || !props.showPopover)\r\n\t\t\treturn;\r\n\r\n\t\tpopover.onClick(\r\n\t\t\t`/roles/${props.gameType}/${roleName}`,\r\n\t\t\t\"role\",\r\n\t\t\troleRef.current,\r\n\t\t\troleName\r\n\t\t);\r\n\t}\r\n\r\n\tfunction onRoleMouseEnter( event ) {\r\n\t\tif (props.onMouseEnter)\r\n\t\t\tprops.onMouseEnter();\r\n\r\n\t\tif (!roleName || !props.showSecondaryHover)\r\n\t\t\treturn;\r\n\r\n\t\t// assumes that this is attached to a child in a popover\r\n\t\tpopover.onHover(\r\n\t\t\t`/roles/${props.gameType}/${roleName}`,\r\n\t\t\t\"role\",\r\n\t\t\troleRef.current,\r\n\t\t\troleName,\r\n\t\t\tnull,\r\n\t\t\tevent.clientY,\r\n\t\t);\r\n\t}\r\n\r\n\tif (!props.closed) {\r\n\t\tconst roleClass = roleName ? `${hyphenDelimit(props.gameType)}-${hyphenDelimit(roleName)}` : \"null\";\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"role-count-wrap\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={`role role-${roleClass} ${props.small ? \"small\" : \"\"} ${props.bg ? \"bg\" : \"\"}`}\r\n\t\t\t\t\ttitle={`${roleName || \"\"} ${modifier ? `(${modifier})` : \"\"}`}\r\n\t\t\t\t\tonClick={onRoleClick}\r\n\t\t\t\t\tonMouseEnter={onRoleMouseEnter}\r\n\t\t\t\t\tref={roleRef}>\r\n\t\t\t\t\t{modifier &&\r\n\t\t\t\t\t\t<div className={`modifier modifier-${props.gameType}-${hyphenDelimit(modifier)}`} />\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{props.count > 0 &&\r\n\t\t\t\t\t<div className=\"super\">{props.count}</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse if (props.count > 0 || props.hideCount) {\r\n\t\treturn (\r\n\t\t\t<div className=\"role-count-wrap\">\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName={`fas fa-question i-${props.alignment}`}\r\n\t\t\t\t\tonClick={props.onClick} />\r\n\t\t\t\t{!props.hideCount &&\r\n\t\t\t\t\t<div className=\"super\">{props.count}</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse {\r\n\t\treturn <></>;\r\n\t}\r\n}\r\n\r\nexport function RoleSearch(props) {\r\n\tconst [roleListType, setRoleListType] = useState(Alignments[props.gameType][0]);\r\n\tconst [searchVal, setSearchVal] = useState(\"\");\r\n\tconst roleCellRefs = useRef([]);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tfunction onAlignNavClick(alignment) {\r\n\t\tsetSearchVal(\"\");\r\n\t\tsetRoleListType(alignment);\r\n\t}\r\n\r\n\tfunction onSearchInput(query) {\r\n\t\tsetSearchVal(query.toLowerCase());\r\n\r\n\t\tif (query != \"\" && roleListType.length > 0)\r\n\t\t\tsetRoleListType(\"\");\r\n\t\telse if (query == \"\" && roleListType.length == 0)\r\n\t\t\tsetRoleListType(Alignments[props.gameType][0]);\r\n\t}\r\n\r\n\tfunction onRoleCellClick(roleCellEl, role) {\r\n\t\tpopover.onClick(\r\n\t\t\t`/roles/${props.gameType}/${role.name}`,\r\n\t\t\t\"role\",\r\n\t\t\troleCellEl,\r\n\t\t\trole.name\r\n\t\t);\r\n\t}\r\n\r\n\tconst alignButtons = Alignments[props.gameType].map(type => (\r\n\t\t<TopBarLink\r\n\t\t\ttext={type}\r\n\t\t\tsel={roleListType}\r\n\t\t\tonClick={() => onAlignNavClick(type)}\r\n\t\t\tkey={type} />\r\n\t));\r\n\r\n\tif (!siteInfo.roles)\r\n\t\treturn <LoadingPage className=\"roles-loading\" />;\r\n\r\n\tconst roleCells = siteInfo.roles[props.gameType].map((role, i) => {\r\n\t\tif (\r\n\t\t\trole.alignment == roleListType ||\r\n\t\t\t(searchVal.length > 0 && role.name.toLowerCase().indexOf(searchVal) != -1)\r\n\t\t) {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"role-cell\" key={role.name}>\r\n\t\t\t\t\t{user.loggedIn && props.onAddClick &&\r\n\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\tclassName=\"add-role fa-plus-circle fas\"\r\n\t\t\t\t\t\t\tonClick={e => {\r\n\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\tprops.onAddClick(role);\r\n\t\t\t\t\t\t\t}} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"role-cell-content\"\r\n\t\t\t\t\t\tonClick={() => onRoleCellClick(roleCellRefs.current[i], role)}\r\n\t\t\t\t\t\tref={el => roleCellRefs.current[i] = el}>\r\n\t\t\t\t\t\t<RoleCount\r\n\t\t\t\t\t\t\trole={role.name}\r\n\t\t\t\t\t\t\tgameType={props.gameType} />\r\n\t\t\t\t\t\t{role.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"role-list-container\">\r\n\t\t\t<div className=\"top-bar\">\r\n\t\t\t\t{alignButtons}\r\n\t\t\t\t<SearchBar\r\n\t\t\t\t\tvalue={searchVal}\r\n\t\t\t\t\tplaceholder=\"Role Name\"\r\n\t\t\t\t\tonInput={onSearchInput} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"role-list\">\r\n\t\t\t\t{roleCells}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useContext, useRef } from \"react\";\r\n\r\nimport { PopoverContext, UserContext } from \"../Contexts\";\r\nimport { RoleCount } from \"./Roles\";\r\nimport { Alignments } from \"../Constants\";\r\nimport { filterProfanity } from \"./Basic\";\r\nimport { hyphenDelimit } from \"../utils\";\r\n\r\nimport \"../css/setup.css\"\r\nimport \"../css/roles.css\"\r\n\r\nexport default function Setup(props) {\r\n\tconst user = useContext(UserContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\tconst setupRef = useRef();\r\n\tconst maxRolesCount = props.maxRolesCount || 5;\r\n\r\n\tvar roleCounts, multi;\r\n\tvar overSize = false;\r\n\r\n\tif (typeof props.setup.roles == \"string\")\r\n\t\tprops.setup.roles = JSON.parse(props.setup.roles);\r\n\r\n\tif (props.setup.closed) {\r\n\t\troleCounts = [];\r\n\r\n\t\tfor (let alignment of Alignments[props.setup.gameType]) {\r\n\t\t\troleCounts.push(\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\tclosed\r\n\t\t\t\t\talignment={alignment}\r\n\t\t\t\t\tcount={props.setup.count[alignment]}\r\n\t\t\t\t\tgameType={props.setup.gameType}\r\n\t\t\t\t\tkey={alignment} />\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tlet roleNames = Object.keys(props.setup.roles[0]);\r\n\t\tmulti = props.setup.roles.length > 1;\r\n\r\n\t\troleCounts = roleNames.map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\tsmall\r\n\t\t\t\trole={role}\r\n\t\t\t\tcount={props.setup.roles[0][role]}\r\n\t\t\t\tgameType={props.setup.gameType}\r\n\t\t\t\tkey={role} />\r\n\t\t));\r\n\r\n\t\tif (roleCounts.length > maxRolesCount) {\r\n\t\t\troleCounts = roleCounts.slice(0, maxRolesCount);\r\n\t\t\toverSize = true;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClick() {\r\n\t\tpopover.onClick(\r\n\t\t\t`/setup/${props.setup.id}`,\r\n\t\t\t\"setup\",\r\n\t\t\tsetupRef.current,\r\n\t\t\tfilterProfanity(props.setup.name, user.settings),\r\n\t\t\tdata => data.roles = JSON.parse(data.roles)\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"setup\" ref={setupRef} onClick={onClick}>\r\n\t\t\t<GameIcon gameType={props.setup.gameType} />\r\n\t\t\t{multi &&\r\n\t\t\t\t<i className=\"multi-setup-icon fas fa-list-alt\" />\r\n\t\t\t}\r\n\t\t\t{roleCounts}\r\n\t\t\t{overSize &&\r\n\t\t\t\t<i className=\"fas fa-ellipsis-h\" />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SmallRoleList(props) {\r\n\tvar roles;\r\n\r\n\tif (Array.isArray(props.roles))\r\n\t\troles = props.roles.map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\tsmall\r\n\t\t\t\trole={role}\r\n\t\t\t\tkey={role}\r\n\t\t\t\tshowSecondaryHover\r\n\t\t\t\tgameType={props.gameType} />\r\n\t\t));\r\n\telse\r\n\t\troles = Object.keys(props.roles).map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\trole={role}\r\n\t\t\t\tcount={props.roles[role]}\r\n\t\t\t\tsmall={true}\r\n\t\t\t\tgameType={props.gameType}\r\n\t\t\t\tshowSecondaryHover\r\n\t\t\t\tkey={role} />\r\n\t\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"small-role-list\">{roles}</div>\r\n\t);\r\n}\r\n\r\nexport function GameIcon(props) {\r\n\tconst gameType = hyphenDelimit(props.gameType);\r\n\treturn <div className={`game-icon ${gameType}`}></div>;\r\n}\r\n\r\nexport function GameStateIcon(props) {\r\n\tvar iconName;\r\n\r\n\tif (props.state == \"Day\")\r\n\t\ticonName = \"sun\";\r\n\telse if (props.state == \"Night\")\r\n\t\ticonName = \"moon\";\r\n\r\n\treturn <i className={`fa-${iconName} fas state-icon`} />\r\n}\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useParams, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { Avatar, Badges, NameWithAvatar } from \"./User\";\r\nimport { HiddenUpload, TextEditor } from \"../../components/Form\";\r\nimport LoadingPage from \"../Loading\";\r\nimport Setup from \"../../components/Setup\";\r\nimport { GameRow } from \"../Play/Join\";\r\nimport { Time, filterProfanity } from \"../../components/Basic\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { RatingThresholds, RequiredTotalForStats } from \"../../Constants\";\r\nimport { capitalize } from \"../../utils\";\r\nimport Comments from \"../Community/Comments\";\r\n\r\nimport \"../../css/user.css\";\r\n\r\nexport default function Profile() {\r\n\tconst [profileLoaded, setProfileLoaded] = useState(false);\r\n\tconst [name, setName] = useState();\r\n\tconst [avatar, setAvatar] = useState();\r\n\tconst [banner, setBanner] = useState();\r\n\tconst [bio, setBio] = useState(\"\");\r\n\tconst [oldBio, setOldBio] = useState();\r\n\tconst [editingBio, setEditingBio] = useState(false);\r\n\tconst [isFriend, setIsFriend] = useState(false);\r\n\tconst [settings, setSettings] = useState({});\r\n\tconst [accounts, setAccounts] = useState({});\r\n\tconst [recentGames, setRecentGames] = useState([]);\r\n\tconst [createdSetups, setCreatedSetups] = useState([]);\r\n\tconst [bustCache, setBustCache] = useState(false);\r\n\tconst [friendsPage, setFriendsPage] = useState(1);\r\n\tconst [maxFriendsPage, setMaxFriendsPage] = useState(1);\r\n\tconst [friends, setFriends] = useState([]);\r\n\tconst [friendRequests, setFriendRequests] = useState([]);\r\n\tconst [stats, setStats] = useState({ Mafia: {} });\r\n\tconst [groups, setGroups] = useState([]);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst history = useHistory();\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst { userId } = useParams();\r\n\r\n\tconst isSelf = userId == user.id;\r\n\tconst isBlocked = !isSelf && user.blockedUsers.indexOf(userId) != -1;\r\n\r\n\tuseEffect(() => {\r\n\t\tif (bustCache)\r\n\t\t\tsetBustCache(false);\r\n\t}, [bustCache]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (userId) {\r\n\t\t\tsetProfileLoaded(false);\r\n\r\n\t\t\taxios.get(`/user/${userId}/profile`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetProfileLoaded(true);\r\n\t\t\t\t\tsetName(res.data.name);\r\n\t\t\t\t\tsetAvatar(res.data.avatar);\r\n\t\t\t\t\tsetBanner(res.data.banner);\r\n\t\t\t\t\tsetBio(filterProfanity(res.data.bio, user.settings, \"\\\\*\") || \"\");\r\n\t\t\t\t\tsetIsFriend(res.data.isFriend);\r\n\t\t\t\t\tsetSettings(res.data.settings);\r\n\t\t\t\t\tsetAccounts(res.data.accounts || {});\r\n\t\t\t\t\tsetRecentGames(res.data.games);\r\n\t\t\t\t\tsetCreatedSetups(res.data.setups);\r\n\t\t\t\t\tsetMaxFriendsPage(res.data.maxFriendsPage);\r\n\t\t\t\t\tsetFriendRequests(res.data.friendRequests);\r\n\t\t\t\t\tsetFriendsPage(1);\r\n\t\t\t\t\tsetStats(res.data.stats);\r\n\t\t\t\t\tsetGroups(res.data.groups);\r\n\r\n\t\t\t\t\tdocument.title = `${res.data.name}'s Profile | BeyondMafia`;\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t\thistory.push(\"/play\");\r\n\t\t\t\t});\r\n\r\n\t\t\taxios.get(`/user/${userId}/friends`)\r\n\t\t\t\t.then((res) => {\r\n\t\t\t\t\tsetFriends(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\t}, [userId]);\r\n\r\n\tfunction onEditBanner(files, type) {\r\n\t\tif (!user.itemsOwned.customProfile) {\r\n\t\t\terrorAlert(\"You must purchase profile customization with coins from the Shop.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction onFileUpload(files, type) {\r\n\t\tif (files.length) {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append(\"image\", files[0]);\r\n\r\n\t\t\tfor (let el of document.getElementsByClassName(\"hidden-upload\"))\r\n\t\t\t\tel.value = \"\";\r\n\r\n\t\t\taxios.post(`/user/${type}`, formData)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\tcase \"avatar\":\r\n\t\t\t\t\t\t\tsetAvatar(true);\r\n\t\t\t\t\t\t\tsiteInfo.clearCache();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"banner\":\r\n\t\t\t\t\t\t\tsetBanner(true);\r\n\t\t\t\t\t\t\tsiteInfo.clearCache();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\tif (e.response == null || e.response.status == 413)\r\n\t\t\t\t\t\terrorAlert(\"File too large, must be less than 2 MB.\");\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onFriendUserClick() {\r\n\t\tif (isFriend) {\r\n\t\t\tvar shouldUnfriend = window.confirm(\"Are you sure you wish to unfriend or cancel your friend request?\");\r\n\t\t\tif (!shouldUnfriend)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\taxios.post(\"/user/friend\", { user: userId })\r\n\t\t\t.then((res) => {\r\n\t\t\t\tsetIsFriend(!isFriend);\r\n\t\t\t\tsiteInfo.showAlert(res.data, \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onBlockUserClick() {\r\n\t\tif (!isBlocked) {\r\n\t\t\tvar shouldBlock = window.confirm(\"Are you sure you wish to block this user?\");\r\n\t\t\tif (!shouldBlock)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\taxios.post(\"/user/block\", { user: userId })\r\n\t\t\t.then(() => {\r\n\t\t\t\tuser.blockUserToggle(userId);\r\n\r\n\t\t\t\tif (isBlocked)\r\n\t\t\t\t\tsiteInfo.showAlert(\"User unblocked.\", \"success\");\r\n\t\t\t\telse\r\n\t\t\t\t\tsiteInfo.showAlert(\"User blocked.\", \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onBioClick() {\r\n\t\tsetEditingBio(isSelf);\r\n\t\tsetOldBio(bio);\r\n\t}\r\n\r\n\tfunction onEditBio(e) {\r\n\t\taxios.post(`/user/bio`, { bio: bio })\r\n\t\t\t.then(() => {\r\n\t\t\t\tsetEditingBio(false);\r\n\t\t\t\tsetBio(filterProfanity(bio, user.settings, \"\\\\*\"));\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onCancelEditBio(e) {\r\n\t\te.stopPropagation();\r\n\t\tsetEditingBio(false);\r\n\t\tsetBio(oldBio);\r\n\t}\r\n\r\n\tfunction onAcceptFriend(_userId) {\r\n\t\taxios.post(\"/user/friend\", { user: _userId })\r\n\t\t\t.then((res) => {\r\n\t\t\t\tvar newFriendRequests = friendRequests.slice().filter(u => u.id != _userId);\r\n\t\t\t\tsetFriendRequests(newFriendRequests);\r\n\t\t\t\tsiteInfo.showAlert(res.data, \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRejectFriend(_userId) {\r\n\t\taxios.post(\"/user/friend/reject\", { user: _userId })\r\n\t\t\t.then((res) => {\r\n\t\t\t\tvar newFriendRequests = friendRequests.slice().filter(u => u.id != _userId);\r\n\t\t\t\tsetFriendRequests(newFriendRequests);\r\n\t\t\t\tsiteInfo.showAlert(res.data, \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onFriendsPageNav(page) {\r\n\t\tvar filterArg = getPageNavFilterArg(page, friendsPage, friends, \"lastActive\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/${userId}/friends?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.length) {\r\n\t\t\t\t\tsetFriends(res.data);\r\n\t\t\t\t\tsetFriendsPage(page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst panelStyle = {};\r\n\tconst bannerStyle = {};\r\n\r\n\tif (settings.backgroundColor)\r\n\t\tpanelStyle.backgroundColor = settings.backgroundColor;\r\n\r\n\tif (banner)\r\n\t\tbannerStyle.backgroundImage = `url(/uploads/${userId}_banner.jpg?t=${siteInfo.cacheVal})`;\r\n\r\n\tif (settings.bannerFormat == \"stretch\")\r\n\t\tbannerStyle.backgroundSize = \"100% 100%\";\r\n\r\n\tvar ratings;\r\n\r\n\tratings = Object.keys(stats[\"Mafia\"]).map(statName => {\r\n\t\tvar stat = stats[\"Mafia\"][statName];\r\n\r\n\t\tif (stat.total < RequiredTotalForStats)\r\n\t\t\tstat = \"-\";\r\n\t\telse if (statName == \"wins\")\r\n\t\t\tstat = `${Math.round((stat.count / stat.total) * 100)}%`;\r\n\t\telse {\r\n\t\t\tvar letter = \"F\";\r\n\t\t\tvar letters = Object.keys(RatingThresholds[statName]).reverse();\r\n\t\t\tvar i = 0;\r\n\r\n\t\t\tstat = stat.count / stat.total;\r\n\r\n\t\t\twhile (stat >= RatingThresholds[statName][letters[i]] && i < letters.length)\r\n\t\t\t\tletter = letters[i++];\r\n\r\n\t\t\tstat = letter;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"rating\" key={statName}>\r\n\t\t\t\t<div className=\"name\">\r\n\t\t\t\t\t{capitalize(statName)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"score\">\r\n\t\t\t\t\t{stat}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tconst recentGamesRows = recentGames.map(game => (\r\n\t\t<GameRow\r\n\t\t\tgame={game}\r\n\t\t\ttype={game.status || \"Finished\"}\r\n\t\t\tkey={game.id}\r\n\t\t\tsmall />\r\n\t));\r\n\r\n\tconst createdSetupRows = createdSetups.map(setup => (\r\n\t\t<Setup setup={setup} key={setup.id} />\r\n\t));\r\n\r\n\tconst friendRequestRows = friendRequests.map(user => (\r\n\t\t<div className=\"friend-request\" key={user.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<div className=\"btns\">\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"fas fa-check\"\r\n\t\t\t\t\tonClick={() => onAcceptFriend(user.id)} />\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"fas fa-times\"\r\n\t\t\t\t\tonClick={() => onRejectFriend(user.id)} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tconst friendRows = friends.map(friend => (\r\n\t\t<div className=\"friend\" key={friend.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={friend.id}\r\n\t\t\t\tname={friend.name}\r\n\t\t\t\tavatar={friend.avatar} />\r\n\t\t\t<div className=\"last-active\">\r\n\t\t\t\t<Time\r\n\t\t\t\t\tminSec\r\n\t\t\t\t\tmillisec={Date.now() - friend.lastActive}\r\n\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tif (user.loaded && !user.loggedIn && !userId)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (user.loaded && user.loggedIn && !userId)\r\n\t\treturn <Redirect to={`/user/${user.id}`} />;\r\n\r\n\tif (!profileLoaded || !user.loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"profile\">\r\n\t\t\t\t<div className=\"main-panel\" style={panelStyle}>\r\n\t\t\t\t\t<div className=\"banner\" style={bannerStyle}>\r\n\t\t\t\t\t\t{isSelf &&\r\n\t\t\t\t\t\t\t<HiddenUpload\r\n\t\t\t\t\t\t\t\tclassName=\"edit\"\r\n\t\t\t\t\t\t\t\tname=\"banner\"\r\n\t\t\t\t\t\t\t\tonClick={onEditBanner}\r\n\t\t\t\t\t\t\t\tonFileUpload={onFileUpload}>\r\n\t\t\t\t\t\t\t\t<i className=\"far fa-file-image\" />\r\n\t\t\t\t\t\t\t</HiddenUpload>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"user-info\">\r\n\t\t\t\t\t\t<div className=\"avi-name-row\">\r\n\t\t\t\t\t\t\t<div className=\"avi-name\">\r\n\t\t\t\t\t\t\t\t{!bustCache &&\r\n\t\t\t\t\t\t\t\t\t<Avatar\r\n\t\t\t\t\t\t\t\t\t\tlarge\r\n\t\t\t\t\t\t\t\t\t\tid={userId}\r\n\t\t\t\t\t\t\t\t\t\thasImage={avatar}\r\n\t\t\t\t\t\t\t\t\t\tbustCache={bustCache}\r\n\t\t\t\t\t\t\t\t\t\tname={name}\r\n\t\t\t\t\t\t\t\t\t\tedit={isSelf}\r\n\t\t\t\t\t\t\t\t\t\tonUpload={onFileUpload} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t<div className=\"name\">\r\n\t\t\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<Badges groups={groups} />\r\n\t\t\t\t\t\t{!isSelf && user.loggedIn &&\r\n\t\t\t\t\t\t\t<div className=\"options\">\r\n\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\tclassName={`fas fa-user-plus ${isFriend ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\tonClick={onFriendUserClick} />\r\n\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\tclassName={`fas fa-ban ${isBlocked ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\tonClick={onBlockUserClick}\r\n\t\t\t\t\t\t\t\t\ttitle=\"Block user\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"accounts\">\r\n\t\t\t\t\t\t\t{accounts.discord && settings.showDiscord &&\r\n\t\t\t\t\t\t\t\t<div className=\"account-badge\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"icon discord-icon\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"username-wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"username\">\r\n\t\t\t\t\t\t\t\t\t\t\t{accounts.discord}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{accounts.twitch && settings.showTwitch &&\r\n\t\t\t\t\t\t\t\t<div className=\"account-badge\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"icon twitch-icon\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"username-wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"username\">\r\n\t\t\t\t\t\t\t\t\t\t\t{accounts.twitch}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{accounts.steam && settings.showSteam &&\r\n\t\t\t\t\t\t\t\t<div className=\"account-badge\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"icon steam-icon\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"username-wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"username\">\r\n\t\t\t\t\t\t\t\t\t\t\t{accounts.steam}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName={`bio ${isSelf && !editingBio ? \"edit\" : \"\"}`}\r\n\t\t\t\t\t\t\tonClick={onBioClick}>\r\n\t\t\t\t\t\t\t{!editingBio &&\r\n\t\t\t\t\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t\t\t\t\t<ReactMarkdown source={bio} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{editingBio &&\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\t\t\t\tvalue={bio}\r\n\t\t\t\t\t\t\t\t\t\tonChange={setBio} />\r\n\t\t\t\t\t\t\t\t\t<div className=\"buttons\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"btn btn-theme\" onClick={onEditBio}>Submit</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"btn btn-theme-sec\" onClick={onCancelEditBio}>Cancel</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"side column\">\r\n\t\t\t\t\t{ratings.length > 0 &&\r\n\t\t\t\t\t\t<div className=\"box-panel ratings\" style={panelStyle}>\r\n\t\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\t\tMafia Ratings\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t\t{ratings}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div className=\"box-panel recent-games\" style={panelStyle}>\r\n\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\tRecent Games\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t{recentGamesRows}\r\n\t\t\t\t\t\t\t{recentGames.length == 0 &&\r\n\t\t\t\t\t\t\t\t\"No games\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{friendRequests.length > 0 &&\r\n\t\t\t\t\t\t<div className=\"box-panel friend-requests\" style={panelStyle}>\r\n\t\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\t\tFriend Requests\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t\t{friendRequestRows}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div className=\"box-panel friends\" style={panelStyle}>\r\n\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\tFriends\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t<PageNav\r\n\t\t\t\t\t\t\t\tinverted\r\n\t\t\t\t\t\t\t\tpage={friendsPage}\r\n\t\t\t\t\t\t\t\tonNav={onFriendsPageNav} />\r\n\t\t\t\t\t\t\t{friendRows}\r\n\t\t\t\t\t\t\t{friends.length == 0 &&\r\n\t\t\t\t\t\t\t\t\"No friends yet\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t<PageNav\r\n\t\t\t\t\t\t\t\tinverted\r\n\t\t\t\t\t\t\t\tpage={friendsPage}\r\n\t\t\t\t\t\t\t\tonNav={onFriendsPageNav} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"box-panel created-setups\" style={panelStyle}>\r\n\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\tSetups Created\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t{createdSetupRows}\r\n\t\t\t\t\t\t\t{createdSetups.length == 0 &&\r\n\t\t\t\t\t\t\t\t\"No setups\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<Comments location={userId} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport LoadingPage from \"../Loading\";\r\nimport Form, { useForm } from \"../../components/Form\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\n\r\nimport \"../../css/settings.css\";\r\nimport { setCaptchaVisible } from \"../../utils\";\r\n\r\nexport default function Settings(props) {\r\n\tconst [settingsLoaded, setSettingsLoaded] = useState(false);\r\n\tconst [accountsLoaded, setAccountsLoaded] = useState(false);\r\n\tconst [accounts, setAccounts] = useState({});\r\n\tconst history = useHistory();\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tconst [siteFields, updateSiteFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Referral URL\",\r\n\t\t\tref: \"referralURL\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tvalue: (deps) => `${process.env.REACT_APP_URL}/auth/login?ref=${deps.user.id}`,\r\n\t\t\tfixed: true,\r\n\t\t\thighlight: true\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"DMs from Friends Only\",\r\n\t\t\tref: \"onlyFriendDMs\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Disable PG-13 Censor\",\r\n\t\t\tref: \"disablePg13Censor\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"!disableAllCensors\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Disable All Censors\",\r\n\t\t\tref: \"disableAllCensors\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.perms.disableAllCensors\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Hide Deleted Posts\",\r\n\t\t\tref: \"hideDeleted\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.perms.viewDeleted\r\n\t\t}\r\n\t]);\r\n\r\n\tconst [profileFields, updateProfileFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Name\",\r\n\t\t\tref: \"username\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tsaveBtn: \"Change\",\r\n\t\t\tsaveBtnDiffer: \"name\",\r\n\t\t\tsaveBtnOnClick: onUsernameSave,\r\n\t\t\tconfirm: \"Are you sure you wish to change your username?\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Show Discord\",\r\n\t\t\tref: \"showDiscord\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.discord && deps.accounts.discord.id\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Show Twitch\",\r\n\t\t\tref: \"showTwitch\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.twitch && deps.accounts.twitch.id\r\n\t\t},\r\n\t\t// {\r\n\t\t// \tlabel: \"Show Google\",\r\n\t\t// \tref: \"showGoogle\",\r\n\t\t// \ttype: \"boolean\",\r\n\t\t// \tshowIf: (deps) => deps.accounts.google && deps.accounts.google.id\r\n\t\t// },\r\n\t\t{\r\n\t\t\tlabel: \"Show Steam\",\r\n\t\t\tref: \"showSteam\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.steam && deps.accounts.steam.id\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Background Color\",\r\n\t\t\tref: \"backgroundColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#5357a5\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.customProfile\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Banner Format\",\r\n\t\t\tref: \"bannerFormat\",\r\n\t\t\ttype: \"select\",\r\n\t\t\toptions: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Tile\",\r\n\t\t\t\t\tvalue: \"tile\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Stretch\",\r\n\t\t\t\t\tvalue: \"stretch\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.customProfile\r\n\t\t}\r\n\t], [accounts]);\r\n\r\n\tconst [gameFields, updateGameFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Name Color\",\r\n\t\t\tref: \"nameColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#000\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.textColors\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Text Color\",\r\n\t\t\tref: \"textColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#000\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.textColors\r\n\t\t}\r\n\t]);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Settings | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (user.loaded && user.loggedIn) {\r\n\t\t\tif (!settingsLoaded) {\r\n\t\t\t\taxios.get(\"/user/settings/data\")\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tlet siteFormFieldChanges = [];\r\n\t\t\t\t\t\tlet profileFormFieldChanges = [];\r\n\t\t\t\t\t\tlet gameFormFieldChanges = [];\r\n\r\n\t\t\t\t\t\tfor (let ref in res.data) {\r\n\t\t\t\t\t\t\tif (!res.data[ref]) continue;\r\n\r\n\t\t\t\t\t\t\tsiteFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tprofileFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tgameFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tupdateSiteFields(siteFormFieldChanges);\r\n\t\t\t\t\t\tupdateProfileFields(profileFormFieldChanges);\r\n\t\t\t\t\t\tupdateGameFields(gameFormFieldChanges);\r\n\t\t\t\t\t\tsetSettingsLoaded(true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\r\n\t\t\tif (!accountsLoaded) {\r\n\t\t\t\taxios.get(\"/user/accounts\")\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tsetAccounts(res.data);\r\n\t\t\t\t\t\tsetAccountsLoaded(true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [user]);\r\n\r\n\tfunction onSettingChange(action, update) {\r\n\t\tif (action.prop == \"value\" && !action.localOnly) {\r\n\t\t\taxios.post(\"/user/settings/update\", {\r\n\t\t\t\tprop: action.ref,\r\n\t\t\t\tvalue: action.value\r\n\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tuser.updateSetting(action.ref, action.value);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\r\n\t\tupdate(action);\r\n\t}\r\n\r\n\tfunction onUsernameSave(name, deps) {\r\n\t\tvar code = \"\";\r\n\r\n\t\tif (reservedNames.indexOf(name.toLowerCase()) != -1)\r\n\t\t\tcode = window.prompt(\"This name is reserved, please enter your reservation code.\");\r\n\r\n\t\taxios.post(\"/user/name\", { name, code })\r\n\t\t\t.then(res => {\r\n\t\t\t\tdeps.siteInfo.showAlert(\"Username changed\", \"success\");\r\n\r\n\t\t\t\tdeps.user.set(update(deps.user, {\r\n\t\t\t\t\tname: { $set: name },\r\n\t\t\t\t\titemsOwned: {\r\n\t\t\t\t\t\tnameChange: {\r\n\t\t\t\t\t\t\t$set: deps.user.itemsOwned.nameChange - 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(deps.errorAlert);\r\n\t}\r\n\r\n\tfunction onLogoutClick() {\r\n\t\taxios.post(\"/user/logout\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tuser.clear();\r\n\t\t\t\tsetCaptchaVisible(true);\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete your account? This is irreversible.\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/user/delete\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tuser.clear();\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tif (user.loaded && !user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (!settingsLoaded || !accountsLoaded || !user.loaded)\r\n\t\treturn <LoadingPage />\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main settings\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tSite\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={siteFields}\r\n\t\t\t\tdeps={{ user }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateSiteFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tProfile\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={profileFields}\r\n\t\t\t\tdeps={{ name: user.name, user, accounts, siteInfo, errorAlert }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateProfileFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tGame\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={gameFields}\r\n\t\t\t\tdeps={{ user }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateGameFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tAccounts\r\n\t\t\t</div>\r\n\t\t\t<div className=\"accounts-row\">\r\n\t\t\t\t<div className=\"accounts-column\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme-sec logout\"\r\n\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\tSign Out\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn delete-account\"\r\n\t\t\t\t\t\tonClick={onDeleteClick}>\r\n\t\t\t\t\t\tDelete Account\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nconst reservedNames = [\"Giga\", \"Giga13\", \"rend\", \"croned\", \"gameshowmaster\", \"gayshowmaster\", \"Golbolco\", \"damiandaniel72\", \"filko\", \"elizachikorita\", \"nyouhas\", \"Thisinthat\", \"jacobkrin\", \"nirkbocaj\", \"hima\", \"Rutab\", \"Nick\", \"kidneybeans\", \"emma\", \"baabaa\", \"DiSoRiEnTeD\", \"DiSo\", \"imasavage\", \"ducky\", \"Pranay7744\", \"Hugo\", \"Dasein\", \"SpaceTimeJumpa\", \"eadin\", \"jingahegami\", \"Kalakaua\", \"GoldenOne\", \"SamP4Palmer\", \"sevenseas\", \"GaryThompson\", \"lemonsun\", \"matt\", \"Transcend\", \"cozy\", \"winx\", \"Roxy\", \"Dawn\", \"mahugashaka\", \"koba\", \"DkKoba\", \"DarkB\", \"LeaderMafia\", \"Validor\", \"BrenTheDerg\", \"juke\", \"polly\", \"eric\", \"evolpz\", \"BradLand\", \"GoodQuestion\", \"Torreador\", \"Gamethroweador\", \"monkney\", \"monkey\", \"Furry\", \"Merlot\", \"Winnie\", \"arials\", \"arials92\", \"lesbian\", \"gays\", \"Mephistopheles\", \"Facilier\", \"MIKEISTKRIEG\", \"MIKEISTKRlEG\", \"JesseVentura\", \"nomsterrpengi\", \"kirbywithaknife\", \"kirbywithagun\", \"Super\", \"shady\", \"shady12\", \"cowboy\", \"Skittlez\", \"Moldyches\", \"Mizzmox\", \"Fro30\", \"Ngekop73\", \"ivana\", \"queen\", \"catlady\", \"mocha\", \"Rapsician\", \"Akari\", \"Sonrio\", \"Purple\", \"GardeningPapa\", \"davesprite\", \"sunburst\", \"RhaegarX\", \"Jennings\", \"ogwam\", \"bono\", \"Loser\", \"Winner\", \"talisker\", \"rigby\", \"CharlieBradbury\", \"KingEvin\", \"swan\", \"dream\", \"ERNurse\", \"lain\", \"jimmyjimjam\", \"starry\", \"muki\", \"starrydash\", \"Xinde\", \"sl0nderman\", \"starlysama\", \"lena\", \"nancy\", \"komaeda\", \"FLICKER\", \"Donut\", \"Mafia\", \"Mafsided\", \"PikachUwU\", \"Vaporeon\", \"marex\", \"feickoo\", \"DrSharky\", \"shwartz99\", \"gemrush\", \"sidnee\", \"MrSlipperyButt\", \"MrsSlipperyButt\", \"emsychum\", \"verum\", \"Disguiser\", \"Ryan\", \"CyanRyan\", \"SinB\", \"xray\", \"ShaggyRogers\", \"TheGreatCornholio\", \"RedRanger\", \"staypositivefriend\", \"FruityPebbles\", \"kimchi\", \"LeChuck\", \"Marty\", \"Joe_\", \"Kerry\", \"Miki\", \"Tristan117\", \"GoodBoiSweater\", \"Clair\", \"Hibiki\", \"viivii\", \"TheTurningRAY\", \"Frabel\", \"Wolf\", \"TheAsian\", \"Achilles\", \"ragefakar\", \"jets\", \"zoot\", \"EllaSantos\", \"Baya\", \"MeteorNate\", \"spookyaleks\", \"ohnoitsrepo\", \"Sona\", \"NinetyNineGhost\", \"ggnore2332\", \"Danny\", \"dannyred694\", \"flashbar\", \"emily\", \"bluscone\", \"Bebop\", \"morgan\", \"Zetonate\", \"johnmiller\", \"Reshoe7777777\", \"Chicken\", \"getdropkicked\", \"JigglyBuff\", \"ibeg\", \"khs131\", \"krista\", \"ania\", \"caitelatte\", \"celebrelatte\", \"Charge\", \"powerofdeath\", \"nightwing8782\", \"weaversden\", \"Valkyrie\", \"alex\", \"megan\", \"lana\", \"psy420\", \"anya\", \"SnowyB\", \"aphelios\", \"MasterCthulhu\", \"XrCyclone\", \"Cyclone\", \"sakin\", \"CooperD\", \"idah09h\", \"jeteon\", \"wink\", \"nicole\", \"sofia\", \"sofiiia\", \"Senty\", \"Sabi\", \"KutiPls\", \"Cream7\", \"Giga96\", \"arcbell\", \"admin\", \"administrator\", \"mod\", \"moderator\", \"lucid\", \"lucidrains\"];","import React, { useState, useEffect, useContext, useRef } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\n\r\nimport \"../../css/shop.css\";\r\n\r\nexport default function Shop(props) {\r\n\tconst [shopInfo, setShopInfo] = useState({ shopItems: [], balance: 0 });\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Shop | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!user.loaded || !user.loggedIn)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(\"/shop/info\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetShopInfo(res.data);\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}, [user.loaded]);\r\n\r\n\tfunction onBuyItem(index) {\r\n\t\tconst item = shopInfo.shopItems[index];\r\n\t\tconst shouldBuy = window.confirm(`Are you sure you wish to buy ${item.name} for ${item.price} coins?`);\r\n\r\n\t\tif (!shouldBuy)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/shop/spendCoins\", { item: index })\r\n\t\t\t.then(() => {\r\n\t\t\t\tsiteInfo.showAlert(\"Item purchased.\", \"success\");\r\n\r\n\t\t\t\tsetShopInfo(update(shopInfo, {\r\n\t\t\t\t\tbalance: {\r\n\t\t\t\t\t\t$set: shopInfo.balance - item.price\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tuser.set(update(user.state, {\r\n\t\t\t\t\titemsOwned: {\r\n\t\t\t\t\t\t[item.key]: {\r\n\t\t\t\t\t\t\t$set: user.itemsOwned[item.key] + 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst shopItems = shopInfo.shopItems.map((item, i) => (\r\n\t\t<div className=\"shop-item\" key={i}>\r\n\t\t\t<div className=\"name\">\r\n\t\t\t\t{item.name}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"desc\">\r\n\t\t\t\t{item.desc}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"bottom\">\r\n\t\t\t\t<div className=\"price\">\r\n\t\t\t\t\t<i className=\"fas fa-coins\" />\r\n\t\t\t\t\t{item.price} coins\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"owned\">\r\n\t\t\t\t\tOwned:\r\n\t\t\t\t\t<div className=\"amt\">\r\n\t\t\t\t\t\t{user.itemsOwned[item.key]}\r\n\t\t\t\t\t\t{item.limit != null &&\r\n\t\t\t\t\t\t\t` / ${item.limit}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={`buy btn btn-theme`}\r\n\t\t\t\t\tdisabled={item.limit != null && user.itemsOwned[item.key] >= item.limit}\r\n\t\t\t\t\tonClick={() => onBuyItem(i)}>\r\n\t\t\t\t\tBuy\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tif (user.loaded && !user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main shop\">\r\n\t\t\t<div className=\"top-bar\">\r\n\t\t\t\t<div className=\"balance\">\r\n\t\t\t\t\t<i className=\"fas fa-coins\" />\r\n\t\t\t\t\t{shopInfo.balance}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"shop-items\">\r\n\t\t\t\t{shopItems}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useContext } from \"react\";\r\nimport { Link, Route, Switch, Redirect } from \"react-router-dom\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport Profile from \"./Profile\";\r\nimport Settings from \"./Settings\";\r\nimport Shop from \"./Shop\";\r\nimport { UserContext, PopoverContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport { HiddenUpload } from \"../../components/Form\";\r\n\r\nimport \"../../css/user.css\"\r\n\r\nexport default function User(props) {\r\n\tconst user = useContext(UserContext);\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Profile\",\r\n\t\t\tpath: user.id ? `/user/${user.id}` : \"/user\",\r\n\t\t\texact: true,\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Settings\",\r\n\t\t\tpath: \"/user/settings\",\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Shop\",\r\n\t\t\tpath: \"/user/shop\",\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/user\" render={() => <Profile />} />\r\n\t\t\t\t\t<Route exact path=\"/user/settings\" render={() => <Settings />} />\r\n\t\t\t\t\t<Route exact path=\"/user/shop\" render={() => <Shop />} />\r\n\t\t\t\t\t<Route exact path=\"/user/:userId\" render={() => <Profile />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/user\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport function Avatar(props) {\r\n\tconst small = props.small;\r\n\tconst large = props.large;\r\n\tconst id = props.id;\r\n\tconst name = props.name;\r\n\tconst hasImage = props.hasImage;\r\n\tconst imageUrl = props.imageUrl;\r\n\tconst edit = props.edit;\r\n\tconst onUpload = props.onUpload;\r\n\tconst active = props.active;\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst style = {};\r\n\tconst colors = [\"#fff59d\", \"#ef9a9a\", \"#9fa8da\", \"#ce93d8\", \"#a5d6a7\", \"#f48fb1\", \"#ffcc80\", \"#90deea\", \"#80cbc4\"]; //yellow, red, blue, purple, green, pink, orange, cyan, teal\r\n\tvar size;\r\n\r\n\tif (small)\r\n\t\tsize = \"small\";\r\n\telse if (large)\r\n\t\tsize = \"large\";\r\n\telse\r\n\t\tsize = \"\";\r\n\r\n\tif (hasImage && !imageUrl && id) {\r\n\t\tstyle.backgroundImage = `url(/uploads/${id}_avatar.jpg?t=${siteInfo.cacheVal})`;\r\n\t}\r\n\telse if (hasImage && imageUrl) {\r\n\t\tstyle.backgroundImage = `url(${imageUrl})`;\r\n\t}\r\n\telse if (name) {\r\n\t\tvar rand = 0;\r\n\r\n\t\tfor (let i = 0; i < name.length; i++)\r\n\t\t\trand ^= name.charCodeAt(i);\r\n\r\n\t\trand ^= name.charCodeAt(1);\r\n\t\trand ^= rand << 13;\r\n\t\trand ^= rand >> 7;\r\n\t\trand ^= rand << 17;\r\n\t\trand = Math.abs(rand) / Math.pow(2, 31);\r\n\r\n\t\tstyle.backgroundColor = colors[Math.floor(rand * colors.length)];\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`avatar ${size} ${active ? \"active\" : \"\"}`}\r\n\t\t\tstyle={style}>\r\n\t\t\t{edit &&\r\n\t\t\t\t<HiddenUpload\r\n\t\t\t\t\tclassName=\"edit\"\r\n\t\t\t\t\tname=\"avatar\"\r\n\t\t\t\t\tonFileUpload={onUpload}>\r\n\t\t\t\t\t<i className=\"far fa-file-image\" />\r\n\t\t\t\t</HiddenUpload>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function NameWithAvatar(props) {\r\n\tconst id = props.id;\r\n\tconst name = props.name || \"[deleted]\";\r\n\tconst avatar = props.avatar;\r\n\tconst noLink = props.name ? props.noLink : true;\r\n\tconst color = props.color;\r\n\tconst newTab = props.newTab;\r\n\tconst small = props.small;\r\n\tconst active = props.active;\r\n\tconst groups = props.groups;\r\n\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\treturn (\r\n\t\t<Link\r\n\t\t\tclassName={`name-with-avatar ${noLink ? \"no-link\" : \"\"}`}\r\n\t\t\tto={`/user/${id}`}\r\n\t\t\ttarget={newTab ? \"_blank\" : \"\"}\r\n\t\t\tonClick={(e) => {\r\n\t\t\t\tpopover.setVisible(false);\r\n\r\n\t\t\t\tif (noLink)\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t}}>\r\n\t\t\t<Avatar\r\n\t\t\t\thasImage={avatar}\r\n\t\t\t\tid={id}\r\n\t\t\t\tname={name}\r\n\t\t\t\tsmall={small}\r\n\t\t\t\tactive={active} />\r\n\t\t\t<div className=\"user-name\" style={color ? { color: color } : {}}>{name}</div>\r\n\t\t\t{groups &&\r\n\t\t\t\t<Badges groups={groups} small={small} />\r\n\t\t\t}\r\n\t\t</Link>\r\n\t);\r\n}\r\n\r\nexport function StatusIcon(props) {\r\n\treturn (\r\n\t\t<div className={`status-icon ${props.status}`} />\r\n\t);\r\n}\r\n\r\nexport function Badges(props) {\r\n\tconst badges = props.groups\r\n\t\t.filter(g => g.badge)\r\n\t\t.sort((a, b) => a.rank - b.rank)\r\n\t\t.map(g => (\r\n\t\t\t<Badge\r\n\t\t\t\ticon={g.badge}\r\n\t\t\t\tcolor={g.badgeColor || \"black\"}\r\n\t\t\t\tname={g.name}\r\n\t\t\t\tkey={g.name} />\r\n\t\t));\r\n\r\n\treturn (\r\n\t\t<div className={`badge-list ${props.small ? \"small\" : \"\"}`}>\r\n\t\t\t{badges}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Badge(props) {\r\n\treturn (\r\n\t\t<div className=\"badge\">\r\n\t\t\t<i\r\n\t\t\t\tclassName={`fas fa-${props.icon}`}\r\n\t\t\t\tstyle={{ color: props.color }}\r\n\t\t\t\ttitle={props.name} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useUser() {\r\n\tconst [user, setUser] = useState({\r\n\t\tloggedIn: false,\r\n\t\tloaded: false,\r\n\t\tperms: {},\r\n\t\trank: 0,\r\n\t\tblockedUsers: [],\r\n\t\tsettings: {},\r\n\t\titemsOwned: {}\r\n\t});\r\n\r\n\tfunction clear() {\r\n\t\tsetUser({\r\n\t\t\tloggedIn: false,\r\n\t\t\tloaded: true,\r\n\t\t\tperms: {},\r\n\t\t\trank: 0,\r\n\t\t\tblockedUsers: []\r\n\t\t});\r\n\t}\r\n\r\n\tfunction blockUserToggle(userId) {\r\n\t\tvar userIndex = user.blockedUsers.indexOf(userId);\r\n\r\n\t\tif (userIndex == -1) {\r\n\t\t\tsetUser(update(user, {\r\n\t\t\t\tblockedUsers: {\r\n\t\t\t\t\t$push: [userId]\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsetUser(update(user, {\r\n\t\t\t\tblockedUsers: {\r\n\t\t\t\t\t$splice: [[userIndex, 1]]\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateSetting(prop, value) {\r\n\t\tsetUser(update(user, {\r\n\t\t\tsettings: {\r\n\t\t\t\t[prop]: {\r\n\t\t\t\t\t$set: value\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\treturn {\r\n\t\t...user,\r\n\t\tstate: user,\r\n\t\tset: setUser,\r\n\t\tblockUserToggle,\r\n\t\tupdateSetting,\r\n\t\tclear\r\n\t};\r\n}","import React, { useEffect } from \"react\";\r\n\r\nimport \"../css/emotes.css\";\r\n\r\nexport function Emote(props) {\r\n\tconst emoteKey = props.emote.toLowerCase();\r\n\tconst emote = Emotes[emoteKey];\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"emote\"\r\n\t\t\ttitle={emote.name}\r\n\t\t\tstyle={{ backgroundImage: `url('/images/emotes/${emote.name.toLowerCase()}.${emote.type}')` }} />\r\n\t);\r\n}\r\n\r\nexport function emotify(text) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\r\n\tfor (let i in text) {\r\n\t\tlet segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tconst words = segment.split(\" \");\r\n\r\n\t\tfor (let j in words) {\r\n\t\t\tlet word = words[j];\r\n\r\n\t\t\tfor (let k in EmoteKeys) {\r\n\t\t\t\tlet key = EmoteKeys[k];\r\n\r\n\t\t\t\tif (word.toLowerCase() == key.toLowerCase()) {\r\n\t\t\t\t\twords[j] = <Emote emote={key} />;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (k == EmoteKeys.length - 1)\r\n\t\t\t\t\twords[j] = words[j] + \" \";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext[i] = words;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport const Emotes = {\r\n\t\":ez:\": {\r\n\t\tname: \"EZ\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":doge:\": {\r\n\t\tname: \"doge\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":feelsdankman:\": {\r\n\t\tname: \"FeelsDankMan\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":feelsokayman:\": {\r\n\t\tname: \"FeelsOkayMan\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":kapp:\": {\r\n\t\tname: \"Kapp\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":monkagun:\": {\r\n\t\tname: \"MonkaGun\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":monkahmm:\": {\r\n\t\tname: \"MonkaHmm\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":monkas:\": {\r\n\t\tname: \"MonkaS\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":nodders:\": {\r\n\t\tname: \"Nodders\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":nopers:\": {\r\n\t\tname: \"Nopers\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":omegalul:\": {\r\n\t\tname: \"Omegalul\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":peepohappy:\": {\r\n\t\tname: \"PeepoHappy\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":peeposad:\": {\r\n\t\tname: \"PeepoSad\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":peepowtf:\": {\r\n\t\tname: \"PeepoWtf\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pepega:\": {\r\n\t\tname: \"Pepega\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pepegaaim:\": {\r\n\t\tname: \"PepegaAim\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":pepehands:\": {\r\n\t\tname: \"PepeHands\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pepelaugh:\": {\r\n\t\tname: \"PepeLaugh\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pepemeltdown:\": {\r\n\t\tname: \"PepeMeltdown\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":pepepains:\": {\r\n\t\tname: \"PepePains\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pepog:\": {\r\n\t\tname: \"PepoG\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":sadge:\": {\r\n\t\tname: \"Sadge\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pepepls:\": {\r\n\t\tname: \"PepePls\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":birb:\": {\r\n\t\tname: \"birb\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":bob:\": {\r\n\t\tname: \"bob\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":bub:\": {\r\n\t\tname: \"bub\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":catjam:\": {\r\n\t\tname: \"catjam\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":ditto:\": {\r\n\t\tname: \"ditto\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":fufu:\": {\r\n\t\tname: \"fufu\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":gay:\": {\r\n\t\tname: \"gay\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":hamster:\": {\r\n\t\tname: \"hamster\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":quiggle:\": {\r\n\t\tname: \"quiggle\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":sandbox:\": {\r\n\t\tname: \"sandbox\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":swag:\": {\r\n\t\tname: \"swag\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":thonk:\": {\r\n\t\tname: \"thonk\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":kekm:\": {\r\n\t\tname: \"kekm\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":omg:\": {\r\n\t\tname: \"omg\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pingu:\": {\r\n\t\tname: \"pingu\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":bats:\": {\r\n\t\tname: \"bats\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":boar:\": {\r\n\t\tname: \"boar\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":bum:\": {\r\n\t\tname: \"bum\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":bump:\": {\r\n\t\tname: \"bump\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":bunny:\": {\r\n\t\tname: \"bunny\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":cake:\": {\r\n\t\tname: \"cake\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":candycane:\": {\r\n\t\tname: \"candycane\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":cat:\": {\r\n\t\tname: \"cat\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":christmas:\": {\r\n\t\tname: \"christmas\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":clock:\": {\r\n\t\tname: \"clock\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":cookie:\": {\r\n\t\tname: \"cookie\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":cupcake:\": {\r\n\t\tname: \"cupcake\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":fox:\": {\r\n\t\tname: \"fox\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":ghost:\": {\r\n\t\tname: \"ghost\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":hammer:\": {\r\n\t\tname: \"hammer\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":horse:\": {\r\n\t\tname: \"horse\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":knife:\": {\r\n\t\tname: \"knife\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":lion:\": {\r\n\t\tname: \"lion\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":mermaid:\": {\r\n\t\tname: \"mermaid\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":panda:\": {\r\n\t\tname: \"panda\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":penguin:\": {\r\n\t\tname: \"penguin\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":pizza:\": {\r\n\t\tname: \"pizza\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":rainbow:\": {\r\n\t\tname: \"rainbow\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":rip:\": {\r\n\t\tname: \"rip\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":rose:\": {\r\n\t\tname: \"rose\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":santa:\": {\r\n\t\tname: \"santa\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":sheep:\": {\r\n\t\tname: \"sheep\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":shotgun:\": {\r\n\t\tname: \"shotgun\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":snake:\": {\r\n\t\tname: \"snake\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":snowman:\": {\r\n\t\tname: \"snowman\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":star:\": {\r\n\t\tname: \"star\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":tmnt:\": {\r\n\t\tname: \"tmnt\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":tiger:\": {\r\n\t\tname: \"tiger\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":turkey:\": {\r\n\t\tname: \"turkey\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":unicorn:\": {\r\n\t\tname: \"unicorn\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":werewolf:\": {\r\n\t\tname: \"werewolf\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":wolf:\": {\r\n\t\tname: \"wolf\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":yum:\": {\r\n\t\tname: \"yum\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\":3\": {\r\n\t\tname: \"candy\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"o_o\": {\r\n\t\tname: \"confused\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\";_;\": {\r\n\t\tname: \"cry\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":@\": {\r\n\t\tname: \"cthulhu\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"-_-\": {\r\n\t\tname: \"expressionless\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\">:(\": {\r\n\t\tname: \"frown\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":)\": {\r\n\t\tname: \"happy\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"<3\": {\r\n\t\tname: \"heart\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"-@\": {\r\n\t\tname: \"jack\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":|\": {\r\n\t\tname: \"neutral\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":(\": {\r\n\t\tname: \"sad\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":o\": {\r\n\t\tname: \"surprised\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\":p\": {\r\n\t\tname: \"tongue\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\";)\": {\r\n\t\tname: \"wink\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"zzz\": {\r\n\t\tname: \"zzz\",\r\n\t\ttype: \"png\"\r\n\t},\r\n};\r\n\r\nexport const EmoteKeys = Object.keys(Emotes);\r\n","export default [\r\n    \"fuck\",\r\n    \"shit\",\r\n    \"bitch\",\r\n    \"cunt\",\r\n    \"whore\",\r\n    \"dick\",\r\n    \"asshole\",\r\n]","export default [\r\n    \"chink\",\r\n    \"faggot\",\r\n    \"fag\",\r\n    \"nazi\",\r\n    \"nigga\",\r\n    \"nigger\",\r\n    \"retard\",\r\n    \"wetback\",\r\n]","import React, { useEffect, useState } from \"react\";\r\n\r\nimport { Avatar } from \"../pages/User/User\"\r\nimport { emotify } from \"./Emotes\";\r\nimport badWords from \"../json/badWords\";\r\nimport slurs from \"../json/slurs\";\r\n\r\nexport function ItemList(props) {\r\n\tconst items = props.items;\r\n\tconst itemRows = items.map(props.map);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`item-list ${props.className || \"\"}`}>\r\n\t\t\t{itemRows}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PanelGrid(props) {\r\n\tconst panels = props.panels.map((panel, i) => (\r\n\t\t<div className=\"box-panel\" key={i}>\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\t{panel.icon}\r\n\t\t\t\t<div className=\"heading-text\">\r\n\t\t\t\t\t{panel.name}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"content\">\r\n\t\t\t\t{panel.text}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\treturn (\r\n\t\t<div className=\"panel-grid\">\r\n\t\t\t{panels}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Time(props) {\r\n\tvar unit = \"millisecond\";\r\n\tvar value = props.millisec;\r\n\tvar suffix = props.suffix || \"\";\r\n\tvar minSec = props.minSec;\r\n\r\n\tconst units = [\r\n\t\t{\r\n\t\t\tname: \"second\",\r\n\t\t\tscale: 1000\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"minute\",\r\n\t\t\tscale: 60\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"hour\",\r\n\t\t\tscale: 60\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"day\",\r\n\t\t\tscale: 24\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"week\",\r\n\t\t\tscale: 7\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"year\",\r\n\t\t\tscale: 52\r\n\t\t}\r\n\t];\r\n\r\n\tlet i = 0;\r\n\twhile (i < units.length - 1 && value >= units[i].scale) {\r\n\t\tvalue /= units[i].scale;\r\n\t\tunit = units[i].name;\r\n\t\ti++;\r\n\t}\r\n\r\n\tif (minSec && unit == \"millisecond\")\r\n\t\treturn `Less than a second${suffix}`;\r\n\r\n\tvalue = Math.floor(value);\r\n\r\n\tif (value > 1)\r\n\t\tunit += \"s\";\r\n\r\n\treturn `${value} ${unit}${suffix}`;\r\n}\r\n\r\nexport function NotificationHolder(props) {\r\n\tconst notifCount = props.notifCount;\r\n\tconst onClick = props.onClick;\r\n\tconst lOffset = props.lOffset;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`notif-bound ${props.className || \"\"}`}\r\n\t\t\tonClick={onClick}\r\n\t\t\tref={props.fwdRef}>\r\n\t\t\t{notifCount > 0 &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<i className={`fas fa-circle notif-icon ${lOffset ? \"l-offset\" : \"\"}`}>\r\n\t\t\t\t\t\t<div className=\"notif-count\">\r\n\t\t\t\t\t\t\t{notifCount}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</i>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserText(props) {\r\n\tconst [content, setContent] = useState(props.text);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (props.text == null)\r\n\t\t\treturn;\r\n\r\n\t\tlet text = props.text;\r\n\r\n\t\tif (props.filterProfanity)\r\n\t\t\ttext = filterProfanity(text, props.settings, props.profChar);\r\n\r\n\t\tif (props.linkify)\r\n\t\t\ttext = linkify(text);\r\n\r\n\t\tif (props.avify)\r\n\t\t\ttext = avify(text, props.players);\r\n\r\n\t\tif (props.emotify)\r\n\t\t\ttext = emotify(text);\r\n\r\n\t\tsetContent(text);\r\n\t}, [props.text]);\r\n\r\n\treturn content;\r\n}\r\n\r\nexport function linkify(text) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tconst linkRegex = /http(s{0,1}):\\/\\/([\\w.]+)\\.(\\w+)([^\\s]*)/g;\r\n\r\n\tfor (let i in text) {\r\n\t\tlet _segment = text[i];\r\n\t\tlet segment = [];\r\n\t\tlet lastIndex = 0;\r\n\t\tlet regexRes = linkRegex.exec(_segment);\r\n\r\n\t\twhile (regexRes) {\r\n\t\t\tsegment.push(_segment.slice(lastIndex, regexRes.index));\r\n\t\t\tsegment.push(<a href={regexRes[0]} target=\"blank\" key={lastIndex}>{regexRes[0]}</a>);\r\n\r\n\t\t\tlastIndex = linkRegex.lastIndex;\r\n\t\t\tregexRes = linkRegex.exec(_segment);\r\n\t\t}\r\n\r\n\t\tsegment.push(_segment.slice(lastIndex, _segment.length));\r\n\t\ttext[i] = segment;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport function avify(text, players) {\r\n\t// Creating players array.\r\n\tconst playersArray = Object.values(players);\r\n\r\n\t// Creating RegExp to match %User calls.\r\n\tconst playerNames = playersArray.map(player => player.name);\r\n\tconst playerNamesRegex = new RegExp(`^%(${playerNames.join(\"|\")})$`);\r\n\r\n\t// Checking text against %User calls.\r\n\tconst words = text.split(\" \");\r\n\tfor (const i in words) {\r\n\t\tif (playerNamesRegex.test(words[i])) {\r\n\t\t\tconst user = playersArray.find(player => player.name === words[i].substring(1));\r\n\t\t\twords[i] = <Avatar\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tid={user.userId}\r\n\t\t\t\thasImage={user.avatar}\r\n\t\t\t\tsmall={true}\r\n\t\t\t\t/>;\r\n\t\t}\r\n\t}\r\n\ttext = words.flat();\r\n\treturn text;\r\n}\r\n\r\nexport function filterProfanity(text, settings, char) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tsettings = settings || {};\r\n\r\n\tfor (let i in text) {\r\n\t\tlet segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tchar = char || \"*\";\r\n\r\n\t\tif (!settings.disablePg13Censor)\r\n\t\t\tsegment = filterProfanitySegment(badWords, segment, char);\r\n\r\n\t\tif (!settings.disableAllCensors)\r\n\t\t\tsegment = filterProfanitySegment(slurs, segment, char);\r\n\r\n\t\ttext[i] = segment;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nfunction filterProfanitySegment(profanity, segment, char) {\r\n\tfor (let word of profanity) {\r\n\t\tlet regex = new RegExp(word, \"i\");\r\n\t\tlet regexRes = regex.exec(segment);\r\n\r\n\t\twhile (regexRes) {\r\n\t\t\tlet index = regexRes.index;\r\n\t\t\tlet length = regexRes[0].length;\r\n\t\t\tlet replacement = char.repeat(length);\r\n\r\n\t\t\tsegment = segment.split(\"\");\r\n\t\t\tsegment.splice(index, length, replacement);\r\n\t\t\tsegment = segment.join(\"\");\r\n\t\t\tregexRes = regex.exec(segment);\r\n\t\t}\r\n\t}\r\n\r\n\treturn segment;\r\n}\r\n\r\nexport function useOnOutsideClick(refs, action) {\r\n\tif (!Array.isArray(refs))\r\n\t\trefs = [refs];\r\n\r\n\tfunction onOutsideClick(e) {\r\n\t\tfor (let ref of refs)\r\n\t\t\tif (!ref || !ref.current || ref.current.contains(e.target))\r\n\t\t\t\treturn;\r\n\r\n\t\taction();\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.addEventListener(\"click\", onOutsideClick);\r\n\t\tdocument.addEventListener(\"contextmenu\", onOutsideClick);\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener(\"click\", onOutsideClick);\r\n\t\t};\r\n\t}, refs);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, LastWillEntry, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function MafiaGame() {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Mafia\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Day\", \"Night\", \"Sunset\"];\r\n\tconst audioFileNames = [/*\"Day\", \"Night\", \"Sunset\", \"nonvillagewin\", \"villagewin\", */\"gunshot\"];\r\n\tconst audioLoops = [/*true, true, true, false, false, */false];\r\n\tconst audioOverrides = [/*true, true, true, false, false, */false];\r\n\tconst audioVolumes = [/*1, 1, 1, 1, 1, */1];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Village\") != -1)\r\n\t\t\t// \tgame.playAudio(\"villagewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"nonvillagewin\");\r\n\t\t});\r\n\r\n\t\tsocket.on(\"gunshot\", () => {\r\n\t\t\tgame.playAudio(\"gunshot\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tnoLeaveRef={game.noLeaveRef}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>M</span>afia\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\treview={game.review}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tsetTyping={game.setTyping}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!game.review && !isSpectator && history.currentState >= 0 && game.setup.lastWill &&\r\n\t\t\t\t\t\t\t<LastWillEntry\r\n\t\t\t\t\t\t\t\tlastWill={game.lastWill}\r\n\t\t\t\t\t\t\t\tsocket={game.socket} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{!game.review && !isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function SplitDecisionGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Split Decision\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Round\", \"Hostage Swap\"];\r\n\tconst audioFileNames = [];\r\n\tconst audioLoops = [];\r\n\tconst audioOverrides = [];\r\n\tconst audioVolumes = [];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Blue\") != -1)\r\n\t\t\t// \tgame.playAudio(\"bluewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"redwin\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>Split</span> Decision\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function ResistanceGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Resistance\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Team Selection\", \"Team Approval\", \"Mission\"];\r\n\tconst audioFileNames = [];\r\n\tconst audioLoops = [];\r\n\tconst audioOverrides = [];\r\n\tconst audioVolumes = [];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Resistance\") != -1)\r\n\t\t\t// \tgame.playAudio(\"resistancewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"spieswin\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>R</span>esistance\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, LastWillEntry, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function OneNightGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"One Night\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Day\", \"Night\"];\r\n\tconst audioFileNames = [/*\"Day\", \"Night\", \"nonvillagewin\", \"villagewin\", */\"gunshot\"];\r\n\tconst audioLoops = [/*true, true, true, false, false, */false];\r\n\tconst audioOverrides = [/*true, true, true, false, false, */false];\r\n\tconst audioVolumes = [/*1, 1, 1, 1, 1, */1];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Village\") != -1)\r\n\t\t\t// \tgame.playAudio(\"villagewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"nonvillagewin\");\r\n\t\t});\r\n\r\n\t\tsocket.on(\"gunshot\", () => {\r\n\t\t\tgame.playAudio(\"gunshot\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>One</span> Night\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","const PING_INTERVAL = 10000;\r\n\r\nclass Socket {\r\n\r\n    constructor(socket) {\r\n        this.listeners = {};\r\n        this.sendQueue = [];\r\n        this.received = [];\r\n\r\n        this.setSocket(socket);\r\n    }\r\n\r\n    setSocket(socket) {\r\n        this.socket = socket;\r\n\r\n        this.configureListeners();\r\n\r\n        this.socket.addEventListener(\"open\", () => {\r\n            this.received = [];\r\n\r\n            for (let message of this.sendQueue)\r\n                this.socket.send(message);\r\n        });\r\n\r\n        this.socket.addEventListener(\"close\", () => {\r\n            this.triggerEvent(\"disconnected\");\r\n        });\r\n\r\n        this.socket.addEventListener(\"error\", () => {\r\n            this.terminate();\r\n        });\r\n    }\r\n\r\n    configureListeners() {\r\n        this.socket.addEventListener(\"message\", message => {\r\n            const [eventName, data] = parseMessage(message.data);\r\n            this.triggerEvent(eventName, data);\r\n            this.received.push({ eventName, data });\r\n        });\r\n    }\r\n\r\n    triggerEvent(eventName, data) {\r\n        const actions = this.listeners[eventName];\r\n\r\n        if (!actions)\r\n            return;\r\n\r\n        for (let i = 0; i < actions.length; i++)\r\n            actions[i](data);\r\n    }\r\n\r\n    on(eventName, action) {\r\n        if (!this.listeners[eventName])\r\n            this.listeners[eventName] = [];\r\n\r\n        action = action.bind(this);\r\n        this.listeners[eventName].push(action);\r\n\r\n        for (let message of this.received)\r\n            if (message.eventName == eventName)\r\n                action(message.data);\r\n    }\r\n\r\n    send(eventName, data) {\r\n        const message = stringifyMessage(eventName, data);\r\n\r\n        if (this.socket.readyState == 0)\r\n            this.sendQueue.push(message);\r\n        else if (this.socket.readyState == 1)\r\n            this.socket.send(message);\r\n    }\r\n\r\n    clearListeners() {\r\n        var newListeners = {};\r\n        newListeners[\"p\"] = this.listeners[\"p\"];\r\n        this.listeners = newListeners;\r\n    }\r\n\r\n    terminate() {\r\n        this.socket.close();\r\n    }\r\n\r\n    get readyState() {\r\n        if (this.socket)\r\n            return this.socket.readyState;\r\n        else\r\n            return 3;\r\n    }\r\n\r\n}\r\n\r\nexport class ClientSocket extends Socket {\r\n\r\n    constructor(path, persistent) {\r\n        super(new WebSocket(path));\r\n\r\n        this.path = path;\r\n        this.persistent = persistent;\r\n\r\n        this.configurePing();\r\n        this.configureClose();\r\n    }\r\n\r\n    reconnect() {\r\n        super.setSocket(new WebSocket(this.path));\r\n        this.heartbeat();\r\n        this.configureClose();\r\n    }\r\n\r\n    configurePing() {\r\n        this.heartbeat();\r\n        this.on(\"p\", () => this.heartbeat());\r\n    }\r\n\r\n    heartbeat() {\r\n        clearTimeout(this.pingTimeout);\r\n        this.send(\"p\");\r\n\r\n        this.pingTimeout = setTimeout(() => {\r\n            this.socket.close();\r\n        }, PING_INTERVAL + 1000);\r\n    }\r\n\r\n    configureClose() {\r\n        this.socket.addEventListener(\"close\", () => {\r\n            if (this.persistent)\r\n                this.reconnect();\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this.pingTimeout);\r\n\r\n        this.persistent = false;\r\n        this.listeners = {};\r\n        this.sendQueue = [];\r\n\r\n        if (this.socket)\r\n            this.socket.close();\r\n\r\n        this.socket = null;\r\n    }\r\n\r\n}\r\n\r\nexport function stringifyMessage(eventName, data) {\r\n    const type = typeof data;\r\n\r\n    if (type == \"undefined\")\r\n        return eventName;\r\n\r\n    if (type == \"object\")\r\n        data = JSON.stringify(data);\r\n    else if (type != \"string\")\r\n        data = String(data);\r\n\r\n    return `${eventName}:${type}:${data}`;\r\n}\r\n\r\nexport function parseMessage(message) {\r\n    var split = message.split(/:(.*)/s);\r\n    const eventName = split[0];\r\n\r\n    if (split.length < 2)\r\n        return [eventName];\r\n\r\n    split = split[1].split(/:(.*)/s);\r\n\r\n    if (split.length < 2)\r\n        return;\r\n\r\n    const type = split[0];\r\n    var data = split[1];\r\n\r\n    switch (type) {\r\n        case \"number\":\r\n            data = Number(data);\r\n            break;\r\n        case \"boolean\":\r\n            data = data != \"false\";\r\n            break;\r\n        case \"object\":\r\n            try {\r\n                data = JSON.parse(data);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n            break;\r\n    }\r\n\r\n    return [eventName, data];\r\n}","import React, { useState, useEffect, useLayoutEffect, useReducer, useContext, useRef } from \"react\";\r\nimport { useParams, Switch, Route, Redirect } from \"react-router-dom\";\r\nimport update from \"immutability-helper\";\r\nimport axios from \"axios\";\r\nimport AgoraRTC from \"agora-rtc-sdk-ng\";\r\nimport ReactLoading from \"react-loading\";\r\n\r\nimport { filterProfanity, linkify, UserText } from \"../../components/Basic\";\r\nimport LoadingPage from \"../Loading\";\r\nimport MafiaGame from \"./MafiaGame\";\r\nimport SplitDecisionGame from \"./SplitDecisionGame\";\r\nimport ResistanceGame from \"./ResistanceGame\";\r\nimport OneNightGame from \"./OneNightGame\";\r\nimport { GameContext, PopoverContext, SiteInfoContext, UserContext } from \"../../Contexts\";\r\nimport Dropdown, { useDropdown } from \"../../components/Dropdown\";\r\nimport Setup from \"../../components/Setup\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\nimport { ClientSocket as Socket } from \"../../Socket\";\r\nimport { RoleCount } from \"../../components/Roles\";\r\nimport Form, { useForm } from \"../../components/Form\";\r\nimport { Modal } from \"../../components/Modal\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { MaxGameMessageLength, MaxWillLength } from \"../../Constants\";\r\n\r\nimport \"../../css/game.css\";\r\n\r\nexport default function Game() {\r\n    return (\r\n        <Switch>\r\n            <Route exact path=\"/game/:gameId\" render={(props) => <GameWrapper key={props.match.params.gameId} />} />\r\n            <Route exact path=\"/game/:gameId/review\" render={() => <GameWrapper review />} />\r\n            <Redirect to=\"/play\" />\r\n        </Switch>\r\n    );\r\n}\r\n\r\nfunction GameWrapper(props) {\r\n    const [loaded, setLoaded] = useState(false);\r\n    const [leave, setLeave] = useState(false);\r\n    const [finished, setFinished] = useState(false);\r\n    const [port, setPort] = useState();\r\n    const [gameType, setGameType] = useState();\r\n    const [token, setToken] = useState();\r\n    const [socket, setSocket] = useState({});\r\n    const [connected, setConnected] = useState(0);\r\n    const [setup, setSetup] = useState();\r\n    const [options, setOptions] = useState({});\r\n    const [emojis, setEmojis] = useState({});\r\n    const [history, updateHistory] = useHistoryReducer();\r\n    const [stateViewing, updateStateViewing] = useStateViewingReducer(history);\r\n    const [players, updatePlayers] = usePlayersReducer();\r\n    const [spectatorCount, setSpectatorCount] = useState(0);\r\n    const [isSpectator, setIsSpectator] = useState(false);\r\n    const [self, setSelf] = useState();\r\n    const [lastWill, setLastWill] = useState(\"\");\r\n    const [timers, updateTimers] = useTimersReducer();\r\n    const [settings, updateSettings] = useSettingsReducer();\r\n    const [showSettingsModal, setShowSettingsModal] = useState(false);\r\n    const [showFirstGameModal, setShowFirstGameModal] = useState(false);\r\n    const [speechFilters, setSpeechFilters] = useState({ from: \"\", contains: \"\" });\r\n    const [activeVoiceChannel, setActiveVoiceChannel] = useState();\r\n    const [muted, setMuted] = useState(false);\r\n    const [deafened, setDeafened] = useState(false);\r\n    const [rehostId, setRehostId] = useState();\r\n    const [dev, setDev] = useState(false);\r\n\r\n    const playersRef = useRef();\r\n    const selfRef = useRef();\r\n    const agoraClient = useRef();\r\n    const localAudioTrack = useRef();\r\n    const noLeaveRef = useRef();\r\n\r\n    const [activity, updateActivity] = useActivity(agoraClient, localAudioTrack);\r\n    const [playAudio, loadAudioFiles, stopAudio, stopAudios, setVolume] = useAudio(settings);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const popover = useContext(PopoverContext);\r\n    const errorAlert = useErrorAlert();\r\n    const { gameId } = useParams();\r\n\r\n    const audioFileNames = [\"bell\", \"ping\", \"tick\"];\r\n    const audioLoops = [false, false, false];\r\n    const audioOverrides = [false, false, false];\r\n    const audioVolumes = [1, 1, 1];\r\n\r\n    useEffect(() => {\r\n        if (token == null)\r\n            return;\r\n\r\n        var socketURL;\r\n\r\n        if (process.env.REACT_APP_USE_PORT == \"true\")\r\n            socketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}:${port}`;\r\n        else\r\n            socketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}/${port}`;\r\n\r\n        var newSocket = new Socket(socketURL);\r\n        newSocket.on(\"connected\", () => setConnected(connected + 1));\r\n        newSocket.on(\"disconnected\", () => setConnected(connected - 1));\r\n        setSocket(newSocket);\r\n\r\n        return () => {\r\n            if (newSocket)\r\n                newSocket.clear();\r\n        };\r\n    }, [token]);\r\n\r\n    useEffect(() => {\r\n        if (finished) {\r\n            socket.clear();\r\n            setSocket({ send: () => { } });\r\n        }\r\n    }, [finished]);\r\n\r\n    useEffect(() => {\r\n        updateSettings({ type: \"load\" });\r\n\r\n        if (!props.review) {\r\n            document.title = `Game ${gameId} | BeyondMafia`;\r\n            loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n            requestNotificationAccess();\r\n\r\n            var timerInterval = setInterval(() => {\r\n                updateTimers({\r\n                    type: \"updateAll\",\r\n                    playAudio\r\n                });\r\n            }, 1000);\r\n\r\n            function onKeydown() {\r\n                var speechInput = document.getElementById(\"speechInput\");\r\n                var activeElName = document.activeElement.tagName;\r\n\r\n                if (speechInput && activeElName != \"INPUT\" && activeElName != \"TEXTAREA\")\r\n                    speechInput.focus();\r\n            }\r\n\r\n            window.addEventListener(\"keydown\", onKeydown);\r\n\r\n            return () => {\r\n                window.removeEventListener(\"keydown\", onKeydown);\r\n\r\n                clearInterval(timerInterval);\r\n                stopAudio();\r\n                agoraDisconnect();\r\n\r\n                if (localAudioTrack.current)\r\n                    localAudioTrack.current.close();\r\n\r\n            }\r\n        }\r\n        else {\r\n            document.title = `Review Game ${gameId} | BeyondMafia`;\r\n\r\n            axios.get(`/game/${gameId}/review/data`)\r\n                .then(res => {\r\n                    var data = res.data;\r\n\r\n                    if (data.broken) {\r\n                        setLeave(true);\r\n                        errorAlert(\"Game not found.\");\r\n                        return;\r\n                    }\r\n\r\n                    setGameType(data.type);\r\n                    setSetup(data.setup);\r\n\r\n                    setOptions({\r\n                        ranked: data.ranked,\r\n                        spectating: data.spectating,\r\n                        private: false\r\n                    });\r\n\r\n                    updateHistory({\r\n                        type: \"set\",\r\n                        history: JSON.parse(data.history)\r\n                    });\r\n\r\n                    var players = {};\r\n\r\n                    for (let i in data.players) {\r\n                        players[data.players[i]] = {\r\n                            id: data.players[i],\r\n                            name: data.names[i],\r\n                            userId: data.users[i] ? data.users[i].id : \"\",\r\n                            avatar: data.users[i] ? data.users[i].avatar : false,\r\n                            textColor: data.users[i] && data.users[i].settings.textColor,\r\n                            nameColor: data.users[i] && data.users[i].settings.nameColor,\r\n                            left: data.left.indexOf(data.players[i]) != -1\r\n                        };\r\n                    }\r\n\r\n                    updatePlayers({\r\n                        type: \"set\",\r\n                        players\r\n                    });\r\n\r\n                    setLoaded(true);\r\n                })\r\n                .catch((e) => {\r\n                    setLeave(true);\r\n                    errorAlert(e);\r\n                });\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        selfRef.current = self;\r\n    }, [self]);\r\n\r\n    useEffect(() => {\r\n        if (stateViewing == null)\r\n            updateStateViewing({ type: \"current\" });\r\n    }, [history.currentState]);\r\n\r\n    useEffect(() => {\r\n        playersRef.current = players;\r\n    }, [players]);\r\n\r\n    useEffect(() => {\r\n        if (!options.voiceChat || props.review)\r\n            return;\r\n\r\n        if (!activeVoiceChannel) {\r\n            agoraDisconnect();\r\n            return;\r\n        }\r\n\r\n        var state = history.states[history.currentState];\r\n        var meeting = state && state.meetings[activeVoiceChannel];\r\n        var vcToken = meeting && meeting.vcToken;\r\n\r\n        if (vcToken)\r\n            agoraConnect(activeVoiceChannel, vcToken);\r\n    }, [activeVoiceChannel]);\r\n\r\n    useEffect(() => {\r\n        if (socket.readyState != 1) {\r\n            if (\r\n                (socket.readyState == null || socket.readyState == 3) &&\r\n                !leave &&\r\n                !finished &&\r\n                !props.review) {\r\n                getConnectionInfo();\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (token)\r\n            socket.send(\"auth\", token);\r\n        else\r\n            socket.send(\"join\", { gameId, guestId: window.localStorage.getItem(\"cacheVal\") });\r\n\r\n        socket.on(\"authSuccess\", () => {\r\n            socket.send(\"join\", {\r\n                gameId,\r\n                isBot: window.location.search == \"?bot\"\r\n            });\r\n        });\r\n\r\n        socket.on(\"loaded\", () => {\r\n            setLoaded(true);\r\n        });\r\n\r\n        socket.on(\"setup\", data => {\r\n            setSetup(data);\r\n        });\r\n\r\n        socket.on(\"options\", options => {\r\n            setOptions(options);\r\n        });\r\n\r\n        socket.on(\"emojis\", emojis => {\r\n            setEmojis(emojis);\r\n        });\r\n\r\n        socket.on(\"state\", state => {\r\n            updateHistory({ type: \"addState\", state: state });\r\n        });\r\n\r\n        socket.on(\"history\", history => {\r\n            updateHistory({\r\n                type: \"set\",\r\n                history\r\n            });\r\n        });\r\n\r\n        socket.on(\"players\", players => {\r\n            updatePlayers({\r\n                type: \"set\",\r\n                players\r\n            });\r\n        });\r\n\r\n        socket.on(\"playerJoin\", player => {\r\n            updatePlayers({\r\n                type: \"add\",\r\n                player\r\n            });\r\n        });\r\n\r\n        socket.on(\"playerLeave\", playerId => {\r\n            updatePlayers({\r\n                type: \"remove\",\r\n                playerId\r\n            });\r\n        });\r\n\r\n        socket.on(\"spectatorCount\", count => {\r\n            setSpectatorCount(count);\r\n        });\r\n\r\n        socket.on(\"self\", playerId => {\r\n            setSelf(playerId);\r\n        });\r\n\r\n        socket.on(\"reveal\", info => {\r\n            updateHistory({\r\n                type: \"reveal\",\r\n                playerId: info.playerId,\r\n                role: info.role\r\n            });\r\n        });\r\n\r\n        socket.on(\"death\", playerId => {\r\n            updateHistory({\r\n                type: \"death\",\r\n                playerId,\r\n            });\r\n        });\r\n\r\n        socket.on(\"revival\", playerId => {\r\n            updateHistory({\r\n                type: \"revival\",\r\n                playerId,\r\n            });\r\n        });\r\n\r\n        socket.on(\"meeting\", meeting => {\r\n            updateHistory({\r\n                type: \"addMeeting\",\r\n                meeting\r\n            });\r\n        });\r\n\r\n        socket.on(\"members\", info => {\r\n            updateHistory({\r\n                type: \"meetingMembers\",\r\n                meetingId: info.meetingId,\r\n                members: info.members\r\n            });\r\n        });\r\n\r\n        socket.on(\"leftMeeting\", meetingId => {\r\n            updateHistory({\r\n                type: \"removeMeeting\",\r\n                meetingId\r\n            });\r\n        });\r\n\r\n        socket.on(\"stateEvents\", stateEvents => {\r\n            updateHistory({\r\n                type: \"stateEvents\",\r\n                stateEvents\r\n            });\r\n        });\r\n\r\n        socket.on(\"message\", message => {\r\n            updateHistory({\r\n                type: \"addMessage\",\r\n                message\r\n            });\r\n\r\n            const pings = message.content.match(/@[\\w-]*/gm) || [];\r\n\r\n            if (\r\n                selfRef.current && playersRef.current[selfRef.current] &&\r\n                (\r\n                    pings.indexOf(\"@\" + playersRef.current[selfRef.current].name) != -1 ||\r\n                    pings.indexOf(\"@everyone\") != -1\r\n                )\r\n            ) {\r\n                playAudio(\"ping\");\r\n            }\r\n        });\r\n\r\n        socket.on(\"quote\", quote => {\r\n            updateHistory({\r\n                type: \"addQuote\",\r\n                quote\r\n            });\r\n        });\r\n\r\n        socket.on(\"vote\", vote => {\r\n            updateHistory({\r\n                type: \"vote\",\r\n                vote\r\n            });\r\n        });\r\n\r\n        socket.on(\"unvote\", info => {\r\n            updateHistory({\r\n                type: \"unvote\",\r\n                info\r\n            });\r\n        });\r\n\r\n        socket.on(\"lastWill\", will => {\r\n            setLastWill(will);\r\n        });\r\n\r\n        socket.on(\"firstGame\", () => {\r\n            setShowFirstGameModal(true);\r\n        });\r\n\r\n        socket.on(\"timerInfo\", info => {\r\n            updateTimers({\r\n                type: \"create\",\r\n                timer: info\r\n            });\r\n\r\n            if (\r\n                info.name == \"pregameCountdown\" &&\r\n                Notification &&\r\n                Notification.permission == \"granted\" &&\r\n                !document.hasFocus()\r\n            ) {\r\n                new Notification(\"Your game is starting!\");\r\n            }\r\n        });\r\n\r\n        socket.on(\"clearTimer\", name => {\r\n            updateTimers({\r\n                type: \"clear\",\r\n                name\r\n            });\r\n        });\r\n\r\n        socket.on(\"time\", info => {\r\n            updateTimers({\r\n                type: \"update\",\r\n                name: info.name,\r\n                time: info.time\r\n            });\r\n        });\r\n\r\n        socket.on(\"typing\", info => {\r\n            updateActivity({\r\n                type: \"typing\",\r\n                playerId: info.playerId,\r\n                meetingId: info.meetingId\r\n            });\r\n        });\r\n\r\n        socket.on(\"isSpectator\", () => {\r\n            setIsSpectator(true);\r\n        });\r\n\r\n        socket.on(\"left\", () => {\r\n            if (!noLeaveRef.current) {\r\n                setLeave(true);\r\n                siteInfo.hideAllAlerts();\r\n            }\r\n        });\r\n\r\n        socket.on(\"finished\", () => {\r\n            setFinished(true);\r\n        });\r\n\r\n        socket.on(\"error\", error => {\r\n            setLeave(true);\r\n            errorAlert(error);\r\n        });\r\n\r\n        socket.on(\"dev\", () => {\r\n            setDev(true);\r\n        });\r\n    }, [connected]);\r\n\r\n    function getConnectionInfo() {\r\n        axios.get(`/game/${gameId}/connect`)\r\n            .then(res => {\r\n                setGameType(res.data.type);\r\n                setPort(res.data.port);\r\n                setToken(res.data.token || false);\r\n            })\r\n            .catch(e => {\r\n                var msg = e && e.response && e.response.data;\r\n\r\n                if (msg == \"Game not found.\")\r\n                    setLeave(\"review\");\r\n                else {\r\n                    setLeave(true);\r\n                    errorAlert(e);\r\n                }\r\n            });\r\n    }\r\n\r\n    function createAgoraClient() {\r\n        if (agoraClient.current)\r\n            return;\r\n\r\n        agoraClient.current = AgoraRTC.createClient({ mode: \"rtc\", codec: \"vp8\" });\r\n\r\n        agoraClient.current.on(\"user-published\", async (user, mediaType) => {\r\n            if (mediaType != \"audio\")\r\n                return;\r\n\r\n            await agoraClient.current.subscribe(user, mediaType);\r\n\r\n            if (deafened)\r\n                user.audioTrack.setVolume(0);\r\n\r\n            user.audioTrack.play();\r\n        });\r\n\r\n        agoraClient.current.on(\"user-unpublished\", user => {\r\n            var audioContainer = document.getElementById(user.uid);\r\n\r\n            if (audioContainer)\r\n                audioContainer.remove();\r\n        });\r\n    }\r\n\r\n    async function agoraConnect(meetingId, token) {\r\n        try {\r\n            if (!agoraClient.current)\r\n                createAgoraClient();\r\n            else\r\n                await agoraDisconnect();\r\n\r\n            await agoraClient.current.join(process.env.REACT_APP_AGORA_ID, meetingId, token, self);\r\n\r\n            if (!localAudioTrack.current) {\r\n                localAudioTrack.current = await AgoraRTC.createMicrophoneAudioTrack();\r\n\r\n                if (muted)\r\n                    localAudioTrack.current.setVolume(0);\r\n            }\r\n\r\n            await agoraClient.current.publish([localAudioTrack.current]);\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    async function agoraDisconnect() {\r\n        if (!agoraClient.current)\r\n            return;\r\n\r\n        agoraClient.current.remoteUsers.forEach(user => {\r\n            let audioContainer = document.getElementById(user.uid);\r\n\r\n            if (audioContainer)\r\n                audioContainer.remove();\r\n        });\r\n\r\n        await agoraClient.current.leave();\r\n    }\r\n\r\n    if (leave == \"review\")\r\n        return <Redirect to={`/game/${gameId}/review`} />;\r\n    else if (leave)\r\n        return <Redirect to=\"/play\" />;\r\n    else if (rehostId)\r\n        return <Redirect to={`/game/${rehostId}`} />;\r\n    else if (!loaded || stateViewing == null)\r\n        return (\r\n            <div className=\"game\">\r\n                <LoadingPage />\r\n            </div>\r\n        );\r\n    else {\r\n        const context = {\r\n            socket: socket,\r\n            review: props.review,\r\n            setup: setup,\r\n            history: history,\r\n            updateHistory: updateHistory,\r\n            stateViewing: stateViewing,\r\n            updateStateViewing: updateStateViewing,\r\n            self: self,\r\n            isSpectator: isSpectator,\r\n            players: players,\r\n            updatePlayers: updatePlayers,\r\n            timers: timers,\r\n            options: options,\r\n            spectatorCount: spectatorCount,\r\n            lastWill: lastWill,\r\n            emojis: emojis,\r\n            setLeave: setLeave,\r\n            finished: finished,\r\n            settings: settings,\r\n            updateSettings: updateSettings,\r\n            setShowSettingsModal: setShowSettingsModal,\r\n            speechFilters: speechFilters,\r\n            setSpeechFilters: setSpeechFilters,\r\n            loadAudioFiles: loadAudioFiles,\r\n            playAudio: playAudio,\r\n            stopAudio: stopAudio,\r\n            stopAudios: stopAudios,\r\n            setRehostId: setRehostId,\r\n            agoraClient: agoraClient,\r\n            localAudioTrack: localAudioTrack,\r\n            setActiveVoiceChannel: setActiveVoiceChannel,\r\n            activity: activity,\r\n            muted: muted,\r\n            setMuted: setMuted,\r\n            deafened: deafened,\r\n            setDeafened: setDeafened,\r\n            noLeaveRef,\r\n            dev: dev,\r\n        };\r\n\r\n        return (\r\n            <GameContext.Provider value={context}>\r\n                <div className=\"game no-highlight\">\r\n                    <SettingsModal\r\n                        showModal={showSettingsModal}\r\n                        setShowModal={setShowSettingsModal}\r\n                        settings={settings}\r\n                        updateSettings={updateSettings} />\r\n                    <FirstGameModal\r\n                        showModal={showFirstGameModal}\r\n                        setShowModal={setShowFirstGameModal} />\r\n                    {gameType == \"Mafia\" &&\r\n                        <MafiaGame />\r\n                    }\r\n                    {gameType == \"Resistance\" &&\r\n                        <ResistanceGame />\r\n                    }\r\n                    {gameType == \"Split Decision\" &&\r\n                        <SplitDecisionGame />\r\n                    }\r\n                    {gameType == \"One Night\" &&\r\n                        <OneNightGame />\r\n                    }\r\n                </div>\r\n            </GameContext.Provider>\r\n        );\r\n    }\r\n}\r\n\r\nexport function useSocketListeners(listeners, socket) {\r\n    useEffect(() => {\r\n        if (!socket.on)\r\n            return;\r\n\r\n        listeners(socket);\r\n    }, [socket]);\r\n}\r\n\r\nexport function TopBar(props) {\r\n    const { gameId } = useParams();\r\n    const infoRef = useRef();\r\n    const errorAlert = useErrorAlert();\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const popover = useContext(PopoverContext);\r\n\r\n    function onInfoClick(e) {\r\n        e.stopPropagation();\r\n        popover.onClick(\r\n            `/game/${gameId}/info`,\r\n            \"game\",\r\n            infoRef.current,\r\n            `Game ${gameId}`,\r\n        );\r\n    }\r\n\r\n    function onLogoClick() {\r\n        window.open(process.env.REACT_APP_URL, \"_blank\");\r\n    }\r\n\r\n    function onSettingsClick() {\r\n        props.setShowSettingsModal(true);\r\n    }\r\n\r\n    function onTestClick() {\r\n        for (let i = 0; i < props.setup.total - 1; i++)\r\n            window.open(window.location + \"?bot\");\r\n    }\r\n\r\n    function onLeaveGameClick() {\r\n        const shouldLeave = props.finished || props.review || window.confirm(\"Are you sure you wish to leave?\");\r\n\r\n        if (!shouldLeave)\r\n            return;\r\n\r\n        if (props.finished)\r\n            siteInfo.hideAllAlerts();\r\n\r\n        if (props.socket.on)\r\n            props.socket.send(\"leave\");\r\n        else\r\n            props.setLeave(true);\r\n    }\r\n\r\n    function onRehostGameClick() {\r\n        props.noLeaveRef.current = true;\r\n\r\n        if (props.socket.on)\r\n            props.socket.send(\"leave\");\r\n\r\n        setTimeout(() => {\r\n            var stateLengths = {};\r\n\r\n            for (let stateName in props.options.stateLengths)\r\n                stateLengths[stateName] = props.options.stateLengths[stateName] / 60000;\r\n\r\n            axios.post(\"/game/host\", {\r\n                rehost: gameId,\r\n                gameType: props.gameType,\r\n                setup: props.setup.id,\r\n                lobby: props.options.lobby,\r\n                private: props.options.private,\r\n                spectating: props.options.spectating,\r\n                guests: props.options.guests,\r\n                ranked: props.options.ranked,\r\n                stateLengths: stateLengths,\r\n                ...props.options.gameTypeOptions\r\n            })\r\n                .then(res => props.setRehostId(res.data))\r\n                .catch((e) => {\r\n                    props.noLeaveRef.current = false;\r\n                    errorAlert(e);\r\n                });\r\n        }, 500);\r\n    }\r\n\r\n    return (\r\n        <div className=\"top\">\r\n            <div className=\"game-name-wrapper\" onClick={onLogoClick}>\r\n                {props.gameName}\r\n            </div>\r\n            <div className=\"state-wrapper\">\r\n                <StateSwitcher\r\n                    history={props.history}\r\n                    stateViewing={props.stateViewing}\r\n                    updateStateViewing={props.updateStateViewing} />\r\n                {props.timer}\r\n            </div>\r\n            <div className=\"misc-wrapper\">\r\n                <div className=\"misc-left\">\r\n                    <div className=\"misc-buttons\">\r\n                        {props.options.voiceChat &&\r\n                            <i className=\"misc-icon fas fa-microphone\" />\r\n                        }\r\n                        <i\r\n                            className=\"misc-icon fas fa-info-circle\"\r\n                            ref={infoRef}\r\n                            onClick={onInfoClick} />\r\n                        <i\r\n                            className=\"misc-icon fas fa-cog\"\r\n                            onClick={onSettingsClick} />\r\n                        {props.dev &&\r\n                            <i\r\n                                className=\"misc-icon fas fa-vial\"\r\n                                onClick={onTestClick} />\r\n                        }\r\n                    </div>\r\n                    <div className=\"options\">\r\n                        {!props.options.private && !props.review &&\r\n                            <i className=\"fas fa-lock-open\" />\r\n                        }\r\n                        {props.options.private && !props.review &&\r\n                            <i className=\"fas fa-lock\" />\r\n                        }\r\n                        {!props.review &&\r\n                            <div className=\"player-count\">\r\n                                <i className=\"fas fa-users\" />\r\n                                {Object.values(props.players).filter(p => !p.left).length} / {props.setup.total}\r\n                            </div>\r\n                        }\r\n                        {!props.options.spectating && !props.review &&\r\n                            <div className=\"no-spectator\">\r\n                                <i className=\"fas fa-eye-slash\" />\r\n                            </div>\r\n                        }\r\n                        {props.options.spectating && !props.review &&\r\n                            <div className=\"spectator-count\">\r\n                                <i className=\"fas fa-eye\" />\r\n                                {props.spectatorCount}\r\n                            </div>\r\n                        }\r\n                    </div>\r\n                </div>\r\n                {props.setup &&\r\n                    <Setup setup={props.setup} />\r\n                }\r\n                <div\r\n                    className=\"btn btn-theme leave-game\"\r\n                    onClick={onLeaveGameClick}>\r\n                    Leave\r\n                </div>\r\n                {!props.review && props.history.currentState == -2 &&\r\n                    < div\r\n                        className=\"btn btn-theme-sec rehost-game\"\r\n                        onClick={onRehostGameClick}>\r\n                        Rehost\r\n                    </div>\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function ThreePanelLayout(props) {\r\n    return (\r\n        <div className=\"main\">\r\n            <div className=\"left-panel panel\">\r\n                {props.leftPanelContent}\r\n            </div>\r\n            <div className=\"center-panel panel\">\r\n                {props.centerPanelContent}\r\n            </div>\r\n            <div className=\"right-panel panel\">\r\n                {props.rightPanelContent}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function TextMeetingLayout(props) {\r\n    const history = props.history;\r\n    const players = props.players;\r\n    const stateViewing = props.stateViewing;\r\n    const updateHistory = props.updateHistory;\r\n    const setActiveVoiceChannel = props.setActiveVoiceChannel;\r\n    const stateInfo = history.states[stateViewing];\r\n    const meetings = stateInfo ? stateInfo.meetings : {};\r\n    const alerts = stateInfo ? stateInfo.alerts : [];\r\n    const selTab = stateInfo && stateInfo.selTab;\r\n\r\n    const [autoScroll, setAutoScroll] = useState(true);\r\n    const [mouseMoved, setMouseMoved] = useState(false);\r\n    const speechDisplayRef = useRef();\r\n\r\n    const speechMeetings = Object.values(meetings).filter(meeting => meeting.speech);\r\n\r\n    useLayoutEffect(() => doAutoScroll());\r\n\r\n    useEffect(() => {\r\n        if (stateViewing != null && !selTab && speechMeetings.length) {\r\n            updateHistory({\r\n                type: \"selTab\",\r\n                state: stateViewing,\r\n                meetingId: speechMeetings[0].id\r\n            });\r\n        }\r\n    }, [stateViewing, speechMeetings]);\r\n\r\n    useEffect(() => {\r\n        if (stateViewing == history.currentState)\r\n            setAutoScroll(true);\r\n        else\r\n            setAutoScroll(false);\r\n    }, [stateViewing]);\r\n\r\n    useEffect(() => {\r\n        function onMouseMove() {\r\n            setMouseMoved(true);\r\n            document.removeEventListener(\"mousemove\", onMouseMove);\r\n        }\r\n\r\n        document.addEventListener(\"mousemove\", onMouseMove);\r\n\r\n        return () => document.removeEventListener(\"mousemove\", onMouseMove);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!selTab || !meetings[selTab] || !meetings[selTab].vcToken)\r\n            setActiveVoiceChannel(null);\r\n\r\n        setActiveVoiceChannel(selTab);\r\n    }, [selTab, meetings]);\r\n\r\n    function doAutoScroll() {\r\n        if (autoScroll && speechDisplayRef.current)\r\n            speechDisplayRef.current.scrollTop = speechDisplayRef.current.scrollHeight;\r\n    }\r\n\r\n    function onTabClick(tabId) {\r\n        updateHistory({\r\n            type: \"selTab\",\r\n            state: stateViewing,\r\n            meetingId: tabId\r\n        });\r\n\r\n        setAutoScroll(true);\r\n    }\r\n\r\n    function onMessageQuote(message) {\r\n        if (!props.review && message.senderId != \"server\" && !message.isQuote && message.quotable) {\r\n            props.socket.send(\"quote\", {\r\n                messageId: message.id,\r\n                toMeetingId: history.states[history.currentState].selTab,\r\n                fromMeetingId: message.meetingId,\r\n                fromState: stateViewing\r\n            });\r\n        }\r\n    }\r\n\r\n    function onSpeechScroll() {\r\n        if (!mouseMoved) {\r\n            doAutoScroll();\r\n            return;\r\n        }\r\n\r\n        var speech = speechDisplayRef.current;\r\n\r\n        if (Math.round(speech.scrollTop + speech.clientHeight) >= Math.round(speech.scrollHeight))\r\n            setAutoScroll(true);\r\n        else\r\n            setAutoScroll(false);\r\n    }\r\n\r\n    const tabs = speechMeetings.map(meeting => {\r\n        return (\r\n            <div\r\n                className={`tab ${selTab == meeting.id ? \"sel\" : \"\"}`}\r\n                key={meeting.id}\r\n                onClick={() => onTabClick(meeting.id)}>\r\n                {meeting.name}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    var messages = getMessagesToDisplay(meetings, alerts, selTab, players, props.settings, props.filters);\r\n    messages = messages.map((message, i) => {\r\n        return (\r\n            <Message\r\n                message={message}\r\n                history={history}\r\n                players={players}\r\n                key={message.id || message.messageId + message.time || i}\r\n                onMessageQuote={onMessageQuote}\r\n                settings={props.settings} />\r\n        );\r\n    });\r\n\r\n    var canSpeak = selTab;\r\n    canSpeak = canSpeak && (meetings[selTab].members.length > 1 || history.currentState == -1);\r\n    canSpeak = canSpeak && stateViewing == history.currentState && meetings[selTab].amMember && meetings[selTab].canTalk;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"meeting-tabs\">\r\n                {tabs.length > 0 &&\r\n                    tabs\r\n                }\r\n                {tabs.length == 0 &&\r\n                    <div className=\"tab sel\">\r\n                        {stateInfo && stateInfo.name}\r\n                    </div>\r\n                }\r\n            </div>\r\n            <div className=\"speech-wrapper\">\r\n                <div\r\n                    className=\"speech-display\"\r\n                    onScroll={onSpeechScroll}\r\n                    ref={speechDisplayRef}>\r\n                    {messages}\r\n                </div>\r\n                {canSpeak &&\r\n                    <SpeechInput\r\n                        meetings={meetings}\r\n                        selTab={selTab}\r\n                        players={players}\r\n                        options={props.options}\r\n                        socket={props.socket}\r\n                        setAutoScroll={setAutoScroll}\r\n                        agoraClient={props.agoraClient}\r\n                        localAudioTrack={props.localAudioTrack}\r\n                        muted={props.muted}\r\n                        setMuted={props.setMuted}\r\n                        deafened={props.deafened}\r\n                        setDeafened={props.setDeafened} />\r\n                }\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nfunction getMessagesToDisplay(meetings, alerts, selTab, players, settings, filters) {\r\n    var messages;\r\n\r\n    if (selTab)\r\n        messages = [...meetings[selTab].messages];\r\n    else\r\n        messages = [];\r\n\r\n    if (filters && (filters.from || filters.contains))\r\n        messages = messages.filter(m => {\r\n            var content = m.content || \"\";\r\n            var matches = content.toLowerCase().indexOf(filters.contains.toLowerCase()) != -1;\r\n\r\n            var playerName = players[m.senderId].name;\r\n            matches = matches && playerName.toLowerCase().indexOf(filters.from.toLowerCase()) != -1;\r\n\r\n            return matches;\r\n        });\r\n\r\n    for (let alert of alerts) {\r\n        for (let i = 0; i <= messages.length; i++) {\r\n            if (i == messages.length) {\r\n                messages.push(alert);\r\n                break;\r\n            }\r\n            else if (alert.time < messages[i].time) {\r\n                messages.splice(i, 0, alert);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!settings.votingLog)\r\n        return messages;\r\n\r\n    var voteRecord;\r\n\r\n    if (selTab)\r\n        voteRecord = meetings[selTab].voteRecord;\r\n    else\r\n        voteRecord = [];\r\n\r\n    for (let meetingId in meetings)\r\n        if (!meetings[meetingId].speech)\r\n            voteRecord = voteRecord.concat(meetings[meetingId].voteRecord);\r\n\r\n    for (let vote of voteRecord) {\r\n        let isUnvote = vote.type == \"unvote\";\r\n        let voter = players[vote.voterId];\r\n        let voterName = voter ? voter.name : \"Anonymous\";\r\n        let target = vote.target;\r\n\r\n        if (!isUnvote) {\r\n            if (target != \"*\" && players[target])\r\n                target = players[target].name;\r\n            else if (target == \"*\")\r\n                target = \"no one\";\r\n        }\r\n\r\n        let voteMsg = {\r\n            senderId: \"vote\",\r\n            content: `${voterName} ${isUnvote ? \"unvotes\" : \"votes\"} ${isUnvote ? \"\" : target}`,\r\n            time: vote.time\r\n        };\r\n\r\n        for (let i = 0; i <= messages.length; i++) {\r\n            if (i == messages.length) {\r\n                messages.push(voteMsg);\r\n                break;\r\n            }\r\n            else if (vote.time < messages[i].time) {\r\n                messages.splice(i, 0, voteMsg);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    return messages;\r\n}\r\n\r\nfunction Message(props) {\r\n    const history = props.history;\r\n    const players = props.players;\r\n    const user = useContext(UserContext);\r\n\r\n    var message = props.message;\r\n    var player, quotedMessage;\r\n    var contentClass = \"content \";\r\n    var isMe = false;\r\n\r\n    if (\r\n        message.senderId != \"server\" &&\r\n        message.senderId != \"vote\" &&\r\n        message.senderId != \"anonymous\"\r\n    ) {\r\n        player = players[message.senderId];\r\n    }\r\n\r\n    if (message.isQuote) {\r\n        var state = history.states[message.fromState];\r\n\r\n        if (!state)\r\n            return <></>;\r\n\r\n        var meeting = state.meetings[message.fromMeetingId];\r\n\r\n        if (!meeting)\r\n            return <></>;\r\n\r\n        for (let msg of meeting.messages) {\r\n            if (msg.id == message.messageId) {\r\n                quotedMessage = { ...msg };\r\n                quotedMessage.meetingName = meeting.name;\r\n\r\n                if (msg.senderId == \"anonymous\")\r\n                    quotedMessage.senderName = \"Anonymous\";\r\n                else\r\n                    quotedMessage.senderName = players[msg.senderId].name;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (message.isQuote && !quotedMessage)\r\n        return <></>;\r\n\r\n    if ((player || message.senderId == \"anonymous\") && !message.isQuote)\r\n        contentClass += \"clickable \";\r\n\r\n    if (!message.isQuote && message.content.indexOf(\"/me \") == 0) {\r\n        isMe = true;\r\n        message = { ...message };\r\n        message.content = message.content.replace(\"/me \", \"\");\r\n    }\r\n\r\n    if (message.isQuote)\r\n        contentClass += \"quote \";\r\n    else if (message.senderId == \"server\")\r\n        contentClass += \"server \";\r\n    else if (message.senderId == \"vote\")\r\n        contentClass += \"vote-record \";\r\n    else if (isMe)\r\n        contentClass += \"me \";\r\n\r\n    return (\r\n        <div\r\n            className=\"message\"\r\n            onDoubleClick={() => props.onMessageQuote(message)}>\r\n            <div className=\"sender\">\r\n                {props.settings.timestamps &&\r\n                    <Timestamp time={message.time} />\r\n                }\r\n                {player &&\r\n                    <NameWithAvatar\r\n                        id={player.userId}\r\n                        name={player.name}\r\n                        avatar={player.avatar}\r\n                        color={player.nameColor}\r\n                        noLink\r\n                        small />\r\n                }\r\n                {message.senderId == \"anonymous\" &&\r\n                    <div className=\"name-with-avatar\">\r\n                        Anonymous\r\n                    </div>\r\n                }\r\n            </div>\r\n            <div className={contentClass} style={player && player.textColor ? { color: player.textColor } : {}}>\r\n                {!message.isQuote &&\r\n                    <>\r\n                        {message.prefix &&\r\n                            <div className=\"prefix\">\r\n                                ({message.prefix})\r\n                            </div>\r\n                        }\r\n                        <UserText\r\n                            text={message.content}\r\n                            settings={user.settings}\r\n                            players={players}\r\n                            filterProfanity\r\n                            linkify\r\n                            avify\r\n                            emotify />\r\n                    </>\r\n                }\r\n                {message.isQuote &&\r\n                    <>\r\n                        <i className=\"fas fa-quote-left\" />\r\n                        <Timestamp time={quotedMessage.time} />\r\n                        <div className=\"quote-info\">\r\n                            {`${quotedMessage.senderName} in ${quotedMessage.meetingName}: `}\r\n                        </div>\r\n                        <div className=\"quote-content\">\r\n                            <UserText\r\n                                text={quotedMessage.content}\r\n                                settings={user.settings}\r\n                                filterProfanity\r\n                                linkify\r\n                                emotify />\r\n                        </div>\r\n                        <i className=\"fas fa-quote-right\" />\r\n                    </>\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function Timestamp(props) {\r\n    const time = new Date(props.time);\r\n    var hours = String(time.getHours()).padStart(2, \"0\");\r\n    var minutes = String(time.getMinutes()).padStart(2, \"0\");\r\n    var seconds = String(time.getSeconds()).padStart(2, \"0\");\r\n\r\n    return (\r\n        <div className=\"time\">\r\n            {hours}:{minutes}:{seconds}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SpeechInput(props) {\r\n    const socket = props.socket;\r\n    const meetings = props.meetings;\r\n    const selTab = props.selTab;\r\n    const players = props.players;\r\n    const options = props.options;\r\n    const agoraClient = props.agoraClient;\r\n    const localAudioTrack = props.localAudioTrack;\r\n    const muted = props.muted;\r\n    const setMuted = props.setMuted;\r\n    const deafened = props.deafened;\r\n    const setDeafened = props.setDeafened;\r\n\r\n    const [speechInput, setSpeechInput] = useState(\"\");\r\n    const [speechDropdownOptions, setSpeechDropdownOptions] = useState([]);\r\n    const [speechDropdownValue, setSpeechDropdownValue] = useState(\"Say\");\r\n    const [lastTyped, setLastTyped] = useState(0);\r\n    const [typingIn, setTypingIn] = useState();\r\n    const [clearTyping, setClearTyping] = useState();\r\n\r\n    var placeholder = \"\";\r\n\r\n    for (let option of speechDropdownOptions) {\r\n        if (speechDropdownValue == option.id) {\r\n            placeholder = option.placeholder || \"\";\r\n            break;\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!selTab)\r\n            return <></>;\r\n\r\n        const speechAbilities = meetings[selTab].speechAbilities;\r\n        const newDropdownOptions = [{ label: \"Say\", id: \"Say\", placeholder: \"to everyone\" }];\r\n\r\n        for (let ability of speechAbilities) {\r\n            newDropdownOptions.push(\"divider\");\r\n\r\n            for (let target of ability.targets) {\r\n                let targetDisplay = target;\r\n\r\n                if (ability.targetType == \"player\")\r\n                    targetDisplay = players[target].name;\r\n\r\n                newDropdownOptions.push({\r\n                    label: ability.name,\r\n                    placeholder: `${ability.verb} ${targetDisplay}`,\r\n                    id: `${ability.name}:${target}`\r\n                });\r\n            }\r\n        }\r\n\r\n        setSpeechDropdownOptions(newDropdownOptions);\r\n    }, [selTab]);\r\n\r\n    useEffect(() => {\r\n        if (lastTyped > 0) {\r\n            clearTimeout(clearTyping);\r\n            setClearTyping(setTimeout(() => setLastTyped(0), 1000));\r\n\r\n            if (typingIn != selTab) {\r\n                setTypingIn(selTab);\r\n\r\n                if (typingIn != null)\r\n                    socket.send(\"typing\", { meetingId: typingIn, isTyping: false });\r\n\r\n                socket.send(\"typing\", { meetingId: selTab, isTyping: true });\r\n            }\r\n        }\r\n        else if (typingIn != null) {\r\n            setTypingIn(null);\r\n            socket.send(\"typing\", { meetingId: typingIn, isTyping: false });\r\n        }\r\n\r\n    }, [lastTyped]);\r\n\r\n    function onSpeechDropdownChange(value) {\r\n        setSpeechDropdownValue(value);\r\n    }\r\n\r\n    function onSpeechType(e) {\r\n        setSpeechInput(e.target.value);\r\n\r\n        if (\r\n            e.target.value.length > 0 &&\r\n            (e.target.value[0] != \"/\" || e.target.value.slice(0, 4) == \"/me \") &&\r\n            !meetings[selTab].anonymous &&\r\n            speechDropdownValue == \"Say\"\r\n        ) {\r\n            setLastTyped(Date.now());\r\n        }\r\n    }\r\n\r\n    function onSpeechSubmit(e) {\r\n        if (e.key === \"Enter\" && selTab && speechInput.length) {\r\n            const abilityInfo = speechDropdownValue.split(\":\");\r\n            var abilityName = abilityInfo[0];\r\n            var abilityTarget = abilityInfo[1];\r\n\r\n            if (abilityName == \"Say\")\r\n                abilityName = null;\r\n\r\n            socket.send(\"speak\", {\r\n                content: speechInput,\r\n                meetingId: selTab,\r\n                abilityName,\r\n                abilityTarget\r\n            });\r\n\r\n            setSpeechInput(\"\");\r\n            props.setAutoScroll(true);\r\n\r\n        } else if (e.key === \"Tab\") {\r\n            e.preventDefault();\r\n            const words = speechInput.split(\" \");\r\n            const word = words.pop();\r\n            const seedString = word.match(/[^\\w-]?([\\w-]*)$/)[1].toLowerCase();\r\n            const prefix = word.substring(0, word.length - seedString.length);\r\n            if (!seedString.length)\r\n                return;\r\n\r\n            const playerNames = Object.values(players).map(player => player.name);\r\n            const playerSeeds = playerNames.map(playerName => playerName.toLowerCase().substring(0, seedString.length));\r\n            const matchedPlayers = [];\r\n            for (const i in playerSeeds) { // Checking seed string against characters in player names.\r\n                if (playerSeeds[i] === seedString) {\r\n                    matchedPlayers.push(playerNames[i]);\r\n                }\r\n            }\r\n            if (matchedPlayers.length) {\r\n                if (matchedPlayers.length === 1) { // If one matching player, autocomplete entire name.\r\n                    words.push(prefix + matchedPlayers[0]);\r\n                } else { // If multiple matching players, autocomplete until player names diverge.\r\n                    let autocompleted = \"\";\r\n                    let i = 1;\r\n                    while (matchedPlayers.every(playerName => playerName[i] === matchedPlayers[0][i])) {\r\n                        i += 1;\r\n                    }\r\n                    words.push(prefix + matchedPlayers[0].substring(0, i));\r\n                }\r\n                setSpeechInput(words.join(\" \"));\r\n            }\r\n        }\r\n    }\r\n\r\n    function onMute() {\r\n        if (localAudioTrack.current) {\r\n            var volume = muted ? 100 : 0;\r\n\r\n            localAudioTrack.current.setVolume(volume);\r\n            setMuted(!muted);\r\n        }\r\n    }\r\n\r\n    function onDeafen() {\r\n        if (agoraClient.current) {\r\n            var volume = deafened ? 100 : 0;\r\n\r\n            agoraClient.current.remoteUsers.forEach(user => {\r\n                user.audioTrack && user.audioTrack.setVolume(volume);\r\n            });\r\n\r\n            setDeafened(!deafened);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"speech-input-area\">\r\n            <div className=\"speech-input-wrapper\">\r\n                <Dropdown\r\n                    className=\"speech-dropdown\"\r\n                    options={speechDropdownOptions}\r\n                    onChange={onSpeechDropdownChange}\r\n                    value={speechDropdownValue} />\r\n                <input\r\n                    id=\"speechInput\"\r\n                    className=\"speech-input\"\r\n                    type=\"text\"\r\n                    autoComplete=\"off\"\r\n                    value={speechInput}\r\n                    placeholder={placeholder}\r\n                    maxLength={MaxGameMessageLength}\r\n                    onChange={onSpeechType}\r\n                    onKeyDown={onSpeechSubmit} />\r\n            </div>\r\n            {options.voiceChat &&\r\n                <>\r\n                    <i className={`fas fa-microphone ${muted ? \"disabled\" : \"\"}`} onClick={onMute} />\r\n                    <i className={`fas fa-headphones ${deafened ? \"disabled\" : \"\"}`} onClick={onDeafen} />\r\n                </>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function StateSwitcher(props) {\r\n    const history = props.history;\r\n    const stateViewing = props.stateViewing;\r\n    const stateName = history.states[stateViewing] ? history.states[stateViewing].name : \"\";\r\n\r\n    const leftArrowVisible = props.stateViewing != -1;\r\n    const rigthArrowVisible =\r\n        props.stateViewing < history.currentState ||\r\n        (history.currentState == -2 && props.stateViewing != history.currentState);\r\n\r\n    function onStateNameClick() {\r\n        props.updateStateViewing({ type: \"current\" });\r\n    }\r\n\r\n    return (\r\n        <div className=\"state-nav\">\r\n            <i\r\n                className={`hist-arrow fas fa-caret-left ${leftArrowVisible ? \"\" : \"invisible\"}`}\r\n                onClick={() => props.updateStateViewing({ type: \"backward\" })} />\r\n            <div\r\n                className=\"state-name\"\r\n                onClick={onStateNameClick}>\r\n                {stateName.toUpperCase()}\r\n            </div>\r\n            <i\r\n                className={`hist-arrow fas fa-caret-right ${rigthArrowVisible ? \"\" : \"invisible\"}`}\r\n                onClick={() => props.updateStateViewing({ type: \"forward\" })} />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function formatTimerTime(time) {\r\n    if (time > 0)\r\n        time = Math.round(time / 1000);\r\n    else\r\n        time = 0;\r\n\r\n    const minutes = String(Math.floor(time / 60)).padStart(2, \"0\");\r\n    const seconds = String(time % 60).padStart(2, \"0\");\r\n\r\n    return `${minutes}:${seconds}`;\r\n}\r\n\r\nexport function SideMenu(props) {\r\n    return (\r\n        <div className={`side-menu ${props.scrollable ? \"scrollable\" : \"\"}`}>\r\n            <div className=\"side-menu-title\">\r\n                {props.title}\r\n            </div>\r\n            <div className=\"side-menu-content\">\r\n                {props.content}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function PlayerRows(props) {\r\n    const history = props.history;\r\n    const players = props.players;\r\n    const activity = props.activity;\r\n    const stateViewingInfo = history.states[props.stateViewing];\r\n    const selTab = stateViewingInfo && stateViewingInfo.selTab;\r\n\r\n    const rows = players.map(player => (\r\n        <div\r\n            className={`player ${props.className ? props.className : \"\"}`}\r\n            key={player.id}>\r\n            {props.stateViewing != -1 &&\r\n                <RoleCount\r\n                    role={stateViewingInfo.roles[player.id]}\r\n                    gameType={props.gameType}\r\n                    showPopover />\r\n            }\r\n            <NameWithAvatar\r\n                id={player.userId}\r\n                name={player.name}\r\n                avatar={player.avatar}\r\n                color={player.nameColor}\r\n                active={activity.speaking[player.id]}\r\n                newTab />\r\n            {selTab && activity.typing[player.id] == selTab &&\r\n                <ReactLoading\r\n                    className={`typing-icon ${props.stateViewing != -1 ? \"has-role\" : \"\"}`}\r\n                    type=\"bubbles\"\r\n                    color=\"black\"\r\n                    width=\"20\"\r\n                    height=\"20\" />\r\n            }\r\n        </div>\r\n    ));\r\n\r\n    return rows;\r\n}\r\n\r\nexport function PlayerList(props) {\r\n    const history = props.history;\r\n    const stateViewingInfo = history.states[props.stateViewing];\r\n    const alivePlayers = Object.values(props.players).filter(p => !stateViewingInfo.dead[p.id] && !p.left);\r\n    const deadPlayers = Object.values(props.players).filter(p => stateViewingInfo.dead[p.id] && !p.left);\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Players\"\r\n            scrollable\r\n            content={\r\n                <div className=\"player-list\">\r\n                    <PlayerRows\r\n                        players={alivePlayers}\r\n                        history={history}\r\n                        gameType={props.gameType}\r\n                        stateViewing={props.stateViewing}\r\n                        activity={props.activity} />\r\n                    {deadPlayers.length > 0 &&\r\n                        <div className=\"section-title\">\r\n                            <i className=\"fas fa-skull\" />\r\n                            Graveyard\r\n                        </div>\r\n                    }\r\n                    <PlayerRows\r\n                        players={deadPlayers}\r\n                        history={history}\r\n                        gameType={props.gameType}\r\n                        stateViewing={props.stateViewing}\r\n                        activity={props.activity}\r\n                        className=\"dead\" />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nexport function ActionList(props) {\r\n    const actions = Object.values(props.meetings).reduce((actions, meeting) => {\r\n        if (meeting.voting) {\r\n            var action;\r\n\r\n            switch (meeting.inputType) {\r\n                case \"player\":\r\n                case \"boolean\":\r\n                case \"alignment\":\r\n                case \"select\":\r\n                    action =\r\n                        <ActionSelect\r\n                            key={meeting.id}\r\n                            socket={props.socket}\r\n                            meeting={meeting}\r\n                            players={props.players}\r\n                            self={props.self}\r\n                            history={props.history}\r\n                            stateViewing={props.stateViewing} />;\r\n                    break;\r\n                case \"button\":\r\n                    action =\r\n                        <ActionButton\r\n                            key={meeting.id}\r\n                            socket={props.socket}\r\n                            meeting={meeting}\r\n                            players={props.players}\r\n                            self={props.self}\r\n                            history={props.history}\r\n                            stateViewing={props.stateViewing} />;\r\n                    break;\r\n                case \"text\":\r\n                    action =\r\n                        <ActionText\r\n                            key={meeting.id}\r\n                            socket={props.socket}\r\n                            meeting={meeting}\r\n                            players={props.players}\r\n                            self={props.self}\r\n                            history={props.history}\r\n                            stateViewing={props.stateViewing} />;\r\n                    break;\r\n            }\r\n\r\n            actions.push(action);\r\n        }\r\n        return actions;\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            {actions.length > 0 &&\r\n                <SideMenu\r\n                    scrollable\r\n                    title=\"Actions\"\r\n                    content={\r\n                        <div className=\"action-list\">\r\n                            {actions}\r\n                        </div>\r\n                    } />\r\n            }\r\n        </>\r\n    );\r\n}\r\n\r\nfunction ActionSelect(props) {\r\n    const [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n    const [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef] = useDropdown();\r\n\r\n    const targets = meeting.targets.map(target => {\r\n        var targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n        return (\r\n            <div\r\n                className=\"target dropdown-menu-option\"\r\n                key={target}\r\n                onClick={() => onSelectVote(target)}>\r\n                {targetDisplay}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    const votes = Object.values(meeting.members).filter(member => member.canVote).map(member => {\r\n        var selection = meeting.votes[member.id];\r\n        var player = props.players[member.id];\r\n        selection = getTargetDisplay(selection, meeting, props.players);\r\n\r\n        return (\r\n            <div\r\n                className={`vote ${meeting.multi ? \"multi\" : \"\"}`}\r\n                key={member.id}>\r\n                <div className=\"voter\">\r\n                    {(player && player.name) || \"Anonymous\"}\r\n                </div>\r\n                {\r\n                    selection.length > 0 &&\r\n                    <div className=\"italic\">\r\n                        votes\r\n                    </div>\r\n                }\r\n                <div className=\"selection\">\r\n                    {selection.join(\", \")}\r\n                </div>\r\n            </div>\r\n        );\r\n    });\r\n\r\n    function onSelectVote(sel) {\r\n        setMenuVisible(false);\r\n        onVote(sel);\r\n    }\r\n\r\n    function onActionClick() {\r\n        if (!notClickable)\r\n            setMenuVisible(!menuVisible);\r\n    }\r\n\r\n    return (\r\n        <div className=\"action\">\r\n            <div\r\n                className={`action-name dropdown-control ${notClickable ? \"not-clickable\" : \"\"}`}\r\n                ref={dropdownContainerRef}\r\n                onClick={onActionClick}>\r\n                {meeting.actionName}\r\n                <i className=\"fas fa-angle-down dropdown-arrow\" />\r\n            </div>\r\n            {menuVisible &&\r\n                <div\r\n                    className=\"targets dropdown-menu\"\r\n                    ref={dropdownMenuRef}>\r\n                    {targets}\r\n                </div>\r\n            }\r\n            <div className=\"votes\">\r\n                {votes}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ActionButton(props) {\r\n    const [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n    const votes = { ...meeting.votes };\r\n\r\n    for (let playerId in votes)\r\n        votes[playerId] = getTargetDisplay(votes[playerId], meeting, props.players);\r\n\r\n    const buttons = meeting.targets.map(target => {\r\n        var targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n        return (\r\n            <div\r\n                className={`btn btn-theme ${votes[props.self] == targetDisplay ? \"sel\" : \"\"}`}\r\n                key={target}\r\n                disabled={votes[props.self] && !meeting.canUnvote}\r\n                onClick={() => onVote(target)}>\r\n                {targetDisplay}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <div className=\"action\">\r\n            <div className=\"action-name\">\r\n                {meeting.actionName}\r\n            </div>\r\n            {buttons}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ActionText(props) {\r\n    const [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n    const [inputValue, setInputValue] = useState(\"\");\r\n    const votes = { ...meeting.votes };\r\n\r\n    if (inputValue.length == 0 && votes[props.self])\r\n        setInputValue(votes[props.self]);\r\n\r\n    const buttons = meeting.targets.map(target => {\r\n        var targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n        return (\r\n            <div\r\n                className={`btn btn-theme ${votes[props.self] == targetDisplay ? \"sel\" : \"\"}`}\r\n                key={target}\r\n                onClick={() => onVote(target)}>\r\n                {targetDisplay}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    function onInputChange(e) {\r\n        onVote(e.target.value);\r\n        setInputValue(e.target.value);\r\n    }\r\n\r\n    return (\r\n        <div className=\"action\">\r\n            <input\r\n                value={inputValue}\r\n                onChange={onInputChange} />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction useAction(props) {\r\n    const meeting = props.meeting;\r\n    const history = props.history;\r\n    const stateViewing = props.stateViewing;\r\n    const isCurrentState = stateViewing == history.currentState;\r\n    const notClickable = !isCurrentState || !meeting.amMember || !meeting.canVote || (meeting.instant && meeting.votes[props.self]);\r\n\r\n    function onVote(sel) {\r\n        var isUnvote;\r\n\r\n        if (!Array.isArray(meeting.votes[props.self]))\r\n            isUnvote = sel == meeting.votes[props.self];\r\n        else\r\n            isUnvote = meeting.votes[props.self].indexOf(sel) != -1;\r\n\r\n        if (!isUnvote) {\r\n            props.socket.send(\"vote\", {\r\n                meetingId: meeting.id,\r\n                selection: sel\r\n            });\r\n        }\r\n        else {\r\n            props.socket.send(\"unvote\", {\r\n                meetingId: meeting.id,\r\n                selection: sel\r\n            });\r\n        }\r\n    }\r\n\r\n    return [meeting, history, stateViewing, isCurrentState, notClickable, onVote];\r\n}\r\n\r\nfunction getTargetDisplay(targets, meeting, players) {\r\n    if (!Array.isArray(targets) && targets)\r\n        targets = [targets];\r\n    else if (!targets)\r\n        targets = [];\r\n    else\r\n        targets = [...targets];\r\n\r\n    for (let i in targets) {\r\n        let target = targets[i];\r\n\r\n        switch (meeting.inputType) {\r\n            case \"player\":\r\n                if (target == \"*\")\r\n                    target = \"no one\";\r\n                else if (target)\r\n                    target = players[target].name;\r\n                else\r\n                    target = \"\";\r\n                break;\r\n            case \"boolean\":\r\n                if (target == \"*\")\r\n                    target = \"No\";\r\n                else if (!target)\r\n                    target = \"\";\r\n            default:\r\n                if (target == \"*\")\r\n                    target = \"None\";\r\n                else if (!target)\r\n                    target = \"\";\r\n        }\r\n\r\n        targets[i] = target;\r\n    }\r\n\r\n    return targets;\r\n}\r\n\r\nexport function Timer(props) {\r\n    var timerName;\r\n\r\n    if (props.history.currentState == -1)\r\n        timerName = \"pregameCountdown\";\r\n    else if (props.history.currentState == -2)\r\n        timerName = \"postgame\";\r\n    else if (props.timers[\"secondary\"])\r\n        timerName = \"secondary\";\r\n    else\r\n        timerName = \"main\";\r\n\r\n    const timer = props.timers[timerName];\r\n\r\n    if (!timer)\r\n        return <div className=\"state-timer\"></div>;\r\n\r\n    var time = timer.delay - timer.time;\r\n    time = formatTimerTime(time);\r\n\r\n    return (\r\n        <div className=\"state-timer\">\r\n            {time}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function LastWillEntry(props) {\r\n    const [lastWill, setLastWill] = useState(props.lastWill);\r\n\r\n    function onWillChange(e) {\r\n        var newWill = e.target.value.slice(0, MaxWillLength);\r\n        setLastWill(newWill);\r\n        props.socket.send(\"lastWill\", newWill);\r\n    }\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Last Will\"\r\n            content={\r\n                <div className=\"last-will-wrapper\">\r\n                    <textarea\r\n                        className=\"last-will-entry\"\r\n                        value={lastWill}\r\n                        onChange={onWillChange} />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nfunction SettingsModal(props) {\r\n    const settings = props.settings;\r\n    const updateSettings = props.updateSettings;\r\n    const showModal = props.showModal;\r\n    const setShowModal = props.setShowModal;\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Voting Log\",\r\n            ref: \"votingLog\",\r\n            type: \"boolean\",\r\n            value: settings.votingLog\r\n        },\r\n        {\r\n            label: \"Timestamps\",\r\n            ref: \"timestamps\",\r\n            type: \"boolean\",\r\n            value: settings.timestamps\r\n        },\r\n        {\r\n            label: \"Sounds\",\r\n            ref: \"sounds\",\r\n            type: \"boolean\",\r\n            value: settings.sounds\r\n        },\r\n        {\r\n            label: \"Volume\",\r\n            ref: \"volume\",\r\n            type: \"range\",\r\n            min: 0,\r\n            max: 1,\r\n            step: 0.1,\r\n            value: settings.volume\r\n        },\r\n    ]);\r\n\r\n    const modalHeader = \"Settings\";\r\n\r\n    const modalContent = (\r\n        <Form\r\n            fields={formFields}\r\n            onChange={updateFormFields} />\r\n    );\r\n\r\n    const modalFooter = (\r\n        <div className=\"settings-control\">\r\n            <div\r\n                className=\"settings-save btn btn-theme\"\r\n                onClick={saveSettings}>\r\n                Save\r\n            </div>\r\n            <div\r\n                className=\"settings-cancel btn btn-theme-third\"\r\n                onClick={cancel}>\r\n                Cancel\r\n            </div>\r\n        </div>\r\n    );\r\n    function cancel() {\r\n        for (let field of formFields) {\r\n            updateFormFields({\r\n                ref: field.ref,\r\n                prop: \"value\",\r\n                value: settings[field.ref]\r\n            });\r\n        }\r\n\r\n        setShowModal(false);\r\n    }\r\n\r\n    function saveSettings() {\r\n        var newSettings = {};\r\n\r\n        for (let field of formFields)\r\n            newSettings[field.ref] = field.value;\r\n\r\n        updateSettings({\r\n            type: \"set\",\r\n            settings: newSettings\r\n        });\r\n\r\n        setShowModal(false);\r\n    }\r\n\r\n    return (\r\n        <Modal\r\n            className=\"settings\"\r\n            show={showModal}\r\n            header={modalHeader}\r\n            content={modalContent}\r\n            footer={modalFooter}\r\n            onBgClick={cancel} />\r\n    );\r\n}\r\n\r\nfunction FirstGameModal(props) {\r\n    const showModal = props.showModal;\r\n    const setShowModal = props.setShowModal;\r\n\r\n    const modalHeader = \"Welcome to BeyondMafia\";\r\n\r\n    const modalContent = (\r\n        <>\r\n            <div className=\"paragraph\">\r\n                To keep games fun and competitive for all, please don't:\r\n            </div>\r\n\r\n            <div className=\"paragraph\">\r\n                <div>\r\n                    - Communicate with other players using anything which isn't part of the game.\r\n                </div>\r\n                <div>\r\n                    - Form alliances or other out-of-game arrangements with other users.\r\n                </div>\r\n                <div>\r\n                    - Attempt to play a game using more than one account.\r\n                </div>\r\n                <div>\r\n                    - Send screenshots or \"prove\" anything with images or video.\r\n                </div>\r\n                <div>\r\n                    - Copy exactly any system messages you recieve (blue text).\r\n                </div>\r\n                <div>\r\n                    - Try to lose the game on purpose.\r\n                </div>\r\n                <div>\r\n                    - Give up or leave partway through the game.\r\n                </div>\r\n                <div>\r\n                    - Issue out-of-game bribes or threats to sway other players, including threatening to leave.\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"paragraph\">\r\n                Breaking game conduct may result in necessary action being taken against your account.\r\n            </div>\r\n            <div className=\"paragraph\">\r\n                A full description of these rules as well as site and community rules is found <a>here</a>.\r\n            </div>\r\n            <div className=\"paragraph\">\r\n                You can also find tutorials, tips, and strategy guides <a href=\"/community/forums/board/SLsDA_SI2\">here</a>. Good luck, and have fun!\r\n            </div>\r\n        </>\r\n    );\r\n\r\n    const modalFooter = (\r\n        <div\r\n            className=\"btn btn-theme\"\r\n            onClick={cancel}>\r\n            Close\r\n        </div>\r\n    );\r\n\r\n    function cancel() {\r\n        setShowModal(false);\r\n    }\r\n\r\n    return (\r\n        <Modal\r\n            className=\"first-game\"\r\n            show={showModal}\r\n            header={modalHeader}\r\n            content={modalContent}\r\n            footer={modalFooter}\r\n            onBgClick={cancel} />\r\n    );\r\n}\r\n\r\nexport function SpeechFilter(props) {\r\n    const filters = props.filters;\r\n    const setFilters = props.setFilters;\r\n    const stateViewing = props.stateViewing;\r\n\r\n    function onFilter(type, value) {\r\n        setFilters(update(filters, {\r\n            [type]: {\r\n                $set: value\r\n            }\r\n        }));\r\n    }\r\n\r\n    if (stateViewing < 0)\r\n        return <></>;\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Speech Filters\"\r\n            content={\r\n                <div className=\"speech-filters\">\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"From user\"\r\n                        value={filters.from}\r\n                        onChange={(e) => onFilter(\"from\", e.target.value)} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Contains\"\r\n                        value={filters.contains}\r\n                        onChange={(e) => onFilter(\"contains\", e.target.value)} />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nexport function Notes(props) {\r\n    const stateViewing = props.stateViewing;\r\n    const [notes, setNotes] = useState(\"\");\r\n    const { gameId } = useParams();\r\n\r\n    useEffect(() => {\r\n        var notesData = window.localStorage.getItem(\"notesData\");\r\n\r\n        if (notesData) {\r\n            notesData = JSON.parse(notesData);\r\n\r\n            if (notesData.game != gameId)\r\n                window.localStorage.removeItem(\"notesData\");\r\n            else\r\n                setNotes(notesData.notes);\r\n        }\r\n    }, []);\r\n\r\n    function onNotesUpdate(_notes) {\r\n        setNotes(_notes);\r\n        window.localStorage.setItem(\"notesData\", JSON.stringify({ game: gameId, notes: _notes }));\r\n    }\r\n\r\n    if (stateViewing < 0)\r\n        return <></>;\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Notes\"\r\n            content={\r\n                <div className=\"notes-wrapper\">\r\n                    <textarea\r\n                        className=\"notes-entry\"\r\n                        value={notes}\r\n                        onChange={(e) => onNotesUpdate(e.target.value)} />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nfunction useHistoryReducer() {\r\n    return useReducer((history, action) => {\r\n        var newHistory;\r\n\r\n        switch (action.type) {\r\n            case \"set\":\r\n                var stateIds = Object.keys(action.history).sort((a, b) => a - b);\r\n                newHistory = { states: action.history };\r\n\r\n                if (stateIds[0] == -2)\r\n                    newHistory.currentState = -2;\r\n                else\r\n                    newHistory.currentState = stateIds[stateIds.length - 1];\r\n                break;\r\n            case \"addState\":\r\n                if (!history.states[action.state.id]) {\r\n                    var prevState;\r\n\r\n                    if (action.state.id != -2)\r\n                        prevState = action.state.id - 1;\r\n                    else\r\n                        prevState = Object.keys(history.states).sort((a, b) => b - a)[0];\r\n\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [action.state.id]: {\r\n                                $set: {\r\n                                    name: action.state.name,\r\n                                    meetings: {},\r\n                                    alerts: [],\r\n                                    stateEvents: [],\r\n                                    roles: { ...history.states[prevState].roles },\r\n                                    dead: { ...history.states[prevState].dead }\r\n                                }\r\n                            }\r\n                        },\r\n                        currentState: {\r\n                            $set: action.state.id\r\n                        }\r\n                    });\r\n                }\r\n                else\r\n                    newHistory = history;\r\n                break;\r\n            case \"addMeeting\":\r\n                var state = history.states[history.currentState];\r\n\r\n                if (state) {\r\n                    if (!state.meetings) {\r\n                        newHistory = update(history, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    meetings: {\r\n                                        $set: {}\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    newHistory = update(newHistory || history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.meeting.id]: {\r\n                                        $set: action.meeting\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"meetingMembers\":\r\n                if (\r\n                    history.states[history.currentState] &&\r\n                    history.states[history.currentState].meetings[action.meetingId]\r\n                ) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.meetingId]: {\r\n                                        members: {\r\n                                            $set: action.members\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"removeMeeting\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    $unset: [action.meetingId]\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    if (newHistory.states[history.currentState].selTab == action.meetingId) {\r\n                        newHistory = update(newHistory, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    $unset: [\"selTab\"]\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            case \"addMessage\":\r\n                if (history.states[history.currentState]) {\r\n                    if (action.message.meetingId) {\r\n                        if (history.states[history.currentState].meetings[action.message.meetingId]) {\r\n                            newHistory = update(history, {\r\n                                states: {\r\n                                    [history.currentState]: {\r\n                                        meetings: {\r\n                                            [action.message.meetingId]: {\r\n                                                messages: {\r\n                                                    $push: [action.message]\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    else {\r\n                        newHistory = update(history, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    alerts: {\r\n                                        $push: [action.message]\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            case \"addQuote\":\r\n                if (\r\n                    history.states[history.currentState] &&\r\n                    history.states[history.currentState].meetings[action.quote.toMeetingId]\r\n                ) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.quote.toMeetingId]: {\r\n                                        messages: {\r\n                                            $push: [action.quote]\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"vote\":\r\n                var target = action.vote.target;\r\n                var state = history.states[history.currentState];\r\n                var meeting = state && state.meetings[action.vote.meetingId];\r\n\r\n                if (meeting) {\r\n                    if (meeting.multi)\r\n                        target = [...(meeting.votes[action.vote.voterId] || []), target];\r\n\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.vote.meetingId]: {\r\n                                        votes: {\r\n                                            [action.vote.voterId]: {\r\n                                                $set: target\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    if (!action.vote.noLog) {\r\n                        newHistory = update(newHistory, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    meetings: {\r\n                                        [action.vote.meetingId]: {\r\n                                            voteRecord: {\r\n                                                $push: [{\r\n                                                    type: \"vote\",\r\n                                                    voterId: action.vote.voterId,\r\n                                                    target: action.vote.target,\r\n                                                    time: Date.now()\r\n                                                }]\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            case \"unvote\":\r\n                var target = undefined;\r\n                var state = history.states[history.currentState];\r\n                var meeting = state && state.meetings[action.info.meetingId];\r\n\r\n                if (meeting) {\r\n                    if (meeting.multi)\r\n                        target = (meeting.votes[action.info.voterId] || []).filter(t => t != action.info.target);\r\n\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.info.meetingId]: {\r\n                                        votes: {\r\n                                            [action.info.voterId]: {\r\n                                                $set: target\r\n                                            }\r\n                                        },\r\n                                        voteRecord: {\r\n                                            $push: [{\r\n                                                type: \"unvote\",\r\n                                                voterId: action.info.voterId,\r\n                                                time: Date.now()\r\n                                            }]\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"stateEvents\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                stateEvents: {\r\n                                    $set: action.stateEvents\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"selTab\":\r\n                if (history.states[action.state]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [action.state]: {\r\n                                selTab: {\r\n                                    $set: action.meetingId\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"reveal\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                roles: {\r\n                                    [action.playerId]: {\r\n                                        $set: action.role\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"death\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                dead: {\r\n                                    [action.playerId]: {\r\n                                        $set: true\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"revival\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                dead: {\r\n                                    [action.playerId]: {\r\n                                        $set: false\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n        }\r\n\r\n        return newHistory || history;\r\n    }, { states: {} });\r\n}\r\n\r\nexport function useStateViewingReducer(history) {\r\n    return useReducer((state, action) => {\r\n        var newState;\r\n\r\n        switch (action.type) {\r\n            case \"backward\":\r\n                if (state > -2)\r\n                    newState = state - 1;\r\n                else\r\n                    newState = Math.max(...Object.keys(history.states));\r\n                break;\r\n            case \"forward\":\r\n                if (history.states[state + 1])\r\n                    newState = state + 1;\r\n                else\r\n                    newState = -2;\r\n                break;\r\n            case \"current\":\r\n                newState = history.currentState;\r\n                break;\r\n            case \"first\":\r\n                newState = -1;\r\n                break;\r\n            default:\r\n                newState = state;\r\n        }\r\n\r\n        if (history.states[newState])\r\n            return newState;\r\n        else\r\n            return state;\r\n    }, history.currentState);\r\n}\r\n\r\nexport function useTimersReducer() {\r\n    return useReducer((timers, action) => {\r\n        var newTimers = { ...timers };\r\n\r\n        switch (action.type) {\r\n            case \"create\":\r\n                newTimers[action.timer.name] = {\r\n                    delay: action.timer.delay,\r\n                    time: 0\r\n                };\r\n                break;\r\n            case \"clear\":\r\n                delete newTimers[action.name];\r\n                break;\r\n            case \"update\":\r\n                newTimers[action.name].time = action.time;\r\n                break;\r\n            case \"updateAll\":\r\n                for (var timerName in newTimers)\r\n                    newTimers[timerName].time += 1000;\r\n\r\n                const timer = newTimers[\"pregameCountdown\"] || newTimers[\"secondary\"] || newTimers[\"main\"];\r\n\r\n                if (!timer)\r\n                    break;\r\n\r\n                const intTime = Math.round((timer.delay - timer.time) / 1000);\r\n\r\n                if (intTime < 6 && intTime > 0)\r\n                    action.playAudio(\"tick\");\r\n                break;\r\n        }\r\n\r\n        return newTimers;\r\n    }, {});\r\n}\r\n\r\nexport function usePlayersReducer() {\r\n    return useReducer((players, action) => {\r\n        var newPlayers;\r\n\r\n        switch (action.type) {\r\n            case \"set\":\r\n                newPlayers = action.players;\r\n                break;\r\n            case \"add\":\r\n                if (!players[action.player.id]) {\r\n                    newPlayers = update(players, {\r\n                        [action.player.id]: {\r\n                            $set: action.player\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    newPlayers = update(players, {\r\n                        [action.player.id]: {\r\n                            $unset: [\"left\"]\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"remove\":\r\n                newPlayers = update(players, {\r\n                    [action.playerId]: {\r\n                        left: {\r\n                            $set: true\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            case \"setProp\":\r\n                newPlayers = update(players, {\r\n                    [action.playerId]: {\r\n                        [action.propName]: {\r\n                            $set: action.propVal\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newPlayers || players;\r\n    }, {});\r\n}\r\n\r\nexport function useSettingsReducer() {\r\n    const defaultSettings = {\r\n        votingLog: true,\r\n        timestamps: true,\r\n        sounds: true,\r\n        volume: 1,\r\n    };\r\n\r\n    return useReducer((settings, action) => {\r\n        var newSettings;\r\n\r\n        switch (action.type) {\r\n            case \"load\":\r\n                try {\r\n                    newSettings = window.localStorage.getItem(\"gameSettings\");\r\n                    newSettings = JSON.parse(newSettings);\r\n                }\r\n                catch (e) {\r\n                    newSettings = settings;\r\n                }\r\n                break;\r\n            case \"set\":\r\n                newSettings = action.settings;\r\n                window.localStorage.setItem(\"gameSettings\", JSON.stringify(newSettings));\r\n                break;\r\n            case \"setProp\":\r\n                newSettings = update(settings, {\r\n                    [action.propName]: {\r\n                        $set: action.propval\r\n                    }\r\n                });\r\n\r\n                window.localStorage.setItem(\"gameSettings\", JSON.stringify(newSettings));\r\n                break;\r\n        }\r\n\r\n        return newSettings || settings;\r\n    }, defaultSettings);\r\n}\r\n\r\nexport function useActivity(agoraClient, localAudioTrack) {\r\n    const volumeThreshold = 0.001;\r\n    const [activity, updateActivity] = useReducer((activity, action) => {\r\n        var newActivity;\r\n\r\n        switch (action.type) {\r\n            case \"typing\":\r\n                newActivity = update(activity, {\r\n                    typing: {\r\n                        [action.playerId]: {\r\n                            $set: action.meetingId\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            case \"speaking\":\r\n                var newSpeaking = action.players.reduce((speaking, playerId) => {\r\n                    speaking[playerId] = true;\r\n                    return speaking;\r\n                }, {});\r\n\r\n                newActivity = update(activity, {\r\n                    speaking: {\r\n                        $set: newSpeaking\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newActivity || activity;\r\n    }, { typing: {}, speaking: {} });\r\n\r\n    useEffect(() => {\r\n        var activityInterval = setInterval(() => {\r\n            if (agoraClient.current) {\r\n                var speaking = [];\r\n\r\n                if (localAudioTrack.current && localAudioTrack.current.getVolumeLevel() > volumeThreshold) {\r\n                    speaking.push(agoraClient.current.uid);\r\n                }\r\n\r\n                agoraClient.current.remoteUsers.forEach(user => {\r\n                    if (user.audioTrack && user.audioTrack.getVolumeLevel() > volumeThreshold)\r\n                        speaking.push(user.uid);\r\n                });\r\n\r\n                updateActivity({\r\n                    type: \"speaking\",\r\n                    players: speaking\r\n                });\r\n            }\r\n        }, 50);\r\n\r\n        return () => clearInterval(activityInterval);\r\n    });\r\n\r\n    return [activity, updateActivity];\r\n}\r\n\r\nexport function useAudio(settings) {\r\n    const audioRef = useRef({});\r\n\r\n    const [audioInfo, updateAudio] = useReducer((audioInfo, action) => {\r\n        var newAudioInfo;\r\n\r\n        switch (action.type) {\r\n            case \"play\":\r\n                if (!settings.sounds)\r\n                    return audioInfo;\r\n\r\n                if (audioInfo.overrides[action.audioName])\r\n                    for (let audioName in audioInfo.overrides)\r\n                        if (audioInfo.overrides[audioName] && audioRef.current[audioName])\r\n                            audioRef.current[audioName].pause();\r\n\r\n                if (audioRef.current[action.audioName]) {\r\n                    audioRef.current[action.audioName].currentTime = 0;\r\n                    audioRef.current[action.audioName].play().catch(e => { });\r\n                }\r\n                break;\r\n            case \"load\":\r\n                newAudioInfo = {\r\n                    overrides: { ...audioInfo.overrides },\r\n                    volumes: { ...audioInfo.volumes }\r\n                };\r\n\r\n                for (let i in action.files) {\r\n                    let fileName = action.files[i];\r\n\r\n                    if (!audioRef.current[fileName]) {\r\n                        audioRef.current[fileName] = new Audio(`/audio/${fileName}.mp3`);\r\n                        audioRef.current[fileName].load();\r\n                        audioRef.current[fileName].loop = action.loops[i];\r\n                    }\r\n\r\n                    newAudioInfo.overrides[fileName] = action.overrides[i];\r\n                    newAudioInfo.volumes[fileName] = action.volumes[i];\r\n                }\r\n                break;\r\n            case \"volume\":\r\n                for (let audioName in audioRef.current) {\r\n                    if (audioInfo.volumes[audioName])\r\n                        audioRef.current[audioName].volume = audioInfo.volumes[audioName] * action.volume;\r\n                }\r\n                break;\r\n        }\r\n\r\n        return newAudioInfo || audioInfo;\r\n    }, { overrides: {}, volumes: {} });\r\n\r\n    useEffect(() => {\r\n        updateAudio({\r\n            type: \"volume\",\r\n            volume: settings.volume\r\n        });\r\n    }, [settings.volume, audioInfo]);\r\n\r\n    function playAudio(audioName) {\r\n        updateAudio({\r\n            type: \"play\",\r\n            audioName\r\n        });\r\n    }\r\n\r\n    function loadAudioFiles(files, loops, overrides, volumes) {\r\n        updateAudio({\r\n            type: \"load\",\r\n            files,\r\n            loops,\r\n            overrides,\r\n            volumes\r\n        });\r\n    }\r\n\r\n    function stopAudio() {\r\n        for (let audioName in audioRef.current)\r\n            audioRef.current[audioName].pause();\r\n    }\r\n\r\n    function stopAudios(audios) {\r\n        for (let audioName of audios)\r\n            audioRef.current[audioName].pause();\r\n    }\r\n\r\n    function setVolume(volume) {\r\n        updateAudio({\r\n            type: \"volume\",\r\n            volume\r\n        });\r\n    }\r\n\r\n    return [playAudio, loadAudioFiles, stopAudio, stopAudios, setVolume];\r\n}\r\n\r\nasync function requestNotificationAccess() {\r\n    if (!Notification)\r\n        return;\r\n\r\n    await Notification.requestPermission();\r\n}\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\n\r\nimport \"../../css/userSearch.css\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { Time } from \"../../components/Basic\";\r\n\r\nexport default function UserSearch(props) {\r\n\tconst [userList, setUserList] = useState([]);\r\n\tconst [searchVal, setSearchVal] = useState(\"\");\r\n\r\n\tconst user = useContext(UserContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Users | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchVal.length > 0) {\r\n\t\t\taxios.get(`/user/searchName?query=${searchVal}`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetUserList(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(useErrorAlert);\r\n\t\t}\r\n\t\telse {\r\n\t\t\taxios.get(\"/user/online\")\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetUserList(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(useErrorAlert);\r\n\t\t}\r\n\t}, [searchVal]);\r\n\r\n\tconst users = userList.map(user => (\r\n\t\t<div className=\"user-cell\">\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<StatusIcon status={user.status} />\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"user-search-page\">\r\n\t\t\t<div className=\"span-panel main\">\r\n\t\t\t\t<div className=\"form\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder=\"Username\"\r\n\t\t\t\t\t\tvalue={searchVal}\r\n\t\t\t\t\t\tonChange={(e) => setSearchVal(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"users\">\r\n\t\t\t\t\t{users}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"user-lists\">\r\n\t\t\t\t<NewestUsers />\r\n\t\t\t\t{user.perms.viewFlagged &&\r\n\t\t\t\t\t<FlaggedUsers />\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction NewestUsers(props) {\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [users, setUsers] = useState([]);\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tonPageNav(1);\r\n\t}, []);\r\n\r\n\tfunction onPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, users, \"joined\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/newest?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tsetUsers(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst userRows = users.map(user => (\r\n\t\t<div className=\"user-row\" key={user.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<div className=\"joined\">\r\n\t\t\t\t<Time\r\n\t\t\t\t\tminSec\r\n\t\t\t\t\tmillisec={Date.now() - user.joined}\r\n\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"newest-users box-panel\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tNewest Users\r\n\t\t\t</div>\r\n\t\t\t<div className=\"users-list\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t\t{userRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction FlaggedUsers(props) {\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [users, setUsers] = useState([]);\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tonPageNav(1);\r\n\t}, []);\r\n\r\n\tfunction onPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, users, \"joined\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/flagged?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tsetUsers(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst userRows = users.map(user => (\r\n\t\t<div className=\"user-row\" key={user.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<div className=\"joined\">\r\n\t\t\t\t<Time\r\n\t\t\t\t\tminSec\r\n\t\t\t\t\tmillisec={Date.now() - user.joined}\r\n\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"flagged-users box-panel\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tFlagged Users\r\n\t\t\t</div>\r\n\t\t\t<div className=\"users-list\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t\t{userRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { SearchSelect, UserSearchSelect } from \"../../components/Form\";\r\nimport { SiteInfoContext, UserContext } from \"../../Contexts\";\r\nimport { Badge, NameWithAvatar, StatusIcon } from \"../User/User\";\r\nimport LoadingPage from \"../Loading\";\r\nimport { MaxBoardNameLength, MaxCategoryNameLength, MaxGroupNameLength, MaxBoardDescLength } from \"../../Constants\";\r\n\r\nimport \"../../css/moderation.css\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { Time } from \"../../components/Basic\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nexport default function Moderation() {\r\n\tconst [groups, setGroups] = useState([]);\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Moderation | BeyondMafia\";\r\n\r\n\t\taxios.get(\"/mod/groups\")\r\n\t\t\t.then((res) => {\r\n\t\t\t\tsetGroups(res.data.sort((a, b) => b.rank - a.rank));\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t})\r\n\t\t\t.catch((e) => {\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t});\r\n\t}, []);\r\n\r\n\tconst groupsPanels = groups.map(group => {\r\n\t\tconst members = group.members.map(member => (\r\n\t\t\t<div className=\"member user-cell\" key={member.id}>\r\n\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\tid={member.id}\r\n\t\t\t\t\tname={member.name}\r\n\t\t\t\t\tavatar={member.avatar} />\r\n\t\t\t\t<StatusIcon status={member.status} />\r\n\t\t\t</div>\r\n\t\t));\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"span-panel group-panel\" key={group.name}>\r\n\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t{group.badge &&\r\n\t\t\t\t\t\t<Badge\r\n\t\t\t\t\t\t\ticon={group.badge}\r\n\t\t\t\t\t\t\tcolor={group.badgeColor || \"black\"}\r\n\t\t\t\t\t\t\tname={group.name} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{group.name + \"s\"}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"members\">\r\n\t\t\t\t\t{members}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"moderation\">\r\n\t\t\t<div className=\"main-section\">\r\n\t\t\t\t{user.perms.viewModActions &&\r\n\t\t\t\t\t<div className=\"span-panel action-panel\">\r\n\t\t\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t\t\tDo Action\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<ModCommands />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{groupsPanels}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"side-column\">\r\n\t\t\t\t<ModActions />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ModCommands() {\r\n\tconst [command, setCommand] = useState();\r\n\tconst [argValues, setArgValues] = useState({});\r\n\tconst modCommands = useModCommands(argValues, commandRan);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tvar options = [];\r\n\tvar args = [];\r\n\r\n\tfor (let commandName in modCommands)\r\n\t\tif (user.perms[modCommands[commandName].perm] && !modCommands[commandName].hidden)\r\n\t\t\toptions.push(commandName);\r\n\r\n\tif (command) {\r\n\t\targs = modCommands[command].args.map(arg => {\r\n\t\t\tvar placeholder = arg.label;\r\n\r\n\t\t\tif (arg.default != null)\r\n\t\t\t\tplaceholder = `${placeholder} (${arg.default})`;\r\n\t\t\telse if (arg.optional)\r\n\t\t\t\tplaceholder = `[${placeholder}]`;\r\n\r\n\t\t\tif (arg.type == \"user_search\") {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<UserSearchSelect\r\n\t\t\t\t\t\tvalue={argValues[arg.name] || \"\"}\r\n\t\t\t\t\t\tsetValue={(value) => updateArgValue(arg.name, value, arg.isArray)}\r\n\t\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\t\tkey={arg.name} />\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<input\r\n\t\t\t\t\tclassName=\"arg\"\r\n\t\t\t\t\ttype={arg.type}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tmaxLength={arg.maxlength}\r\n\t\t\t\t\tonChange={(e) => updateArgValue(arg.name, e.target.value, arg.isArray)}\r\n\t\t\t\t\tkey={arg.name} />\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction updateArgValue(name, value, isArray) {\r\n\t\tif (isArray)\r\n\t\t\tvalue = value.split(/ *, */);\r\n\r\n\t\tsetArgValues(\r\n\t\t\tupdate(argValues, {\r\n\t\t\t\t[name]: {\r\n\t\t\t\t\t$set: value\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction commandRan() {\r\n\t\tsetCommand(null);\r\n\t\tsetArgValues({});\r\n\t}\r\n\r\n\tfunction onRunClick() {\r\n\t\tfor (let arg of modCommands[command].args) {\r\n\t\t\tif (argValues[arg.name] == null) {\r\n\t\t\t\tif (arg.default != null)\r\n\t\t\t\t\targValues[arg.name] = arg.default;\r\n\t\t\t\telse if (!arg.optional) {\r\n\t\t\t\t\terrorAlert(\"Missing arguments.\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmodCommands[command].run();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"mod-commands\">\r\n\t\t\t<div className=\"inputs\">\r\n\t\t\t\t<SearchSelect\r\n\t\t\t\t\toptions={options}\r\n\t\t\t\t\tvalue={command}\r\n\t\t\t\t\tsetValue={setCommand} />\r\n\t\t\t\t{args}\r\n\t\t\t</div>\r\n\t\t\t{command &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"btn btn-theme-sec submit\"\r\n\t\t\t\t\tonClick={onRunClick}>\r\n\t\t\t\t\tRun\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction useModCommands(argValues, commandRan) {\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\treturn {\r\n\t\t\"Create Group\": {\r\n\t\t\tperm: \"createGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\tdefault: 0\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Badge\",\r\n\t\t\t\t\tname: \"badge\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Badge Color\",\r\n\t\t\t\t\tname: \"badgeColor\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Permissions\",\r\n\t\t\t\t\tname: \"permissions\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true,\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/group\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Group created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Group\": {\r\n\t\t\tperm: \"deleteGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/group/delete\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Group deleted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Create Forum Category\": {\r\n\t\t\tperm: \"createCategory\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxCategoryNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\tdefault: 0\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Position\",\r\n\t\t\t\t\tname: \"position\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\tdefault: 0\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/category\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Category created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Create Forum Board\": {\r\n\t\t\tperm: \"createBoard\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Category\",\r\n\t\t\t\t\tname: \"category\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxCategoryNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Description\",\r\n\t\t\t\t\tname: \"description\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardDescLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Icon\",\r\n\t\t\t\t\tname: \"icon\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Position\",\r\n\t\t\t\t\tname: \"position\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/board\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Board created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Update Group Permissions\": {\r\n\t\t\tperm: \"updateGroupPerms\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Group Name\",\r\n\t\t\t\t\tname: \"groupName\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Permissions to Add\",\r\n\t\t\t\t\tname: \"addPermissions\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true,\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Permissions to Remove\",\r\n\t\t\t\t\tname: \"removePermissions\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true,\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/groupPerms\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Group permissions updated.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Add User to Group\": {\r\n\t\t\tperm: \"giveGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Group Name\",\r\n\t\t\t\t\tname: \"groupName\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/addToGroup\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User added to group.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Remove User from Group\": {\r\n\t\t\tperm: \"removeFromGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Group Name\",\r\n\t\t\t\t\tname: \"groupName\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/removeFromGroup\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User removed from group.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get Group Permissions\": {\r\n\t\t\tperm: \"viewPerms\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/groupPerms?name=${argValues.name}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.join(\", \"), \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get User Permissions\": {\r\n\t\t\tperm: \"viewPerms\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/userPerms?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.join(\", \"), \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Forum Board\": {\r\n\t\t\tperm: \"deleteBoard\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardNameLength\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/board/delete\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Board deleted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Move Forum Thread\": {\r\n\t\t\tperm: \"moveThread\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Thread ID\",\r\n\t\t\t\t\tname: \"thread\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Board Name\",\r\n\t\t\t\t\tname: \"board\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/thread/move\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Thread moved.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Create Chat Room\": {\r\n\t\t\tperm: \"createRoom\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Position\",\r\n\t\t\t\t\tname: \"position\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/chat/room\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Room created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Chat Room\": {\r\n\t\t\tperm: \"deleteRoom\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Room Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/chat/room/delete\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Room deleted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Forum Ban\": {\r\n\t\t\tperm: \"forumBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/forumBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User forum banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Chat Ban\": {\r\n\t\t\tperm: \"chatBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/chatBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User chat banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Game Ban\": {\r\n\t\t\tperm: \"gameBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/gameBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User game banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Host Ranked Ban\": {\r\n\t\t\tperm: \"hostRankedBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/hostRankedBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User host ranked banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Site Ban\": {\r\n\t\t\tperm: \"siteBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/siteBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User site banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Force Sign Out\": {\r\n\t\t\tperm: \"forceSignOut\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/logout\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User logged out.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Forum Unban\": {\r\n\t\t\tperm: \"forumUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/forumUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User forum unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Chat Unban\": {\r\n\t\t\tperm: \"chatUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/chatUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User chat unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Game Unban\": {\r\n\t\t\tperm: \"gameUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/gameUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User game unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Site Unban\": {\r\n\t\t\tperm: \"siteUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/siteUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User site unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get Alt Accounts\": {\r\n\t\t\tperm: \"viewAlts\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/alts?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.map(u => `${u.name} (${u.id})`).join(\", \"));\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get Bans\": {\r\n\t\t\tperm: \"viewBans\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/bans?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.map(ban => `Type: ${ban.type}, mod: ${ban.modId}, expires: ${(new Date(ban.expires)).toLocaleString()}`).join(\"\\n\"));\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Check Flagged\": {\r\n\t\t\tperm: \"viewFlagged\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/flagged?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tif (res.data)\r\n\t\t\t\t\t\t\talert(\"Flagged!\")\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\talert(\"Not flagged\")\r\n\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Setup Name\": {\r\n\t\t\tperm: \"clearSetupName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Setup Id\",\r\n\t\t\t\t\tname: \"setupId\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearSetupName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Setup name cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Bio\": {\r\n\t\t\tperm: \"clearBio\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearBio\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Bio cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Account Display\": {\r\n\t\t\tperm: \"clearAccountDisplay\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAccountDisplay\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Account display cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Name\": {\r\n\t\t\tperm: \"clearName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Name cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Avatar\": {\r\n\t\t\tperm: \"clearAvi\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAvi\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Avatar cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear All User Content\": {\r\n\t\t\tperm: \"clearAllUserContent\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAllContent\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User content cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Change Name\": {\r\n\t\t\tperm: \"changeName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"New Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/changeName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Name changed.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Give Coins\": {\r\n\t\t\tperm: \"giveCoins\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Amount\",\r\n\t\t\t\t\tname: \"amount\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/giveCoins\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Coins given.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Break Game\": {\r\n\t\t\tperm: \"breakGame\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Game Id\",\r\n\t\t\t\t\tname: \"gameId\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/breakGame\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Game broken.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Toggle Featured Setup\": {\r\n\t\t\tperm: \"featureSetup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Setup Id\",\r\n\t\t\t\t\tname: \"setupId\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/setup/feature\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Setup feature toggled.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear All IPs\": {\r\n\t\t\tperm: \"clearAllIPs\",\r\n\t\t\targs: [],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAllIPs\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"IPs cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Whitelist\": {\r\n\t\t\tperm: \"whitelist\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/whitelist\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User whitelisted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Schedule Restart\": {\r\n\t\t\tperm: \"scheduleRestart\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"When\",\r\n\t\t\t\t\tname: \"when\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/scheduleRestart\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Restart scheduled.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Kick Player\": {\r\n\t\t\tperm: \"kick\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/kick\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Kicked player.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Break Port Games\": {\r\n\t\t\tperm: \"breakPortGames\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Port\",\r\n\t\t\t\t\tname: \"port\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/breakPortGames\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Games broken.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Make Announcement\": {\r\n\t\t\tperm: \"announce\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Content\",\r\n\t\t\t\t\tname: \"content\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/announcement\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Announcement created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Block Name\": {\r\n\t\t\tperm: \"blockName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/blockName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Name blocked.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Forum Board\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Update Board Description\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Delete Forum Thread\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Thread ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Restore Forum Thread\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Thread ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Toggle Forum Thread Pin\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Thread ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Toggle Forum Thread Lock\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Thread ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Delete Forum Reply\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Reply ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Restore Forum Reply\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Reply ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Delete Comment\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Comment ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t\"Restore Comment\": {\r\n\t\t\thidden: true,\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Comment ID\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t};\r\n}\r\n\r\nfunction ModActions(props) {\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [actions, setActions] = useState([]);\r\n\r\n\tconst modCommands = useModCommands({}, () => { });\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tonPageNav(1);\r\n\t}, []);\r\n\r\n\tfunction onPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, actions, \"date\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/mod/actions?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tsetActions(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst actionRows = actions.map(action => {\r\n\t\tlet command = modCommands[action.name];\r\n\t\tlet actionArgs = action.args.map((arg, i) => {\r\n\t\t\tlet label = command.args[i].label;\r\n\r\n\t\t\tif (label == \"User\")\r\n\t\t\t\targ = <Link to={`/user/${arg}`}>{arg}</Link>\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"action-arg\" key={i}>\r\n\t\t\t\t\t{label}: {arg}\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"action\" key={action.id}>\r\n\t\t\t\t<div className=\"top-row\">\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tid={action.mod.id}\r\n\t\t\t\t\t\tname={action.mod.name}\r\n\t\t\t\t\t\tavatar={action.mod.avatar} />\r\n\t\t\t\t\t<div className=\"date\">\r\n\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\tmillisec={Date.now() - action.date}\r\n\t\t\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"action-name\">\r\n\t\t\t\t\t{action.name}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"action-args\">\r\n\t\t\t\t\t{actionArgs}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"box-panel\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tMod Actions\r\n\t\t\t</div>\r\n\t\t\t<div className=\"actions-wrapper\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav} />\r\n\t\t\t\t{actionRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Route, Switch, Redirect } from \"react-router-dom\";\r\n\r\nimport Forums from \"./Forums/Forums\";\r\nimport UserSearch from \"./UserSearch\";\r\nimport Moderation from \"./Moderation\";\r\nimport { SubNav } from \"../../components/Nav\";\r\n\r\nexport default function Community() {\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Forums\",\r\n\t\t\tpath: `/community/forums`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Users\",\r\n\t\t\tpath: `/community/users`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Moderation\",\r\n\t\t\tpath: `/community/moderation`\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route path=\"/community/forums\" render={() => <Forums />} />\r\n\t\t\t\t\t<Route path=\"/community/users\" render={() => <UserSearch />} />\r\n\t\t\t\t\t<Route path=\"/community/moderation\" render={() => <Moderation />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/community/forums\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, sendEmailVerification } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { Modal } from \"../../components/Modal\";\r\nimport { SiteInfoContext } from \"../../Contexts\";\r\nimport { verifyRecaptcha } from \"../../utils\";\r\n\r\nexport default function LogIn() {\r\n\tconst [email, setEmail] = useState(\"\");\r\n\tconst [password, setPassword] = useState(\"\");\r\n\tconst [submitDisabled, setSubmitDisabled] = useState(true);\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [showResetPw, setShowResetPw] = useState(false);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Log In | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetSubmitDisabled(email.length == 0 || password.length == 0);\r\n\t}, [email, password]);\r\n\r\n\tasync function onSubmit(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (submitDisabled)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tsetLoading(true);\r\n\t\t\tawait verifyRecaptcha(\"auth\");\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tconst userCred = await signInWithEmailAndPassword(auth, email, password);\r\n\t\t\tconst idToken = await userCred.user.getIdToken(true);\r\n\t\t\taxios.post(\"/auth\", { idToken })\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t\tsetLoading(false);\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (e.response && e.response.status == 403)\r\n\t\t\t\t\t\t\tsendEmailVerification(userCred.user);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tsetLoading(false);\r\n\r\n\t\t\tif (!e || !e.message)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (e.message.indexOf(\"(auth/wrong-password)\") != -1)\r\n\t\t\t\terrorAlert(\"Incorrect password.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/invalid-email)\") != -1)\r\n\t\t\t\terrorAlert(\"Invalid email.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/user-not-found)\") != -1)\r\n\t\t\t\terrorAlert(\"Account does not exist.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/too-many-requests)\") != -1)\r\n\t\t\t\terrorAlert(\"Too many login attempts on this account. Please try again later.\");\r\n\t\t\telse\r\n\t\t\t\terrorAlert(e);\r\n\t\t}\r\n\t}\r\n\r\n\tasync function onResetPw(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetShowResetPw(false);\r\n\t\t\tsetLoading(true);\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tawait sendPasswordResetEmail(auth, email);\r\n\r\n\t\t\tsiteInfo.showAlert(\"Password reset email sent.\", \"success\");\r\n\t\t\tsetLoading(false);\r\n\t\t} catch (e) {\r\n\t\t\terrorAlert(\"Error resetting password.\");\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}\r\n\r\n\tconst modalContent = (\r\n\t\t<form className=\"form\" onSubmit={onResetPw}>\r\n\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tEmail\r\n\t\t\t\t</div>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={email}\r\n\t\t\t\t\tonChange={(e) => setEmail(e.target.value)} />\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t);\r\n\tconst modalFooter = (\r\n\t\t<div className=\"control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"reset btn btn-theme\"\r\n\t\t\t\tonClick={onResetPw}>\r\n\t\t\t\tReset\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={() => setShowResetPw(false)}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tif (loading)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main login\">\r\n\t\t\t<form className=\"form\" onSubmit={onSubmit}>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tEmail\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={e => setEmail(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tPassword\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\t\tvalue={password}\r\n\t\t\t\t\t\tonChange={e => setPassword(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<a\r\n\t\t\t\t\tclassName=\"forgot-pw\"\r\n\t\t\t\t\thref=\"#\"\r\n\t\t\t\t\tonClick={() => setShowResetPw(true)}>\r\n\t\t\t\t\tForgot password?\r\n\t\t\t\t</a>\r\n\t\t\t\t<input className={`auth-btn ${submitDisabled ? \"disabled\" : \"\"}`} type=\"submit\" value=\"Log In\" />\r\n\t\t\t</form>\r\n\t\t\t<div className=\"legal\">\r\n\t\t\t\tBy logging in you agree to follow our <Link to=\"/legal/tos\">Terms of Service </Link>\r\n\t\t\t\tand accept our <Link to=\"/legal/privacy\">Privacy Policy</Link>.\r\n\t\t\t</div>\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"reset-pw\"\r\n\t\t\t\tshow={showResetPw}\r\n\t\t\t\tonBgClick={() => setShowResetPw(false)}\r\n\t\t\t\theader={\"Reset Password\"}\r\n\t\t\t\tcontent={modalContent}\r\n\t\t\t\tfooter={modalFooter} />\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link, Redirect } from \"react-router-dom\";\r\nimport { createUserWithEmailAndPassword, getAuth, sendEmailVerification } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../Contexts\";\r\nimport { verifyRecaptcha } from \"../../utils\";\r\n\r\nexport default function SignUp() {\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [passwordConf, setPasswordConf] = useState(\"\");\r\n    const [submitDisabled, setSubmitDisabled] = useState(true);\r\n    const [loading, setLoading] = useState(false);\r\n    const [signedUp, setSignedUp] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    const allowedEmailDomans = JSON.parse(process.env.REACT_APP_EMAIL_DOMAINS);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Sign Up | BeyondMafia\";\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setSubmitDisabled(email.length == 0 || password.length == 0 || password != passwordConf);\r\n    }, [email, password, passwordConf]);\r\n\r\n    async function onSubmit(e) {\r\n        try {\r\n            e.preventDefault();\r\n\r\n            if (submitDisabled)\r\n                return;\r\n\r\n            var emailDomain = email.split(\"@\")[1] || \"\";\r\n\r\n            if (allowedEmailDomans.indexOf(emailDomain) == -1) {\r\n                errorAlert(\"Email domain must be one of the following: \" + allowedEmailDomans.join(\", \"));\r\n                return;\r\n            }\r\n\r\n            setLoading(true);\r\n            await verifyRecaptcha(\"auth\");\r\n\r\n            const auth = getAuth();\r\n            const userCred = await createUserWithEmailAndPassword(auth, email, password);\r\n            await sendEmailVerification(userCred.user);\r\n\r\n            siteInfo.showAlert(\"Account created. Please click the verification link in your email before logging in. Be sure to check your spam folder.\", \"success\", true);\r\n            setSignedUp(true);\r\n            setLoading(false);\r\n        } catch (e) {\r\n            setLoading(false);\r\n\r\n            if (!e || !e.message)\r\n                return;\r\n\r\n            if (e.message.indexOf(\"(auth/invalid-email)\") != -1)\r\n                errorAlert(\"Invalid email.\");\r\n            else if (e.message.indexOf(\"(auth/weak-password)\") != -1)\r\n                errorAlert(\"Password should be at least 6 characters.\");\r\n            else if (e.message.indexOf(\"(auth/email-already-in-use)\") != -1)\r\n                errorAlert(\"Email already in use.\");\r\n            else\r\n                errorAlert(e);\r\n        }\r\n    }\r\n\r\n    if (loading)\r\n        return <LoadingPage />;\r\n\r\n    if (signedUp)\r\n        return <Redirect to=\"/auth/login\" />;\r\n\r\n    return (\r\n        <div className=\"span-panel main login\">\r\n            <form className=\"form\" onSubmit={onSubmit}>\r\n                <div className=\"field-wrapper\">\r\n                    <div className=\"label\">\r\n                        Email\r\n                    </div>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={email}\r\n                        onChange={e => setEmail(e.target.value)} />\r\n                </div>\r\n                <div className=\"field-wrapper\">\r\n                    <div className=\"label\">\r\n                        Password\r\n                    </div>\r\n                    <input\r\n                        type=\"password\"\r\n                        value={password}\r\n                        onChange={e => setPassword(e.target.value)} />\r\n                </div>\r\n                <div className=\"field-wrapper\">\r\n                    <div className=\"label\">\r\n                        Confirm Password\r\n                    </div>\r\n                    <input\r\n                        type=\"password\"\r\n                        value={passwordConf}\r\n                        onChange={e => setPasswordConf(e.target.value)} />\r\n                </div>\r\n                <input className={`auth-btn ${submitDisabled ? \"disabled\" : \"\"}`} type=\"submit\" value=\"Sign Up\" />\r\n            </form>\r\n            <div className=\"legal\">\r\n                By signing up you agree to follow our <Link to=\"/legal/tos\">Terms of Service </Link>\r\n                and accept our <Link to=\"/legal/privacy\">Privacy Policy</Link>, and that you are at least 13 years of age.\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useContext, useEffect } from \"react\";\r\nimport { Redirect, Switch, Route, useLocation } from \"react-router-dom\";\r\nimport { initializeApp } from \"firebase/app\";\r\nimport { getAuth, inMemoryPersistence } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LogIn from \"./LogIn\";\r\nimport SignUp from \"./SignUp\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport LoadingPage from \"../Loading\";\r\n\r\nimport \"../../css/auth.css\"\r\n\r\nexport default function Auth() {\r\n\tconst user = useContext(UserContext);\r\n\tconst location = useLocation();\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Log In\",\r\n\t\t\tpath: \"/auth/login\",\r\n\t\t\texact: true\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Sign Up\",\r\n\t\t\tpath: \"/auth/signup\",\r\n\t\t\texact: true\r\n\t\t}\r\n\t];\r\n\r\n\tuseEffect(() => {\r\n\t\tconst params = new URLSearchParams(location.search);\r\n\r\n\t\tif (params.get(\"ref\"))\r\n\t\t\twindow.localStorage.setItem(\"referrer\", params.get(\"ref\"));\r\n\r\n\t\tconst fbConfig = {\r\n\t\t\tapiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n\t\t\tauthDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n\t\t\tprojectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\r\n\t\t\tstorageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n\t\t\tmessagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n\t\t\tappId: process.env.REACT_APP_FIREBASE_APP_ID,\r\n\t\t\tmeasurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\r\n\t\t};\r\n\t\tinitializeApp(fbConfig);\r\n\t\tgetAuth().setPersistence(inMemoryPersistence);\r\n\t}, []);\r\n\r\n\tif (!user.loaded)\r\n\t\treturn <LoadingPage />;\r\n\telse if (user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"auth inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/auth/login\">\r\n\t\t\t\t\t\t<LogIn />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/auth/signup\">\r\n\t\t\t\t\t\t<SignUp />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/auth/login\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import React, { useEffect } from \"react\";\r\n\r\nexport default function PrivacyPolicy() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Privacy Policy | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>Privacy Policy of BeyondMafia</h1>\r\n\t\t\t<p>BeyondMafia operates the BeyondMafia.org website, which provides the SERVICE.</p>\r\n\t\t\t<p>This page is used to inform website visitors regarding our policies with the collection, use, and disclosure of Personal Information if anyone decided to use our Service, the BeyondMafia website.</p>\r\n\t\t\t<p>If you choose to use our Service, then you agree to the collection and use of information in relation with this policy. The Personal Information that we collect are used for providing and improving the Service. We will not use or share your information with anyone except as described in this Privacy Policy.</p>\t\t\t<p>The terms used in this Privacy Policy have the same meanings as in our Terms and Conditions, which is accessible at BeyondMafia.org, unless otherwise defined in this Privacy Policy. Our Privacy Policy was created with the help of the <a href=\"https://www.privacypolicytemplate.net\">Privacy Policy Template</a> and the <a href=\"https://www.disclaimer-template.net\">Disclaimer Template</a>.</p>\r\n\t\t\t<h2>Information Collection and Use</h2>\r\n\t\t\t<p>For a better experience while using our Service, we may require you to provide us with certain personally identifiable information, including but not limited to your email address and usernames on other services. You may also voluntarily upload any of your own personal information you wish for your profile, including but not limited to photos and textual data.</p>\r\n\t\t\t<h2>Log Data</h2>\r\n\t\t\t<p>We want to inform you that whenever you visit our Service, we collect information that your browser sends to us that is called Log Data. This Log Data may include information such as your computers Internet Protocol (\"IP\") address, browser version, pages of our Service that you visit, the time and date of your visit, the time spent on those pages, and other statistics.</p>\r\n\t\t\t<h2>Cookies</h2>\r\n\t\t\t<p>Cookies are files with small amount of data that is commonly used an anonymous unique identifier. These are sent to your browser from the website that you visit and are stored on your computers hard drive.</p>\r\n\t\t\t<p>Our website uses these \"cookies\" to collection information and to improve our Service. You have the option to either accept or refuse these cookies by either loggin in or choosing not to log in. If you choose to refuse our cookies, you may not be able to use some portions of our Service, which includes any features that require a user to be signed in.</p>\r\n\t\t\t<h2>Service Providers</h2>\r\n\t\t\t<p>We may employ third-party companies and individuals due to the following reasons:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>To facilitate our Service;</li>\r\n\t\t\t\t<li>To provide the Service on our behalf;</li>\r\n\t\t\t\t<li>To perform Service-related services; or</li>\r\n\t\t\t\t<li>To assist us in analyzing how our Service is used.</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>We want to inform our Service users that these third parties have access to your Personal Information. The reason is to perform the tasks assigned to them on our behalf. However, they are obligated not to disclose or use the information for any other purpose.</p>\r\n\t\t\t<h2>Security</h2>\r\n\t\t\t<p>We value your trust in providing us your Personal Information, thus we are striving to use commercially acceptable means of protecting it. But remember that no method of transmission over the internet, or method of electronic storage is 100% secure and reliable, and we cannot guarantee its absolute security.</p>\r\n\t\t\t<h2>Links to Other Sites</h2>\r\n\t\t\t<p>Our Service may contain links to other sites. If you click on a third-party link, you will be directed to that site. Note that these external sites are not operated by us. Therefore, we strongly advise you to review the Privacy Policy of these websites. We have no control over, and assume no responsibility for the content, privacy policies, or practices of any third-party sites or services.</p>\r\n\t\t\t<p>Childrens Privacy</p>\r\n\t\t\t<p>Our Services do not address anyone under the age of 13. We do not knowingly collect personal identifiable information from children under 13. In the case we discover that a child under 13 has provided us with personal information, we immediately delete this from our servers. If you are a parent or guardian and you are aware that your child has provided us with personal information, please contact us so that we will be able to do necessary actions.</p>\r\n\t\t\t<h2>Changes to This Privacy Policy</h2>\r\n\t\t\t<p>We may update our Privacy Policy from time to time. Thus, we advise you to review this page periodically for any changes. We will notify you of any changes by posting the new Privacy Policy on this page. These changes are effective immediately, after they are posted on this page.</p>\r\n\t\t\t<h2>Contact Us</h2>\r\n\t\t\t<p>If you have any questions or suggestions about our Privacy Policy, do not hesitate to contact us.</p>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useEffect } from \"react\";\r\n\r\nexport default function PrivacyPolicy() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Terms of Service | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>BeyondMafia Terms and Conditions of Use</h1>\r\n\t\t\t<h2>1. Terms</h2>\r\n\t\t\t<p>By accessing this Website, accessible from BeyondMafia.org, you are agreeing to be bound by these Website Terms and Conditions of Use and agree that you are responsible for the agreement with any applicable local laws. If you disagree with any of these terms, you are prohibited from accessing this site. The materials contained in this Website are protected by copyright and trade mark law. These Terms of Service has been created with the help of the <a href=\"https://www.termsofservicegenerator.net\">Terms of Service Generator</a> and the <a href=\"https://www.termsconditionsexample.com\">Terms & Conditions Example</a>.</p>\r\n\t\t\t<h2>2. Use License</h2>\r\n\t\t\t<p>Permission is granted to temporarily download one copy of the materials on BeyondMafia's Website for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title, and under this license you may not:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>modify or copy the materials;</li>\r\n\t\t\t\t<li>use the materials for any commercial purpose or for any public display;</li>\r\n\t\t\t\t<li>attempt to reverse engineer any software contained on BeyondMafia's Website;</li>\r\n\t\t\t\t<li>remove any copyright or other proprietary notations from the materials; or</li>\r\n\t\t\t\t<li>transferring the materials to another person or \"mirror\" the materials on any other server.</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>This will let BeyondMafia to terminate upon violations of any of these restrictions. Upon termination, your viewing right will also be terminated and you should destroy any downloaded materials in your possession whether it is printed or electronic format.</p>\r\n\t\t\t<h2>3. Disclaimer</h2>\r\n\t\t\t<p>All the materials on BeyondMafias Website are provided \"as is\". BeyondMafia makes no warranties, may it be expressed or implied, therefore negates all other warranties. Furthermore, BeyondMafia does not make any representations concerning the accuracy or reliability of the use of the materials on its Website or otherwise relating to such materials or any sites linked to this Website.</p>\r\n\t\t\t<h2>4. Limitations</h2>\r\n\t\t\t<p>BeyondMafia or its suppliers will not be hold accountable for any damages that will arise with the use or inability to use the materials on BeyondMafias Website, even if BeyondMafia or an authorize representative of this Website has been notified, orally or written, of the possibility of such damage. Some jurisdiction does not allow limitations on implied warranties or limitations of liability for incidental damages, these limitations may not apply to you.</p>\r\n\t\t\t<h2>5. Revisions and Errata</h2>\r\n\t\t\t<p>The materials appearing on BeyondMafias Website may include technical, typographical, or photographic errors. BeyondMafia will not promise that any of the materials in this Website are accurate, complete, or current. BeyondMafia may change the materials contained on its Website at any time without notice. BeyondMafia does not make any commitment to update the materials.</p>\r\n\t\t\t<h2>6. Links</h2>\r\n\t\t\t<p>BeyondMafia has not reviewed all of the sites linked to its Website and is not responsible for the contents of any such linked site. The presence of any link does not imply endorsement by BeyondMafia of the site. The use of any linked website is at the users own risk.</p>\r\n\t\t\t<h2>7. Site Terms of Use Modifications</h2>\r\n\t\t\t<p>BeyondMafia may revise these Terms of Use for its Website at any time without prior notice. By using this Website, you are agreeing to be bound by the current version of these Terms and Conditions of Use.</p>\r\n\t\t\t<h2>8. Your Privacy</h2>\r\n\t\t\t<p>Please read <a href=\"/legal/privacy\">our Privacy Policy</a>.</p>\r\n\t\t\t<h2>9. Governing Law</h2>\r\n\t\t\t<p>Any claim related to BeyondMafia's Website shall be governed by the laws of us without regards to its conflict of law provisions.</p>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Route, Switch, Redirect } from \"react-router-dom\";\r\n\r\nimport PrivacyPolicy from \"./PrivacyPolicy\";\r\nimport TermsOfService from \"./TermsOfService\";\r\nimport { SubNav } from \"../../components/Nav\";\r\n\r\nimport \"../../css/legal.css\";\r\n\r\nexport default function Legal(props) {\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Terms of Service\",\r\n\t\t\tpath: \"/legal/tos\",\r\n\t\t\texact: true\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Privacy Policy\",\r\n\t\t\tpath: \"/legal/privacy\",\r\n\t\t\texact: true\r\n\t\t}\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/legal/tos\" render={() => <TermsOfService />} />\r\n\t\t\t\t\t<Route exact path=\"/legal/privacy\" render={() => <PrivacyPolicy />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/legal/tos\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useContext, useRef, useEffect, useLayoutEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { PopoverContext, SiteInfoContext } from \"../Contexts\";\r\nimport { Time } from \"./Basic\";\r\nimport { SmallRoleList, GameStateIcon } from \"./Setup\";\r\nimport { NameWithAvatar } from \"../pages/User/User\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\nimport { GameStates, Alignments } from \"../Constants\";\r\nimport { useOnOutsideClick } from \"./Basic\";\r\n\r\nimport \"../css/popover.css\";\r\n\r\nexport default function Popover() {\r\n\tconst popover = useContext(PopoverContext);\r\n\tconst popoverRef = useRef();\r\n\tconst triangleRef = useRef();\r\n\tconst sideContentRef = useRef();\r\n\r\n\tuseOnOutsideClick(\r\n\t\t[\r\n\t\t\t{ current: popover.boundingEl },\r\n\t\t\tpopoverRef\r\n\t\t],\r\n\t\t() => {\r\n\t\t\tif (!popover.loadingRef.current) {\r\n\t\t\t\tpopover.setVisible(false);\r\n\t\t\t\tpopover.setSideContentVisible(false);\r\n\t\t\t\tpopover.setBoundingEl(null);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!popover.visible)\r\n\t\t\treturn;\r\n\r\n\t\tconst boundingRect = popover.boundingEl.getBoundingClientRect();\r\n\t\tconst popoverRect = popoverRef.current.getBoundingClientRect();\r\n\r\n\t\tvar triangleLeft = boundingRect.left + boundingRect.width;\r\n\t\tvar triangleTop = boundingRect.top - 10 + (boundingRect.height / 2) + window.scrollY;\r\n\r\n\t\tvar popoverLeft = boundingRect.left + boundingRect.width + 10;\r\n\t\tvar popoverTop = boundingRect.top - (popoverRect.height / 2) + (boundingRect.height / 2) + window.scrollY;\r\n\t\tvar popoverHorzShift = window.innerWidth - (popoverLeft + popoverRect.width);\r\n\r\n\t\tif (popoverTop < window.scrollY)\r\n\t\t\tpopoverTop = window.scrollY;\r\n\r\n\t\tif (popoverHorzShift < 0) {\r\n\t\t\tif (popoverLeft + popoverHorzShift < 0)\r\n\t\t\t\tpopoverHorzShift -= (popoverLeft + popoverHorzShift);\r\n\t\t}\r\n\t\telse\r\n\t\t\tpopoverHorzShift = 0;\r\n\r\n\t\tpopoverLeft += popoverHorzShift;\r\n\t\ttriangleLeft += popoverHorzShift;\r\n\r\n\t\ttriangleRef.current.style.left = triangleLeft + \"px\";\r\n\t\ttriangleRef.current.style.top = triangleTop + \"px\";\r\n\t\ttriangleRef.current.style.visibility = \"visible\";\r\n\r\n\t\tpopoverRef.current.style.top = popoverTop + \"px\";\r\n\t\tpopoverRef.current.style.left = popoverLeft + \"px\";\r\n\t\tpopoverRef.current.style.visibility = \"visible\";\r\n\r\n\t\tif( popover.sideContentVisible ) {\r\n\t\t\tsideContentRef.current.style.width = popoverRect.width + \"px\"; // Gives consistent styling + just makes loading not funky\r\n\r\n\t\t\tconst useLeft = popoverRect.x > window.innerWidth - (popoverRect.x + popoverRect.width)\r\n\t\t\t\t? (popoverRect.x - popoverRect.width)\r\n\t\t\t\t: popoverRect.x + popoverRect.width\r\n\r\n\t\t\tsideContentRef.current.style.top = popover.sideContentMouseY + \"px\";\r\n\t\t\tsideContentRef.current.style.left = useLeft + \"px\";\r\n\t\t\tsideContentRef.current.style.visibility = \"visible\";\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\tpopover.visible &&\r\n\t\t<>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"triangle triangle-left\"\r\n\t\t\t\tref={triangleRef} />\r\n\t\t\t<div\r\n\t\t\t\tclassName={`popover-window`}\r\n\t\t\t\tref={popoverRef}>\r\n\t\t\t\t<div className=\"popover-title\">\r\n\t\t\t\t\t{popover.title}\r\n\t\t\t\t</div>\r\n\t\t\t\t{!popover.loading &&\r\n\t\t\t\t\t<div className=\"popover-content\">\r\n\t\t\t\t\t\t{popover.content}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t{ popover.sideContentVisible && <div\r\n\t\t\t\tclassName={`popover-window`}\r\n\t\t\t\tref={sideContentRef}>\r\n\t\t\t\t<div className=\"popover-title\">\r\n\t\t\t\t\t{popover.sideContentTitle}\r\n\t\t\t\t</div>\r\n\t\t\t\t{!popover.sideContentLoading &&\r\n\t\t\t\t\t<div className=\"popover-content\">\r\n\t\t\t\t\t\t{popover.sideContent}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div> }\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport function usePopover(siteInfo) {\r\n\tconst [visible, setVisible] = useState(false);\r\n\tconst [boundingEl, setBoundingEl] = useState();\r\n\tconst [title, setTitle] = useState(\"\");\r\n\tconst [content, setContent] = useState(\"\");\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [sideContent, setSideContent] = useState(\"\");\r\n\tconst [sideContentTitle, setSideContentTitle] = useState(\"\");\r\n\tconst [sideContentVisible, setSideContentVisible] = useState(\"\");\r\n\tconst [sideContentLoading, setSideContentLoading] = useState(false);\r\n\tconst [sideContentMouseY, setSideContentMouseY] = useState(0);\r\n\r\n\tconst loadingRef = useRef();\r\n\tconst errorAlert = useErrorAlert(siteInfo);\r\n\r\n\tfunction onClick(path, type, _boundingEl, title, dataMod) {\r\n\t\tif (_boundingEl == boundingEl) {\r\n\t\t\tsetVisible(false);\r\n\t\t\tsetSideContentVisible(false);\r\n\t\t\tsetBoundingEl(null);\r\n\t\t}\r\n\t\telse\r\n\t\t\tload(path, type, _boundingEl, title, dataMod);\r\n\t}\r\n\r\n\tfunction onHover(path, type, _boundingEl, title, dataMod, mouseY) {\r\n\t\tif( !sideContentLoading && title !== sideContentTitle) { // using this just so requests aren't massive\r\n\t\t\tsetSideContentMouseY( mouseY );\r\n\t\t\tload(path, type, _boundingEl, title, dataMod, true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction open(boundingEl, title, sideload) {\r\n\t\tif( sideload ) {\r\n\t\t\tsetSideContentTitle(title);\r\n\t\t\tsetSideContentLoading(true);\r\n\t\t\tsetSideContentVisible(true);\r\n\t\t} else {\r\n\t\t\tsetBoundingEl(boundingEl);\r\n\r\n\t\t\tsetTitle(title);\r\n\t\t\tsetSideContentVisible(false);\r\n\t\t\tsetLoading(true);\r\n\t\t\tsetVisible(true);\r\n\r\n\t\t\tloadingRef.current = true;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction ready(content, type, title, sideload) {\r\n\t\tswitch (type) {\r\n\t\t\tcase \"setup\":\r\n\t\t\t\tcontent = parseSetupPopover(content, siteInfo.roles);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"role\":\r\n\t\t\t\tcontent = parseRolePopover(content);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"game\":\r\n\t\t\t\tcontent = parseGamePopover(content);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif( sideload ) {\r\n\t\t\tsetSideContent(content);\r\n\t\t\tsetSideContentTitle(title); // doing this here guarentees the content + title are synced if multiple hovers are firing at once\r\n\t\t\tsetSideContentLoading(false);\r\n\t\t} else {\r\n\t\t\tsetContent(content);\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction load(path, type, boundingEl, title, dataMod, sideload) {\r\n\t\topen(boundingEl, title, sideload);\r\n\r\n\t\taxios.get(path)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (dataMod)\r\n\t\t\t\t\tdataMod(res.data);\r\n\r\n\t\t\t\tloadingRef.current = false;\r\n\t\t\t\tready(res.data, type, title, sideload)\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn {\r\n\t\tvisible,\r\n\t\tsetVisible,\r\n\t\tboundingEl,\r\n\t\tsetBoundingEl,\r\n\t\ttitle,\r\n\t\tsetTitle,\r\n\t\tcontent,\r\n\t\tsetContent,\r\n\t\tloading,\r\n\t\tsetLoading,\r\n\t\tonClick,\r\n\t\tonHover,\r\n\t\topen,\r\n\t\tready,\r\n\t\tload,\r\n\t\tloadingRef,\r\n\t\tsideContent,\r\n\t\tsideContentVisible,\r\n\t\tsetSideContentVisible,\r\n\t\tsideContentTitle,\r\n\t\tsideContentLoading,\r\n\t\tsideContentMouseY,\r\n\t};\r\n}\r\n\r\nfunction InfoRow(props) {\r\n\treturn (\r\n\t\t<div className=\"info-row\">\r\n\t\t\t<div className=\"title\">{props.title}</div>\r\n\t\t\t<div className=\"content\">{props.content}</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function parseSetupPopover(setup, roleData) {\r\n\tconst result = [];\r\n\r\n\t// ID\r\n\tresult.push(<InfoRow title=\"ID\" content={setup.id} key={-2} />);\r\n\r\n\t//Creator\r\n\tif (setup.creator) {\r\n\t\tconst name =\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tsmall\r\n\t\t\t\tid={setup.creator.id}\r\n\t\t\t\tname={setup.creator.name}\r\n\t\t\t\tavatar={setup.creator.avatar} />\r\n\t\tresult.push(<InfoRow title=\"Created By\" content={name} key={-1} />);\r\n\t}\r\n\r\n\t//Total\r\n\tresult.push(<InfoRow title=\"Players\" content={setup.total} key={0} />);\r\n\r\n\t//Whispers\r\n\tconst whisperContent = [];\r\n\twhisperContent.push(<div key={0}>{setup.whispers ? \"Yes\" : \"No\"}</div>);\r\n\r\n\tif (setup.whispers)\r\n\t\twhisperContent.push(<div key={1}>{setup.leakPercentage}% leak rate</div>);\r\n\r\n\tresult.push(<InfoRow title=\"Whispers\" content={whisperContent} key={1} />);\r\n\r\n\t//Must act\r\n\tresult.push(<InfoRow title=\"Must Act\" content={setup.mustAct ? \"Yes\" : \"No\"} key={2} />);\r\n\r\n\t//Game settings\r\n\tswitch (setup.gameType) {\r\n\t\tcase \"Mafia\":\r\n\t\t\t//Starting state\r\n\t\t\tresult.push(<InfoRow title=\"Starting State\" content={<GameStateIcon state={setup.startState} />} key={3} />);\r\n\r\n\t\t\t//Dawn\r\n\t\t\tresult.push(<InfoRow title=\"Dawn\" content={setup.dawn ? \"Yes\" : \"No\"} key={\"dawn\"} />);\r\n\r\n\t\t\t//Last will\r\n\t\t\tresult.push(<InfoRow title=\"Last Will\" content={setup.lastWill ? \"Yes\" : \"No\"} key={4} />);\r\n\r\n\t\t\t//No reveal\r\n\t\t\tresult.push(<InfoRow title=\"No Reveal\" content={setup.noReveal ? \"Yes\" : \"No\"} key={5} />);\r\n\r\n\t\t\t//Votes invisible\r\n\t\t\tresult.push(<InfoRow title=\"Votes Invisible\" content={setup.votesInvisible ? \"Yes\" : \"No\"} key={6} />);\r\n\t\t\tbreak;\r\n\t\tcase \"Split Decision\":\r\n\t\t\t//Initial swap amount\r\n\t\t\tresult.push(<InfoRow title=\"Initial Swap Amount\" content={setup.swapAmt} key={3} />);\r\n\r\n\t\t\t//Round amount\r\n\t\t\tresult.push(<InfoRow title=\"Round Amount\" content={setup.roundAmt} key={4} />);\r\n\t\t\tbreak;\r\n\t\tcase \"Resistance\":\r\n\t\t\t//First team size\r\n\t\t\tresult.push(<InfoRow title=\"First Team Size\" content={setup.firstTeamSize} key={3} />);\r\n\r\n\t\t\t//Last team size\r\n\t\t\tresult.push(<InfoRow title=\"Last Team Size\" content={setup.lastTeamSize} key={4} />);\r\n\r\n\t\t\t//Number of Missions\r\n\t\t\tresult.push(<InfoRow title=\"Number of Missions\" content={setup.numMissions} key={5} />);\r\n\r\n\t\t\t//Team Formation Attempts\r\n\t\t\tresult.push(<InfoRow title=\"Team Formation Attempts\" content={setup.teamFailLimit} key={6} />);\r\n\t\t\tbreak;\r\n\t\tcase \"One Night\":\r\n\t\t\t//Votes invisible\r\n\t\t\tresult.push(<InfoRow title=\"Votes Invisible\" content={setup.votesInvisible ? \"Yes\" : \"No\"} key={3} />);\r\n\r\n\t\t\t//Excess roles\r\n\t\t\tresult.push(<InfoRow title=\"Excess Roles\" content={setup.excessRoles} key={4} />);\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\t//Roles\r\n\tif (setup.closed) {\r\n\t\tresult.push(<InfoRow title=\"Unique Roles\" content={setup.unique ? \"Yes\" : \"No\"} key={7} />);\r\n\r\n\t\tconst roleset = setup.roles[0];\r\n\t\tvar rolesByAlignment = {};\r\n\r\n\t\tfor (let role in roleset) {\r\n\t\t\tlet roleName = role.split(\":\")[0];\r\n\r\n\t\t\tfor (let roleObj of roleData[setup.gameType]) {\r\n\t\t\t\tif (roleObj.name == roleName) {\r\n\t\t\t\t\tlet alignment = roleObj.alignment;\r\n\r\n\t\t\t\t\tif (!rolesByAlignment[alignment])\r\n\t\t\t\t\t\trolesByAlignment[alignment] = {};\r\n\r\n\t\t\t\t\trolesByAlignment[alignment][role] = roleset[role];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let alignment in rolesByAlignment) {\r\n\t\t\tresult.push(\r\n\t\t\t\t<InfoRow\r\n\t\t\t\t\ttitle={`${alignment} roles`}\r\n\t\t\t\t\tcontent={\r\n\t\t\t\t\t\t<SmallRoleList\r\n\t\t\t\t\t\t\troles={rolesByAlignment[alignment]}\r\n\t\t\t\t\t\t\tgameType={setup.gameType} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkey={alignment} />\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tconst rolesets = [];\r\n\t\tconst sectionName = setup.roles.length > 1 ? \"Role Sets\" : \"Roles\";\r\n\r\n\t\tfor (let i in setup.roles) {\r\n\t\t\tlet roleset = setup.roles[i];\r\n\t\t\trolesets.push(\r\n\t\t\t\t<SmallRoleList\r\n\t\t\t\t\troles={roleset}\r\n\t\t\t\t\tgameType={setup.gameType}\r\n\t\t\t\t\tkey={i} />\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tresult.push(<InfoRow title={sectionName} content={rolesets} key={7} />);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function parseGamePopover(game) {\r\n\tconst result = [];\r\n\r\n\t//Scheduled\r\n\tif (game.settings.scheduled)\r\n\t\tresult.push(<InfoRow title=\"Scheduled For\" content={(new Date(game.settings.scheduled)).toLocaleString()} key={-1} />);\r\n\r\n\t//Players\r\n\tconst playerList = [];\r\n\r\n\tfor (let i = 0; i < game.players.length; i++) {\r\n\t\tplayerList.push(\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tsmall\r\n\t\t\t\tid={game.players[i].id}\r\n\t\t\t\tname={game.players[i].name}\r\n\t\t\t\tavatar={game.players[i].avatar}\r\n\t\t\t\tkey={game.players[i].id} />\r\n\t\t);\r\n\t}\r\n\r\n\twhile (playerList.length < game.totalPlayers) {\r\n\t\tplayerList.push(\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tsmall\r\n\t\t\t\tname=\"[Guest]\"\r\n\t\t\t\tkey={playerList.length} />\r\n\t\t);\r\n\t}\r\n\r\n\tresult.push(<InfoRow title=\"Players\" content={playerList} key=\"players\" />);\r\n\r\n\t//State lengths\r\n\tconst stateLengths = [];\r\n\r\n\tfor (let stateName of GameStates[game.type]) {\r\n\t\tstateLengths.push(<div key={stateName}>{stateName}: <Time millisec={game.settings.stateLengths[stateName]} /></div>);\r\n\t}\r\n\r\n\tresult.push(<InfoRow title=\"State Lengths\" content={stateLengths} key=\"stateLengths\" />);\r\n\r\n\t//Ranked\r\n\tresult.push(<InfoRow title=\"Ranked\" content={game.settings.ranked ? \"Yes\" : \"No\"} key=\"ranked\" />);\r\n\r\n\t//Spectating\r\n\tresult.push(<InfoRow title=\"Spectating\" content={game.settings.spectating ? \"Yes\" : \"No\"} key=\"spectating\" />);\r\n\r\n\t//Guests\r\n\tresult.push(<InfoRow title=\"Guests Allowed\" content={game.settings.guests ? \"Yes\" : \"No\"} key=\"guests\" />);\r\n\r\n\t//Guests\r\n\tresult.push(<InfoRow title=\"Ready Check\" content={game.settings.readyCheck ? \"Yes\" : \"No\"} key=\"readyCheck\" />);\r\n\r\n\tswitch (game.type) {\r\n\t\tcase \"Mafia\":\r\n\t\t\tvar extendLength = game.settings.gameTypeOptions.extendLength || 3;\r\n\t\t\tresult.push(<InfoRow title=\"Extension Length\" content={<Time millisec={extendLength * 60 * 1000} />} key=\"extendLength\" />);\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\t//Created at\r\n\tif (game.createTime)\r\n\t\tresult.push(<InfoRow title=\"Created At\" content={(new Date(game.createTime)).toLocaleString()} key=\"createdAt\" />);\r\n\r\n\t//Started at\r\n\tif (game.startTime)\r\n\t\tresult.push(<InfoRow title=\"Started At\" content={(new Date(game.startTime)).toLocaleString()} key=\"startedAt\" />);\r\n\r\n\t//Ended at\r\n\tif (game.endTime)\r\n\t\tresult.push(<InfoRow title=\"Ended At\" content={(new Date(game.endTime)).toLocaleString()} key=\"endedAt\" />);\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function parseRolePopover(role) {\r\n\tconst result = [];\r\n\r\n\t//Alignment\r\n\tresult.push(<InfoRow title=\"Alignment\" content={role.alignment} key={0} />);\r\n\r\n\t//Description\r\n\tconst descLines = [];\r\n\r\n\tfor (let i in role.description)\r\n\t\tdescLines.push(<li key={i}>{role.description[i]}</li>);\r\n\r\n\tresult.push(<InfoRow title=\"Description\" content={<ul>{descLines}</ul>} key={1} />);\r\n\r\n\treturn result;\r\n}\r\n","import React, { useState, useEffect, useLayoutEffect, useRef, useReducer, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { ClientSocket as Socket } from \"../../Socket\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport { MaxChatMessageLength } from \"../../Constants\";\r\nimport { Time, UserText } from \"../../components/Basic\";\r\nimport { NotificationHolder, filterProfanity, useOnOutsideClick } from \"../../components/Basic\";\r\n\r\nimport \"../../css/chat.css\";\r\n\r\nexport default function Chat() {\r\n\tconst [showWindow, setShowWindow] = useState(false);\r\n\tconst [connected, setConnected] = useState(0);\r\n\tconst [token, setToken] = useState(\"\");\r\n\tconst [socket, setSocket] = useState({});\r\n\tconst [chatInfo, updateChatInfo] = useChatInfoReducer();\r\n\tconst [currentTab, setCurrentTab] = useState(\"rooms\");\r\n\tconst [currentChannelId, setCurrentChannelId] = useState();\r\n\tconst [channel, updateChannel] = useChannelReducer();\r\n\tconst [newDMUsers, setNewDMUsers] = useState({});\r\n\tconst [textInput, setTextInput] = useState(\"\");\r\n\tconst [autoScroll, setAutoScroll] = useState(true);\r\n\tconst [userSearchVal, setUserSearchVal] = useState(\"\");\r\n\r\n\tconst messageListRef = useRef();\r\n\tconst oldScrollHeight = useRef();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseLayoutEffect(() => manageScroll());\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!user.loggedIn && token)\r\n\t\t\tsetToken(\"\");\r\n\t}, [user.loggedIn]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token)\r\n\t\t\treturn;\r\n\r\n\t\tvar socketURL;\r\n\r\n\t\tif (process.env.REACT_APP_USE_PORT == \"true\")\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}:${process.env.REACT_APP_CHAT_PORT}`;\r\n\t\telse\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}/chatSocket`;\r\n\r\n\t\tvar newSocket = new Socket(socketURL);\r\n\t\tnewSocket.on(\"connected\", () => setConnected(connected + 1));\r\n\t\tnewSocket.on(\"disconnected\", () => setConnected(connected - 1));\r\n\t\tsetSocket(newSocket);\r\n\r\n\t\treturn () => {\r\n\t\t\tif (newSocket)\r\n\t\t\t\tnewSocket.clear();\r\n\t\t};\r\n\t}, [token]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (socket.readyState != 1) {\r\n\t\t\tif (socket.readyState == null || socket.readyState == 3)\r\n\t\t\t\tgetToken();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsocket.send(\"auth\", token);\r\n\r\n\t\tsocket.on(\"chatInfo\", chatInfo => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tchatInfo\r\n\t\t\t});\r\n\r\n\t\t\tif (chatInfo.rooms && chatInfo.rooms.length > 0) {\r\n\t\t\t\tif (!currentChannelId) {\r\n\t\t\t\t\tvar roomId = chatInfo.rooms[0].id;\r\n\t\t\t\t\tsetCurrentChannelId(roomId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"channel\", channel => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tchannel\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"message\", message => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"message\",\r\n\t\t\t\tmessage\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"oldMessages\", messages => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"oldMessages\",\r\n\t\t\t\tmessages,\r\n\t\t\t\tmessageListRef\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"users\", users => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"users\",\r\n\t\t\t\tusers\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"newDirectChannel\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"directs\",\r\n\t\t\t\tchannel: info.channel\r\n\t\t\t});\r\n\r\n\t\t\tif (info.focus) {\r\n\t\t\t\tsetCurrentTab(\"directs\");\r\n\t\t\t\tsetCurrentChannelId(info.channel.id);\r\n\t\t\t\tsocket.send(\"getChannel\", info.channel.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"openDM\", channelId => {\r\n\t\t\tsetCurrentTab(\"directs\");\r\n\t\t\tsetCurrentChannelId(channelId);\r\n\t\t\tsocket.send(\"getChannel\", channelId);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"dateUpdate\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"date\",\r\n\t\t\t\tchannelId: info.channel,\r\n\t\t\t\tdate: info.date\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"newNotif\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"addNotif\",\r\n\t\t\t\tchannelId: info.notif.channelId\r\n\t\t\t});\r\n\r\n\t\t\tif (document.hidden && document.title.indexOf(\"\") == -1)\r\n\t\t\t\tdocument.title = document.title + \"\";\r\n\t\t});\r\n\r\n\t\tsocket.on(\"messageDeleted\", messageId => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"deleteMessage\",\r\n\t\t\t\tmessageId\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"error\", error => {\r\n\t\t\terrorAlert(error);\r\n\t\t});\r\n\t}, [connected]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!channel.id)\r\n\t\t\treturn;\r\n\r\n\t\tif (chatInfo.notifs.byChannel[channel.id])\r\n\t\t\tsocket.send(\"readNotifsInChannel\", channel.id);\r\n\r\n\t\tupdateChatInfo({\r\n\t\t\ttype: \"readNotifs\",\r\n\t\t\tchannelId: channel.id\r\n\t\t});\r\n\t}, [channel]);\r\n\r\n\tfunction getToken() {\r\n\t\taxios.get(\"/chat/connect\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetToken(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onTopBarClick() {\r\n\t\tsetShowWindow(!showWindow);\r\n\t\tsetAutoScroll(true);\r\n\r\n\t\tif (!showWindow) {\r\n\t\t\tif (currentChannelId)\r\n\t\t\t\tsocket.send(\"getChannel\", currentChannelId);\r\n\r\n\t\t\tif (currentChannelId) {\r\n\t\t\t\tif (chatInfo.notifs.byChannel[currentChannelId])\r\n\t\t\t\t\tsocket.send(\"readNotifsInChannel\", currentChannelId);\r\n\r\n\t\t\t\tupdateChatInfo({\r\n\t\t\t\t\ttype: \"readNotifs\",\r\n\t\t\t\t\tchannelId: currentChannelId\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t\tsocket.send(\"closedChat\");\r\n\t}\r\n\r\n\tfunction onTabClick(type) {\r\n\t\tsetCurrentTab(type);\r\n\r\n\t\tif (type == \"users\")\r\n\t\t\tsocket.send(\"getUsers\", userSearchVal);\r\n\t}\r\n\r\n\tfunction onChannelClick(id) {\r\n\t\tif (currentTab != \"users\") {\r\n\t\t\tsocket.send(\"getChannel\", id);\r\n\r\n\t\t\tsetCurrentChannelId(id);\r\n\t\t\tsetAutoScroll(true);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!newDMUsers[id]) {\r\n\t\t\t\tsetNewDMUsers(update(newDMUsers, {\r\n\t\t\t\t\t[id]: {\r\n\t\t\t\t\t\t$set: true\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsetNewDMUsers(update(newDMUsers, {\r\n\t\t\t\t\t$unset: [id]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onSendMessage(e) {\r\n\t\tif (e.key == \"Enter\" && textInput.length) {\r\n\t\t\tconst message = e.target.value;\r\n\t\t\tsocket.send(\"sendMessage\", message);\r\n\t\t\tsetTextInput(\"\");\r\n\t\t\tsetAutoScroll(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onMessagesScroll() {\r\n\t\tvar messageList = messageListRef.current;\r\n\r\n\t\tif (Math.round(messageList.scrollTop + messageList.clientHeight) >= Math.round(messageList.scrollHeight))\r\n\t\t\tsetAutoScroll(true);\r\n\t\telse {\r\n\t\t\tsetAutoScroll(false);\r\n\r\n\t\t\tif (messageList.scrollTop == 0)\r\n\t\t\t\tsocket.send(\"getOldMessages\", channel.messages[0].date);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction manageScroll() {\r\n\t\tif (messageListRef.current) {\r\n\t\t\tif (oldScrollHeight.current == null)\r\n\t\t\t\toldScrollHeight.current = messageListRef.current.scrollHeight;\r\n\t\t\telse if (oldScrollHeight.current != messageListRef.current.scrollHeight) {\r\n\t\t\t\tif (messageListRef.current.scrollTop == 0) {\r\n\t\t\t\t\tvar scrollTo = messageListRef.current.scrollHeight * (1 - (oldScrollHeight.current / messageListRef.current.scrollHeight));\r\n\t\t\t\t\tmessageListRef.current.scrollTop = scrollTo - 5;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toldScrollHeight.current = messageListRef.current.scrollHeight;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (autoScroll && messageListRef.current)\r\n\t\t\tmessageListRef.current.scrollTop = messageListRef.current.scrollHeight;\r\n\t}\r\n\r\n\tfunction onUserSearch(e) {\r\n\t\tconst query = e.target.value;\r\n\t\tsetUserSearchVal(query);\r\n\t\tsocket.send(\"getUsers\", query);\r\n\t}\r\n\r\n\tfunction onCreateDM() {\r\n\t\tvar users = Object.keys(newDMUsers);\r\n\t\tsocket.send(\"newDMChannel\", users);\r\n\t\tsetNewDMUsers({});\r\n\t}\r\n\r\n\tfunction onCloseDM(channelId) {\r\n\t\tsocket.send(\"closeDM\", channelId);\r\n\r\n\t\tsetCurrentChannelId(null);\r\n\t\tupdateChannel({ type: \"clear\" });\r\n\t\tupdateChatInfo({\r\n\t\t\ttype: \"remove\",\r\n\t\t\tchannelType: currentTab,\r\n\t\t\tchannelId\r\n\t\t});\r\n\t}\r\n\r\n\tvar channels = chatInfo[currentTab];\r\n\r\n\tif (currentTab == \"directs\")\r\n\t\tchannels = channels.sort(sortDMs);\r\n\r\n\tchannels = channels.reduce((channels, channel) => {\r\n\t\tif (currentTab == \"users\" && channel.id == user.id)\r\n\t\t\treturn channels;\r\n\r\n\t\tvar className = \"channel\";\r\n\r\n\t\tif (currentTab != \"users\" && channel.id == currentChannelId)\r\n\t\t\tclassName += \" sel\";\r\n\t\telse if (currentTab == \"users\" && newDMUsers[channel.id])\r\n\t\t\tclassName += \" sel\";\r\n\r\n\t\tchannels.push(\r\n\t\t\t<NotificationHolder\r\n\t\t\t\tclassName={className}\r\n\t\t\t\tkey={channel.id}\r\n\t\t\t\tnotifCount={chatInfo.notifs.byChannel[channel.id]}\r\n\t\t\t\tonClick={() => onChannelClick(channel.id)}>\r\n\t\t\t\t<ChannelName\r\n\t\t\t\t\tshort\r\n\t\t\t\t\tchannelType={currentTab}\r\n\t\t\t\t\tchannel={channel}\r\n\t\t\t\t\tuser={user} />\r\n\t\t\t</NotificationHolder>\r\n\t\t);\r\n\r\n\t\treturn channels;\r\n\t}, []);\r\n\r\n\tconst messages = channel.messages.map(message => (\r\n\t\t<Message\r\n\t\t\tmessage={message}\r\n\t\t\tsocket={socket}\r\n\t\t\tkey={message.id} />\r\n\t));\r\n\r\n\treturn (\r\n\t\ttoken &&\r\n\t\t<NotificationHolder\r\n\t\t\tclassName=\"chat-wrapper\"\r\n\t\t\tnotifCount={chatInfo.notifs.all}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"top-bar\"\r\n\t\t\t\tonClick={onTopBarClick}>\r\n\t\t\t\t<i className=\"fas fa-comment\" />\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tChat\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{showWindow &&\r\n\t\t\t\t<div className=\"window\">\r\n\t\t\t\t\t<div className=\"left-panel\">\r\n\t\t\t\t\t\t<div className=\"channel-type-nav\">\r\n\t\t\t\t\t\t\t<NotificationHolder\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"rooms\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tnotifCount={chatInfo.notifs.byChannelType[\"rooms\"]}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"rooms\")}>\r\n\t\t\t\t\t\t\t\tRooms\r\n\t\t\t\t\t\t\t</NotificationHolder>\r\n\t\t\t\t\t\t\t<NotificationHolder\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"directs\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tnotifCount={chatInfo.notifs.byChannelType[\"directs\"]}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"directs\")}>\r\n\t\t\t\t\t\t\t\tDirects\r\n\t\t\t\t\t\t\t</NotificationHolder>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"users\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"users\")}>\r\n\t\t\t\t\t\t\t\tUsers\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{currentTab == \"users\" &&\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\tclassName=\"user-search\"\r\n\t\t\t\t\t\t\t\tvalue={userSearchVal}\r\n\t\t\t\t\t\t\t\tplaceholder={\"Search\"}\r\n\t\t\t\t\t\t\t\tonChange={onUserSearch} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"channel-list\">\r\n\t\t\t\t\t\t\t{channels}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{currentTab == \"users\" && Object.keys(newDMUsers).length > 0 &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"create-dm-btn btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onCreateDM}>\r\n\t\t\t\t\t\t\t\t<i className=\"fas fa-plus\" />\r\n\t\t\t\t\t\t\t\tCreate DM ({Object.keys(newDMUsers).length})\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"right-panel\">\r\n\t\t\t\t\t\t{channel.id &&\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t<div className=\"channel-top\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"channel-name\">\r\n\t\t\t\t\t\t\t\t\t\t<ChannelName\r\n\t\t\t\t\t\t\t\t\t\t\tchannelType={channel.public ? \"rooms\" : \"directs\"}\r\n\t\t\t\t\t\t\t\t\t\t\tchannel={channel}\r\n\t\t\t\t\t\t\t\t\t\t\tuser={user} />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{!channel.public &&\r\n\t\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"close-dm fas fa-times\"\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => onCloseDM(channel.id)} />\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName=\"channel-messages\"\r\n\t\t\t\t\t\t\t\t\tref={messageListRef}\r\n\t\t\t\t\t\t\t\t\tonScroll={onMessagesScroll}>\r\n\t\t\t\t\t\t\t\t\t{messages}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"channel-input-wrapper\">\r\n\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"channel-input\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={textInput}\r\n\t\t\t\t\t\t\t\t\t\tmaxLength={MaxChatMessageLength}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setTextInput(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\tonKeyPress={onSendMessage} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</NotificationHolder>\r\n\t);\r\n}\r\n\r\nfunction Message(props) {\r\n\tconst message = props.message;\r\n\tconst socket = props.socket;\r\n\r\n\tconst [showContextMenu, setShowContextMenu] = useState(false);\r\n\tconst [clickCoords, setClickCoords] = useState({});\r\n\r\n\tconst messageRef = useRef();\r\n\tconst contextMenuRef = useRef();\r\n\tconst user = useContext(UserContext);\r\n\tconst isSelf = message.sender.id == user.id;\r\n\tconst age = Date.now() - message.date;\r\n\r\n\tuseOnOutsideClick(messageRef, () => setShowContextMenu(false));\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!contextMenuRef.current)\r\n\t\t\treturn;\r\n\r\n\t\tconst messageRect = messageRef.current.getBoundingClientRect();\r\n\r\n\t\tcontextMenuRef.current.style.top = (clickCoords.y - messageRect.top) + \"px\";\r\n\r\n\t\tif (!isSelf)\r\n\t\t\tcontextMenuRef.current.style.left = (clickCoords.x - messageRect.left) + \"px\";\r\n\t\telse\r\n\t\t\tcontextMenuRef.current.style.right = (messageRect.right - clickCoords.x) + \"px\";\r\n\r\n\t\tcontextMenuRef.current.style.visibility = \"visible\";\r\n\t}, [clickCoords]);\r\n\r\n\tfunction onMessageClick(e) {\r\n\t\tif (e.type == \"contextmenu\") {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetShowContextMenu(true);\r\n\t\t\tsetClickCoords({ x: e.clientX, y: e.clientY });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tsocket.send(\"deleteMessage\", message.id);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className={`message ${isSelf ? \"self\" : \"\"}`}>\r\n\t\t\t<div className=\"info\">\r\n\t\t\t\t{!isSelf &&\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={message.sender.id}\r\n\t\t\t\t\t\tname={message.sender.name}\r\n\t\t\t\t\t\tavatar={message.sender.avatar}\r\n\t\t\t\t\t\tcolor={message.sender.settings && message.sender.settings.nameColor}\r\n\t\t\t\t\t\tgroups={message.sender.groups} />\r\n\t\t\t\t}\r\n\t\t\t\t{age > 1000 * 60 &&\r\n\t\t\t\t\t<div className=\"timestamp\">\r\n\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\tmillisec={age}\r\n\t\t\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"content\"\r\n\t\t\t\tstyle={message.sender.settings && message.sender.settings.textColor ? { color: message.sender.settings.textColor } : {}}\r\n\t\t\t\tonContextMenu={onMessageClick}\r\n\t\t\t\tref={messageRef}>\r\n\t\t\t\t{/* {linkify(message.content)} */}\r\n\t\t\t\t<UserText\r\n\t\t\t\t\ttext={message.content}\r\n\t\t\t\t\tsettings={user.settings}\r\n\t\t\t\t\tfilterProfanity\r\n\t\t\t\t\tlinkify\r\n\t\t\t\t\temotify />\r\n\t\t\t</div>\r\n\t\t\t{showContextMenu && (user.id == message.sender.id || user.perms.deleteChatMessage) &&\r\n\t\t\t\t<div className=\"context\" ref={contextMenuRef}>\r\n\t\t\t\t\t<div className=\"item\" onClick={onDeleteClick}>\r\n\t\t\t\t\t\tDelete\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ChannelName(props) {\r\n\tconst channelType = props.channelType;\r\n\tconst channel = props.channel;\r\n\tconst user = props.user;\r\n\tconst short = props.short;\r\n\r\n\tswitch (channelType) {\r\n\t\tcase \"rooms\":\r\n\t\t\treturn channel.name;\r\n\t\tcase \"directs\":\r\n\t\t\tif (short) {\r\n\t\t\t\tvar memberNames = channel.members.filter(m => m.id != user.id).map(m => m.name);\r\n\t\t\t\tvar name = memberNames.join(\", \");\r\n\r\n\t\t\t\tif (memberNames.length > 1 && name.length > 20)\r\n\t\t\t\t\tname = name.slice(0, 17) + \"...\";\r\n\r\n\t\t\t\treturn name;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar members = channel.members.filter(m => m.id != user.id);\r\n\t\t\t\treturn members.map(\r\n\t\t\t\t\tm => (\r\n\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\t\tid={m.id}\r\n\t\t\t\t\t\t\tname={m.name}\r\n\t\t\t\t\t\t\tavatar={m.avatar}\r\n\t\t\t\t\t\t\tkey={m.id} />\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\tcase \"users\":\r\n\t\t\treturn (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tnoLink\r\n\t\t\t\t\t\tid={channel.id}\r\n\t\t\t\t\t\tname={channel.name}\r\n\t\t\t\t\t\tavatar={channel.avatar} />\r\n\t\t\t\t\t<StatusIcon status={channel.status} />\r\n\t\t\t\t</>\r\n\t\t\t);\r\n\t}\r\n}\r\n\r\nfunction sortDMs(a, b) {\r\n\treturn b.lastMessageDate - a.lastMessageDate;\r\n}\r\n\r\nfunction useChatInfoReducer() {\r\n\treturn useReducer((chatInfo, action) => {\r\n\t\tvar newChatInfo = chatInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tvar notifsArray = action.chatInfo.notifs;\r\n\t\t\t\tvar notifsTotal = 0;\r\n\t\t\t\tvar notifsByChannelType = { rooms: 0, directs: 0 };\r\n\t\t\t\tvar notifsByChannel = {};\r\n\r\n\t\t\t\tfor (let notif of notifsArray) {\r\n\t\t\t\t\tif (!notifsByChannel[notif.channelId])\r\n\t\t\t\t\t\tnotifsByChannel[notif.channelId] = 0;\r\n\r\n\t\t\t\t\tlet channelType = notif.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\r\n\t\t\t\t\tnotifsTotal += 1;\r\n\t\t\t\t\tnotifsByChannelType[channelType] += 1;\r\n\t\t\t\t\tnotifsByChannel[notif.channelId] += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewChatInfo = { ...action.chatInfo, notifs: chatInfo.notifs };\r\n\t\t\t\tnewChatInfo = update(newChatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: notifsTotal\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t$set: notifsByChannelType\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t$set: notifsByChannel\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"directs\":\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tdirects: {\r\n\t\t\t\t\t\t$unshift: [action.channel]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"users\":\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tusers: {\r\n\t\t\t\t\t\t$set: action.users\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"remove\":\r\n\t\t\t\tvar newChannels = chatInfo[action.channelType];\r\n\t\t\t\tnewChannels = newChannels.filter(channel => channel.id != action.channelId);\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\t[action.channelType]: {\r\n\t\t\t\t\t\t$set: newChannels\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"date\":\r\n\t\t\t\tvar newDirects = chatInfo.directs.map(channel => {\r\n\t\t\t\t\tif (channel.id == action.channelId)\r\n\t\t\t\t\t\tchannel.lastMessageDate = action.date;\r\n\r\n\t\t\t\t\treturn channel;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tdirects: {\r\n\t\t\t\t\t\t$set: newDirects\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addNotif\":\r\n\t\t\t\tvar channelType = action.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\t\t\t\tvar newAll = chatInfo.notifs.all + 1;\r\n\t\t\t\tvar newByChannelType = chatInfo.notifs[channelType] ? chatInfo.notifs[channelType] + 1 : 1;\r\n\t\t\t\tvar newByChannel = chatInfo.notifs[action.channelId] ? chatInfo.notifs[action.channelId] + 1 : 1;\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: newAll\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t[channelType]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannelType\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t[action.channelId]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannel\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"readNotifs\":\r\n\t\t\t\tvar amt = chatInfo.notifs.byChannel[action.channelId] || 0;\r\n\t\t\t\tvar channelType = action.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\t\t\t\tvar newAll = chatInfo.notifs.all - amt;\r\n\t\t\t\tvar newByChannelType = chatInfo.notifs.byChannelType[channelType] - amt;\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: newAll\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t[channelType]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannelType\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t[action.channelId]: {\r\n\t\t\t\t\t\t\t\t$set: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newChatInfo;\r\n\t}, { rooms: [], directs: [], users: [], notifs: { all: 0, byChannelType: {}, byChannel: {} } });\r\n}\r\n\r\nfunction useChannelReducer() {\r\n\treturn useReducer((channel, action) => {\r\n\t\tvar newChannel = channel;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tnewChannel = action.channel;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"message\":\r\n\t\t\t\tif (action.message.channel != channel.id)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t$push: [action.message]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"deleteMessage\":\r\n\t\t\t\tvar index = -1;\r\n\r\n\t\t\t\tfor (let i in channel.messages) {\r\n\t\t\t\t\tlet message = channel.messages[i];\r\n\r\n\t\t\t\t\tif (message.id == action.messageId) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index != -1) {\r\n\t\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t\t$splice: [[index, 1]]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"oldMessages\":\r\n\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t$unshift: action.messages\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"clear\":\r\n\t\t\t\tnewChannel = { messages: [] };\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newChannel;\r\n\t}, { messages: [] });\r\n}","import React, { useState, useContext, useRef, useEffect, useLayoutEffect } from \"react\";\r\nimport { Route, Link, NavLink, Switch, Redirect, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { UserContext, SiteInfoContext, PopoverContext, useSiteInfo } from \"./Contexts\";\r\nimport { AlertList, useErrorAlert } from \"./components/Alerts\";\r\nimport { NotificationHolder, useOnOutsideClick, Time } from \"./components/Basic\";\r\nimport { Nav } from \"./components/Nav\";\r\nimport Game from \"./pages/Game/Game\";\r\nimport Play from \"./pages/Play/Play\";\r\nimport Community from \"./pages/Community/Community\";\r\nimport Auth from \"./pages/Auth/Auth\";\r\nimport User, { Avatar, useUser } from \"./pages/User/User\";\r\nimport Legal from \"./pages/Legal/Legal\";\r\nimport Popover, { usePopover } from \"./components/Popover\";\r\nimport Chat from \"./pages/Chat/Chat\";\r\n\r\nimport \"./css/main.css\";\r\nimport { useReducer } from \"react\";\r\nimport { setCaptchaVisible } from \"./utils\";\r\n\r\nfunction Main() {\r\n    var cacheVal = window.localStorage.getItem(\"cacheVal\");\r\n\r\n    if (!cacheVal) {\r\n        cacheVal = Date.now();\r\n        window.localStorage.setItem(\"cacheVal\", cacheVal);\r\n    }\r\n\r\n    const user = useUser();\r\n    const siteInfo = useSiteInfo({\r\n        alerts: [],\r\n        cacheVal\r\n    });\r\n    const popover = usePopover(siteInfo);\r\n    const errorAlert = useErrorAlert(siteInfo);\r\n\r\n    function onGameLeave(index) {\r\n        axios.post(\"/game/leave\")\r\n            .then(() => {\r\n                siteInfo.hideAlert(index);\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function getInfo() {\r\n            try {\r\n                var res = await axios.get(\"/user/info\");\r\n\r\n                if (res.data.id) {\r\n                    setCaptchaVisible(false);\r\n\r\n                    axios.defaults.headers.common['x-csrf'] = res.data.csrf;\r\n                    axios.post(\"/user/online\");\r\n\r\n                    res.data.loggedIn = true;\r\n                    res.data.loaded = true;\r\n                    res.data.rank = Number(res.data.rank);\r\n                    user.set(res.data);\r\n\r\n                    var referrer = window.localStorage.getItem(\"referrer\");\r\n\r\n                    if (referrer) {\r\n                        axios.post(\"/user/referred\", { referrer });\r\n                        window.localStorage.removeItem(\"referrer\");\r\n                    }\r\n                }\r\n                else {\r\n                    user.clear();\r\n                    setCaptchaVisible(true);\r\n                }\r\n\r\n                if (res.data.nameChanged == false) {\r\n                    siteInfo.showAlert(() => (\r\n                        <div>\r\n                            New account created, you can change your username once in your <Link to={`/user/settings`}>settings</Link>.\r\n                        </div>\r\n                    ), \"basic\", true);\r\n                }\r\n\r\n                if (res.data.inGame) {\r\n                    siteInfo.showAlert(index => (\r\n                        <div>\r\n                            Return to game <Link to={`/game/${res.data.inGame}`}>{res.data.inGame}</Link> or <a onClick={() => onGameLeave(index)}>leave</a>.\r\n                        </div>\r\n                    ), \"basic\", true);\r\n                }\r\n\r\n                res = await axios.get(\"/roles/all\");\r\n                siteInfo.update(\"roles\", res.data);\r\n            }\r\n            catch (e) {\r\n                errorAlert(e);\r\n            }\r\n\r\n        }\r\n\r\n        getInfo();\r\n\r\n        var onlineInterval = setInterval(() => {\r\n            axios.post(\"/user/online\");\r\n        }, 1000 * 30);\r\n\r\n        return () => {\r\n            clearInterval(onlineInterval);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <UserContext.Provider value={user}>\r\n            <SiteInfoContext.Provider value={siteInfo}>\r\n                <PopoverContext.Provider value={popover}>\r\n                    <Switch>\r\n                        <Route path=\"/game\">\r\n                            <Game />\r\n                        </Route>\r\n                        <Route path=\"/\">\r\n                            <div className=\"site-wrapper\">\r\n                                <div className=\"main-container\">\r\n                                    <Header />\r\n                                    <div className=\"inner-container\">\r\n                                        <Switch>\r\n                                            <Route path=\"/play\" render={() => <Play />} />\r\n                                            <Route path=\"/community\" render={() => <Community />} />\r\n                                            <Route path=\"/auth\" render={() => <Auth />} />\r\n                                            <Route path=\"/user\" render={() => <User />} />\r\n                                            <Route path=\"/legal\" render={() => <Legal />} />\r\n                                            <Route render={() => <Redirect to=\"/play\" />} />\r\n                                        </Switch>\r\n                                    </div>\r\n                                    <Footer />\r\n                                    <AlertList />\r\n                                    <Chat />\r\n                                </div>\r\n                            </div>\r\n                        </Route>\r\n                    </Switch>\r\n                    <Popover />\r\n                </PopoverContext.Provider>\r\n            </SiteInfoContext.Provider>\r\n        </UserContext.Provider>\r\n    );\r\n}\r\n\r\nfunction Header(props) {\r\n    const user = useContext(UserContext);\r\n\r\n    return (\r\n        <div className=\"header\">\r\n            <div className=\"nav-wrapper left\">\r\n                <Nav>\r\n                    <NavLink to=\"/play\">Lobby</NavLink>\r\n                    <NavLink to=\"/community\">Community</NavLink>\r\n                </Nav>\r\n            </div>\r\n            <Link to=\"/\" className=\"logo-wrapper\">\r\n                <div className=\"logo\" />\r\n            </Link>\r\n            <div className=\"nav-wrapper right\">\r\n                <Nav>\r\n                    <a href=\"https://beyondmafia.fandom.com\" target=\"_blank\">Wiki</a>\r\n                    {!user.loggedIn &&\r\n                        <NavLink to=\"/auth\" className=\"nav-link\">Log In</NavLink>\r\n                    }\r\n                    {user.loggedIn &&\r\n                        <div className=\"user-wrapper\">\r\n                            <SiteNotifs />\r\n                            <Link to=\"/user\" className=\"profile-link\">\r\n                                <Avatar\r\n                                    id={user.id}\r\n                                    name={user.name}\r\n                                    hasImage={user.avatar} />\r\n                            </Link>\r\n                        </div>\r\n\r\n                    }\r\n                </Nav>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SiteNotifs() {\r\n    const [showNotifList, setShowNotifList] = useState(false);\r\n    const [notifInfo, updateNotifInfo] = useNotifInfoReducer();\r\n    const [nextRestart, setNextRestart] = useState();\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const history = useHistory();\r\n\r\n    const bellRef = useRef();\r\n    const notifListRef = useRef();\r\n\r\n    useOnOutsideClick([bellRef, notifListRef], () => setShowNotifList(false));\r\n\r\n    useEffect(() => {\r\n        getNotifs();\r\n        var notifGetInterval = setInterval(() => getNotifs(), 10 * 1000);\r\n        return () => clearInterval(notifGetInterval);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (showNotifList)\r\n            viewedNotifs();\r\n    }, [notifInfo.notifs]);\r\n\r\n    useEffect(() => {\r\n        if (nextRestart && nextRestart > Date.now()) {\r\n            var restartMinutes = Math.ceil((nextRestart - Date.now()) / 1000 / 60);\r\n            siteInfo.showAlert(`The server will be restarting in ${restartMinutes} minutes.`, \"basic\", true);\r\n        }\r\n    }, [nextRestart]);\r\n\r\n    useLayoutEffect(() => {\r\n        if (!showNotifList)\r\n            return;\r\n\r\n        const listRect = notifListRef.current.getBoundingClientRect();\r\n        const listRight = listRect.left + listRect.width;\r\n\r\n        if (listRight > window.innerWidth)\r\n            notifListRef.current.style.left = (window.innerWidth - listRight) + \"px\";\r\n\r\n        notifListRef.current.style.visibility = \"visible\";\r\n    });\r\n\r\n    function getNotifs() {\r\n        axios.get(\"/notifs\")\r\n            .then(res => {\r\n                var nextRestart = res.data[0];\r\n                var notifs = res.data.slice(1);\r\n\r\n                setNextRestart(nextRestart);\r\n\r\n                updateNotifInfo({\r\n                    type: \"add\",\r\n                    notifs: notifs\r\n                });\r\n            })\r\n            .catch(() => { });\r\n    }\r\n\r\n    function viewedNotifs() {\r\n        axios.post(\"/notifs/viewed\")\r\n            .then(() => {\r\n                updateNotifInfo({ type: \"viewed\" });\r\n            })\r\n            .catch(() => { });\r\n    }\r\n\r\n    function onShowNotifsClick() {\r\n        setShowNotifList(!showNotifList);\r\n\r\n        if (!showNotifList && notifInfo.unread > 0)\r\n            viewedNotifs();\r\n    }\r\n\r\n    function onNotifClick(e, notif) {\r\n        if (!notif.link)\r\n            e.preventDefault();\r\n        else if (window.location.pathname == notif.link.split(\"?\")[0])\r\n            history.go(0);\r\n    }\r\n\r\n    const notifs = notifInfo.notifs.map(notif => (\r\n        <Link\r\n            className=\"notif\"\r\n            key={notif.id}\r\n            to={notif.link}\r\n            onClick={e => onNotifClick(e, notif)}>\r\n            {notif.icon &&\r\n                <i className={`fas fa-${notif.icon}`} />\r\n            }\r\n            <div className=\"info\">\r\n                <div className=\"time\">\r\n                    <Time\r\n                        millisec={Date.now() - notif.date}\r\n                        suffix=\" ago\" />\r\n                </div>\r\n                <div className=\"content\">\r\n                    {notif.content}\r\n                </div>\r\n            </div>\r\n        </Link>\r\n    ));\r\n\r\n    return (\r\n        <div className=\"notifs-wrapper\">\r\n            <NotificationHolder\r\n                lOffset\r\n                notifCount={notifInfo.unread}\r\n                onClick={onShowNotifsClick}\r\n                fwdRef={bellRef}>\r\n                <i className=\"fas fa-bell\" />\r\n            </NotificationHolder>\r\n            {showNotifList &&\r\n                <div\r\n                    className=\"notif-list\"\r\n                    ref={notifListRef}>\r\n                    {notifs}\r\n                    {notifs.length == 0 &&\r\n                        \"No unread notifications\"\r\n                    }\r\n                </div>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction useNotifInfoReducer() {\r\n    return useReducer((notifInfo, action) => {\r\n        var newNotifInfo;\r\n\r\n        switch (action.type) {\r\n            case \"add\":\r\n                var existingNotifIds = notifInfo.notifs.map(notif => notif.id);\r\n                var newNotifs = action.notifs.filter(notif => existingNotifIds.indexOf(notif.id) == -1);\r\n\r\n                newNotifInfo = update(notifInfo, {\r\n                    notifs: {\r\n                        $set: newNotifs.concat(notifInfo.notifs)\r\n                    },\r\n                    unread: {\r\n                        $set: notifInfo.unread + newNotifs.length\r\n                    }\r\n                });\r\n\r\n                // if (newNotifs.length > 0 && document.hidden && document.title.indexOf(\"\") == -1)\r\n                //     document.title = document.title + \"\";\r\n                break;\r\n            case \"viewed\":\r\n                newNotifInfo = update(notifInfo, {\r\n                    unread: {\r\n                        $set: 0\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newNotifInfo || notifInfo;\r\n    }, { notifs: [], unread: 0 });\r\n}\r\n\r\nfunction Footer() {\r\n    let year = (new Date()).getYear() + 1900;\r\n\r\n    return (\r\n        <div className=\"footer\">\r\n            <div className=\"footer-inner\">\r\n                <p> {year} BeyondMafia</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Main;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\n\r\nimport Main from \"./Main\";\r\n\r\nReactDOM.render((\r\n    <Router>\r\n        <Main />\r\n    </Router>\r\n), document.getElementById(\"root\"));"],"sourceRoot":""}