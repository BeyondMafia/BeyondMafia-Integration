{"version":3,"sources":["Constants.jsx","Contexts.jsx","components/Alerts.jsx","components/Emotes.jsx","lib/profanity.js","json/slurs.js","json/swears.js","components/Basic.jsx","components/Dropdown.jsx","utils.jsx","components/Nav.jsx","pages/Loading.jsx","pages/Game/MafiaGame.jsx","pages/Game/SplitDecisionGame.jsx","pages/Game/ResistanceGame.jsx","pages/Game/OneNightGame.jsx","pages/Landing.jsx","components/Form.jsx","components/Modal.jsx","pages/User/Profile.jsx","pages/User/Settings.jsx","pages/User/Shop.jsx","pages/User/User.jsx","pages/Community/Forums/Categories.jsx","pages/Community/Forums/Board.jsx","pages/Community/Forums/Thread.jsx","pages/Community/Forums/Forums.jsx","pages/Community/Comments.jsx","pages/Play/Join.jsx","pages/Play/Host/Host.jsx","pages/Play/Host/HostMafia.jsx","pages/Play/CreateSetup/CreateSetup.jsx","pages/Play/CreateSetup/CreateMafiaSetup.jsx","pages/Play/Learn/LearnMafia.jsx","pages/Play/Host/HostSplitDecision.jsx","pages/Play/CreateSetup/CreateSplitDecisionSetup.jsx","pages/Play/Learn/LearnSplitDecision.jsx","pages/Play/Host/HostResistance.jsx","pages/Play/CreateSetup/CreateResistanceSetup.jsx","pages/Play/Learn/LearnResistance.jsx","pages/Play/Host/HostOneNight.jsx","pages/Play/CreateSetup/CreateOneNightSetup.jsx","pages/Play/Learn/LearnOneNight.jsx","pages/Play/Play.jsx","components/Roles.jsx","components/Setup.jsx","Socket.js","pages/Game/Game.jsx","pages/Community/UserSearch.jsx","pages/Community/Moderation.jsx","pages/Community/Community.jsx","pages/Auth/LogIn.jsx","pages/Auth/SignUp.jsx","pages/Auth/Auth.jsx","pages/Legal/PrivacyPolicy.jsx","pages/Legal/TermsOfService.jsx","pages/Legal/Legal.jsx","components/Popover.jsx","pages/Chat/Chat.jsx","pages/Chat/EmoteList.jsx","Main.jsx","index.jsx"],"names":["GameTypes","Lobbies","Alignments","GameStates","RatingThresholds","UserContext","React","createContext","SiteInfoContext","PopoverContext","GameContext","useSiteInfo","initData","useReducer","siteInfo","action","newSiteInfo","type","prop","value","update","$set","text","alerts","length","$push","alertType","id","$splice","index","i","updateSiteInfo","setSiteInfoProp","showAlert","noFade","alertId","Math","random","setTimeout","alert","document","getElementById","style","opacity","fadeAlert","hideAlert","hideAllAlerts","clearCache","cacheVal","Date","now","window","localStorage","setItem","AlertList","props","useContext","map","Alert","onHide","key","className","onClick","useErrorAlert","siteInfoContext","e","message","response","data","Emote","emoteKey","emote","toLowerCase","Emotes","title","name","backgroundImage","emotify","Array","isArray","segment","words","split","j","word","flat","Object","keys","createProfanityRegexps","join","String","raw","concat","RegExp","slurRegexps","swearRegexps","leetMappings","filterProfanitySegment","profanityType","char","profanityRegexps","mappedSegment","num","replaceAll","profanityRegex","regexRes","exec","indexOf","slice","repeat","ItemList","itemRows","items","PanelGrid","panels","panel","icon","Time","unit","millisec","suffix","minSec","units","scale","floor","NotificationHolder","notifCount","lOffset","ref","fwdRef","children","UserText","useState","content","setContent","useEffect","filterProfanity","settings","profChar","linkify","linkRegex","_segment","lastIndex","push","href","target","iconUsername","players","trim","replaced","charAt","checkName","substring","matchedPlayer","values","find","curPlayer","avatar","InlineAvatar","url","userId","username","disablePg13Censor","disableAllCensors","useOnOutsideClick","refs","onOutsideClick","current","contains","addEventListener","removeEventListener","Dropdown","useDropdown","menuVisible","setMenuVisible","dropdownContainerRef","dropdownMenuRef","selOption","options","filter","option","selLabel","label","menuItems","optionId","onChange","placeholder","caret","useRef","useLayoutEffect","containerRect","getBoundingClientRect","menuRect","menuLeft","left","menuTop","top","height","scrollY","menuHorzShift","innerWidith","width","innerHeight","visibility","hyphenDelimit","roleName","replace","adjustColor","hexColor","contrastVal","colorScheme","colorAutoScheme","documentElement","classList","matchMedia","matches","colorContrast","flipTextColor","hslColor","H","undefined","r","g","b","cmin","min","cmax","max","delta","h","l","round","abs","toFixed","hexToHSL","hslVals","difference","parseInt","match","s","c","x","m","toString","HSLToHex","camelCase","string","subStrings","result","toUpperCase","pad","amt","dateToHTMLString","date","day","toLocaleDateString","time","toTimeString","verifyRecaptcha","Promise","res","rej","grecaptcha","ready","execute","process","token","axios","post","console","log","setCaptchaVisible","visible","el","getElementsByClassName","Nav","SubNav","links","link","hide","exact","to","path","showFilter","filterSel","filterOptions","onFilter","filterIcon","PageNav","page","maxPage","range","onNav","inverted","noRange","sel","list","changed","unshift","pages","updatePages","pageNums","getPageNavFilterArg","newPage","oldPage","pageItems","sortField","filterArg","SearchBar","event","onInput","LoadingPage","color","MafiaGame","game","history","updateHistory","stateViewing","updatePlayers","updateStateViewing","self","isSpectator","playBellRef","meetings","states","audioFileNames","stateEvents","audioLoops","audioOverrides","audioVolumes","currentState","loadAudioFiles","review","useSocketListeners","socket","on","state","playAudio","winners","TopBar","gameType","setup","spectatorCount","setLeave","finished","setShowSettingsModal","setRehostId","noLeaveRef","dev","gameName","timer","Timer","timers","ThreePanelLayout","leftPanelContent","PlayerList","activity","SpeechFilter","filters","speechFilters","setFilters","setSpeechFilters","centerPanelContent","TextMeetingLayout","setTyping","agoraClient","localAudioTrack","setActiveVoiceChannel","muted","setMuted","deafened","setDeafened","rightPanelContent","ActionList","lastWill","LastWillEntry","Notes","SplitDecisionGame","ResistanceGame","ScoreKeeper","numMissions","missionRecord","extraInfo","SideMenu","scrollable","MissionInfo","Score","score","MissionHistory","missionHistory","ScoreBox","team","scoreValue","missionHistoryView","success","numFails","teamMembers","OneNightGame","LandingPage","Form","field","localOnly","Number","onDChange","formFields","fields","showIf","disabled","deps","fieldWrapperClass","fixed","saveBtn","highlight","select","saveBtnDiffer","confirm","saveBtnOnClick","step","Switch","ColorPicker","default","alpha","noReset","selectedValue","user","format","calendarAriaLabel","clearAriaLabel","dayAriaLabel","monthAriaLabel","nativeInputAriaLabel","maxDetail","submitText","onSubmit","picking","setPicking","pickerRef","backgroundColor","disableAlpha","onChangeComplete","hex","HiddenUpload","inputRef","shouldInput","click","onFileUpload","files","useForm","initialFormFields","initFields","actions","newFormFields","newField","updateFields","updates","SearchSelect","setValue","inputValue","setInputValue","optionsVisible","setOptionsVisible","hoveringOptions","setHoveringOptions","matchingOptions","setMatchingOptions","searchSelectRef","optionsRef","searchSelectRect","optionsRect","optionsTop","includes","onOptionClick","tabIndex","onFocus","onBlur","onInputChange","onKeyDown","onMouseEnter","onMouseLeave","UserSearchSelect","setOptions","idMap","setIdMap","query","setQuery","valueName","setValueName","get","then","newIdMap","userData","catch","TextEditor","tab","setTab","selectedTab","onTabChange","classes","generateMarkdownPreview","markdown","resolve","source","Modal","show","onBgClick","header","footer","Profile","profileLoaded","setProfileLoaded","setName","setAvatar","banner","setBanner","bio","setBio","oldBio","setOldBio","editingBio","setEditingBio","isFriend","setIsFriend","setSettings","accounts","setAccounts","recentGames","setRecentGames","createdSetups","setCreatedSetups","bustCache","setBustCache","friendsPage","setFriendsPage","setMaxFriendsPage","friends","setFriends","friendRequests","setFriendRequests","stats","setStats","groups","setGroups","showStatsModal","setShowStatsModal","embedId","setEmbedId","autoplay","setAutoplay","useHistory","errorAlert","useParams","isSelf","isBlocked","blockedUsers","formData","FormData","append","status","onFriendsPageNav","youtubeRegex","games","setups","maxFriendsPage","youtube","videoMatches","panelStyle","bannerStyle","bannerFormat","backgroundSize","ratings","totalGames","all","mafiaStats","wins","total","abandons","statName","stat","count","letter","letters","reverse","recentGamesRows","GameRow","small","createdSetupRows","Setup","friendRequestRows","NameWithAvatar","_userId","newFriendRequests","u","friendRows","friend","friendId","lastActive","loaded","loggedIn","StatsModal","setShow","itemsOwned","customProfile","Avatar","large","hasImage","edit","onUpload","Badges","blockUserToggle","discord","showDiscord","twitch","showTwitch","steam","showSteam","stopPropagation","YouTubeEmbed","Comments","location","statsRowNames","statsFilter","setStatsFilter","statsFilterQuery","setStatsFilterQuery","statsFilterNames","statsKeyNames","filterDropdownOptions","statsRows","statsObj","totalGamesUnabandoned","statsList","statKey","statData","Settings","settingsLoaded","setSettingsLoaded","accountsLoaded","setAccountsLoaded","perms","viewDeleted","siteFields","updateSiteFields","code","reservedNames","prompt","set","nameChange","birthday","bdayChanged","profileFields","updateProfileFields","textColors","gameFields","updateGameFields","onSettingChange","updateSetting","siteFormFieldChanges","profileFormFieldChanges","gameFormFieldChanges","clear","Shop","shopItems","balance","shopInfo","setShopInfo","setLoaded","item","desc","price","limit","onBuyItem","src","allow","allowFullScreen","User","render","size","imageUrl","active","colors","rand","charCodeAt","pow","noLink","newTab","popover","userNameClassName","setVisible","preventDefault","StatusIcon","badges","badge","sort","a","rank","Badge","badgeColor","Categories","categoryInfo","setCategoryInfo","sortItems","position","updateForumNavInfo","categories","category","boards","board","newestThreads","thread","author","ViewsAndReplies","viewCount","replyCount","recentReplies","reply","postDate","description","Board","boardInfo","setBoardInfo","showCreateModal","setShowCreateModal","newThreadTitle","setNewThreadTitle","newThreadContent","setNewThreadContent","boardPage","setBoardPage","sortType","redirect","setRedirect","boardId","onBoardPageNav","threads","threadRowsMap","deleted","VoteWidget","itemType","itemHolder","setItemHolder","itemKey","locked","pinned","pinnedThreads","CreateThreadModal","threadTitle","setThreadTitle","threadContent","setThreadContent","createThread","onCancel","Thread","threadInfo","setThreadInfo","showReplyForm","setShowReplyForm","replyContent","setReplyContent","setPage","scrolled","setScrolled","replyFormRef","threadId","useLocation","params","URLSearchParams","search","onReplyClick","postInLocked","newContent","quotedContent","scrollIntoView","onThreadPageNav","replies","boardName","Post","postInfo","voteItem","voteItemHolder","setVoteItemHolder","permaLink","onDelete","onRestore","onEdit","onNotifyToggled","replyNotify","onPinToggled","onLockToggled","hasTitle","body","scrollTop","scrollHeight","pageCount","editing","setEditing","editContent","setEditContent","hideDeleted","pinThreads","lockThreads","deleteAnyPost","deleteOwnPost","editPost","navigator","clipboard","writeText","origin","postReply","restoreDeleted","Forums","info","newInfo","forumNavInfo","ForumNav","onVote","itemId","direction","vote","newDirection","newItem","voteCount","updateItemVoteCount","newItems","viewsPlural","repliesPlural","comments","setComments","showInput","setShowInput","postContent","setPostContent","onCommentsPageNav","_page","comment","commentRows","Comment","Join","listType","setListType","setGames","getItem","lobby","setLobby","getGameList","_listType","lobbyNav","_lobby","pathname","TopBarLink","refresh","odd","empty","Announcements","linkPath","buttonText","reserved","setReserved","infoRef","buttonClass","scheduled","spectating","canSpectateAny","broken","private","gameId","hostId","PlayerCount","maxRolesCount","ranked","voiceChat","stateLengths","stateName","guests","readyCheck","JSON","parse","gameTypeOptions","circles","announcements","setAnnouncements","onPageNav","announcementRows","announcement","mod","Host","selSetup","setSelSetup","updateFormFields","onHostGame","setPageCount","searchVal","setSearchVal","setSetups","getSetupList","onFavSetup","favSetup","newSetups","favorite","onEditSetup","onDelSetup","hostButtons","onHostNavClick","SetupRow","onSelect","onFav","onDel","args","selIconFormat","favIconFormat","HostMafia","defaults","dayLength","nightLength","extendLength","getFormFieldValue","stringify","CreateSetup","roleSets","closedField","resetFormFields","formFieldValueMods","onCreateSetup","selRoleSet","setSelRoleSet","modifier","setModifier","roleData","newRoleData","roles","closed","roleSet","role","splice","updateRoleData","formFieldChanges","valueMod","alignment","RoleCount","RoleSetRow","modifiers","RoleSearch","onAddClick","CreateMafiaSetup","startState","dawn","whispers","leakPercentage","mustAct","noReveal","votesInvisible","unique","LearnMafia","HostSplitDecision","getTime","CreateSplitDecisionSetup","swapAmt","roundAmt","LearnSplitDecision","HostResistance","CreateResistanceSetup","firstTeamSize","lastTeamSize","teamFailLimit","LearnResistance","CreateOneNightSetup","excessRoles","LearnOneNight","Play","inLobby","setGameType","roleRef","isRolePrediction","makeRolePrediction","hideCount","roleClass","bg","showPopover","showSecondaryHover","onHover","clientY","roleListType","setRoleListType","roleCellRefs","alignButtons","roleCells","roleCellEl","onRoleCellClick","roleCounts","multi","setupRef","overSize","roleNames","GameIcon","SmallRoleList","GameStateIcon","iconName","ClientSocket","persistent","WebSocket","configurePing","configureClose","this","heartbeat","clearTimeout","pingTimeout","send","close","PING_INTERVAL","reconnect","listeners","sendQueue","received","setSocket","configureListeners","triggerEvent","terminate","eventName","parseMessage","bind","stringifyMessage","readyState","newListeners","Game","GameWrapper","leave","setFinished","port","setPort","setToken","connected","setConnected","setSetup","emojis","setEmojis","newHistory","stateIds","prevState","dead","meeting","meetingId","members","$unset","selTab","messages","quote","toMeetingId","votes","voterId","noLog","voteRecord","t","playerId","newState","useStateViewingReducer","newPlayers","player","propName","propVal","setSpectatorCount","setIsSpectator","setSelf","setLastWill","newTimers","delay","timerName","intTime","updateTimers","newSettings","propval","votingLog","timestamps","sounds","volume","updateSettings","showSettingsModal","showFirstGameModal","setShowFirstGameModal","from","isolationEnabled","setIsolationEnabled","Set","isolatedPlayers","setIsolatedPlayers","rolePredictions","setRolePredictions","activeVoiceChannel","rehostId","setDev","playersRef","selfRef","newActivity","typing","newSpeaking","reduce","speaking","updateActivity","activityInterval","setInterval","getVolumeLevel","uid","remoteUsers","forEach","audioTrack","clearInterval","useActivity","audioRef","audioInfo","newAudioInfo","overrides","audioName","pause","currentTime","play","volumes","fileName","Audio","load","loop","loops","updateAudio","audios","useAudio","stopAudio","stopAudios","toggleRolePrediction","prediction","newRolePredictions","createAgoraClient","AgoraRTC","createClient","mode","codec","mediaType","subscribe","setVolume","audioContainer","remove","agoraDisconnect","createMicrophoneAudioTrack","publish","error","socketURL","newSocket","Socket","onKeydown","speechInput","activeElName","activeElement","tagName","focus","requestNotificationAccess","timerInterval","names","users","textColor","nameColor","vcToken","agoraConnect","guestId","isBot","pings","will","Notification","permission","hasFocus","context","togglePlayerIsolation","newIsolatedPlayers","has","delete","add","Provider","SettingsModal","showModal","setShowModal","FirstGameModal","open","StateSwitcher","p","rehost","stateInfo","autoScroll","setAutoScroll","mouseMoved","setMouseMoved","speechDisplayRef","speechMeetings","speech","doAutoScroll","onMessageQuote","senderId","isQuote","quotable","messageId","fromMeetingId","fromState","onMouseMove","tabs","tabId","playerName","isUnvote","voter","voterName","voteMsg","getMessagesToDisplay","isNotServerMessage","unfocusedMessage","Message","canSpeak","amMember","canTalk","onScroll","clientHeight","SpeechInput","quotedMessage","contentClass","isMe","msg","meetingName","senderName","first","second","messageStyle","setYear","getMonth","getDate","startsWith","onDoubleClick","Timestamp","prefix","hours","getHours","padStart","minutes","getMinutes","seconds","getSeconds","setSpeechInput","speechDropdownOptions","setSpeechDropdownOptions","speechDropdownValue","setSpeechDropdownValue","lastTyped","setLastTyped","typingIn","setTypingIn","clearTyping","setClearTyping","speechAbilities","newDropdownOptions","ability","targets","targetDisplay","targetType","verb","isTyping","autoComplete","maxLength","anonymous","enterKeyHint","abilityInfo","abilityName","abilityTarget","test","textIncludesSlurs","pop","seedString","playerNames","playerSeeds","matchedPlayers","every","leftArrowVisible","rigthArrowVisible","RoleMarkerToggle","roleMarkerRef","PlayerRows","stateViewingInfo","isolationCheckbox","checked","rolePrediction","roleToShow","bubbleColor","alivePlayers","deadPlayers","voting","inputType","ActionSelect","ActionButton","ActionText","useAction","notClickable","getTargetDisplay","onSelectVote","member","selection","canVote","actionName","buttons","canUnvote","textOptions","minLength","textData","setTextData","textInput","alphaOnly","submit","isCurrentState","instant","mainTimer","mainTime","formatTimerTime","newWill","modalContent","modalFooter","cancel","marginBottom","htmlFor","notes","setNotes","notesData","removeItem","_notes","requestPermission","UserSearch","userList","setUserList","NewestUsers","viewFlagged","FlaggedUsers","setUsers","userRows","joined","Moderation","groupsPanels","group","viewModActions","ModCommands","ModActions","command","setCommand","argValues","setArgValues","modCommands","useModCommands","commandName","perm","hidden","updateArgValue","arg","optional","maxlength","run","commandRan","ban","modId","expires","toLocaleString","setActions","actionRows","actionArgs","Community","LogIn","email","setEmail","password","setPassword","submitDisabled","setSubmitDisabled","loading","setLoading","showResetPw","setShowResetPw","auth","getAuth","signInWithEmailAndPassword","userCred","getIdToken","idToken","reload","sendEmailVerification","onResetPw","sendPasswordResetEmail","SignUp","passwordConf","setPasswordConf","signedUp","setSignedUp","allowedEmailDomans","emailDomain","createUserWithEmailAndPassword","Auth","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","setPersistence","inMemoryPersistence","PrivacyPolicy","Legal","Popover","popoverRef","triangleRef","sideContentRef","boundingEl","loadingRef","setSideContentVisible","setBoundingEl","boundingRect","popoverRect","triangleLeft","triangleTop","popoverLeft","popoverTop","popoverHorzShift","innerWidth","sideContentVisible","useLeft","sideContentMouseY","sideContentTitle","sideContentLoading","sideContent","usePopover","setTitle","setSideContent","setSideContentTitle","setSideContentLoading","setSideContentMouseY","sideload","InfoRow","creator","whisperContent","roleset","rolesByAlignment","roleObj","rolesets","sectionName","parseSetupPopover","parseRolePredictionPopover","descLines","parseRolePopover","playerList","totalPlayers","createTime","startTime","endTime","parseGamePopover","dataMod","_boundingEl","mouseY","Chat","showWindow","setShowWindow","chatInfo","newChatInfo","notifsArray","notifs","notifsTotal","notifsByChannelType","rooms","directs","notifsByChannel","notif","channelId","channelType","byChannelType","byChannel","$unshift","channel","newChannels","newDirects","lastMessageDate","newAll","newByChannelType","newByChannel","updateChatInfo","currentTab","setCurrentTab","currentChannelId","setCurrentChannelId","newChannel","updateChannel","newDMUsers","setNewDMUsers","setTextInput","userSearchVal","setUserSearchVal","messageListRef","oldScrollHeight","onTabClick","scrollTo","manageScroll","roomId","channels","sortDMs","ChannelName","short","public","messageList","onKeyPress","showContextMenu","setShowContextMenu","clickCoords","setClickCoords","messageRef","contextMenuRef","sender","age","messageRect","y","right","onContextMenu","clientX","deleteChatMessage","memberNames","EmoteList","emotesList","getEmotes","Header","SiteNotifs","showNotifList","setShowNotifList","notifInfo","newNotifInfo","existingNotifIds","newNotifs","unread","updateNotifInfo","nextRestart","setNextRestart","bellRef","notifListRef","getNotifs","viewedNotifs","notifGetInterval","restartMinutes","ceil","listRect","listRight","go","onNotifClick","Footer","year","getYear","Main","setUser","userIndex","useUser","onGameLeave","userColourScheme","siteColorScheme","headers","common","csrf","referrer","nameChanged","inGame","getInfo","onlineInterval","ReactDOM"],"mappings":"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ACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM,OAEV,SAAU,CACN0D,KAAM,OACN1D,KAAM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","file":"static/js/main.267218a4.chunk.js","sourcesContent":["export const GameTypes = [\"Mafia\", \"Split Decision\", \"Resistance\", \"One Night\"];\r\nexport const Lobbies = [\"Main\", \"Sandbox\", \"Competitive\", \"Games\"];\r\n\r\nexport const Alignments = {\r\n    \"Mafia\": [\"Village\", \"Mafia\", \"Monsters\", \"Independent\"],\r\n    \"Split Decision\": [\"Blue\", \"Red\", \"Independent\"],\r\n    \"Resistance\": [\"Resistance\", \"Spies\"],\r\n    \"One Night\": [\"Village\", \"Werewolves\", \"Independent\"],\r\n};\r\n\r\nexport const GameStates = {\r\n    \"Mafia\": [\"Day\", \"Night\"],\r\n    \"Split Decision\": [\"Initial Round\", \"Hostage Swap\"],\r\n    \"Resistance\": [\"Team Selection\", \"Team Approval\", \"Mission\"],\r\n    \"One Night\": [\"Day\", \"Night\"],\r\n};\r\n\r\nexport const RatingThresholds = {\r\n    \"reads\": {\r\n        \"S\": 0.95,\r\n        \"A\": 0.9,\r\n        \"B\": 0.8,\r\n        \"C\": 0.7,\r\n        \"D\": 0.6,\r\n        \"E\": 0.5,\r\n    },\r\n    \"survival\": {\r\n        \"S\": 0.95,\r\n        \"A\": 0.9,\r\n        \"B\": 0.8,\r\n        \"C\": 0.7,\r\n        \"D\": 0.6,\r\n        \"E\": 0.5,\r\n    },\r\n    \"wins\": {}\r\n};\r\n\r\nexport const RequiredTotalForStats = 1;\r\n\r\nexport const MaxGameMessageLength = 240;\r\nexport const MaxTextInputLength = 100;\r\nexport const MaxWillLength = 100;\r\n\r\nexport const MaxGroupNameLength = 20;\r\nexport const MaxCategoryNameLength = 20;\r\nexport const MaxBoardNameLength = 20;\r\nexport const MaxBoardDescLength = 60;\r\nexport const MaxThreadTitleLength = 50;\r\nexport const MaxThreadContentLength = 5000;\r\nexport const MaxReplyLength = 1000;\r\n\r\nexport const MaxChatMessageLength = 240;\r\n\r\nexport const AlertFadeTimeout = 3000;\r\nexport const AlertFadeDuration = 500;\r\n\r\n","import React, { useState, useReducer } from \"react\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { AlertFadeTimeout, AlertFadeDuration } from \"./Constants\";\r\n\r\nexport const UserContext = React.createContext();\r\nexport const SiteInfoContext = React.createContext();\r\nexport const PopoverContext = React.createContext();\r\nexport const GameContext = React.createContext();\r\n\r\nexport function useSiteInfo(initData) {\r\n\tconst [siteInfo, updateSiteInfo] = useReducer((siteInfo, action) => {\r\n\t\tvar newSiteInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"setProp\":\r\n\t\t\t\tif (siteInfo[action.prop] != action.value) {\r\n\t\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\t\t[action.prop]: {\r\n\t\t\t\t\t\t\t$set: action.value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showAlert\":\r\n\t\t\t\tif (typeof action.text == \"function\")\r\n\t\t\t\t\taction.text = action.text(siteInfo.alerts.length);\r\n\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$push: [{ \r\n\t\t\t\t\t\t\ttext: action.text, \r\n\t\t\t\t\t\t\ttype: action.alertType || \"\" ,\r\n\t\t\t\t\t\t\tid: action.id\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAlert\":\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$splice: [[action.index, 1]]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAlertById\":\r\n\t\t\t\tfor (let i = 0; i < siteInfo.alerts.length; i++) {\r\n\t\t\t\t\tif (siteInfo.alerts[i].id == action.id) {\r\n\t\t\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t\t\t$splice: [[i, 1]]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAllAlerts\":\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$set: []\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newSiteInfo || siteInfo;\r\n\t}, initData);\r\n\r\n\tfunction setSiteInfoProp(prop, value) {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"setProp\",\r\n\t\t\tprop,\r\n\t\t\tvalue\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showAlert(text, alertType, noFade) {\r\n\t\tvar alertId = Math.random();\r\n\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"showAlert\",\r\n\t\t\ttext,\r\n\t\t\talertType,\r\n\t\t\tid: alertId\r\n\t\t});\r\n\r\n\t\tif (!noFade)\r\n\t\t\tsetTimeout(() => fadeAlert(alertId), AlertFadeTimeout);\r\n\t}\r\n\r\n\tfunction hideAlert(index) {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"hideAlert\",\r\n\t\t\tindex\r\n\t\t});\r\n\t}\r\n\r\n\tfunction hideAllAlerts() {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"hideAllAlerts\"\r\n\t\t});\r\n\t}\r\n\r\n\tfunction clearCache() {\r\n\t\tvar cacheVal = Date.now();\r\n\t\tsetSiteInfoProp(\"cacheVal\", cacheVal);\r\n\t\twindow.localStorage.setItem(\"cacheVal\", cacheVal);\r\n\t}\r\n\r\n\tfunction fadeAlert(id) {\r\n\t\tvar alert = document.getElementById(`alert-id-${id}`);\r\n\r\n\t\tif (!alert)\r\n\t\t\treturn;\r\n\r\n\t\talert.style.opacity = 0;\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tupdateSiteInfo({\r\n\t\t\t\ttype: \"hideAlertById\",\r\n\t\t\t\tid\r\n\t\t\t});\r\n\t\t}, AlertFadeDuration);\r\n\t}\r\n\r\n\treturn {\r\n\t\t...siteInfo,\r\n\t\tupdate: setSiteInfoProp,\r\n\t\tshowAlert,\r\n\t\thideAlert,\r\n\t\thideAllAlerts,\r\n\t\tclearCache\r\n\t};\r\n}","import React, { useContext } from \"react\";\r\nimport { SiteInfoContext } from \"../Contexts\";\r\n\r\nimport \"../css/alerts.css\";\r\n\r\nexport function AlertList(props) {\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tconst alerts = siteInfo.alerts.map((alert, i) => {\r\n\t\treturn (\r\n\t\t\t<Alert\r\n\t\t\t\tid={alert.id}\r\n\t\t\t\tindex={i}\r\n\t\t\t\ttext={alert.text}\r\n\t\t\t\ttype={alert.type}\r\n\t\t\t\tonHide={siteInfo.hideAlert}\r\n\t\t\t\tkey={alert.id} />\r\n\t\t)\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"alert-list\">\r\n\t\t\t{alerts}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Alert(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tid={`alert-id-${props.id}`}\r\n\t\t\tclassName={`alert alert-${props.type}`}>\r\n\t\t\t<i\r\n\t\t\t\tclassName={`hide-alert fa-times-circle fas`}\r\n\t\t\t\tonClick={() => props.onHide(props.index)} />\r\n\t\t\t{props.text}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport function useErrorAlert(siteInfo) {\r\n\tconst siteInfoContext = useContext(SiteInfoContext);\r\n\tsiteInfo = siteInfo || siteInfoContext;\r\n\r\n\treturn (e) => {\r\n\t\tvar message;\r\n\r\n\t\tif (e && e.response)\r\n\t\t\tmessage = e.response.data;\r\n\t\telse if (e && e.message)\r\n\t\t\tmessage = e.message;\r\n\t\telse if (typeof e == \"string\")\r\n\t\t\tmessage = e;\r\n\t\telse\r\n\t\t\tmessage = \"Error loading data\";\r\n\r\n\t\tif (message.length > 200)\r\n\t\t\tmessage = \"Connection error\";\r\n\r\n\t\tsiteInfo.showAlert(message, \"error\");\r\n\t};\r\n}","import React, { useEffect } from \"react\";\r\n\r\nimport \"../css/emotes.css\";\r\n\r\nexport function Emote(props) {\r\n\tconst emoteKey = props.emote.toLowerCase();\r\n\tconst emote = Emotes[emoteKey];\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"emote\"\r\n\t\t\ttitle={emote.name}\r\n\t\t\tstyle={{ backgroundImage: `url('/images/emotes/${emote.name.toLowerCase()}.${emote.type}')` }} />\r\n\t);\r\n}\r\n\r\nexport function emotify(text) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\r\n\tfor (let i in text) {\r\n\t\tlet segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tconst words = segment.split(\" \");\r\n\r\n\t\tfor (let j in words) {\r\n\t\t\tlet word = words[j].toLowerCase();\r\n\r\n\t\t\t// Checking if Emote dictionary contains the word.\r\n\t\t\tif (Emotes[word]) {\r\n\t\t\t\twords[j] = <Emote emote={word}/>;\r\n\t\t\t} else {\r\n\t\t\t\twords[j] = words[j] + \" \";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext[i] = words;\r\n\t}\r\n\t\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport const Emotes = {\r\n    \"-_-\": {\r\n        name: \"expressionless\",\r\n        type: \"png\"\r\n    },\r\n    \"-@\": {\r\n        name: \"jack\",\r\n        type: \"png\"\r\n    },\r\n    \";_;\": {\r\n        name: \"cry\",\r\n        type: \"png\"\r\n    },\r\n    \";)\": {\r\n        name: \"wink\",\r\n        type: \"png\"\r\n    },\r\n    \":(\": {\r\n        name: \"sad\",\r\n        type: \"png\"\r\n    },\r\n    \":)\": {\r\n        name: \"happy\",\r\n        type: \"png\"\r\n    },\r\n    \":@\": {\r\n        name: \"cthulhu\",\r\n        type: \"png\"\r\n    },\r\n    \":|\": {\r\n        name: \"neutral\",\r\n        type: \"png\"\r\n    },\r\n    \":3\": {\r\n        name: \"candy\",\r\n        type: \"png\"\r\n    },\r\n    \":awoo:\": {\r\n        name: \"awoo\",\r\n        type: \"png\"\r\n    },\r\n    \":bats:\": {\r\n        name: \"bats\",\r\n        type: \"png\"\r\n    },\r\n    \":birb:\": {\r\n        name: \"birb\",\r\n        type: \"gif\"\r\n    },\r\n    \":boar:\": {\r\n        name: \"boar\",\r\n        type: \"png\"\r\n    },\r\n    \":bob:\": {\r\n        name: \"bob\",\r\n        type: \"gif\"\r\n    },\r\n    \":bub:\": {\r\n        name: \"bub\",\r\n        type: \"gif\"\r\n    },\r\n    \":bum:\": {\r\n        name: \"bum\",\r\n        type: \"gif\"\r\n    },\r\n    \":bump:\": {\r\n        name: \"bump\",\r\n        type: \"png\"\r\n    },\r\n    \":bunny:\": {\r\n        name: \"bunny\",\r\n        type: \"png\"\r\n    },\r\n    \":cake:\": {\r\n        name: \"cake\",\r\n        type: \"png\"\r\n    },\r\n    \":candycane:\": {\r\n        name: \"candycane\",\r\n        type: \"png\"\r\n    },\r\n    \":cat:\": {\r\n        name: \"cat\",\r\n        type: \"png\"\r\n    },\r\n    \":catjam:\": {\r\n        name: \"catjam\",\r\n        type: \"gif\"\r\n    },\r\n    \":cavebob:\": {\r\n        name: \"cavebob\",\r\n        type: \"png\"\r\n    },\r\n    \":chick:\": {\r\n        name: \"chick\",\r\n        type: \"png\"\r\n    },\r\n    \":christmas:\": {\r\n        name: \"christmas\",\r\n        type: \"png\"\r\n    },\r\n    \":clock:\": {\r\n        name: \"clock\",\r\n        type: \"png\"\r\n    },\r\n    \":cookie:\": {\r\n        name: \"cookie\",\r\n        type: \"png\"\r\n    },\r\n    \":couldyounot:\": {\r\n        name: \"couldyounot\",\r\n        type: \"gif\"\r\n    },\r\n    \":cupcake:\": {\r\n        name: \"cupcake\",\r\n        type: \"png\"\r\n    },\r\n    \":ditto:\": {\r\n        name: \"ditto\",\r\n        type: \"gif\"\r\n    },\r\n    \":doge:\": {\r\n        name: \"doge\",\r\n        type: \"png\"\r\n    },\r\n    \":eee:\": {\r\n        name: \"eee\",\r\n        type: \"png\"\r\n    },\r\n    \":ez:\": {\r\n        name: \"EZ\",\r\n        type: \"png\"\r\n    },\r\n    \":feelsdankman:\": {\r\n        name: \"FeelsDankMan\",\r\n        type: \"png\"\r\n    },\r\n    \":feelsokayman:\": {\r\n        name: \"FeelsOkayMan\",\r\n        type: \"png\"\r\n    },\r\n    \":fox:\": {\r\n        name: \"fox\",\r\n        type: \"png\"\r\n    },\r\n    \":fufu:\": {\r\n        name: \"fufu\",\r\n        type: \"png\"\r\n    },\r\n    \":gay:\": {\r\n        name: \"gay\",\r\n        type: \"png\"\r\n    },\r\n    \":ghost:\": {\r\n        name: \"ghost\",\r\n        type: \"png\"\r\n    },\r\n    \":hammer:\": {\r\n        name: \"hammer\",\r\n        type: \"png\"\r\n    },\r\n    \":hamster:\": {\r\n        name: \"hamster\",\r\n        type: \"gif\"\r\n    },\r\n    \":horse:\": {\r\n        name: \"horse\",\r\n        type: \"png\"\r\n    },\r\n    \":kapp:\": {\r\n        name: \"Kapp\",\r\n        type: \"png\"\r\n    },\r\n    \":kekm:\": {\r\n        name: \"kekm\",\r\n        type: \"png\"\r\n    },\r\n    \":knife:\": {\r\n        name: \"knife\",\r\n        type: \"png\"\r\n    },\r\n    \":lion:\": {\r\n        name: \"lion\",\r\n        type: \"png\"\r\n    },\r\n    \":lmao:\": {\r\n        name: \"lmao\",\r\n        type: \"png\"\r\n    },\r\n    \":mermaid:\": {\r\n        name: \"mermaid\",\r\n        type: \"png\"\r\n    },\r\n    \":monkagun:\": {\r\n        name: \"MonkaGun\",\r\n        type: \"png\"\r\n    },\r\n    \":monkahmm:\": {\r\n        name: \"MonkaHmm\",\r\n        type: \"png\"\r\n    },\r\n    \":monkas:\": {\r\n        name: \"MonkaS\",\r\n        type: \"png\"\r\n    },\r\n    \":monkfade:\": {\r\n        name: \"monkfade\",\r\n        type: \"gif\"\r\n    },\r\n    \":monkspin:\": {\r\n        name: \"monkspin\",\r\n        type: \"gif\"\r\n    },\r\n    \":nodders:\": {\r\n        name: \"Nodders\",\r\n        type: \"gif\"\r\n    },\r\n    \":nopers:\": {\r\n        name: \"Nopers\",\r\n        type: \"gif\"\r\n    },\r\n    \":o\": {\r\n        name: \"surprised\",\r\n        type: \"png\"\r\n    },\r\n    \":omegalul:\": {\r\n        name: \"Omegalul\",\r\n        type: \"png\"\r\n    },\r\n    \":omg:\": {\r\n        name: \"omg\",\r\n        type: \"png\"\r\n    },\r\n    \":p\": {\r\n        name: \"tongue\",\r\n        type: \"png\"\r\n    },\r\n    \":panda:\": {\r\n        name: \"panda\",\r\n        type: \"png\"\r\n    },\r\n    \":peepohappy:\": {\r\n        name: \"PeepoHappy\",\r\n        type: \"png\"\r\n    },\r\n    \":peeposad:\": {\r\n        name: \"PeepoSad\",\r\n        type: \"png\"\r\n    },\r\n    \":peepowtf:\": {\r\n        name: \"PeepoWtf\",\r\n        type: \"png\"\r\n    },\r\n    \":penguin:\": {\r\n        name: \"penguin\",\r\n        type: \"png\"\r\n    },\r\n    \":pepeawooga:\": {\r\n        name: \"awooga128\",\r\n        type: \"png\"\r\n    },\r\n    \":pepega:\": {\r\n        name: \"Pepega\",\r\n        type: \"png\"\r\n    },\r\n    \":pepegaaim:\": {\r\n        name: \"PepegaAim\",\r\n        type: \"gif\"\r\n    },\r\n    \":pepehands:\": {\r\n        name: \"PepeHands\",\r\n        type: \"png\"\r\n    },\r\n    \":pepelaugh:\": {\r\n        name: \"PepeLaugh\",\r\n        type: \"png\"\r\n    },\r\n    \":pepemeltdown:\": {\r\n        name: \"PepeMeltdown\",\r\n        type: \"gif\"\r\n    },\r\n    \":pepepains:\": {\r\n        name: \"PepePains\",\r\n        type: \"png\"\r\n    },\r\n    \":pepepls:\": {\r\n        name: \"PepePls\",\r\n        type: \"gif\"\r\n    },\r\n    \":pepereee:\": {\r\n        name: \"reeeee1\",\r\n        type: \"png\"\r\n    },\r\n    \":pepog:\": {\r\n        name: \"PepoG\",\r\n        type: \"png\"\r\n    },\r\n    \":pingu:\": {\r\n        name: \"pingu\",\r\n        type: \"gif\"\r\n    },\r\n    \":pizza:\": {\r\n        name: \"pizza\",\r\n        type: \"png\"\r\n    },\r\n    \":quiggle:\": {\r\n        name: \"quiggle\",\r\n        type: \"png\"\r\n    },\r\n    \":rainbow:\": {\r\n        name: \"rainbow\",\r\n        type: \"png\"\r\n    },\r\n    \":rainbowdoge:\": {\r\n        name: \"rainbowdoge\",\r\n        type: \"png\"\r\n    },\r\n    \":ratjam:\": {\r\n        name: \"ratjam\",\r\n        type: \"gif\"\r\n    },\r\n    \":rip:\": {\r\n        name: \"rip\",\r\n        type: \"png\"\r\n    },\r\n    \":roach:\": {\r\n        name: \"roach\",\r\n        type: \"gif\"\r\n    },\r\n    \":rose:\": {\r\n        name: \"rose\",\r\n        type: \"png\"\r\n    },\r\n    \":sadge:\": {\r\n        name: \"Sadge\",\r\n        type: \"png\"\r\n    },\r\n    \":sandbox:\": {\r\n        name: \"sandbox\",\r\n        type: \"png\"\r\n    },\r\n    \":santa:\": {\r\n        name: \"santa\",\r\n        type: \"png\"\r\n    },\r\n    \":sheep:\": {\r\n        name: \"sheep\",\r\n        type: \"png\"\r\n    },\r\n    \":shotgun:\": {\r\n        name: \"shotgun\",\r\n        type: \"png\"\r\n    },\r\n    \":snake:\": {\r\n        name: \"snake\",\r\n        type: \"png\"\r\n    },\r\n    \":snowman:\": {\r\n        name: \"snowman\",\r\n        type: \"png\"\r\n    },\r\n    \":star:\": {\r\n        name: \"star\",\r\n        type: \"png\"\r\n    },\r\n    \":swag:\": {\r\n        name: \"swag\",\r\n        type: \"gif\"\r\n    },\r\n    \":sy0a:\": {\r\n        name: \"sy0a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0b:\": {\r\n        name: \"sy0b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0c:\": {\r\n        name: \"sy0c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0d:\": {\r\n        name: \"sy0d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0e:\": {\r\n        name: \"sy0e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0f:\": {\r\n        name: \"sy0f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0g:\": {\r\n        name: \"sy0g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0h:\": {\r\n        name: \"sy0h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy0i:\": {\r\n        name: \"sy0i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1a:\": {\r\n        name: \"sy1a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1b:\": {\r\n        name: \"sy1b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1c:\": {\r\n        name: \"sy1c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1d:\": {\r\n        name: \"sy1d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1e:\": {\r\n        name: \"sy1e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1f:\": {\r\n        name: \"sy1f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1g:\": {\r\n        name: \"sy1g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1h:\": {\r\n        name: \"sy1h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy1i:\": {\r\n        name: \"sy1i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2a:\": {\r\n        name: \"sy2a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2b:\": {\r\n        name: \"sy2b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2c:\": {\r\n        name: \"sy2c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2d:\": {\r\n        name: \"sy2d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2e:\": {\r\n        name: \"sy2e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2f:\": {\r\n        name: \"sy2f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2g:\": {\r\n        name: \"sy2g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2h:\": {\r\n        name: \"sy2h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy2i:\": {\r\n        name: \"sy2i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3a:\": {\r\n        name: \"sy3a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3b:\": {\r\n        name: \"sy3b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3c:\": {\r\n        name: \"sy3c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3d:\": {\r\n        name: \"sy3d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3e:\": {\r\n        name: \"sy3e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3f:\": {\r\n        name: \"sy3f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3g:\": {\r\n        name: \"sy3g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3h:\": {\r\n        name: \"sy3h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy3i:\": {\r\n        name: \"sy3i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4a:\": {\r\n        name: \"sy4a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4b:\": {\r\n        name: \"sy4b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4c:\": {\r\n        name: \"sy4c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4d:\": {\r\n        name: \"sy4d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4e:\": {\r\n        name: \"sy4e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4f:\": {\r\n        name: \"sy4f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4g:\": {\r\n        name: \"sy4g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4h:\": {\r\n        name: \"sy4h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy4i:\": {\r\n        name: \"sy4i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5a:\": {\r\n        name: \"sy5a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5b:\": {\r\n        name: \"sy5b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5c:\": {\r\n        name: \"sy5c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5d:\": {\r\n        name: \"sy5d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5e:\": {\r\n        name: \"sy5e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5f:\": {\r\n        name: \"sy5f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5g:\": {\r\n        name: \"sy5g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5h:\": {\r\n        name: \"sy5h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy5i:\": {\r\n        name: \"sy5i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6a:\": {\r\n        name: \"sy6a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6b:\": {\r\n        name: \"sy6b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6c:\": {\r\n        name: \"sy6c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6d:\": {\r\n        name: \"sy6d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6e:\": {\r\n        name: \"sy6e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6f:\": {\r\n        name: \"sy6f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6g:\": {\r\n        name: \"sy6g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6h:\": {\r\n        name: \"sy6h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy6i:\": {\r\n        name: \"sy6i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7a:\": {\r\n        name: \"sy7a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7b:\": {\r\n        name: \"sy7b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7c:\": {\r\n        name: \"sy7c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7d:\": {\r\n        name: \"sy7d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7e:\": {\r\n        name: \"sy7e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7f:\": {\r\n        name: \"sy7f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7g:\": {\r\n        name: \"sy7g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7h:\": {\r\n        name: \"sy7h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy7i:\": {\r\n        name: \"sy7i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8a:\": {\r\n        name: \"sy8a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8b:\": {\r\n        name: \"sy8b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8c:\": {\r\n        name: \"sy8c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8d:\": {\r\n        name: \"sy8d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8e:\": {\r\n        name: \"sy8e\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8f:\": {\r\n        name: \"sy8f\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8g:\": {\r\n        name: \"sy8g\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8h:\": {\r\n        name: \"sy8h\",\r\n        type: \"png\"\r\n    },\r\n    \":sy8i:\": {\r\n        name: \"sy8i\",\r\n        type: \"png\"\r\n    },\r\n    \":sy9a:\": {\r\n        name: \"sy9a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy9a:\": {\r\n        name: \"sy9a\",\r\n        type: \"png\"\r\n    },\r\n    \":sy9b:\": {\r\n        name: \"sy9b\",\r\n        type: \"png\"\r\n    },\r\n    \":sy9c:\": {\r\n        name: \"sy9c\",\r\n        type: \"png\"\r\n    },\r\n    \":sy9d:\": {\r\n        name: \"sy9d\",\r\n        type: \"png\"\r\n    },\r\n    \":sy9e:\": {\r\n        name: \"sy9e\",\r\n        type: \"png\"\r\n    },\r\n    \":taco:\": {\r\n        name: \"taco\",\r\n        type: \"gif\"\r\n    },\r\n    \":thomas:\": {\r\n        name: \"thomasoface\",\r\n        type: \"png\"\r\n    },\r\n    \":thonk:\": {\r\n        name: \"thonk\",\r\n        type: \"png\"\r\n    },\r\n    \":tiger:\": {\r\n        name: \"tiger\",\r\n        type: \"png\"\r\n    },\r\n    \":tip:\": {\r\n        name: \"tip\",\r\n        type: \"gif\"\r\n    },\r\n    \":tipb:\": {\r\n        name: \"tipb\",\r\n        type: \"gif\"\r\n    },\r\n    \":tmnt:\": {\r\n        name: \"tmnt\",\r\n        type: \"gif\"\r\n    },\r\n    \":turkey:\": {\r\n        name: \"turkey\",\r\n        type: \"png\"\r\n    },\r\n    \":unicorn:\": {\r\n        name: \"unicorn\",\r\n        type: \"png\"\r\n    },\r\n    \":werewolf:\": {\r\n        name: \"werewolf\",\r\n        type: \"png\"\r\n    },\r\n    \":wink:\": {\r\n        name: \"wink\",\r\n        type: \"png\"\r\n    },\r\n    \":wolf:\": {\r\n        name: \"wolf\",\r\n        type: \"png\"\r\n    },\r\n    \":yum:\": {\r\n        name: \"yum\",\r\n        type: \"gif\"\r\n    },\r\n    \":zzz:\": {\r\n        name: \"zzz\",\r\n        type: \"png\"\r\n    },\r\n    \"<3\": {\r\n        name: \"heart\",\r\n        type: \"png\"\r\n    },\r\n    \">:(\": {\r\n        name: \"frown\",\r\n        type: \"png\"\r\n    },\r\n    \"o_o\": {\r\n        name: \"confused\",\r\n        type: \"png\"\r\n    },\r\n    \"zzz\": {\r\n        name: \"zzz\",\r\n        type: \"png\"\r\n    },\r\n};\r\n\r\nexport const EmoteKeys = Object.keys(Emotes);\r\n","import slurs from \"../json/slurs\";\r\nimport swears from \"../json/swears\";\r\n\r\n/* Creates an array of profanity RegExps. See https://regex101.com for a detailed breakdown.\r\n *\r\n * ([^A-Z]|\\s) matches any non-alphabet character or whitespace character\r\n * This is inserted between each character of the slur to prevent masking white spaces or punctuation.\r\n * \r\n * \\b matches word boundaries\r\n * [^A-Z] matches any non-alphabet characters\r\n * (${word}) matches the modified word RegExp (see above comment)\r\n * s matches the character \"s\" literally\r\n * \r\n * The -i flag makes the RegExp case insensitive.\r\n * \r\n*/\r\nfunction createProfanityRegexps(words) {\r\n    return words\r\n        .map((word) => word.split(\"\").join(String.raw`+([^A-Z]|\\s)*`).concat(\"+\"))\r\n        .map((word) => new RegExp(String.raw`\\b[^A-Z]*((${word})+s*)+[^A-Z]*\\b`, \"i\"));\r\n}\r\n\r\n// Creating profanity RegExps.\r\nconst slurRegexps = createProfanityRegexps(slurs);\r\nconst swearRegexps = createProfanityRegexps(swears);\r\n\r\n// Leet speak mappings.\r\nconst leetMappings = {\r\n    \"0\": \"o\",\r\n    \"1\": \"i\",\r\n    \"2\": \"z\",\r\n    \"3\": \"e\",\r\n    \"4\": \"a\",\r\n    \"5\": \"s\",\r\n    \"6\": \"g\",\r\n    \"7\": \"t\",\r\n    \"8\": \"b\",\r\n    \"9\": \"g\"\r\n};\r\n\r\n// Server-side slur detection.\r\nfunction textIncludesSlurs(text) {\r\n    for (const num in leetMappings) {\r\n        text = text.replace(num, leetMappings[num]);\r\n    }\r\n    for (const slurRegex of slurRegexps) {\r\n        if (slurRegex.test(text)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\n// Client-side speech filtering.\r\nfunction filterProfanitySegment(profanityType, segment, char) {\r\n    let profanityRegexps;\r\n    // Getting profanity list.\r\n    switch (profanityType) {\r\n        case \"slurs\":\r\n            profanityRegexps = slurRegexps; break;\r\n        case \"swears\":\r\n            profanityRegexps = swearRegexps; break;\r\n        default:\r\n            return segment;\r\n    }\r\n\r\n    // Substituting numbers with letters.\r\n    let mappedSegment = segment;\r\n    for (const num in leetMappings) {\r\n        mappedSegment = mappedSegment.replaceAll(num, leetMappings[num]);\r\n    }\r\n\r\n    // Filtering profanity.\r\n    for (const profanityRegex of profanityRegexps) {\r\n        let regexRes = profanityRegex.exec(mappedSegment);\r\n        while (regexRes) {\r\n            // regexRes.index returns the index of the start of the match, not the capturing group.\r\n            const index = regexRes.index + regexRes[0].indexOf(regexRes[1]);\r\n            const length = regexRes[1].length;\r\n            segment = segment.slice(0, index) + char.repeat(length) + segment.slice(index + length);\r\n            // Filtering mappedSegment, to ensure that segments match.\r\n            mappedSegment = mappedSegment.slice(0, index) + char.repeat(length) + mappedSegment.slice(index + length);\r\n            regexRes = profanityRegex.exec(mappedSegment);\r\n        }\r\n    }\r\n    return segment;\r\n}\r\n\r\nexport { filterProfanitySegment, textIncludesSlurs };\r\n","export default [\r\n    \"abo\",\r\n    \"chink\",\r\n    \"coon\",\r\n    \"dago\",\r\n    \"fag\",\r\n    \"faggot\",\r\n    \"gook\",\r\n    \"jap\",\r\n    \"kike\",\r\n    \"mong\",\r\n    \"nazi\",\r\n    \"nigga\",\r\n    \"nigger\",\r\n    \"paki\",\r\n    \"retard\",\r\n    \"spastic\",\r\n    \"spic\",\r\n    \"trannie\",\r\n    \"tranny\",\r\n    \"wetback\",\r\n    \"wog\",\r\n]\r\n","export default [\r\n    \"ass\",\r\n    \"asshole\",\r\n    \"bitch\",\r\n    \"bitches\",\r\n    \"cock\",\r\n    \"cunt\",\r\n    \"dick\",\r\n    \"fuck\",\r\n    \"fucked\",\r\n    \"fucking\",\r\n    \"pussy\",\r\n    \"shit\",\r\n    \"slut\",\r\n    \"tit\",\r\n    \"wanker\",\r\n    \"whore\",\r\n]\r\n","import React, { useEffect, useState } from \"react\";\r\n\r\nimport { emotify } from \"./Emotes\";\r\nimport { filterProfanitySegment } from \"../lib/profanity\";\r\n\r\nexport function ItemList(props) {\r\n\tconst items = props.items;\r\n\tconst itemRows = items.map(props.map);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`item-list ${props.className || \"\"}`}>\r\n\t\t\t{itemRows}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PanelGrid(props) {\r\n\tconst panels = props.panels.map((panel, i) => (\r\n\t\t<div className=\"box-panel\" key={i}>\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\t{panel.icon}\r\n\t\t\t\t<div className=\"heading-text\">\r\n\t\t\t\t\t{panel.name}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"content\">\r\n\t\t\t\t{panel.text}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\treturn (\r\n\t\t<div className=\"panel-grid\">\r\n\t\t\t{panels}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Time(props) {\r\n\tvar unit = \"millisecond\";\r\n\tvar value = props.millisec;\r\n\tvar suffix = props.suffix || \"\";\r\n\tvar minSec = props.minSec;\r\n\r\n\tconst units = [\r\n\t\t{\r\n\t\t\tname: \"second\",\r\n\t\t\tscale: 1000\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"minute\",\r\n\t\t\tscale: 60\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"hour\",\r\n\t\t\tscale: 60\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"day\",\r\n\t\t\tscale: 24\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"week\",\r\n\t\t\tscale: 7\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"year\",\r\n\t\t\tscale: 52\r\n\t\t}\r\n\t];\r\n\r\n\tlet i = 0;\r\n\twhile (i < units.length - 1 && value >= units[i].scale) {\r\n\t\tvalue /= units[i].scale;\r\n\t\tunit = units[i].name;\r\n\t\ti++;\r\n\t}\r\n\r\n\tif (minSec && unit == \"millisecond\")\r\n\t\treturn `Less than a second${suffix}`;\r\n\r\n\tvalue = Math.floor(value);\r\n\r\n\tif (value > 1)\r\n\t\tunit += \"s\";\r\n\r\n\treturn `${value} ${unit}${suffix}`;\r\n}\r\n\r\nexport function NotificationHolder(props) {\r\n\tconst notifCount = props.notifCount;\r\n\tconst onClick = props.onClick;\r\n\tconst lOffset = props.lOffset;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`notif-bound ${props.className || \"\"}`}\r\n\t\t\tonClick={onClick}\r\n\t\t\tref={props.fwdRef}>\r\n\t\t\t{notifCount > 0 &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<i className={`fas fa-circle notif-icon ${lOffset ? \"l-offset\" : \"\"}`}>\r\n\t\t\t\t\t\t<div className=\"notif-count\">\r\n\t\t\t\t\t\t\t{notifCount}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</i>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserText(props) {\r\n\tconst [content, setContent] = useState(props.text);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (props.text == null)\r\n\t\t\treturn;\r\n\r\n\t\tlet text = props.text;\r\n\r\n\t\tif (props.filterProfanity)\r\n\t\t\ttext = filterProfanity(text, props.settings, props.profChar);\r\n\r\n\t\tif (props.linkify)\r\n\t\t\ttext = linkify(text);\r\n\r\n\t\t// Any effects that inject elements need to be added after this point because the text property changes\r\n\t\t// throughout this useEffect function\r\n\t\tif (props.emotify)\r\n\t\t\ttext = emotify(text);\r\n\r\n\t\tif (props.iconUsername)\r\n\t\t\ttext = iconUsername(text, props.players);\r\n\r\n\t\tsetContent(text);\r\n\t}, [props.text]);\r\n\r\n\treturn content;\r\n}\r\n\r\nexport function linkify(text) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tconst linkRegex = /http(s{0,1}):\\/\\/([\\w.]+)\\.(\\w+)([^\\s]*)/g;\r\n\r\n\tfor (let i in text) {\r\n\t\tlet _segment = text[i];\r\n\t\tlet segment = [];\r\n\t\tlet lastIndex = 0;\r\n\t\tlet regexRes = linkRegex.exec(_segment);\r\n\r\n\t\twhile (regexRes) {\r\n\t\t\tsegment.push(_segment.slice(lastIndex, regexRes.index));\r\n\t\t\tsegment.push(<a href={regexRes[0]} target=\"blank\" key={lastIndex}>{regexRes[0]}</a>);\r\n\r\n\t\t\tlastIndex = linkRegex.lastIndex;\r\n\t\t\tregexRes = linkRegex.exec(_segment);\r\n\t\t}\r\n\r\n\t\tsegment.push(_segment.slice(lastIndex, _segment.length));\r\n\t\ttext[i] = segment;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport function filterProfanity(text, settings, char) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tsettings = settings || {};\r\n\r\n\tfor (let i in text) {\r\n\t\tlet segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tchar = char || \"*\";\r\n\r\n\t\tif (!settings.disablePg13Censor)\r\n\t\t\tsegment = filterProfanitySegment(\"swears\", segment, char);\r\n\r\n\t\tif (!settings.disableAllCensors)\r\n\t\t\tsegment = filterProfanitySegment(\"slurs\", segment, char);\r\n\r\n\t\ttext[i] = segment;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport function iconUsername(text, players) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tfor (let i in text) {\r\n\t\tconst segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tconst words = segment.trim().split(\" \");\r\n\r\n\t\tfor (let j in words) {\r\n\t\t\tconst word = words[j];\r\n\t\t\tlet replaced = false;\r\n\r\n\t\t\tif( word.length > 1 && word.charAt(0) === \"%\" ) {\r\n\t\t\t\tconst checkName = word.substring(1);\r\n\r\n\t\t\t\tconst matchedPlayer = Object.values(players).find( (curPlayer) => {\r\n\t\t\t\t\treturn curPlayer.name === checkName;\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tif( matchedPlayer && matchedPlayer.avatar ) {\r\n\t\t\t\t\treplaced = true;\r\n\r\n\t\t\t\t\twords[j] = <InlineAvatar\r\n\t\t\t\t\t\turl={`url(/uploads/${matchedPlayer.userId}_avatar.jpg)`}\r\n\t\t\t\t\t\tusername={matchedPlayer.name} />\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif( !replaced ) {\r\n\t\t\t\twords[j] = words[j] + \" \";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext[i] = words;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nfunction InlineAvatar(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"avatar small inline\"\r\n\t\t\ttitle={props.username}\r\n\t\t\tstyle={{ backgroundImage: props.url }} />\r\n\t);\r\n}\r\n\r\nexport function useOnOutsideClick(refs, action) {\r\n\tif (!Array.isArray(refs))\r\n\t\trefs = [refs];\r\n\r\n\tfunction onOutsideClick(e) {\r\n\t\tfor (let ref of refs)\r\n\t\t\tif (!ref || !ref.current || ref.current.contains(e.target))\r\n\t\t\t\treturn;\r\n\r\n\t\taction();\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.addEventListener(\"click\", onOutsideClick);\r\n\t\tdocument.addEventListener(\"contextmenu\", onOutsideClick);\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener(\"click\", onOutsideClick);\r\n\t\t};\r\n\t}, refs);\r\n}\r\n","import React, { useState, useEffect, useLayoutEffect, useRef } from \"react\";\r\n\r\nimport { useOnOutsideClick } from \"./Basic\";\r\n\r\nexport default function Dropdown(props) {\r\n\tconst [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef] = useDropdown();\r\n\tconst selOption = props.options.filter(option => option == props.value || option.id == props.value)[0];\r\n\tconst selLabel = selOption ? selOption.label || selOption : \"\";\r\n\r\n\tconst menuItems = props.options.map(option => {\r\n\t\tif (option == \"divider\")\r\n\t\t\treturn (<div className=\"dropdown-divider\" />);\r\n\r\n\t\tif (typeof option == \"string\")\r\n\t\t\toption = { id: option, label: option };\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"dropdown-menu-option\"\r\n\t\t\t\tkey={option.id}\r\n\t\t\t\tonClick={() => onMenuItemClick(option.id)}>\r\n\t\t\t\t{option.label} {option.placeholder}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\r\n\tfunction onMenuItemClick(optionId) {\r\n\t\tsetMenuVisible(false);\r\n\t\tprops.onChange(optionId);\r\n\t}\r\n\r\n\tfunction onControlClick() {\r\n\t\tsetMenuVisible(!menuVisible);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`dropdown ${props.className || \"\"}`}\r\n\t\t\tref={dropdownContainerRef}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"dropdown-control\"\r\n\t\t\t\tonClick={onControlClick}>\r\n\t\t\t\t{props.icon}\r\n\t\t\t\t{selLabel}\r\n\t\t\t\t{props.caret &&\r\n\t\t\t\t\t<i className=\"fas fa-caret-down\" />\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t{menuVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"dropdown-menu\"\r\n\t\t\t\t\tref={dropdownMenuRef}>\r\n\t\t\t\t\t{menuItems}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useDropdown() {\r\n\tconst [menuVisible, setMenuVisible] = useState(false);\r\n\tconst dropdownContainerRef = useRef();\r\n\tconst dropdownMenuRef = useRef();\r\n\r\n\tuseOnOutsideClick([dropdownMenuRef, dropdownContainerRef], () => setMenuVisible(false));\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!menuVisible)\r\n\t\t\treturn;\r\n\r\n\t\tconst containerRect = dropdownContainerRef.current.getBoundingClientRect();\r\n\t\tconst menuRect = dropdownMenuRef.current.getBoundingClientRect();\r\n\r\n\t\tvar menuLeft = containerRect.left;\r\n\t\tvar menuTop = containerRect.top + containerRect.height + 1 + window.scrollY;\r\n\t\tvar menuHorzShift = window.innerWidith - (menuLeft + menuRect.width);\r\n\r\n\t\tif (menuTop + menuRect.height - window.scrollY > window.innerHeight)\r\n\t\t\tmenuTop = containerRect.top - menuRect.height - 2;\r\n\r\n\t\tif (menuHorzShift < 0) {\r\n\t\t\tif (menuLeft + menuHorzShift < 0)\r\n\t\t\t\tmenuHorzShift -= (menuLeft + menuHorzShift);\r\n\t\t}\r\n\t\telse \r\n\t\t\tmenuHorzShift = 0;\r\n\r\n\t\tdropdownMenuRef.current.style.left = menuLeft + \"px\";\r\n\t\tdropdownMenuRef.current.style.top = menuTop + \"px\";\r\n\t\tdropdownMenuRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\treturn [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef];\r\n}","import axios from \"axios\";\r\nimport colorContrast from \"color-contrast\";\r\n\r\nexport function hyphenDelimit(roleName) {\r\n\troleName = roleName.slice();\r\n\r\n\tfor (let i = 0; i < roleName.length; i++) {\r\n\t\tif (roleName[i] == \" \")\r\n\t\t\troleName = roleName.replace(\" \", \"-\");\r\n\t}\r\n\r\n\treturn roleName;\r\n}\r\n\r\nexport function capitalize(string) {\r\n\treturn string.charAt(0).toUpperCase() + string.substring(1);\r\n}\r\n\r\n  export function hexToHSL(H) {\r\n\t//CHECK IF UNDEFINED!!!!\r\n\t//May break certain pages if this is not done.\r\n\tif(H == undefined){\r\n\t\tH = '#000000';\r\n\t}\r\n\r\n\t// Convert hex to RGB first\r\n\tlet r = 0, g = 0, b = 0;\r\n\tif (H.length == 4) {\r\n\t  r = \"0x\" + H[1] + H[1];\r\n\t  g = \"0x\" + H[2] + H[2];\r\n\t  b = \"0x\" + H[3] + H[3];\r\n\t} else if (H.length == 7) {\r\n\t  r = \"0x\" + H[1] + H[2];\r\n\t  g = \"0x\" + H[3] + H[4];\r\n\t  b = \"0x\" + H[5] + H[6];\r\n\t}\r\n\t// Then to HSL\r\n\tr /= 255;\r\n\tg /= 255;\r\n\tb /= 255;\r\n\tlet cmin = Math.min(r,g,b),\r\n\t\tcmax = Math.max(r,g,b),\r\n\t\tdelta = cmax - cmin,\r\n\t\th = 0,\r\n\t\ts = 0,\r\n\t\tl = 0;\r\n  \r\n\tif (delta == 0)\r\n\t  h = 0;\r\n\telse if (cmax == r)\r\n\t  h = ((g - b) / delta) % 6;\r\n\telse if (cmax == g)\r\n\t  h = (b - r) / delta + 2;\r\n\telse\r\n\t  h = (r - g) / delta + 4;\r\n  \r\n\th = Math.round(h * 60);\r\n  \r\n\tif (h < 0)\r\n\t  h += 360;\r\n  \r\n\tl = (cmax + cmin) / 2;\r\n\ts = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\r\n\ts = +(s * 100).toFixed(1);\r\n\tl = +(l * 100).toFixed(1);\r\n  \r\n\treturn h + \",\" + s + \",\" + l;\r\n  }\r\n\r\n  export function HSLToHex(h,s,l) {\r\n\ts /= 100;\r\n\tl /= 100;\r\n  \r\n\tlet c = (1 - Math.abs(2 * l - 1)) * s,\r\n\t\tx = c * (1 - Math.abs((h / 60) % 2 - 1)),\r\n\t\tm = l - c/2,\r\n\t\tr = 0,\r\n\t\tg = 0, \r\n\t\tb = 0; \r\n  \r\n\tif (0 <= h && h < 60) {\r\n\t  r = c; g = x; b = 0;\r\n\t} else if (60 <= h && h < 120) {\r\n\t  r = x; g = c; b = 0;\r\n\t} else if (120 <= h && h < 180) {\r\n\t  r = 0; g = c; b = x;\r\n\t} else if (180 <= h && h < 240) {\r\n\t  r = 0; g = x; b = c;\r\n\t} else if (240 <= h && h < 300) {\r\n\t  r = x; g = 0; b = c;\r\n\t} else if (300 <= h && h < 360) {\r\n\t  r = c; g = 0; b = x;\r\n\t}\r\n\t// Having obtained RGB, convert channels to hex\r\n\tr = Math.round((r + m) * 255).toString(16);\r\n\tg = Math.round((g + m) * 255).toString(16);\r\n\tb = Math.round((b + m) * 255).toString(16);\r\n  \r\n\t// Prepend 0s, if necessary\r\n\tif (r.length == 1)\r\n\t  r = \"0\" + r;\r\n\tif (g.length == 1)\r\n\t  g = \"0\" + g;\r\n\tif (b.length == 1)\r\n\t  b = \"0\" + b;\r\n  \r\n\treturn \"#\" + r + g + b;\r\n  }\r\n\r\n  export function adjustColor(hexColor) {\r\n\tlet contrastVal = 0;\r\n\tlet colorScheme = \"light\"\r\n\tlet colorAutoScheme = false;\r\n\tif (document.documentElement.classList.length === 0) {\r\n\t\tcolorAutoScheme = true;\r\n\t}\r\n\telse {\r\n\t\tif (!document.documentElement.classList.contains(\"light-mode\")) {\r\n\t\t\tif (!document.documentElement.classList.contains(\"dark-mode\")) {\r\n\t\t\t\tcolorAutoScheme = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcolorScheme = \"dark\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (colorAutoScheme) {\r\n\t\tif (window.matchMedia(\"(prefers-color-scheme: dark)\").matches) {\r\n\t\t\tcolorScheme = \"dark\";\r\n\t\t}\r\n\t}\r\n\r\n\tif (colorScheme === \"light\") {\r\n\t\tcontrastVal = colorContrast(hexColor, \"#ffffff\");\r\n\t\tif (contrastVal < 1.5) {\r\n\t\t\treturn \"darkest\";\r\n\t\t} \r\n\t\telse if(contrastVal <= 2.5) {\r\n\t\t\treturn \"darker\";\r\n\t\t}\r\n\t\telse if (contrastVal <= 4.5) {\r\n\t\t\treturn \"dark\";\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tcontrastVal = colorContrast(hexColor, \"#181a1b\");\r\n\t\tif (contrastVal < 1.5) {\r\n\t\t\treturn \"brightest\";\r\n\t\t}\r\n\t\telse if (contrastVal <= 2.5) {\r\n\t\t\treturn \"brighter\"\r\n\t\t}\r\n\t\telse if (contrastVal <= 4.5) {\r\n\t\t\treturn \"bright\";\r\n\t\t}\r\n\t}\r\n\treturn \"\";\r\n  }\r\n\r\n\r\n  export function flipTextColor(hexColor) {\r\n\tlet contrastVal = 0;\r\n\tlet hslColor = hexToHSL(hexColor);\r\n\tlet hslVals = hslColor.split(',');\r\n\tlet h = hslVals[0], s = hslVals[1], l = hslVals[2];\r\n\r\n\tlet colorScheme = \"light\";\r\n\tlet colorAutoScheme = false;\r\n\tif (document.documentElement.classList.length === 0) {\r\n\t\tcolorAutoScheme = true;\r\n\t}\r\n\telse {\r\n\t\tif (!document.documentElement.classList.contains(\"light-mode\")) {\r\n\t\t\tif (!document.documentElement.classList.contains(\"dark-mode\")) {\r\n\t\t\t\tcolorAutoScheme = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcolorScheme = \"dark\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (colorAutoScheme) {\r\n\t\tif (window.matchMedia(\"(prefers-color-scheme: dark)\").matches) {\r\n\t\t\tcolorScheme = \"dark\";\r\n\t\t}\r\n\t}\r\n\r\n\tif (l > 70 && colorScheme === \"light\") {\r\n\t\tvar difference = l - 70;\r\n\t\thslColor = hslColor.replace(/[0-9.]+(?!.*[0-9])/, String(parseInt(hslColor.match(/[0-9.]+(?!.*[0-9])/) - difference, 10)));\r\n\t}\r\n\telse {\r\n\t\tif(l < 30 && colorScheme === \"dark\") {\r\n\t\t\tvar difference = 30 - l;\r\n\t\t\thslColor = hslColor.replace(/[0-9.]+(?!.*[0-9])/, String(difference + parseInt(hslColor.match(/[0-9.]+(?!.*[0-9])/), 10)));\r\n\t\t}\r\n\t}\r\n\t\r\n\thslVals = hslColor.split(',');\r\n\th = hslVals[0];\r\n\ts = hslVals[1];\r\n\tl = hslVals[2];\r\n\treturn HSLToHex(h, s, l);\r\n  }\r\n\r\nexport function camelCase(string) {\r\n\tlet subStrings = string.toLowerCase().split(\" \");\r\n\tlet result = \"\";\r\n\r\n\tfor (let i = 0; i < subStrings.length; i++) {\r\n\t\tif (i == 0)\r\n\t\t\tresult += subStrings[i];\r\n\t\telse\r\n\t\t\tresult += subStrings[i].charAt(0).toUpperCase() + subStrings[i].substring(1);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function pascalCase(string) {\r\n\tvar parts = string.split(\" \");\r\n\tvar res = \"\";\r\n\r\n\tfor (let i = 0; i < parts.length; i++) {\r\n\t\tlet part = parts[i];\r\n\t\tres += (part[0].toUpperCase() + part.slice(1, part.length));\r\n\t}\r\n\r\n\treturn res;\r\n}\r\n\r\nexport function replaceAll(string, from, to) {\r\n\twhile (string.indexOf(from) != -1)\r\n\t\tstring = string.replace(from, to);\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function pad(value, amt, char) {\r\n\twhile (value.length < amt)\r\n\t\tvalue = char + value;\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function dateToHTMLString(date) {\r\n\tif (!date)\r\n\t\treturn \"\";\r\n\telse if (typeof date == \"string\")\r\n\t\treturn date;\r\n\r\n\tdate = (new Date(date));\r\n\r\n\tvar day = date.toLocaleDateString();\r\n\tvar time = date.toTimeString();\r\n\r\n\tday = day.split(\"/\");\r\n\tday = pad(day[2], 2, \"0\") + \"-\" + pad(day[0], 2, \"0\") + \"-\" + pad(day[1], 2, \"0\");\r\n\r\n\ttime = time.split(\":\");\r\n\ttime = time[0] + \":\" + time[1];\r\n\r\n\tdate = day + \"T\" + time;\r\n\treturn date;\r\n}\r\n\r\nexport async function verifyRecaptcha(action) {\r\n\treturn new Promise((res, rej) => {\r\n\t\twindow.grecaptcha.ready(async () => {\r\n\t\t\ttry {\r\n\t\t\t\tconst token = await window.grecaptcha.execute(process.env.REACT_APP_RECAPTCHA_KEY, { action });\r\n\t\t\t\tawait axios.post(\"/auth/verifyCaptcha\", { token });\r\n\t\t\t\tres(token);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\trej(e);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function setCaptchaVisible(visible) {\r\n\tvar el = document.getElementsByClassName(\"grecaptcha-badge\")[0];\r\n\r\n\tif (el)\r\n\t\tel.style.visibility = visible ? \"visible\" : \"hidden\";\r\n}","import React, { useState, useEffect, useReducer } from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nimport Dropdown from \"./Dropdown\";\r\nimport { camelCase } from \"../utils\";\r\n\r\nimport \"../css/nav.css\"\r\n\r\nexport function Nav(props) {\r\n\treturn (\r\n\t\t<div className=\"nav\">\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SubNav(props) {\r\n\tconst links = props.links.map((link, i) => {\r\n\t\treturn (!link.hide &&\r\n\t\t\t<NavLink\r\n\t\t\t\texact={link.exact}\r\n\t\t\t\tto={link.path}\r\n\t\t\t\tkey={link.path}>\r\n\t\t\t\t{link.text}\r\n\t\t\t</NavLink>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"sub-nav\">\r\n\t\t\t{links}\r\n\t\t\t{props.showFilter &&\r\n\t\t\t\t<div className=\"filter\">\r\n\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\tvalue={props.filterSel}\r\n\t\t\t\t\t\toptions={props.filterOptions}\r\n\t\t\t\t\t\tonChange={props.onFilter}\r\n\t\t\t\t\t\ticon={props.filterIcon}\r\n\t\t\t\t\t\tcaret />\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ButtonGroup(props) {\r\n\tconst sel = camelCase(props.sel);\r\n\tconst buttons = props.buttons.map((button, i) => {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`btn ${sel == camelCase(button) ? \"btn-sel\" : \"\"}`}\r\n\t\t\t\tonClick={() => props.onClick(button)}\r\n\t\t\t\tkey={i}>\r\n\t\t\t\t{button}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"btn-group\">\r\n\t\t\t{buttons}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PageNav(props) {\r\n\tconst page = props.page;\r\n\tconst maxPage = props.maxPage;\r\n\tconst range = props.range || 5;\r\n\tconst onNav = props.onNav;\r\n\tconst inverted = props.inverted;\r\n\tconst noRange = maxPage == null;\r\n\r\n\tconst [pages, updatePages] = useReducer(\r\n\t\t() => {\r\n\t\t\tif (noRange)\r\n\t\t\t\treturn [page];\r\n\r\n\t\t\tvar sel = page <= maxPage ? page : 1;\r\n\t\t\tvar i = sel;\r\n\t\t\tvar j = sel + 1;\r\n\t\t\tvar list = [];\r\n\t\t\tvar changed = true;\r\n\r\n\t\t\twhile (changed) {\r\n\t\t\t\tchanged = false;\r\n\r\n\t\t\t\tif (list.length < range && i >= 1) {\r\n\t\t\t\t\tlist.unshift(i--);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (list.length < range && j <= maxPage) {\r\n\t\t\t\t\tlist.push(j++);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\tmaxPage,\r\n\t\t(pages) => {\r\n\t\t\tif (noRange)\r\n\t\t\t\treturn [1];\r\n\r\n\t\t\tvar list = [];\r\n\r\n\t\t\tfor (let i = 0; i < pages; i++)\r\n\t\t\t\tlist.push(i + 1);\r\n\r\n\t\t\treturn list;\r\n\t\t}\r\n\t);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdatePages();\r\n\t}, [page, range, maxPage]);\r\n\r\n\tfunction onClick(page) {\r\n\t\tif (page >= 1 && (noRange || page <= maxPage))\r\n\t\t\tonNav(page);\r\n\t}\r\n\r\n\tconst pageNums = pages.map(page => {\r\n\t\tvar className = \"page-num\";\r\n\r\n\t\tif (props.page == page)\r\n\t\t\tclassName += \" page-sel\";\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={className}\r\n\t\t\t\tonClick={() => onClick(page)}\r\n\t\t\t\tkey={page}>\r\n\t\t\t\t{page}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className={`page-nav ${inverted ? \"inverted\" : \"\"}`}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"page-nav-left max\"\r\n\t\t\t\tonClick={() => onClick(1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"page-nav-left\"\r\n\t\t\t\tonClick={() => onClick(page - 1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t{pageNums}\r\n\t\t\t<div\r\n\t\t\t\tclassName={`page-nav-right ${noRange ? \"max\" : \"\"}`}\r\n\t\t\t\tonClick={() => onClick(page + 1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t{!noRange &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"page-nav-right max\"\r\n\t\t\t\t\tonClick={() => onClick(maxPage)}>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function getPageNavFilterArg(newPage, oldPage, pageItems, sortField) {\r\n\tvar filterArg;\r\n\r\n\tif (newPage == 1)\r\n\t\tfilterArg = \"last=Infinity\";\r\n\telse if (newPage < oldPage && pageItems.length != 0)\r\n\t\tfilterArg = `first=${pageItems[0][sortField]}`;\r\n\telse if (newPage > oldPage && pageItems.length != 0)\r\n\t\tfilterArg = `last=${pageItems[pageItems.length - 1][sortField]}`;\r\n\telse\r\n\t\treturn;\r\n\r\n\treturn filterArg;\r\n}\r\n\r\nexport function SearchBar(props) {\r\n\tfunction onInput(event) {\r\n\t\tprops.onInput(event.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"search-bar\">\r\n\t\t\t<input\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\tvalue={props.value}\r\n\t\t\t\tplaceholder={props.placeholder}\r\n\t\t\t\tonChange={onInput} />\r\n\t\t\t<div className=\"search-icon\">\r\n\t\t\t\t<i className=\"fas fa-search\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport ReactLoading from \"react-loading\";\r\n\r\nexport default function LoadingPage(props) {\r\n\treturn (\r\n\t\t<div className={`loading-page ${props.className || \"\"}`}>\r\n\t\t\t<ReactLoading type=\"bars\" color=\"#ffffff\" />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function LoadingIcon() {\r\n\treturn (\r\n\t\t<div className=\"loading-page\">\r\n\t\t\t<ReactLoading type=\"bars\" color=\"#ffffff\" width=\"50\" height=\"50\" />\r\n\t\t</div>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, LastWillEntry, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function MafiaGame() {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Mafia\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Day\", \"Night\", \"Sunset\"];\r\n\tconst audioFileNames = [/*\"Day\", \"Night\", \"Sunset\", \"nonvillagewin\", \"villagewin\", */\"gunshot\"];\r\n\tconst audioLoops = [/*true, true, true, false, false, */false];\r\n\tconst audioOverrides = [/*true, true, true, false, false, */false];\r\n\tconst audioVolumes = [/*1, 1, 1, 1, 1, */1];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Village\") != -1)\r\n\t\t\t// \tgame.playAudio(\"villagewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"nonvillagewin\");\r\n\t\t});\r\n\r\n\t\tsocket.on(\"gunshot\", () => {\r\n\t\t\tgame.playAudio(\"gunshot\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tnoLeaveRef={game.noLeaveRef}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>M</span>afia\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\treview={game.review}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tsetTyping={game.setTyping}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!game.review && !isSpectator && history.currentState >= 0 && game.setup.lastWill &&\r\n\t\t\t\t\t\t\t<LastWillEntry\r\n\t\t\t\t\t\t\t\tlastWill={game.lastWill}\r\n\t\t\t\t\t\t\t\tsocket={game.socket} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{!game.review && !isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function SplitDecisionGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Split Decision\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Round\", \"Hostage Swap\"];\r\n\tconst audioFileNames = [];\r\n\tconst audioLoops = [];\r\n\tconst audioOverrides = [];\r\n\tconst audioVolumes = [];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Blue\") != -1)\r\n\t\t\t// \tgame.playAudio(\"bluewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"redwin\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>Split</span> Decision\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext, useState } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nimport { SideMenu } from \"./Game\";\r\nimport \"../../css/game.css\";\r\n\r\nexport default function ResistanceGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Resistance\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Team Selection\", \"Team Approval\", \"Mission\", \"Epilogue\"];\r\n\tconst audioFileNames = [];\r\n\tconst audioLoops = [];\r\n\tconst audioOverrides = [];\r\n\tconst audioVolumes = [];\r\n\t\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Resistance\") != -1)\r\n\t\t\t// \tgame.playAudio(\"resistancewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"spieswin\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>R</span>esistance\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ScoreKeeper\r\n\t\t\t\t\t\t\tnumMissions={game.setup.numMissions}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nfunction ScoreKeeper(props) {\r\n\tconst numMissions = props.numMissions;\r\n\tconst history = props.history;\r\n\r\n\tconst stateViewing = props.stateViewing;\r\n\r\n\tif (stateViewing < 0)\r\n\t\treturn <></>;\r\n\r\n\tconst missionRecord = history.states[stateViewing].extraInfo;\r\n\t\r\n\treturn (\r\n\t\t<SideMenu\r\n\t\t\ttitle=\"Game Info\"\r\n\t\t\tscrollable\r\n\t\t\tcontent={ \r\n\t\t\t\t<>\r\n\t\t\t\t\t<MissionInfo numMissions={numMissions} />\r\n\t\t\t\t\t<Score score={missionRecord?.score} />\r\n\t\t\t\t\t<MissionHistory missionHistory={missionRecord?.missionHistory} />\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nfunction MissionInfo(props) {\r\n\treturn (\r\n\t\t<div className=\"rst\">\r\n\t\t\t<div className=\"rst-name\">\r\n\t\t\t\tTotal Missions\r\n\t\t\t</div>\r\n\t\t\t{props.numMissions} \r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction Score(props) {\r\n\tvar score = props.score || { \"rebels\" : 0, \"spies\": 0 }\r\n\r\n\treturn (\r\n\t\t<div className=\"rst-score\">\r\n\t\t\t<ScoreBox team=\"rebels\" scoreValue={ score[\"rebels\"] || 0 }/>\r\n\t\t\t<ScoreBox team=\"spies\" scoreValue={ score[\"spies\"] || 0 }/>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ScoreBox(props) {\r\n\tfunction capitaliseFirstLetter(string) {\r\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\r\n\t}\r\n\t\r\n\treturn (\r\n\t\t<div className=\"rst-score-box\">\r\n\t\t\t<div className=\"rst-score-box-name\">{capitaliseFirstLetter(props.team)}</div>\r\n\t\t\t<div className={`rst-score-box-value rst-score-box-${props.team || \"\"}`}>{props.scoreValue}</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction MissionHistory(props) {\r\n\tconst missionHistory = props.missionHistory || [];\r\n\r\n\tconst missionHistoryView = missionHistory.map((history, i) => {\r\n\t\tconst success = history.numFails === 0 ? \"success\" : \"fail\"\r\n\r\n\t\tlet teamMembers = history.team.join(\" \");\r\n\r\n\t\tif (history.numFails === -1) {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"rst-mh-row\">\r\n\t\t\t\t<div className={`rst-mh-status rst-mh-${success}`}>\r\n\t\t\t\t\tX\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<div className=\"rst-mh-team\">\r\n\t\t\t\t\trejected\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"rst-mh-row\">\r\n\t\t\t\t<div className={`rst-mh-status rst-mh-${success}`}>\r\n\t\t\t\t\t{history.numFails}\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<div className=\"rst-mh-team\">\r\n\t\t\t\t\t{teamMembers}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t)\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"rst\">\r\n\t\t\t<div className=\"rst-name\">\r\n\t\t\t\tMission History\r\n\t\t\t</div>\r\n\t\t\t<div className=\"rst-mh-all-rows\">\r\n\t\t\t\t{missionHistoryView}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\t\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, LastWillEntry, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function OneNightGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"One Night\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Day\", \"Night\"];\r\n\tconst audioFileNames = [/*\"Day\", \"Night\", \"nonvillagewin\", \"villagewin\", */\"gunshot\"];\r\n\tconst audioLoops = [/*true, true, true, false, false, */false];\r\n\tconst audioOverrides = [/*true, true, true, false, false, */false];\r\n\tconst audioVolumes = [/*1, 1, 1, 1, 1, */1];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Village\") != -1)\r\n\t\t\t// \tgame.playAudio(\"villagewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"nonvillagewin\");\r\n\t\t});\r\n\r\n\t\tsocket.on(\"gunshot\", () => {\r\n\t\t\tgame.playAudio(\"gunshot\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>One</span> Night\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport \"../css/landing.css\"\r\n\r\nexport default function LandingPage(props) {\r\n\treturn (\r\n\t\t<div className=\"span-panel main landing-page\">\r\n\t\t\t<div className=\"banner\">\r\n\t\t\t\t<div className=\"logo\" />\r\n\t\t\t\t<div className=\"characters-circle\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"play-break\">\r\n\t\t\t\t<div className=\"play-btn-wrapper\">\r\n\t\t\t\t\t<Link to=\"/auth/signup\">\r\n\t\t\t\t\t\tPlay Mafia\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"intro\">\r\n\t\t\t\tBeyondMafia is the mafia site that is revolutionary in design, safety, and has a thriving community of users from all walks of life. With competitive and casual live mafia, and other gamemodes like Resistance, you're sure to find something that suits how YOU want to play.\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mafia-features\">\r\n\t\t\t\t<div className=\"chat-mafia\">\r\n\t\t\t\t\t<div className=\"village-character\" />\r\n\t\t\t\t\t<div className=\"feature-title\">Chat Mafia</div>\r\n\t\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\t\t10-20 minute games with a variety of roles! Play with classic roles, or try out something different in the Sandbox lobby. You can create your own custom roles, too, using modifiers or by contributing to the open source codebase!\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-mafia\">\r\n\t\t\t\t\t<div className=\"cop-character\" />\r\n\t\t\t\t\t<div className=\"feature-title\">Forum Mafia</div>\r\n\t\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\t\tPlay Mafia in the forums. More features are coming soon with the planned forum game engine!\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"other-games\">\r\n\t\t\t\t<div className=\"other-games-img\" />\r\n\t\t\t\t<div className=\"feature-title\">Other Games</div>\r\n\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\tExplore other Mafia-esque games like Resistance, One Night Ultimate Werewolf, and 2 Rooms and a Boom.\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"play-break\">\r\n\t\t\t\t<div className=\"play-btn-wrapper\">\r\n\t\t\t\t\t<Link to=\"/auth/signup\">\r\n\t\t\t\t\t\tPlay Mafia\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useReducer, useRef, useEffect } from \"react\";\r\nimport { ChromePicker } from \"react-color\";\r\nimport  DatePicker  from \"react-date-picker\";\r\nimport ReactMde from \"react-mde\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport axios from \"axios\";\r\n\r\nimport { useOnOutsideClick } from \"./Basic\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\n\r\nimport \"react-mde/lib/styles/css/react-mde.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-editor.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-toolbar.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-suggestions.css\";\r\n\r\nimport \"../css/form.css\";\r\nimport \"../css/markdown.css\";\r\nimport { dateToHTMLString } from \"../utils\";\r\n\r\nexport default function Form(props) {\r\n\tfunction onChange(event, field, localOnly) {\r\n\t\tvar value = event.target.value;\r\n\r\n\t\tif (field.min != null && Number(value) < field.min)\r\n\t\t\tvalue = field.min;\r\n\t\telse if (field.max != null && Number(value) > field.max)\r\n\t\t\tvalue = field.max;\r\n\r\n\t\tprops.onChange({\r\n\t\t\tref: field.ref,\r\n\t\t\tprop: \"value\",\r\n\t\t\tvalue: value,\r\n\t\t\tlocalOnly\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onDChange(date, field, localOnly) {\r\n\t\tvar value = new Date(date);\r\n\r\n\t\tprops.onChange({\r\n\t\t\tref: field.ref,\r\n\t\t\tprop: \"value\",\r\n\t\t\tvalue: value,\r\n\t\t\tlocalOnly\r\n\t\t});\r\n\t}\r\n\r\n\tconst formFields = props.fields.map((field, i) => {\r\n\t\tconst disabled = typeof field.disabled == \"function\" ? field.disabled(props.deps) : field.disabled;\r\n\t\tconst fieldWrapperClass = `field-wrapper ${disabled ? \"disabled\" : \"\"}`;\r\n\t\tvar showIf;\r\n\r\n\t\tif (typeof field.showIf == \"string\")\r\n\t\t\tshowIf = [field.showIf];\r\n\t\telse\r\n\t\t\tshowIf = field.showIf;\r\n\r\n\t\tif (Array.isArray(showIf)) {\r\n\t\t\tfor (let ref of showIf) {\r\n\t\t\t\tlet inverted = ref[0] == \"!\";\r\n\r\n\t\t\t\tif (inverted)\r\n\t\t\t\t\tref = ref.slice(1);\r\n\r\n\t\t\t\tfor (let field of props.fields) {\r\n\t\t\t\t\tif (field.ref == ref && field.type == \"boolean\") {\r\n\t\t\t\t\t\tlet value = field.value == true;\r\n\r\n\t\t\t\t\t\tif ((value ^ inverted) == 0)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (typeof showIf == \"function\")\r\n\t\t\tif (!showIf(props.deps))\r\n\t\t\t\treturn;\r\n\r\n\t\tconst value = typeof field.value == \"function\" ? field.value(props.deps) : field.value;\r\n\r\n\t\tswitch (field.type) {\r\n\t\t\tcase \"text\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype={field.type}\r\n\t\t\t\t\t\t\tvalue={value || \"\"}\r\n\t\t\t\t\t\t\tplaceholder={field.placeholder}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={(e) => !field.fixed && onChange(e, field, field.saveBtn)}\r\n\t\t\t\t\t\t\tonClick={(e) => field.highlight && e.target.select()} />\r\n\t\t\t\t\t\t{field.saveBtn && props.deps[field.saveBtnDiffer] != field.value &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\tlet conf = !field.confirm || window.confirm(field.confirm);\r\n\r\n\t\t\t\t\t\t\t\t\tif (conf) {\r\n\t\t\t\t\t\t\t\t\t\tif (field.saveBtnOnClick)\r\n\t\t\t\t\t\t\t\t\t\t\tfield.saveBtnOnClick(field.value, props.deps);\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tonChange(e, field);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t{field.saveBtn}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"number\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\tvalue={field.value || \"0\"}\r\n\t\t\t\t\t\t\tmin={field.min}\r\n\t\t\t\t\t\t\tmax={field.max}\r\n\t\t\t\t\t\t\tstep={field.step}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={(e) => onChange(e, field)} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"boolean\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"switch-wrapper\">\r\n\t\t\t\t\t\t\t<Switch\r\n\t\t\t\t\t\t\t\tvalue={field.value || false}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"select\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tvalue={field.value || field.options[0].ref}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={e => onChange(e, field)}>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfield.options.map(option => (\r\n\t\t\t\t\t\t\t\t\t<option value={option.value} key={option.value}>\r\n\t\t\t\t\t\t\t\t\t\t{option.label}\r\n\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"range\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"range-wrapper\">\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\t\t\tmin={field.min}\r\n\t\t\t\t\t\t\t\tmax={field.max}\r\n\t\t\t\t\t\t\t\tstep={field.step}\r\n\t\t\t\t\t\t\t\tvalue={field.value}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"color\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<ColorPicker\r\n\t\t\t\t\t\t\tvalue={field.value}\r\n\t\t\t\t\t\t\tdefault={field.default}\r\n\t\t\t\t\t\t\talpha={field.alpha}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t{!field.noReset && field.value != field.default && field.value &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={() => onChange({ target: { value: field.default } }, field)}>\r\n\t\t\t\t\t\t\t\tReset\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"date\":\r\n\t\t\t\tif (field.value === \"undefined\") {\r\n\t\t\t\t\tfield.value = undefined\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet selectedValue = props.deps.user[field.ref];\r\n\t\t\t\tif (selectedValue === \"undefined\") {\r\n\t\t\t\t\tselectedValue = undefined\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<DatePicker\r\n\t\t\t\t\t\t\tformat='MMMM dd'\r\n\t\t\t\t\t\t\tcalendarAriaLabel=\"Toggle calendar\"\r\n\t\t\t\t\t\t\tclearAriaLabel=\"Clear value\"\r\n\t\t\t\t\t\t\tdayAriaLabel=\"Day\"\r\n\t\t\t\t\t\t\tmonthAriaLabel=\"Month\"\r\n\t\t\t\t\t\t\tnativeInputAriaLabel=\"Date\"\r\n\t\t\t\t\t\t\tonChange={e => onDChange(e, field, true)}\r\n\t\t\t\t\t\t\tvalue={field.value || selectedValue || new Date()}\r\n\t\t\t\t\t\t\tmaxDetail=\"month\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{field.saveBtn && !props.deps.user[field.saveBtnDiffer] &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\tlet conf = !field.confirm || window.confirm(field.confirm);\r\n\r\n\t\t\t\t\t\t\t\t\tif (conf) {\r\n\t\t\t\t\t\t\t\t\t\tif (field.saveBtnOnClick)\r\n\t\t\t\t\t\t\t\t\t\t\tfield.saveBtnOnClick(field.value || field.default, props.deps);\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tonDChange(e, field, true);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t{field.saveBtn}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"datetime-local\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"datetime-wrapper\">\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\r\n\t\t\t\t\t\t\t\tmin={dateToHTMLString(field.min)}\r\n\t\t\t\t\t\t\t\tmax={dateToHTMLString(field.max)}\r\n\t\t\t\t\t\t\t\tvalue={dateToHTMLString(field.value)}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"form\">\r\n\t\t\t{formFields}\r\n\t\t\t{props.submitText &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\tonClick={props.onSubmit}>\r\n\t\t\t\t\t{props.submitText}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Switch(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`switch ${props.value ? \"on\" : \"\"}`}\r\n\t\t\tonClick={() => !props.disabled && props.onChange({ target: { value: !props.value } })}>\r\n\t\t\t<div className=\"track\" />\r\n\t\t\t<div className=\"thumb\" />\r\n\t\t\t<input\r\n\t\t\t\ttype=\"hidden\"\r\n\t\t\t\tvalue={props.value} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ColorPicker(props) {\r\n\tconst [picking, setPicking] = useState(false);\r\n\tconst pickerRef = useRef();\r\n\tconst value = props.value || props.default;\r\n\tconst disabled = props.disabled;\r\n\r\n\tfunction onClick(e) {\r\n\t\tif (!disabled && e.target == pickerRef.current)\r\n\t\t\tsetPicking(!picking);\r\n\t}\r\n\r\n\tfunction onChangeComplete(color, event) {\r\n\t\tprops.onChange({ target: { value: color.hex } });\r\n\t}\r\n\r\n\tuseOnOutsideClick(pickerRef, () => setPicking(false));\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`color-picker ${disabled ? \"disabled\" : \"\"}`}\r\n\t\t\tstyle={{ backgroundColor: value }}\r\n\t\t\tonClick={onClick}\r\n\t\t\tref={pickerRef}>\r\n\t\t\t{picking &&\r\n\t\t\t\t<ChromePicker\r\n\t\t\t\t\tcolor={value}\r\n\t\t\t\t\tdisableAlpha={!props.alpha}\r\n\t\t\t\t\tonChangeComplete={onChangeComplete} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function HiddenUpload(props) {\r\n\tconst inputRef = useRef();\r\n\r\n\tfunction onClick() {\r\n\t\tvar shouldInput = true;\r\n\r\n\t\tif (props.onClick)\r\n\t\t\tshouldInput = props.onClick();\r\n\r\n\t\tif (shouldInput)\r\n\t\t\tshowFileUploadDialog();\r\n\t}\r\n\r\n\tfunction showFileUploadDialog() {\r\n\t\tinputRef.current.click();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={props.className}\r\n\t\t\tonClick={onClick}>\r\n\t\t\t{props.children}\r\n\t\t\t<input\r\n\t\t\t\tclassName=\"hidden-upload\"\r\n\t\t\t\tref={inputRef}\r\n\t\t\t\ttype=\"file\"\r\n\t\t\t\tonChange={e => props.onFileUpload(e.target.files, props.name)} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useForm(initialFormFields) {\r\n\tconst [initFields] = useState(initialFormFields);\r\n\tconst [fields, updateFields] = useReducer((formFields, actions) => {\r\n\t\tconst newFormFields = [...formFields];\r\n\r\n\t\tif (!Array.isArray(actions))\r\n\t\t\tactions = [actions];\r\n\r\n\t\tfor (let i in newFormFields) {\r\n\t\t\tlet field = newFormFields[i];\r\n\t\t\tlet newField = { ...field };\r\n\r\n\t\t\tfor (let action of actions) {\r\n\t\t\t\tif (field.ref && field.ref == action.ref) {\r\n\t\t\t\t\tif (typeof action.value == \"string\" && field.type == \"boolean\")\r\n\t\t\t\t\t\taction.value = action.value == \"true\";\r\n\r\n\t\t\t\t\tnewField[action.prop] = action.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tnewFormFields[i] = newField;\r\n\t\t}\r\n\r\n\t\treturn newFormFields;\r\n\t}, initialFormFields);\r\n\r\n\tfunction resetFields() {\r\n\t\tvar updates = [];\r\n\r\n\t\tfor (let field of initFields) {\r\n\t\t\tupdates.push({\r\n\t\t\t\tref: field.ref,\r\n\t\t\t\tprop: \"value\",\r\n\t\t\t\tvalue: field.value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tupdateFields(updates);\r\n\t}\r\n\r\n\treturn [fields, updateFields, resetFields];\r\n}\r\n\r\nexport function SearchSelect(props) {\r\n\tconst value = props.value;\r\n\tconst setValue = props.setValue;\r\n\r\n\tconst [inputValue, setInputValue] = useState(\"\");\r\n\tconst [optionsVisible, setOptionsVisible] = useState(false);\r\n\tconst [hoveringOptions, setHoveringOptions] = useState(false);\r\n\tconst [matchingOptions, setMatchingOptions] = useState(props.options);\r\n\tconst searchSelectRef = useRef();\r\n\tconst optionsRef = useRef();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!optionsVisible)\r\n\t\t\treturn;\r\n\r\n\t\tconst searchSelectRect = searchSelectRef.current.getBoundingClientRect();\r\n\t\tconst optionsRect = optionsRef.current.getBoundingClientRect();\r\n\r\n\t\tvar optionsTop = searchSelectRect.top + searchSelectRect.height + 1;\r\n\r\n\t\tif (optionsTop + optionsRect.height > window.innerHeight)\r\n\t\t\toptionsTop = searchSelectRect.top - optionsRect.height - 2;\r\n\r\n\t\toptionsRef.current.style.top = optionsTop + \"px\";\r\n\t\toptionsRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (inputValue == \"\")\r\n\t\t\tsetMatchingOptions(props.options);\r\n\t\telse {\r\n\t\t\tvar options = props.options.filter(option => (\r\n\t\t\t\toption.toLowerCase().includes(inputValue.toLowerCase())\r\n\t\t\t));\r\n\r\n\t\t\tsetMatchingOptions(options);\r\n\t\t}\r\n\t}, [inputValue, props.options]);\r\n\r\n\tconst options = matchingOptions.map(option => (\r\n\t\t<div\r\n\t\t\tclassName=\"option-row\"\r\n\t\t\tonClick={() => onOptionClick(option)}\r\n\t\t\tkey={option}>\r\n\t\t\t{option}\r\n\t\t</div>\r\n\t));\r\n\r\n\tfunction onOptionClick(option) {\r\n\t\tsetValue(option);\r\n\t\tsetInputValue(\"\");\r\n\t\tsetOptionsVisible(false);\r\n\t\tsetHoveringOptions(false);\r\n\r\n\t\tif (props.onChange)\r\n\t\t\tprops.onChange(option);\r\n\t}\r\n\r\n\tfunction onKeyDown(e) {\r\n\t\tif (e.key == \"Enter\") {\r\n\t\t\tsetValue(matchingOptions[0]);\r\n\t\t\tsetInputValue(\"\");\r\n\t\t\tsetOptionsVisible(false);\r\n\t\t\tsetHoveringOptions(false);\r\n\r\n\t\t\tif (props.onChange)\r\n\t\t\t\tprops.onChange(matchingOptions[0]);\r\n\t\t}\r\n\t\telse if (!optionsVisible)\r\n\t\t\tsetOptionsVisible(true);\r\n\t}\r\n\r\n\tfunction onMouseEnterOptionsList() {\r\n\t\tsetHoveringOptions(true);\r\n\t}\r\n\r\n\tfunction onMouseLeaveOptionsList() {\r\n\t\tsetHoveringOptions(false);\r\n\t}\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tsetInputValue(e.target.value);\r\n\r\n\t\tif (props.onInputChange)\r\n\t\t\tprops.onInputChange(e);\r\n\t}\r\n\r\n\tfunction onSelectFocus() {\r\n\t\tsetOptionsVisible(true);\r\n\t}\r\n\r\n\tfunction onSelectBlur() {\r\n\t\tif (hoveringOptions)\r\n\t\t\treturn;\r\n\r\n\t\tsetOptionsVisible(false);\r\n\t\tsetInputValue(\"\");\r\n\t\tsetMatchingOptions(props.options);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"search-select\"\r\n\t\t\ttabIndex=\"0\"\r\n\t\t\tonFocus={onSelectFocus}\r\n\t\t\tonBlur={onSelectBlur}\r\n\t\t\tref={searchSelectRef}>\r\n\t\t\t<input\r\n\t\t\t\tvalue={inputValue}\r\n\t\t\t\tplaceholder={value || props.placeholder}\r\n\t\t\t\tonChange={onInputChange}\r\n\t\t\t\tonKeyDown={onKeyDown} />\r\n\t\t\t<div className=\"icon-wrapper\">\r\n\t\t\t\t<i className=\"fas fa-chevron-down\" />\r\n\t\t\t</div>\r\n\t\t\t{optionsVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"option-list\"\r\n\t\t\t\t\tonMouseEnter={onMouseEnterOptionsList}\r\n\t\t\t\t\tonMouseLeave={onMouseLeaveOptionsList}\r\n\t\t\t\t\tref={optionsRef}>\r\n\t\t\t\t\t{options.length > 0 &&\r\n\t\t\t\t\t\toptions\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{!options.length &&\r\n\t\t\t\t\t\t<div className=\"no-options\">\r\n\t\t\t\t\t\t\tNo Options\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserSearchSelect(props) {\r\n\tconst [options, setOptions] = useState([]);\r\n\tconst [idMap, setIdMap] = useState({});\r\n\tconst [query, setQuery] = useState(\"\");\r\n\tconst [valueName, setValueName] = useState(\"\");\r\n\r\n\tuseEffect(() => {\r\n\t\tif (query.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/searchName?query=${query}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar newIdMap = {};\r\n\r\n\t\t\t\tfor (let userData of res.data)\r\n\t\t\t\t\tnewIdMap[userData.name] = userData.id;\r\n\r\n\t\t\t\tsetIdMap(newIdMap);\r\n\t\t\t\tsetOptions(res.data.map(user => user.name));\r\n\t\t\t})\r\n\t\t\t.catch(useErrorAlert);\r\n\t}, [query]);\r\n\r\n\tfunction setValue(option) {\r\n\t\tsetValueName(option);\r\n\t\tprops.setValue(idMap[option]);\r\n\t}\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tsetQuery(e.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<SearchSelect\r\n\t\t\t{...props}\r\n\t\t\toptions={options}\r\n\t\t\tvalue={valueName}\r\n\t\t\tsetValue={setValue}\r\n\t\t\tonInputChange={onInputChange} />\r\n\t);\r\n}\r\n\r\nexport function TextEditor(props) {\r\n\tconst [tab, setTab] = useState(\"write\");\r\n\r\n\treturn (\r\n\t\t<ReactMde\r\n\t\t\tvalue={props.value}\r\n\t\t\tonChange={props.onChange}\r\n\t\t\tselectedTab={tab}\r\n\t\t\tonTabChange={setTab}\r\n\t\t\tclasses={{ \"preview\": \"md-content\" }}\r\n\t\t\tgenerateMarkdownPreview={\r\n\t\t\t\t(markdown) => Promise.resolve(<ReactMarkdown source={markdown} />)\r\n\t\t\t} />\r\n\t);\r\n}","import React, { } from \"react\";\r\n\r\nimport \"../css/modal.css\";\r\n\r\nexport function Modal(props) {\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{props.show &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclassName=\"modal-bg\"\r\n\t\t\t\t\t\tonClick={props.onBgClick} />\r\n\t\t\t\t\t<div className={`modal ${props.className ? props.className : \"\"}`}>\r\n\t\t\t\t\t\t<div className=\"modal-header\">\r\n\t\t\t\t\t\t\t{props.header}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"modal-content\">\r\n\t\t\t\t\t\t\t{props.content}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"modal-footer\">\r\n\t\t\t\t\t\t\t{props.footer}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useParams, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { Avatar, Badges, NameWithAvatar, YouTubeEmbed} from \"./User\";\r\nimport { HiddenUpload, TextEditor } from \"../../components/Form\";\r\nimport LoadingPage from \"../Loading\";\r\nimport Setup from \"../../components/Setup\";\r\nimport { GameRow } from \"../Play/Join\";\r\nimport { Time, filterProfanity } from \"../../components/Basic\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { RatingThresholds, RequiredTotalForStats } from \"../../Constants\";\r\nimport { capitalize } from \"../../utils\";\r\nimport Comments from \"../Community/Comments\";\r\n\r\nimport \"../../css/user.css\";\r\nimport { Modal } from \"../../components/Modal\";\r\n\r\nexport default function Profile() {\r\n    const [profileLoaded, setProfileLoaded] = useState(false);\r\n    const [name, setName] = useState();\r\n    const [avatar, setAvatar] = useState();\r\n    const [banner, setBanner] = useState();\r\n    const [bio, setBio] = useState(\"\");\r\n    const [oldBio, setOldBio] = useState();\r\n    const [editingBio, setEditingBio] = useState(false);\r\n    const [isFriend, setIsFriend] = useState(false);\r\n    const [settings, setSettings] = useState({});\r\n    const [accounts, setAccounts] = useState({});\r\n    const [recentGames, setRecentGames] = useState([]);\r\n    const [createdSetups, setCreatedSetups] = useState([]);\r\n    const [bustCache, setBustCache] = useState(false);\r\n    const [friendsPage, setFriendsPage] = useState(1);\r\n    const [maxFriendsPage, setMaxFriendsPage] = useState(1);\r\n    const [friends, setFriends] = useState([]);\r\n    const [friendRequests, setFriendRequests] = useState([]);\r\n    const [stats, setStats] = useState();\r\n    const [groups, setGroups] = useState([]);\r\n    const [showStatsModal, setShowStatsModal] = useState(false);\r\n    const [embedId, setEmbedId] = useState(\"\");\r\n    const [autoplay, setAutoplay] = useState(false);\r\n\r\n    const user = useContext(UserContext);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const history = useHistory();\r\n    const errorAlert = useErrorAlert();\r\n    const { userId } = useParams();\r\n\r\n    const isSelf = userId == user.id;\r\n    const isBlocked = !isSelf && user.blockedUsers.indexOf(userId) != -1;\r\n\r\n    useEffect(() => {\r\n        if (bustCache)\r\n            setBustCache(false);\r\n    }, [bustCache]);\r\n\r\n    useEffect(() => {\r\n        setEditingBio(false);\r\n\r\n        if (userId) {\r\n            setProfileLoaded(false);\r\n            let youtubeRegex = /^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#\\&\\?]{11}).*/;\r\n\r\n            axios.get(`/user/${userId}/profile`)\r\n                .then(res => {\r\n                    setProfileLoaded(true);\r\n                    setName(res.data.name);\r\n                    setAvatar(res.data.avatar);\r\n                    setBanner(res.data.banner);\r\n                    setBio(filterProfanity(res.data.bio, user.settings, \"\\\\*\") || \"\");\r\n                    setIsFriend(res.data.isFriend);\r\n                    setSettings(res.data.settings);\r\n                    setAccounts(res.data.accounts || {});\r\n                    setRecentGames(res.data.games);\r\n                    setCreatedSetups(res.data.setups);\r\n                    setMaxFriendsPage(res.data.maxFriendsPage);\r\n                    setFriendRequests(res.data.friendRequests);\r\n                    setFriendsPage(1);\r\n                    setStats(res.data.stats);\r\n                    setGroups(res.data.groups);\r\n                    setEmbedId(\"\");\r\n                    setAutoplay(false);\r\n\r\n                    if(res.data.settings.youtube !== undefined) {\r\n                        var videoMatches = res.data.settings.youtube.match(youtubeRegex) ?? \"\";\r\n                        if (videoMatches && videoMatches.length >= 7) {\r\n                            setEmbedId(videoMatches[7]);\r\n                        }\r\n                        setAutoplay(res.data.settings.autoplay);\r\n                    }\r\n\r\n                    document.title = `${res.data.name}'s Profile | BeyondMafia`;\r\n                })\r\n                .catch(e => {\r\n                    errorAlert(e);\r\n                    history.push(\"/play\");\r\n                });\r\n\r\n            axios.get(`/user/${userId}/friends`)\r\n                .then((res) => {\r\n                    setFriends(res.data);\r\n                })\r\n                .catch(errorAlert);\r\n        }\r\n    }, [userId]);\r\n\r\n    function onEditBanner(files, type) {\r\n        if (!user.itemsOwned.customProfile) {\r\n            errorAlert(\"You must purchase profile customization with coins from the Shop.\");\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    function onFileUpload(files, type) {\r\n        if (files.length) {\r\n            const formData = new FormData();\r\n            formData.append(\"image\", files[0]);\r\n\r\n            for (let el of document.getElementsByClassName(\"hidden-upload\"))\r\n                el.value = \"\";\r\n\r\n            axios.post(`/user/${type}`, formData)\r\n                .then(res => {\r\n                    switch (type) {\r\n                        case \"avatar\":\r\n                            setAvatar(true);\r\n                            siteInfo.clearCache();\r\n                            break;\r\n                        case \"banner\":\r\n                            setBanner(true);\r\n                            siteInfo.clearCache();\r\n                            break;\r\n                    }\r\n                })\r\n                .catch((e) => {\r\n                    if (e.response == null || e.response.status == 413)\r\n                        errorAlert(\"File too large, must be less than 2 MB.\");\r\n                    else\r\n                        errorAlert(e);\r\n                });\r\n        }\r\n    }\r\n\r\n    function onFriendUserClick() {\r\n        if (isFriend) {\r\n            var shouldUnfriend = window.confirm(\"Are you sure you wish to unfriend or cancel your friend request?\");\r\n            if (!shouldUnfriend)\r\n                return;\r\n        }\r\n\r\n        axios.post(\"/user/friend\", { user: userId })\r\n            .then((res) => {\r\n                setIsFriend(!isFriend);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onDeleteFriend(friendId) {\r\n        return () => {\r\n            var shouldUnfriend = window.confirm(\"Are you sure you wish to delete this friend?\");\r\n            if (!shouldUnfriend)\r\n                return;\r\n            \r\n            axios.post(\"/user/friend\", { user: friendId })\r\n                .then((res) => {\r\n                    setIsFriend(false);\r\n                    siteInfo.showAlert(res.data, \"success\");\r\n                })\r\n                .catch(errorAlert);\r\n        }\r\n    }\r\n\r\n    function onBlockUserClick() {\r\n        if (!isBlocked) {\r\n            var shouldBlock = window.confirm(\"Are you sure you wish to block this user?\");\r\n            if (!shouldBlock)\r\n                return;\r\n        }\r\n\r\n        axios.post(\"/user/block\", { user: userId })\r\n            .then(() => {\r\n                user.blockUserToggle(userId);\r\n\r\n                if (isBlocked)\r\n                    siteInfo.showAlert(\"User unblocked.\", \"success\");\r\n                else\r\n                    siteInfo.showAlert(\"User blocked.\", \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onBioClick() {\r\n        setEditingBio(isSelf);\r\n        setOldBio(bio);\r\n    }\r\n\r\n    function onEditBio(e) {\r\n        axios.post(`/user/bio`, { bio: bio })\r\n            .then(() => {\r\n                setEditingBio(false);\r\n                setBio(filterProfanity(bio, user.settings, \"\\\\*\"));\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onCancelEditBio(e) {\r\n        e.stopPropagation();\r\n        setEditingBio(false);\r\n        setBio(oldBio);\r\n    }\r\n\r\n    function onAcceptFriend(_userId) {\r\n        axios.post(\"/user/friend\", { user: _userId })\r\n            .then((res) => {\r\n                var newFriendRequests = friendRequests.slice().filter(u => u.id != _userId);\r\n                setFriendRequests(newFriendRequests);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onRejectFriend(_userId) {\r\n        axios.post(\"/user/friend/reject\", { user: _userId })\r\n            .then((res) => {\r\n                var newFriendRequests = friendRequests.slice().filter(u => u.id != _userId);\r\n                setFriendRequests(newFriendRequests);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onFriendsPageNav(page) {\r\n        var filterArg = getPageNavFilterArg(page, friendsPage, friends, \"lastActive\");\r\n\r\n        if (filterArg == null)\r\n            return;\r\n\r\n        axios.get(`/user/${userId}/friends?${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length) {\r\n                    setFriends(res.data);\r\n                    setFriendsPage(page);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const panelStyle = {};\r\n    const bannerStyle = {};\r\n\r\n    if (settings.backgroundColor)\r\n        panelStyle.backgroundColor = settings.backgroundColor;\r\n\r\n    if (banner)\r\n        bannerStyle.backgroundImage = `url(/uploads/${userId}_banner.jpg?t=${siteInfo.cacheVal})`;\r\n\r\n    if (settings.bannerFormat == \"stretch\")\r\n        bannerStyle.backgroundSize = \"100% 100%\";\r\n\r\n    var ratings = [];\r\n    var totalGames = 0;\r\n\r\n    if (stats && stats[\"Mafia\"] && stats[\"Mafia\"].all) {\r\n        var mafiaStats = stats[\"Mafia\"].all;\r\n        totalGames = (mafiaStats?.wins?.total + mafiaStats?.abandons?.total) || 0;\r\n\r\n        ratings = Object.keys(RatingThresholds).map(statName => {\r\n            var stat = mafiaStats[statName];\r\n\r\n            if (RatingThresholds[statName] == null)\r\n                return <></>;\r\n            else if (totalGames < RequiredTotalForStats)\r\n                stat = \"-\";\r\n            else if (statName == \"wins\")\r\n                stat = `${Math.round((stat.count / totalGames) * 100)}%`;\r\n            else {\r\n                var letter = \"F\";\r\n                var letters = Object.keys(RatingThresholds[statName]).reverse();\r\n                var i = 0;\r\n\r\n                switch (statName) {\r\n                    case \"reads\":\r\n                    case \"survival\":\r\n                        if (stat.total > 0)\r\n                            stat = stat.count / stat.total;\r\n                        else\r\n                            stat = \"-\";\r\n                        break;\r\n                }\r\n\r\n                if (stat != \"-\") {\r\n                    while (stat >= RatingThresholds[statName][letters[i]] && i < letters.length)\r\n                        letter = letters[i++];\r\n\r\n                    stat = letter;\r\n                }\r\n            }\r\n\r\n            return (\r\n                <div className=\"rating\" key={statName}>\r\n                    <div className=\"name\">\r\n                        {capitalize(statName)}\r\n                    </div>\r\n                    <div className=\"score\">\r\n                        {stat}\r\n                    </div>\r\n                </div>\r\n            );\r\n        });\r\n    }\r\n\r\n    const recentGamesRows = recentGames.map(game => (\r\n        <GameRow\r\n            game={game}\r\n            type={game.status || \"Finished\"}\r\n            key={game.id}\r\n            small />\r\n    ));\r\n\r\n    const createdSetupRows = createdSetups.map(setup => (\r\n        <Setup setup={setup} key={setup.id} />\r\n    ));\r\n\r\n    const friendRequestRows = friendRequests.map(user => (\r\n        <div className=\"friend-request\" key={user.id}>\r\n            <NameWithAvatar\r\n                id={user.id}\r\n                name={user.name}\r\n                avatar={user.avatar} />\r\n            <div className=\"btns\">\r\n                <i\r\n                    className=\"fas fa-check\"\r\n                    onClick={() => onAcceptFriend(user.id)} />\r\n                <i\r\n                    className=\"fas fa-times\"\r\n                    onClick={() => onRejectFriend(user.id)} />\r\n            </div>\r\n        </div>\r\n    ));\r\n\r\n    const friendRows = friends.map(friend => (\r\n        <div className=\"friend\" key={friend.id}>\r\n            <div className=\"friend-avatar\">\r\n                <NameWithAvatar\r\n                    id={friend.id}\r\n                    name={friend.name}\r\n                    avatar={friend.avatar} />\r\n                <div className=\"btns-wrapper\">\r\n                    <i className=\"fas fa-trash\"\r\n                        onClick={onDeleteFriend(friend.id)} />\r\n                </div>\r\n            </div>\r\n            <div className=\"last-active\">\r\n                <Time\r\n                    minSec\r\n                    millisec={Date.now() - friend.lastActive}\r\n                    suffix=\" ago\" />\r\n            </div>\r\n        </div>\r\n    ));\r\n\r\n    if (user.loaded && !user.loggedIn && !userId)\r\n        return <Redirect to=\"/play\" />;\r\n\r\n    if (user.loaded && user.loggedIn && !userId)\r\n        return <Redirect to={`/user/${user.id}`} />;\r\n\r\n    if (!profileLoaded || !user.loaded)\r\n        return <LoadingPage />;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"profile\">\r\n                {stats &&\r\n                    <StatsModal\r\n                        stats={stats}\r\n                        show={showStatsModal}\r\n                        setShow={setShowStatsModal} />\r\n                }\r\n                <div className=\"main-panel\" style={panelStyle}>\r\n                    <div className=\"banner\" style={bannerStyle}>\r\n                        {isSelf &&\r\n                            <HiddenUpload\r\n                                className=\"edit\"\r\n                                name=\"banner\"\r\n                                onClick={onEditBanner}\r\n                                onFileUpload={onFileUpload}>\r\n                                <i className=\"far fa-file-image\" />\r\n                            </HiddenUpload>\r\n                        }\r\n                    </div>\r\n                    <div className=\"user-info\">\r\n                        <div className=\"avi-name-row\">\r\n                            <div className=\"avi-name\">\r\n                                {!bustCache &&\r\n                                    <Avatar\r\n                                        large\r\n                                        id={userId}\r\n                                        hasImage={avatar}\r\n                                        bustCache={bustCache}\r\n                                        name={name}\r\n                                        edit={isSelf}\r\n                                        onUpload={onFileUpload} />\r\n                                }\r\n                                <div className=\"name\">\r\n                                    {name}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <Badges groups={groups} />\r\n                        {!isSelf && user.loggedIn &&\r\n                            <div className=\"options\">\r\n                                <i\r\n                                    className={`fas fa-user-plus ${isFriend ? \"sel\" : \"\"}`}\r\n                                    onClick={onFriendUserClick} />\r\n                                <i\r\n                                    className={`fas fa-ban ${isBlocked ? \"sel\" : \"\"}`}\r\n                                    onClick={onBlockUserClick}\r\n                                    title=\"Block user\" />\r\n                            </div>\r\n                        }\r\n                        <div className=\"accounts\">\r\n                            {accounts.discord && settings.showDiscord &&\r\n                                <div className=\"account-badge\">\r\n                                    <div className=\"icon discord-icon\" />\r\n                                    <div className=\"username-wrapper\">\r\n                                        <div className=\"username\">\r\n                                            {accounts.discord}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            }\r\n                            {accounts.twitch && settings.showTwitch &&\r\n                                <div className=\"account-badge\">\r\n                                    <div className=\"icon twitch-icon\" />\r\n                                    <div className=\"username-wrapper\">\r\n                                        <div className=\"username\">\r\n                                            {accounts.twitch}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            }\r\n                            {accounts.steam && settings.showSteam &&\r\n                                <div className=\"account-badge\">\r\n                                    <div className=\"icon steam-icon\" />\r\n                                    <div className=\"username-wrapper\">\r\n                                        <div className=\"username\">\r\n                                            {accounts.steam}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            }\r\n                        </div>\r\n                        <div\r\n                            className={`bio ${isSelf && !editingBio ? \"edit\" : \"\"}`}\r\n                            onClick={onBioClick}>\r\n                            {!editingBio &&\r\n                                <div className=\"md-content\">\r\n                                    <ReactMarkdown source={bio} />\r\n                                </div>\r\n                            }\r\n                            {editingBio &&\r\n                                <>\r\n                                    <TextEditor\r\n                                        value={bio}\r\n                                        onChange={setBio} />\r\n                                    <div className=\"buttons\">\r\n                                        <div className=\"btn btn-theme\" onClick={onEditBio}>Submit</div>\r\n                                        <div className=\"btn btn-theme-sec\" onClick={onCancelEditBio}>Cancel</div>\r\n                                    </div>\r\n                                </>\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"side column\">\r\n                { <YouTubeEmbed\r\n                            embedId={embedId}\r\n                            autoplay={autoplay}></YouTubeEmbed> }\r\n                    {totalGames >= RequiredTotalForStats &&\r\n                        <div className=\"box-panel ratings\" style={panelStyle}>\r\n                            <div className=\"heading\">\r\n                                Mafia Ratings\r\n                            </div>\r\n                            <div className=\"content\">\r\n                                {ratings}\r\n                                <div className=\"expand-icon-wrapper\" onClick={() => setShowStatsModal(true)}>\r\n                                    <i className=\"fas fa-expand-arrows-alt\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    }\r\n                    <div className=\"box-panel recent-games\" style={panelStyle}>\r\n                        <div className=\"heading\">\r\n                            Recent Games\r\n                        </div>\r\n                        <div className=\"content\">\r\n                            {recentGamesRows}\r\n                            {recentGames.length == 0 &&\r\n                                \"No games\"\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                    {friendRequests.length > 0 &&\r\n                        <div className=\"box-panel friend-requests\" style={panelStyle}>\r\n                            <div className=\"heading\">\r\n                                Friend Requests\r\n                            </div>\r\n                            <div className=\"content\">\r\n                                {friendRequestRows}\r\n                            </div>\r\n                        </div>\r\n                    }\r\n                    <div className=\"box-panel friends\" style={panelStyle}>\r\n                        <div className=\"heading\">\r\n                            Friends\r\n                        </div>\r\n                        <div className=\"content\">\r\n                            <PageNav\r\n                                inverted\r\n                                page={friendsPage}\r\n                                onNav={onFriendsPageNav} />\r\n                            {friendRows}\r\n                            {friends.length == 0 &&\r\n                                \"No friends yet\"\r\n                            }\r\n                            <PageNav\r\n                                inverted\r\n                                page={friendsPage}\r\n                                onNav={onFriendsPageNav} />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"box-panel created-setups\" style={panelStyle}>\r\n                        <div className=\"heading\">\r\n                            Setups Created\r\n                        </div>\r\n                        <div className=\"content\">\r\n                            {createdSetupRows}\r\n                            {createdSetups.length == 0 &&\r\n                                \"No setups\"\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <Comments location={userId} />\r\n        </>\r\n    );\r\n}\r\n\r\nfunction StatsModal(props) {\r\n    const [statsFilter, setStatsFilter] = useState(\"all\");\r\n    const [statsFilterQuery, setStatsFilterQuery] = useState(\"\");\r\n\r\n    const statsFilters = [\"all\", \"bySetup\", \"byRole\", \"byAlignment\"];\r\n    const statsFilterNames = { \"all\": \"All\", \"bySetup\": \"Setup\", \"byRole\": \"Role\", \"byAlignment\": \"Alignment\" };\r\n    const statsKeyNames = { \"totalGames\": \"Total Games\", \"wins\": \"Wins\", \"abandons\": \"Abandons\", \"reads\": \"Reads\", \"survival\": \"Village Vote Survival\" };\r\n\r\n    var statsRowNames;\r\n    var stats = props.stats[\"Mafia\"][statsFilter];\r\n\r\n    if (stats == null) {\r\n        stats = [];\r\n        statsRowNames = [];\r\n    }\r\n    if (statsFilter == \"all\") {\r\n        stats = [stats];\r\n        statsRowNames = [\"All\"];\r\n    }\r\n    else {\r\n        statsRowNames = Object.keys(stats)\r\n            .filter(key => key.toLowerCase().includes(statsFilterQuery));\r\n        stats = statsRowNames.map(key => stats[key]);\r\n        statsRowNames = statsRowNames.map(key => `${statsFilterNames[statsFilter]}: ${key}`);\r\n    }\r\n\r\n    const filterDropdownOptions = statsFilters.map(filter => (\r\n        <option key={filter} value={filter}>{statsFilterNames[filter]}</option>\r\n    ));\r\n\r\n    const statsRows = stats.map((statsObj, i) => {\r\n        let totalGames = statsObj.totalGames;\r\n        let totalGamesUnabandoned = statsObj.wins?.total + statsObj?.abandons?.total;\r\n        let statsList = Object.keys(statsObj).map(statKey => {\r\n            let statData = statsObj[statKey];\r\n\r\n            switch (statKey) {\r\n                case \"totalGames\":\r\n                    statData = <div className=\"stat-data\">{statData}</div>\r\n                    break;\r\n                case \"wins\":\r\n                case \"abandons\":\r\n                    statData = <div className=\"stat-data\">{statData.count}/{totalGamesUnabandoned}</div>\r\n                    break;\r\n                case \"reads\":\r\n                case \"survival\":\r\n                    statData = <div className=\"stat-data\">{statData.count}/{statData.total}</div>\r\n                    break;\r\n            }\r\n\r\n            return (\r\n                <div className=\"stat\" key={statKey}>\r\n                    <div className=\"stat-name\">\r\n                        {statsKeyNames[statKey]}\r\n                    </div>\r\n                    {statData}\r\n                </div>\r\n            );\r\n        });\r\n\r\n        return (\r\n            <div className=\"stats-row\" key={statsRowNames[i]}>\r\n                <div className=\"stats-row-name\">\r\n                    {statsRowNames[i]}\r\n                </div>\r\n                <div className=\"stats-list\">\r\n                    {statsList}\r\n                </div>\r\n            </div>\r\n        );\r\n    });\r\n\r\n    const header = \"Ranked Stats\";\r\n\r\n    const content = (\r\n        <div className=\"stats-wrapper\">\r\n            <div className=\"filter\">\r\n                <select\r\n                    value={statsFilter}\r\n                    onChange={(e) => setStatsFilter(e.target.value)}>\r\n                    {filterDropdownOptions}\r\n                </select>\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Query\"\r\n                    onChange={(e) => setStatsFilterQuery(e.target.value.toLowerCase())} />\r\n            </div>\r\n            <div className=\"stats\">\r\n                {statsRows}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const footer = (\r\n        <div className=\"control\">\r\n            <div\r\n                className=\"post btn btn-theme\"\r\n                onClick={() => props.setShow(false)}>\r\n                Close\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    function onCancel() {\r\n        props.setShow(false);\r\n    }\r\n\r\n    return (\r\n        <Modal\r\n            className=\"stats-modal\"\r\n            show={props.show}\r\n            onBgClick={onCancel}\r\n            header={header}\r\n            content={content}\r\n            footer={footer} />\r\n    );\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport LoadingPage from \"../Loading\";\r\nimport Form, { useForm } from \"../../components/Form\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\n\r\nimport \"../../css/settings.css\";\r\nimport { setCaptchaVisible } from \"../../utils\";\r\n\r\nexport default function Settings(props) {\r\n\tconst [settingsLoaded, setSettingsLoaded] = useState(false);\r\n\tconst [accountsLoaded, setAccountsLoaded] = useState(false);\r\n\tconst [accounts, setAccounts] = useState({});\r\n\tconst history = useHistory();\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tconst [siteFields, updateSiteFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Referral URL\",\r\n\t\t\tref: \"referralURL\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tvalue: (deps) => `${process.env.REACT_APP_URL}/auth/login?ref=${deps.user.id}`,\r\n\t\t\tfixed: true,\r\n\t\t\thighlight: true\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"DMs from Friends Only\",\r\n\t\t\tref: \"onlyFriendDMs\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Disable PG-13 Censor\",\r\n\t\t\tref: \"disablePg13Censor\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"!disableAllCensors\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Disable All Censors\",\r\n\t\t\tref: \"disableAllCensors\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.perms.disableAllCensors\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Hide Deleted Posts\",\r\n\t\t\tref: \"hideDeleted\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.perms.viewDeleted\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Site Color Scheme\",\r\n\t\t\tref: \"siteColorScheme\",\r\n\t\t\ttype: \"select\",\r\n\t\t\toptions: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Auto\",\r\n\t\t\t\t\tvalue: \"auto\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Light\",\r\n\t\t\t\t\tvalue: \"light\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Dark\",\r\n\t\t\t\t\tvalue: \"dark\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t]);\r\n\r\n\tconst [profileFields, updateProfileFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Name\",\r\n\t\t\tref: \"username\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tsaveBtn: \"Change\",\r\n\t\t\tsaveBtnDiffer: \"name\",\r\n\t\t\tsaveBtnOnClick: onUsernameSave,\r\n\t\t\tconfirm: \"Are you sure you wish to change your username?\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Birthday\",\r\n\t\t\tref: \"birthday\",\r\n\t\t\ttype: \"date\",\r\n\t\t\tsaveBtn: \"Change\",\r\n\t\t\tsaveBtnDiffer: \"bdayChanged\",\r\n\t\t\tdefault: Date.now(),\r\n\t\t\tsaveBtnOnClick: onBirthdaySave,\r\n\t\t\tconfirm: \"Are you sure you wish to change your birthday? Your birthday can only be changed ONCE per account.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Show Discord\",\r\n\t\t\tref: \"showDiscord\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.discord && deps.accounts.discord.id\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Show Twitch\",\r\n\t\t\tref: \"showTwitch\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.twitch && deps.accounts.twitch.id\r\n\t\t},\r\n\t\t// {\r\n\t\t// \tlabel: \"Show Google\",\r\n\t\t// \tref: \"showGoogle\",\r\n\t\t// \ttype: \"boolean\",\r\n\t\t// \tshowIf: (deps) => deps.accounts.google && deps.accounts.google.id\r\n\t\t// },\r\n\t\t{\r\n\t\t\tlabel: \"Show Steam\",\r\n\t\t\tref: \"showSteam\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.steam && deps.accounts.steam.id\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Background Color\",\r\n\t\t\tref: \"backgroundColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#5357a5\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.customProfile\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Youtube video\",\r\n\t\t\tref: \"youtube\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tsaveBtn: \"Change\",\r\n\t\t\tsaveBtnDiffer: \"youtube\",\r\n\t\t\tsaveBtnOnClick: onYoutubeSave,\r\n\t\t\tdefault: \"\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Autoplay video (will only work after playing once)\",\r\n\t\t\tref: \"autoplay\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.settings.youtube != null\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Banner Format\",\r\n\t\t\tref: \"bannerFormat\",\r\n\t\t\ttype: \"select\",\r\n\t\t\toptions: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Tile\",\r\n\t\t\t\t\tvalue: \"tile\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Stretch\",\r\n\t\t\t\t\tvalue: \"stretch\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.customProfile\r\n\t\t}\r\n\t], [accounts]);\r\n\r\n\tconst [gameFields, updateGameFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Name Color\",\r\n\t\t\tref: \"nameColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#000\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.textColors\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Text Color\",\r\n\t\t\tref: \"textColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#000\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.textColors\r\n\t\t}\r\n\t]);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Settings | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (user.loaded && user.loggedIn) {\r\n\t\t\tif (!settingsLoaded) {\r\n\t\t\t\taxios.get(\"/user/settings/data\")\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tlet siteFormFieldChanges = [];\r\n\t\t\t\t\t\tlet profileFormFieldChanges = [];\r\n\t\t\t\t\t\tlet gameFormFieldChanges = [];\r\n\r\n\t\t\t\t\t\tfor (let ref in res.data) {\r\n\t\t\t\t\t\t\tif (!res.data[ref]) continue;\r\n\r\n\t\t\t\t\t\t\tsiteFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tprofileFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tgameFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tupdateSiteFields(siteFormFieldChanges);\r\n\t\t\t\t\t\tupdateProfileFields(profileFormFieldChanges);\r\n\t\t\t\t\t\tupdateGameFields(gameFormFieldChanges);\r\n\t\t\t\t\t\tsetSettingsLoaded(true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\r\n\t\t\tif (!accountsLoaded) {\r\n\t\t\t\taxios.get(\"/user/accounts\")\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tsetAccounts(res.data);\r\n\t\t\t\t\t\tsetAccountsLoaded(true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [user]);\r\n\r\n\tfunction onSettingChange(action, update) {\r\n\t\tif (action.prop == \"value\" && !action.localOnly) {\r\n\t\t\taxios.post(\"/user/settings/update\", {\r\n\t\t\t\tprop: action.ref,\r\n\t\t\t\tvalue: action.value\r\n\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tuser.updateSetting(action.ref, action.value);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\r\n\t\tupdate(action);\r\n\t}\r\n\r\n\tfunction onBirthdaySave(date, deps) {\r\n\t\taxios.post(\"/user/birthday\", { date })\r\n\t\t\t.then(res => {\r\n\t\t\t\tdeps.siteInfo.showAlert(\"Birthday set\", \"success\");\r\n\r\n\t\t\t\tdeps.user.set(update(deps.user, {\r\n\t\t\t\t\tbirthday: { $set: date },\r\n\t\t\t\t\tbdayChanged: { $set: true }\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(deps.errorAlert);\r\n\t}\r\n\r\n\tfunction onUsernameSave(name, deps) {\r\n\t\tvar code = \"\";\r\n\r\n\t\tif (reservedNames.indexOf(name.toLowerCase()) != -1)\r\n\t\t\tcode = window.prompt(\"This name is reserved, please enter your reservation code.\");\r\n\r\n\t\taxios.post(\"/user/name\", { name, code })\r\n\t\t\t.then(res => {\r\n\t\t\t\tdeps.siteInfo.showAlert(\"Username changed\", \"success\");\r\n\r\n\t\t\t\tdeps.user.set(update(deps.user, {\r\n\t\t\t\t\tname: { $set: name },\r\n\t\t\t\t\titemsOwned: {\r\n\t\t\t\t\t\tnameChange: {\r\n\t\t\t\t\t\t\t$set: deps.user.itemsOwned.nameChange - 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(deps.errorAlert);\r\n\t}\r\n\r\n\t function onYoutubeSave(link, deps){\r\n\t \taxios.post(\"/user/youtube\", {link})\r\n\t \t\t.then(res => {\r\n\t \t\t\tdeps.siteInfo.showAlert(\"Profile video changed\", \"success\");\r\n\t\t\t\t\r\n\t\t\t\tdeps.user.set(update(deps.user, {\r\n\t \t\t\t\tyoutube: { $set: link }\r\n\t \t\t\t}));\r\n\t \t\t})\r\n\t \t\t.catch(deps.errorAlert);\r\n\t }\r\n\r\n\tfunction onLogoutClick() {\r\n\t\taxios.post(\"/user/logout\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tuser.clear();\r\n\t\t\t\tsetCaptchaVisible(true);\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete your account? This is irreversible.\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/user/delete\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tuser.clear();\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tif (user.loaded && !user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (!settingsLoaded || !accountsLoaded || !user.loaded)\r\n\t\treturn <LoadingPage />\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main settings\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tSite\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={siteFields}\r\n\t\t\t\tdeps={{ user }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateSiteFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tProfile\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={profileFields}\r\n\t\t\t\tdeps={{ name: user.name, user, accounts, siteInfo, errorAlert }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateProfileFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tGame\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={gameFields}\r\n\t\t\t\tdeps={{ user }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateGameFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tAccounts\r\n\t\t\t</div>\r\n\t\t\t<div className=\"accounts-row\">\r\n\t\t\t\t<div className=\"accounts-column\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme-sec logout\"\r\n\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\tSign Out\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn delete-account\"\r\n\t\t\t\t\t\tonClick={onDeleteClick}>\r\n\t\t\t\t\t\tDelete Account\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nconst reservedNames = [\"Giga\", \"Giga13\", \"rend\", \"croned\", \"gameshowmaster\", \"gayshowmaster\", \"Golbolco\", \"damiandaniel72\", \"filko\", \"elizachikorita\", \"nyouhas\", \"Thisinthat\", \"jacobkrin\", \"nirkbocaj\", \"hima\", \"Rutab\", \"Nick\", \"kidneybeans\", \"emma\", \"baabaa\", \"DiSoRiEnTeD\", \"DiSo\", \"imasavage\", \"ducky\", \"Pranay7744\", \"Hugo\", \"Dasein\", \"SpaceTimeJumpa\", \"eadin\", \"jingahegami\", \"Kalakaua\", \"GoldenOne\", \"SamP4Palmer\", \"sevenseas\", \"GaryThompson\", \"lemonsun\", \"matt\", \"Transcend\", \"cozy\", \"winx\", \"Roxy\", \"Dawn\", \"mahugashaka\", \"koba\", \"DkKoba\", \"DarkB\", \"LeaderMafia\", \"Validor\", \"BrenTheDerg\", \"juke\", \"polly\", \"eric\", \"evolpz\", \"BradLand\", \"GoodQuestion\", \"Torreador\", \"Gamethroweador\", \"monkney\", \"monkey\", \"Furry\", \"Merlot\", \"Winnie\", \"arials\", \"arials92\", \"lesbian\", \"gays\", \"Mephistopheles\", \"Facilier\", \"MIKEISTKRIEG\", \"MIKEISTKRlEG\", \"JesseVentura\", \"nomsterrpengi\", \"kirbywithaknife\", \"kirbywithagun\", \"Super\", \"shady\", \"shady12\", \"cowboy\", \"Skittlez\", \"Moldyches\", \"Mizzmox\", \"Fro30\", \"Ngekop73\", \"ivana\", \"queen\", \"catlady\", \"mocha\", \"Rapsician\", \"Akari\", \"Sonrio\", \"Purple\", \"GardeningPapa\", \"davesprite\", \"sunburst\", \"RhaegarX\", \"Jennings\", \"ogwam\", \"bono\", \"Loser\", \"Winner\", \"talisker\", \"rigby\", \"CharlieBradbury\", \"KingEvin\", \"swan\", \"dream\", \"ERNurse\", \"lain\", \"jimmyjimjam\", \"starry\", \"muki\", \"starrydash\", \"Xinde\", \"sl0nderman\", \"starlysama\", \"lena\", \"nancy\", \"komaeda\", \"FLICKER\", \"Donut\", \"Mafia\", \"Mafsided\", \"PikachUwU\", \"Vaporeon\", \"marex\", \"feickoo\", \"DrSharky\", \"shwartz99\", \"gemrush\", \"sidnee\", \"MrSlipperyButt\", \"MrsSlipperyButt\", \"emsychum\", \"verum\", \"Disguiser\", \"Ryan\", \"CyanRyan\", \"SinB\", \"xray\", \"ShaggyRogers\", \"TheGreatCornholio\", \"RedRanger\", \"staypositivefriend\", \"FruityPebbles\", \"kimchi\", \"LeChuck\", \"Marty\", \"Joe_\", \"Kerry\", \"Miki\", \"Tristan117\", \"GoodBoiSweater\", \"Clair\", \"Hibiki\", \"viivii\", \"TheTurningRAY\", \"Frabel\", \"Wolf\", \"TheAsian\", \"Achilles\", \"ragefakar\", \"jets\", \"zoot\", \"EllaSantos\", \"Baya\", \"MeteorNate\", \"spookyaleks\", \"ohnoitsrepo\", \"Sona\", \"NinetyNineGhost\", \"ggnore2332\", \"Danny\", \"dannyred694\", \"flashbar\", \"emily\", \"bluscone\", \"Bebop\", \"morgan\", \"Zetonate\", \"johnmiller\", \"Reshoe7777777\", \"Chicken\", \"getdropkicked\", \"JigglyBuff\", \"ibeg\", \"khs131\", \"krista\", \"ania\", \"caitelatte\", \"celebrelatte\", \"Charge\", \"powerofdeath\", \"nightwing8782\", \"weaversden\", \"Valkyrie\", \"alex\", \"megan\", \"lana\", \"psy420\", \"anya\", \"SnowyB\", \"aphelios\", \"MasterCthulhu\", \"XrCyclone\", \"Cyclone\", \"sakin\", \"CooperD\", \"idah09h\", \"jeteon\", \"wink\", \"nicole\", \"sofia\", \"sofiiia\", \"Senty\", \"Sabi\", \"KutiPls\", \"Cream7\", \"Giga96\", \"arcbell\", \"admin\", \"administrator\", \"mod\", \"moderator\", \"lucid\", \"lucidrains\"];","import React, { useState, useEffect, useContext, useRef } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\n\r\nimport \"../../css/shop.css\";\r\n\r\nexport default function Shop(props) {\r\n\tconst [shopInfo, setShopInfo] = useState({ shopItems: [], balance: 0 });\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Shop | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!user.loaded || !user.loggedIn)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(\"/shop/info\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetShopInfo(res.data);\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}, [user.loaded]);\r\n\r\n\tfunction onBuyItem(index) {\r\n\t\tconst item = shopInfo.shopItems[index];\r\n\t\tconst shouldBuy = window.confirm(`Are you sure you wish to buy ${item.name} for ${item.price} coins?`);\r\n\r\n\t\tif (!shouldBuy)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/shop/spendCoins\", { item: index })\r\n\t\t\t.then(() => {\r\n\t\t\t\tsiteInfo.showAlert(\"Item purchased.\", \"success\");\r\n\r\n\t\t\t\tsetShopInfo(update(shopInfo, {\r\n\t\t\t\t\tbalance: {\r\n\t\t\t\t\t\t$set: shopInfo.balance - item.price\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tuser.set(update(user.state, {\r\n\t\t\t\t\titemsOwned: {\r\n\t\t\t\t\t\t[item.key]: {\r\n\t\t\t\t\t\t\t$set: user.itemsOwned[item.key] + 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst shopItems = shopInfo.shopItems.map((item, i) => (\r\n\t\t<div className=\"shop-item\" key={i}>\r\n\t\t\t<div className=\"name\">\r\n\t\t\t\t{item.name}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"desc\">\r\n\t\t\t\t{item.desc}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"bottom\">\r\n\t\t\t\t<div className=\"price\">\r\n\t\t\t\t\t<i className=\"fas fa-coins\" />\r\n\t\t\t\t\t{item.price} coins\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"owned\">\r\n\t\t\t\t\tOwned:\r\n\t\t\t\t\t<div className=\"amt\">\r\n\t\t\t\t\t\t{user.itemsOwned[item.key]}\r\n\t\t\t\t\t\t{item.limit != null &&\r\n\t\t\t\t\t\t\t` / ${item.limit}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={`buy btn btn-theme`}\r\n\t\t\t\t\tdisabled={item.limit != null && user.itemsOwned[item.key] >= item.limit}\r\n\t\t\t\t\tonClick={() => onBuyItem(i)}>\r\n\t\t\t\t\tBuy\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tif (user.loaded && !user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main shop\">\r\n\t\t\t<div className=\"top-bar\">\r\n\t\t\t\t<div className=\"balance\">\r\n\t\t\t\t\t<i className=\"fas fa-coins\" />\r\n\t\t\t\t\t{shopInfo.balance}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"shop-items\">\r\n\t\t\t\t{shopItems}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useContext } from \"react\";\r\nimport { Link, Route, Switch, Redirect } from \"react-router-dom\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport Profile from \"./Profile\";\r\nimport Settings from \"./Settings\";\r\nimport Shop from \"./Shop\";\r\nimport { UserContext, PopoverContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport { HiddenUpload } from \"../../components/Form\";\r\n\r\nimport \"../../css/user.css\"\r\nimport { adjustColor, flipTextColor } from \"../../utils\";\r\n\r\n\r\nexport function YouTubeEmbed(props) {\r\n\tconst embedId = props.embedId;\r\n\tvar autoplay = \"\";\r\n\tif (props.autoplay) {\r\n\t\tautoplay = 1;\r\n\t}\r\n\telse {\r\n\t\tautoplay = 0;\r\n\t}\r\n\tif (embedId !== null && embedId !== \"\") {\r\n\t\treturn (\r\n\t\t<div id=\"profile-video\" className=\"video-responsive\">\r\n\t\t\t<iframe\r\n\t\t\t\tsrc={`https://www.youtube.com/embed/${embedId}?autoplay=${autoplay}&mute=0`}\r\n\t\t\t\tallow=\"accelerometer; autoplay; clipboard-write; encrypted-media;\"\r\n\t\t\t\tallowFullScreen>\r\n\t\t\t</iframe>\r\n\t\t</div>);\r\n\t}\r\n\telse {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nexport default function User(props) {\r\n\tconst user = useContext(UserContext);\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Profile\",\r\n\t\t\tpath: user.id ? `/user/${user.id}` : \"/user\",\r\n\t\t\texact: true,\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Settings\",\r\n\t\t\tpath: \"/user/settings\",\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Shop\",\r\n\t\t\tpath: \"/user/shop\",\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/user\" render={() => <Profile />} />\r\n\t\t\t\t\t<Route exact path=\"/user/settings\" render={() => <Settings />} />\r\n\t\t\t\t\t<Route exact path=\"/user/shop\" render={() => <Shop />} />\r\n\t\t\t\t\t<Route exact path=\"/user/:userId\" render={() => <Profile />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/user\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport function Avatar(props) {\r\n\tconst small = props.small;\r\n\tconst large = props.large;\r\n\tconst id = props.id;\r\n\tconst name = props.name;\r\n\tconst hasImage = props.hasImage;\r\n\tconst imageUrl = props.imageUrl;\r\n\tconst edit = props.edit;\r\n\tconst onUpload = props.onUpload;\r\n\tconst active = props.active;\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst style = {};\r\n\tconst colors = [\"#fff59d\", \"#ef9a9a\", \"#9fa8da\", \"#ce93d8\", \"#a5d6a7\", \"#f48fb1\", \"#ffcc80\", \"#90deea\", \"#80cbc4\"]; //yellow, red, blue, purple, green, pink, orange, cyan, teal\r\n\tvar size;\r\n\r\n\tif (small)\r\n\t\tsize = \"small\";\r\n\telse if (large)\r\n\t\tsize = \"large\";\r\n\telse\r\n\t\tsize = \"\";\r\n\r\n\tif (hasImage && !imageUrl && id) {\r\n\t\tstyle.backgroundImage = `url(/uploads/${id}_avatar.jpg?t=${siteInfo.cacheVal})`;\r\n\t}\r\n\telse if (hasImage && imageUrl) {\r\n\t\tstyle.backgroundImage = `url(${imageUrl})`;\r\n\t}\r\n\telse if (name) {\r\n\t\tvar rand = 0;\r\n\r\n\t\tfor (let i = 0; i < name.length; i++)\r\n\t\t\trand ^= name.charCodeAt(i);\r\n\r\n\t\trand ^= name.charCodeAt(1);\r\n\t\trand ^= rand << 13;\r\n\t\trand ^= rand >> 7;\r\n\t\trand ^= rand << 17;\r\n\t\trand = Math.abs(rand) / Math.pow(2, 31);\r\n\r\n\t\tstyle.backgroundColor = colors[Math.floor(rand * colors.length)];\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`avatar ${size} ${active ? \"active\" : \"\"}`}\r\n\t\t\tstyle={style}>\r\n\t\t\t{edit &&\r\n\t\t\t\t<HiddenUpload\r\n\t\t\t\t\tclassName=\"edit\"\r\n\t\t\t\t\tname=\"avatar\"\r\n\t\t\t\t\tonFileUpload={onUpload}>\r\n\t\t\t\t\t<i className=\"far fa-file-image\" />\r\n\t\t\t\t</HiddenUpload>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function NameWithAvatar(props) {\r\n\tconst id = props.id;\r\n\tconst name = props.name || \"[deleted]\";\r\n\tconst avatar = props.avatar;\r\n\tconst noLink = props.name ? props.noLink : true;\r\n\tconst color = props.color;\r\n\tconst newTab = props.newTab;\r\n\tconst small = props.small;\r\n\tconst active = props.active;\r\n\tconst groups = props.groups;\r\n\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tvar userNameClassName = `user-name ${adjustColor(color)}`;\r\n\r\n\treturn (\r\n\t\t<Link\r\n\t\t\tclassName={`name-with-avatar ${noLink ? \"no-link\" : \"\"}`}\r\n\t\t\tto={`/user/${id}`}\r\n\t\t\ttarget={newTab ? \"_blank\" : \"\"}\r\n\t\t\tonClick={(e) => {\r\n\t\t\t\tpopover.setVisible(false);\r\n\r\n\t\t\t\tif (noLink)\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t}}>\r\n\t\t\t<Avatar\r\n\t\t\t\thasImage={avatar}\r\n\t\t\t\tid={id}\r\n\t\t\t\tname={name}\r\n\t\t\t\tsmall={small}\r\n\t\t\t\tactive={active} />\r\n\t\t\t<div className={userNameClassName} style={color ? { color: flipTextColor(color) } : {}}>{name}</div>\r\n\t\t\t{groups &&\r\n\t\t\t\t<Badges groups={groups} small={small} />\r\n\t\t\t}\r\n\t\t</Link>\r\n\t);\r\n}\r\n\r\nexport function StatusIcon(props) {\r\n\treturn (\r\n\t\t<div className={`status-icon ${props.status}`} />\r\n\t);\r\n}\r\n\r\nexport function Badges(props) {\r\n\tconst badges = props.groups\r\n\t\t.filter(g => g.badge)\r\n\t\t.sort((a, b) => a.rank - b.rank)\r\n\t\t.map(g => (\r\n\t\t\t<Badge\r\n\t\t\t\ticon={g.badge}\r\n\t\t\t\tcolor={g.badgeColor || \"black\"}\r\n\t\t\t\tname={g.name}\r\n\t\t\t\tkey={g.name} />\r\n\t\t));\r\n\r\n\treturn (\r\n\t\t<div className={`badge-list ${props.small ? \"small\" : \"\"}`}>\r\n\t\t\t{badges}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Badge(props) {\r\n\treturn (\r\n\t\t<div className=\"badge\">\r\n\t\t\t<i\r\n\t\t\t\tclassName={`fas fa-${props.icon}`}\r\n\t\t\t\tstyle={{ color: props.color }}\r\n\t\t\t\ttitle={props.name} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useUser() {\r\n\tconst [user, setUser] = useState({\r\n\t\tloggedIn: false,\r\n\t\tloaded: false,\r\n\t\tperms: {},\r\n\t\trank: 0,\r\n\t\tblockedUsers: [],\r\n\t\tsettings: {},\r\n\t\titemsOwned: {}\r\n\t});\r\n\r\n\tfunction clear() {\r\n\t\tsetUser({\r\n\t\t\tloggedIn: false,\r\n\t\t\tloaded: true,\r\n\t\t\tperms: {},\r\n\t\t\trank: 0,\r\n\t\t\tblockedUsers: []\r\n\t\t});\r\n\t}\r\n\r\n\tfunction blockUserToggle(userId) {\r\n\t\tvar userIndex = user.blockedUsers.indexOf(userId);\r\n\r\n\t\tif (userIndex == -1) {\r\n\t\t\tsetUser(update(user, {\r\n\t\t\t\tblockedUsers: {\r\n\t\t\t\t\t$push: [userId]\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsetUser(update(user, {\r\n\t\t\t\tblockedUsers: {\r\n\t\t\t\t\t$splice: [[userIndex, 1]]\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateSetting(prop, value) {\r\n\t\tsetUser(update(user, {\r\n\t\t\tsettings: {\r\n\t\t\t\t[prop]: {\r\n\t\t\t\t\t$set: value\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\treturn {\r\n\t\t...user,\r\n\t\tstate: user,\r\n\t\tset: setUser,\r\n\t\tblockUserToggle,\r\n\t\tupdateSetting,\r\n\t\tclear\r\n\t};\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Time } from \"../../../components/Basic\";\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { ViewsAndReplies } from \"./Forums\";\r\n\r\nexport default function Categories(props) {\r\n\tconst [categoryInfo, setCategoryInfo] = useState([]);\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Categories | BeyondMafia\";\r\n\t\tprops.updateForumNavInfo({ action: \"home\" });\r\n\r\n\t\taxios.get(\"/forums/categories\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar categories = res.data.sort(sortItems);\r\n\r\n\t\t\t\tfor (let category of categories)\r\n\t\t\t\t\tcategory.boards = category.boards.sort(sortItems);\r\n\r\n\t\t\t\tsetCategoryInfo(categories);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"home\"\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}, []);\r\n\r\n\tfunction sortItems(a, b) {\r\n\t\treturn a.position - b.position;\r\n\t}\r\n\r\n\tconst categories = categoryInfo.map(category => {\r\n\t\tconst boards = category.boards.map(board => {\r\n\t\t\tconst newestThreads = board.newestThreads.map(thread => (\r\n\t\t\t\t<div className=\"column-item\" key={thread.id}>\r\n\t\t\t\t\t<div className=\"thread-link-wrapper\">\r\n\t\t\t\t\t\t<Link to={`/community/forums/thread/${thread.id}`}>\r\n\t\t\t\t\t\t\t{thread.title}\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={thread.author.id}\r\n\t\t\t\t\t\tname={thread.author.name}\r\n\t\t\t\t\t\tavatar={thread.author.avatar} />\r\n\t\t\t\t\t<div className=\"thread-counts\">\r\n\t\t\t\t\t\t<ViewsAndReplies\r\n\t\t\t\t\t\t\tviewCount={thread.viewCount || 0}\r\n\t\t\t\t\t\t\treplyCount={thread.replyCount || 0} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t));\r\n\r\n\t\t\tconst recentReplies = board.recentReplies.map(reply => (\r\n\t\t\t\t<div className=\"column-item\" key={reply.id}>\r\n\t\t\t\t\t<div className=\"thread-link-wrapper\">\r\n\t\t\t\t\t\t<Link to={`/community/forums/thread/${reply.thread.id}?reply=${reply.id}`}>\r\n\t\t\t\t\t\t\t{reply.thread.title}\r\n\t\t\t\t\t\t</Link>\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={reply.author.id}\r\n\t\t\t\t\t\tname={reply.author.name}\r\n\t\t\t\t\t\tavatar={reply.author.avatar} />\r\n\t\t\t\t\t<div className=\"reply-age\">\r\n\t\t\t\t\t\t<Time millisec={Date.now() - reply.postDate} />\r\n\t\t\t\t\t\t{` ago`}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t));\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"board\" key={board.id}>\r\n\t\t\t\t\t<i className={`fas fa-${board.icon || \"comments\"} board-icon`} />\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tclassName=\"board-info\"\r\n\t\t\t\t\t\tto={`/community/forums/board/${board.id}`}>\r\n\t\t\t\t\t\t<div className=\"board-name\">\r\n\t\t\t\t\t\t\t{board.name}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"board-desc\">\r\n\t\t\t\t\t\t\t{board.description}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<div className=\"forum-column tall\">\r\n\t\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\t\tNewest Thread\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={`column-content ${newestThreads.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t\t{newestThreads.length == 0 &&\r\n\t\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\t\tNo threads yet\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{newestThreads}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"forum-column tall three\">\r\n\t\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\t\tRecent Replies\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={`column-content ${recentReplies.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t\t{recentReplies.length == 0 &&\r\n\t\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\t\tNo replies yet\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{recentReplies}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"span-panel forum-category\" key={category.id}>\r\n\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t{category.name}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"boards\">\r\n\t\t\t\t\t{boards}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn categories;\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useParams, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../../components/Nav\";\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Modal } from \"../../../components/Modal\";\r\nimport { VoteWidget, ViewsAndReplies } from \"./Forums\";\r\nimport { TextEditor } from \"../../../components/Form\";\r\nimport { Time } from \"../../../components/Basic\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nexport default function Board(props) {\r\n\tconst [boardInfo, setBoardInfo] = useState({});\r\n\tconst [showCreateModal, setShowCreateModal] = useState(false);\r\n\tconst [newThreadTitle, setNewThreadTitle] = useState(\"\");\r\n\tconst [newThreadContent, setNewThreadContent] = useState(\"\");\r\n\tconst [boardPage, setBoardPage] = useState(1);\r\n\tconst [sortType, setSortType] = useState(\"bumpDate\");\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [redirect, setRedirect] = useState();\r\n\r\n\tconst { boardId } = useParams();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Mafia Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.get(`/forums/board/${boardId}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetBoardInfo(res.data);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tdocument.title = `${res.data.name} | BeyondMafia`;\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"board\",\r\n\t\t\t\t\tid: boardId,\r\n\t\t\t\t\tname: res.data.name\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t\tsetRedirect(\"/community/forums\");\r\n\t\t\t});\r\n\t}, [boardId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (loaded) {\r\n\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\taction: \"board\",\r\n\t\t\t\tid: boardInfo.id,\r\n\t\t\t\tname: boardInfo.name\r\n\t\t\t});\r\n\t\t}\r\n\t}, [loaded, boardInfo]);\r\n\r\n\tfunction onCreateThreadClick() {\r\n\t\tsetShowCreateModal(true);\r\n\t}\r\n\r\n\tfunction onBoardPageNav(page) {\r\n\t\tvar filterArg = getPageNavFilterArg(page, boardPage, boardInfo.threads, sortType);\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/forums/board/${boardId}?sortType=${sortType}&${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.threads.length > 0) {\r\n\t\t\t\t\tsetBoardInfo(res.data);\r\n\t\t\t\t\tsetBoardPage(page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction threadRowsMap(thread) {\r\n\t\tconst recentReplies = thread.recentReplies.map(reply => (\r\n\t\t\t<div className=\"column-item\" key={reply.id}>\r\n\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\tsmall\r\n\t\t\t\t\tid={reply.author.id}\r\n\t\t\t\t\tname={reply.author.name}\r\n\t\t\t\t\tavatar={reply.author.avatar} />\r\n\t\t\t\t<Link\r\n\t\t\t\t\tclassName=\"reply-age\"\r\n\t\t\t\t\tto={`/community/forums/thread/${thread.id}?reply=${reply.id}`}>\r\n\t\t\t\t\t<Time millisec={Date.now() - reply.postDate} />\r\n\t\t\t\t\t{` ago`}\r\n\t\t\t\t</Link>\r\n\t\t\t</div>\r\n\t\t));\r\n\r\n\t\treturn (\r\n\t\t\t<div className={`thread ${thread.deleted ? \"deleted\" : \"\"}`} key={thread.id}>\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={thread}\r\n\t\t\t\t\titemType=\"thread\"\r\n\t\t\t\t\titemHolder={boardInfo}\r\n\t\t\t\t\tsetItemHolder={setBoardInfo}\r\n\t\t\t\t\titemKey=\"threads\" />\r\n\t\t\t\t<div className=\"thread-info\">\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tclassName=\"thread-title\"\r\n\t\t\t\t\t\tto={`/community/forums/thread/${thread.id}`}>\r\n\t\t\t\t\t\t{thread.locked &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{thread.pinned &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-thumbtack\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{thread.title}\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={thread.author.id}\r\n\t\t\t\t\t\tavatar={thread.author.avatar}\r\n\t\t\t\t\t\tname={thread.author.name}\r\n\t\t\t\t\t\tgroups={thread.author.groups} />\r\n\t\t\t\t\t<div className=\"counts\">\r\n\t\t\t\t\t\t<ViewsAndReplies\r\n\t\t\t\t\t\t\tviewCount={thread.viewCount || 0}\r\n\t\t\t\t\t\t\treplyCount={thread.replyCount || 0} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-column\">\r\n\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\tPost Date\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"column-content\">\r\n\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t<Time millisec={Date.now() - thread.postDate} />\r\n\t\t\t\t\t\t\t{` ago`}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-column three\">\r\n\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\tRecent Replies\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className={`column-content ${recentReplies.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t{recentReplies.length == 0 &&\r\n\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\tNo replies yet\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{recentReplies}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tif (redirect)\r\n\t\treturn <Redirect to={redirect} />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tconst threads = boardInfo.threads.map(threadRowsMap);\r\n\tconst pinnedThreads = boardInfo.pinnedThreads.map(threadRowsMap);\r\n\r\n\treturn (\r\n\t\t<div className=\"board-wrapper\">\r\n\t\t\t<CreateThreadModal\r\n\t\t\t\tboardId={boardId}\r\n\t\t\t\tshow={showCreateModal}\r\n\t\t\t\tsetShow={setShowCreateModal}\r\n\t\t\t\tthreadTitle={newThreadTitle}\r\n\t\t\t\tsetThreadTitle={setNewThreadTitle}\r\n\t\t\t\tthreadContent={newThreadContent}\r\n\t\t\t\tsetThreadContent={setNewThreadContent}\r\n\t\t\t\tsetRedirect={setRedirect} />\r\n\t\t\t<div className=\"board-info\">\r\n\t\t\t\t<div className=\"board-title-wrapper\">\r\n\t\t\t\t\t<i className={`fas fa-${boardInfo.icon || \"comments\"} board-icon`} />\r\n\t\t\t\t\t<div className=\"board-title\">\r\n\t\t\t\t\t\t{boardInfo.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"create-thread btn btn-theme\"\r\n\t\t\t\t\tonClick={onCreateThreadClick}\r\n\t\t\t\t\tdisabled={!user.perms.createThread}>\r\n\t\t\t\t\t<i className=\"fas fa-plus\" />\r\n\t\t\t\t\tCreate Thread\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{pinnedThreads.length > 0 &&\r\n\t\t\t\t<div className=\"threads pinned-threads span-panel\">\r\n\t\t\t\t\t{pinnedThreads}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t<PageNav\r\n\t\t\t\tinverted\r\n\t\t\t\tpage={boardPage}\r\n\t\t\t\tonNav={onBoardPageNav} />\r\n\t\t\t<div className=\"threads span-panel\">\r\n\t\t\t\t{threads.length > 0 &&\r\n\t\t\t\t\tthreads\r\n\t\t\t\t}\r\n\t\t\t\t{threads.length == 0 &&\r\n\t\t\t\t\t\"No threads yet\"\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<PageNav\r\n\t\t\t\tinverted\r\n\t\t\t\tpage={boardPage}\r\n\t\t\t\tonNav={onBoardPageNav} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction CreateThreadModal(props) {\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst header = \"Create Thread\";\r\n\r\n\tconst content = (\r\n\t\t<div className=\"form\">\r\n\t\t\t<div className=\"field-wrapper thread-title\">\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tTitle\r\n\t\t\t\t</div>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={props.threadTitle}\r\n\t\t\t\t\tonChange={onTitleChange} />\r\n\t\t\t</div>\r\n\t\t\t<TextEditor\r\n\t\t\t\tvalue={props.threadContent}\r\n\t\t\t\tonChange={props.setThreadContent} />\r\n\t\t</div>\r\n\t);\r\n\r\n\tconst footer = (\r\n\t\t<div className=\"control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"post btn btn-theme\"\r\n\t\t\t\tonClick={onPostThread}>\r\n\t\t\t\tPost\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={onCancel}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tfunction onTitleChange(e) {\r\n\t\tprops.setThreadTitle(e.target.value);\r\n\t}\r\n\r\n\tfunction onCancel() {\r\n\t\tprops.setShow(false);\r\n\t}\r\n\r\n\tfunction onPostThread() {\r\n\t\taxios.post(\"/forums/thread\", {\r\n\t\t\tboard: props.boardId,\r\n\t\t\ttitle: props.threadTitle,\r\n\t\t\tcontent: props.threadContent\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tprops.setShow(false);\r\n\t\t\t\tprops.setRedirect(`/community/forums/thread/${res.data}`);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\tclassName=\"create-thread\"\r\n\t\t\tshow={props.show}\r\n\t\t\tonBgClick={onCancel}\r\n\t\t\theader={header}\r\n\t\t\tcontent={content}\r\n\t\t\tfooter={footer} />\r\n\t);\r\n}","import React, { useState, useEffect, useRef, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Redirect, Link, useParams, useLocation } from \"react-router-dom\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { VoteWidget } from \"./Forums\";\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Time, filterProfanity } from \"../../../components/Basic\";\r\nimport { PageNav } from \"../../../components/Nav\";\r\nimport { TextEditor } from \"../../../components/Form\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nexport default function Thread(props) {\r\n\tconst [threadInfo, setThreadInfo] = useState({});\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [redirect, setRedirect] = useState();\r\n\tconst [showReplyForm, setShowReplyForm] = useState(false);\r\n\tconst [replyContent, setReplyContent] = useState(\"\");\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [scrolled, setScrolled] = useState(false);\r\n\r\n\tconst replyFormRef = useRef();\r\n\tconst { threadId } = useParams();\r\n\tconst location = useLocation();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tconst params = new URLSearchParams(location.search);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Forums | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.get(`/forums/thread/${threadId}?reply=${params.get(\"reply\") || \"\"}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tres.data.content = filterProfanity(res.data.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tfor (let reply of res.data.replies)\r\n\t\t\t\t\treply.content = filterProfanity(reply.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tsetThreadInfo(res.data);\r\n\t\t\t\tsetPage(res.data.page);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"thread\",\r\n\t\t\t\t\tboardId: res.data.board.id,\r\n\t\t\t\t\tboardName: res.data.board.name,\r\n\t\t\t\t\tthreadId: res.data.id,\r\n\t\t\t\t\tthreadTitle: res.data.title\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t\tsetRedirect(\"/community/forums\");\r\n\t\t\t});\r\n\t}, [threadId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (loaded) {\r\n\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\taction: \"boardAndThread\",\r\n\t\t\t\tboardId: threadInfo.board.id,\r\n\t\t\t\tboardName: threadInfo.board.name,\r\n\t\t\t\tthreadId: threadInfo.id,\r\n\t\t\t\tthreadTitle: threadInfo.title\r\n\t\t\t});\r\n\r\n\t\t\tif (scrolled || !params.get(\"reply\"))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar reply = document.getElementById(`reply-${params.get(\"reply\")}`);\r\n\t\t\tsetScrolled(true);\r\n\r\n\t\t\tif (reply)\r\n\t\t\t\treply.scrollIntoView();\r\n\t\t}\r\n\t}, [loaded, threadInfo]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (showReplyForm)\r\n\t\t\treplyFormRef.current.scrollIntoView();\r\n\t}, [showReplyForm]);\r\n\r\n\tfunction onReplyClick(reply) {\r\n\t\tif (threadInfo.locked && !user.perms.postInLocked)\r\n\t\t\treturn;\r\n\r\n\t\tsetShowReplyForm(true);\r\n\r\n\t\tif (reply) {\r\n\t\t\tvar newContent = `${replyContent}\\n\\n> ##### @${reply.author.name}:\\n`;\r\n\t\t\tvar quotedContent = reply.content.split(\"\\n\");\r\n\r\n\t\t\tfor (let i = 0; i < quotedContent.length; i++)\r\n\t\t\t\tquotedContent[i] = `> ${quotedContent[i]}`;\r\n\r\n\t\t\tnewContent = `${newContent}${quotedContent.join(\"\\n\")}\\n\\n`;\r\n\t\t\tsetReplyContent(newContent);\r\n\t\t}\r\n\r\n\t\tif (showReplyForm)\r\n\t\t\treplyFormRef.current.scrollIntoView();\r\n\t}\r\n\r\n\tfunction onPostReply() {\r\n\t\taxios.post(`/forums/reply`, {\r\n\t\t\tthread: threadInfo.id,\r\n\t\t\tcontent: replyContent\r\n\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tonThreadPageNav(Number(res.data));\r\n\t\t\t\tsetReplyContent(\"\");\r\n\t\t\t\tsetShowReplyForm(false);\r\n\r\n\t\t\t\tdocument.body.scrollTop = document.body.scrollHeight;\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostCancel() {\r\n\t\tsetShowReplyForm(false);\r\n\t\tsetReplyContent(\"\");\r\n\t}\r\n\r\n\tfunction onThreadPageNav(page) {\r\n\t\taxios.get(`/forums/thread/${threadId}?page=${page}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tres.data.content = filterProfanity(res.data.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tfor (let reply of res.data.replies)\r\n\t\t\t\t\treply.content = filterProfanity(reply.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tsetPage(page);\r\n\t\t\t\tsetThreadInfo(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onThreadDeleted() {\r\n\t\tsetRedirect(`/community/forums/board/${threadInfo.board.id}`);\r\n\t}\r\n\r\n\tfunction onNotifyToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\treplyNotify: {\r\n\t\t\t\t$set: !threadInfo.replyNotify\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tfunction onPinToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\tpinned: {\r\n\t\t\t\t$set: !threadInfo.pinned\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tfunction onLockToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\tlocked: {\r\n\t\t\t\t$set: !threadInfo.locked\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tif (redirect)\r\n\t\treturn <Redirect to={redirect} />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tconst replies = threadInfo.replies.map(reply => (\r\n\t\t<Post\r\n\t\t\tclassName={`reply ${reply.id == params.get(\"reply\") ? \"sel\" : \"\"}`}\r\n\t\t\tid={`reply-${reply.id}`}\r\n\t\t\tkey={reply.id}\r\n\t\t\tpostInfo={reply}\r\n\t\t\titemType=\"reply\"\r\n\t\t\tvoteItem={reply}\r\n\t\t\tvoteItemHolder={threadInfo}\r\n\t\t\tsetVoteItemHolder={setThreadInfo}\r\n\t\t\titemKey=\"replies\"\r\n\t\t\tlocked={threadInfo.locked}\r\n\t\t\tpermaLink={`/community/forums/thread/${threadId}?reply=${reply.id}`}\r\n\t\t\tonReplyClick={() => onReplyClick(reply)}\r\n\t\t\tonDelete={() => onThreadPageNav(page)}\r\n\t\t\tonRestore={() => onThreadPageNav(page)}\r\n\t\t\tonEdit={() => onThreadPageNav(page)} />\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"thread-wrapper\">\r\n\t\t\t<Post\r\n\t\t\t\tpostInfo={threadInfo}\r\n\t\t\t\titemType=\"thread\"\r\n\t\t\t\tvoteItem={threadInfo}\r\n\t\t\t\tsetVoteItemHolder={setThreadInfo}\r\n\t\t\t\tlocked={threadInfo.locked}\r\n\t\t\t\tonReplyClick={() => onReplyClick()}\r\n\t\t\t\tonDelete={onThreadDeleted}\r\n\t\t\t\tonRestore={() => onThreadPageNav(page)}\r\n\t\t\t\tonEdit={() => onThreadPageNav(page)}\r\n\t\t\t\tonNotifyToggled={onNotifyToggled}\r\n\t\t\t\tonPinToggled={onPinToggled}\r\n\t\t\t\tonLockToggled={onLockToggled}\r\n\t\t\t\thasTitle />\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"reply-form-wrapper\"\r\n\t\t\t\tref={replyFormRef}>\r\n\t\t\t\t{showReplyForm &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"reply-form span-panel\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={replyContent}\r\n\t\t\t\t\t\t\tonChange={setReplyContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onPostReply}>\r\n\t\t\t\t\t\t\t\tPost\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onPostCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"replies-wrapper\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tmaxPage={threadInfo.pageCount}\r\n\t\t\t\t\tonNav={onThreadPageNav} />\r\n\t\t\t\t<div className=\"replies\">\r\n\t\t\t\t\t{replies.length == 0 &&\r\n\t\t\t\t\t\t\"No replies yet\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{replies}\r\n\t\t\t\t</div>\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tmaxPage={threadInfo.pageCount}\r\n\t\t\t\t\tonNav={onThreadPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Post(props) {\r\n\tconst id = props.id;\r\n\tconst postInfo = props.postInfo;\r\n\tconst itemType = props.itemType;\r\n\tconst voteItem = props.voteItem;\r\n\tconst voteItemHolder = props.voteItemHolder;\r\n\tconst setVoteItemHolder = props.setVoteItemHolder;\r\n\tconst itemKey = props.itemKey;\r\n\tconst hasTitle = props.hasTitle;\r\n\tconst permaLink = props.permaLink;\r\n\tconst locked = props.locked;\r\n\tconst onReplyClick = props.onReplyClick;\r\n\tconst onDelete = props.onDelete;\r\n\tconst onRestore = props.onRestore;\r\n\tconst onEdit = props.onEdit;\r\n\tconst onNotifyToggled = props.onNotifyToggled;\r\n\tconst onPinToggled = props.onPinToggled;\r\n\tconst onLockToggled = props.onLockToggled;\r\n\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [editContent, setEditContent] = useState(postInfo.content);\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete this?\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(`/forums/${itemType}/delete`, { [itemType]: postInfo.id })\r\n\t\t\t.then(onDelete)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRestoreClick() {\r\n\t\taxios.post(`/forums/${itemType}/restore`, { [itemType]: postInfo.id })\r\n\t\t\t.then(onRestore)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onEditClick() {\r\n\t\tsetEditing(true);\r\n\t}\r\n\r\n\tfunction onEditSave() {\r\n\t\taxios.post(`/forums/${itemType}/edit`, {\r\n\t\t\t[itemType]: postInfo.id,\r\n\t\t\tcontent: editContent\r\n\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tsetEditing(false);\r\n\t\t\t\tonEdit();\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onEditCancel() {\r\n\t\tsetEditing(false);\r\n\t}\r\n\r\n\tfunction onPermaLinkClick() {\r\n\t\tnavigator.clipboard.writeText(window.location.origin + permaLink);\r\n\t}\r\n\r\n\tfunction onNotifyClick() {\r\n\t\taxios.post(`/forums/thread/notify`, { thread: postInfo.id })\r\n\t\t\t.then(onNotifyToggled)\r\n\t\t\t.catch(() => { });\r\n\t}\r\n\r\n\tfunction onTogglePinnedClick() {\r\n\t\taxios.post(`/forums/thread/togglePinned`, { thread: postInfo.id })\r\n\t\t\t.then(onPinToggled)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onToggleLockedClick() {\r\n\t\taxios.post(`/forums/thread/toggleLocked`, { thread: postInfo.id })\r\n\t\t\t.then(onLockToggled)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tvar content = postInfo.content;\r\n\r\n\tif (postInfo.deleted && user.settings.hideDeleted)\r\n\t\tcontent = \"*deleted*\";\r\n\r\n\treturn (\r\n\t\t<div className={`post span-panel ${postInfo.deleted ? \"deleted\" : \"\"} ${props.className}`} id={id}>\r\n\t\t\t<div className=\"vote-wrapper\">\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={voteItem}\r\n\t\t\t\t\titemType={itemType}\r\n\t\t\t\t\titemHolder={voteItemHolder}\r\n\t\t\t\t\tsetItemHolder={setVoteItemHolder}\r\n\t\t\t\t\titemKey={itemKey} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"main-wrapper\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t<div className=\"heading-left\">\r\n\t\t\t\t\t\t{hasTitle &&\r\n\t\t\t\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t\t\t\t{locked &&\r\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{postInfo.pinned &&\r\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-thumbtack\" />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{postInfo.title}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"post-info\">\r\n\t\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\t\tid={postInfo.author.id}\r\n\t\t\t\t\t\t\t\tname={postInfo.author.name}\r\n\t\t\t\t\t\t\t\tavatar={postInfo.author.avatar}\r\n\t\t\t\t\t\t\t\tgroups={postInfo.author.groups} />\r\n\t\t\t\t\t\t\t<div className=\"post-date\">\r\n\t\t\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\t\t\tmillisec={Date.now() - postInfo.postDate} />\r\n\t\t\t\t\t\t\t\t{\" ago\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"btns-wrapper\">\r\n\t\t\t\t\t\t{!postInfo.deleted &&\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && user.perms.pinThreads &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fas fa-thumbtack ${postInfo.pinned ? \"fa-rotate-180\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onTogglePinnedClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && user.perms.lockThreads &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fas fa-lock${postInfo.locked ? \"-open\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onToggleLockedClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{(user.perms.deleteAnyPost || (user.perms.deleteOwnPost && postInfo.author.id == user.id)) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"fas fa-trash\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onDeleteClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{user.perms.editPost && postInfo.author.id == user.id && (!locked || user.perms.postInLocked) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"fas fa-pencil-alt\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onEditClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && postInfo.author.id == user.id &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fa${postInfo.replyNotify ? \"s\" : \"r\"} fa-bell`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onNotifyClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{permaLink &&\r\n\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\tto={permaLink}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => onPermaLinkClick()}>\r\n\t\t\t\t\t\t\t\t\t\t<i className=\"fas fa-link\" />\r\n\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{user.perms.postReply && (!locked || user.perms.postInLocked) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"reply-btn fas fa-reply\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onReplyClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{postInfo.deleted && user.perms.restoreDeleted &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash-restore\"\r\n\t\t\t\t\t\t\t\tonClick={onRestoreClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{!editing &&\r\n\t\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t\t<ReactMarkdown source={content} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{editing &&\r\n\t\t\t\t\t<div className=\"edit-wrapper\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={editContent}\r\n\t\t\t\t\t\t\tonChange={setEditContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onEditSave}>\r\n\t\t\t\t\t\t\t\tSave\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-third\"\r\n\t\t\t\t\t\t\t\tonClick={onEditCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useReducer, useContext } from \"react\";\r\nimport { NavLink, Switch, Route, Redirect, useParams, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport Categories from \"./Categories\";\r\nimport Board from \"./Board\";\r\nimport Thread from \"./Thread\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nimport \"../../../css/forums.css\";\r\n\r\nexport default function Forums() {\r\n\tconst [forumNavInfo, updateForumNavInfo] = useForumNavInfo();\r\n\r\n\treturn (\r\n\t\t<div className=\"forums\">\r\n\t\t\t<ForumNav forumNavInfo={forumNavInfo} />\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route exact path=\"/community/forums\" render={() => <Categories updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route exact path=\"/community/forums/board/:boardId\" render={() => <Board updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route exact path=\"/community/forums/thread/:threadId\" render={() => <Thread updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route render={() => <Redirect to=\"/community/forums\" />} />\r\n\t\t\t</Switch>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ForumNav(props) {\r\n\tconst forumNavInfo = props.forumNavInfo;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel\">\r\n\t\t\t<div className=\"forum-nav\">\r\n\t\t\t\t<div className=\"path\">\r\n\t\t\t\t\t<NavLink to=\"/community/forums\">\r\n\t\t\t\t\t\t<i className=\"fas fa-home home\" />\r\n\t\t\t\t\t\tForums\r\n\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t{forumNavInfo.board &&\r\n\t\t\t\t\t\t<NavLink to={`/community/forums/board/${forumNavInfo.board.id}`}>\r\n\t\t\t\t\t\t\t<i className=\"fas fa-chevron-right separator\" />\r\n\t\t\t\t\t\t\t{forumNavInfo.board.name}\r\n\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{forumNavInfo.thread &&\r\n\t\t\t\t\t\t<NavLink to={`/community/forums/thread/${forumNavInfo.thread.id}`}>\r\n\t\t\t\t\t\t\t<i className=\"fas fa-chevron-right separator\" />\r\n\t\t\t\t\t\t\t{forumNavInfo.thread.title}\r\n\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction useForumNavInfo() {\r\n\treturn useReducer((info, action) => {\r\n\t\tvar newInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"board\":\r\n\t\t\t\tnewInfo = {\r\n\t\t\t\t\tboard: {\r\n\t\t\t\t\t\tid: action.id,\r\n\t\t\t\t\t\tname: action.name\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"thread\":\r\n\t\t\t\tnewInfo = {\r\n\t\t\t\t\tboard: {\r\n\t\t\t\t\t\tid: action.boardId,\r\n\t\t\t\t\t\tname: action.boardName\r\n\t\t\t\t\t},\r\n\t\t\t\t\tthread: {\r\n\t\t\t\t\t\tid: action.threadId,\r\n\t\t\t\t\t\ttitle: action.threadTitle\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"home\":\r\n\t\t\t\tnewInfo = {};\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newInfo || info;\r\n\t}, {});\r\n}\r\n\r\nexport function VoteWidget(props) {\r\n\tconst item = props.item;\r\n\tconst itemType = props.itemType;\r\n\tconst itemHolder = props.itemHolder;\r\n\tconst setItemHolder = props.setItemHolder;\r\n\tconst itemKey = props.itemKey;\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction updateItemVoteCount(direction, newDirection) {\r\n\t\tvar voteCount = item.voteCount;\r\n\r\n\t\tif (item.vote == 0)\r\n\t\t\tvoteCount += direction;\r\n\t\telse if (item.vote == direction)\r\n\t\t\tvoteCount += -1 * direction;\r\n\t\telse\r\n\t\t\tvoteCount += 2 * direction;\r\n\r\n\t\treturn update(item, {\r\n\t\t\tvote: {\r\n\t\t\t\t$set: newDirection\r\n\t\t\t},\r\n\t\t\tvoteCount: {\r\n\t\t\t\t$set: voteCount\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onVote(itemId, direction) {\r\n\t\tif (!user.perms.vote)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/forums/vote\", {\r\n\t\t\titem: itemId,\r\n\t\t\titemType,\r\n\t\t\tdirection\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar newDirection = Number(res.data);\r\n\t\t\t\tvar newItem = updateItemVoteCount(direction, newDirection);\r\n\t\t\t\tvar items;\r\n\r\n\t\t\t\tif (itemHolder == null) {\r\n\t\t\t\t\tsetItemHolder(newItem);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (itemKey)\r\n\t\t\t\t\titems = itemHolder[itemKey];\r\n\t\t\t\telse\r\n\t\t\t\t\titems = itemHolder;\r\n\r\n\t\t\t\tfor (let i in items) {\r\n\t\t\t\t\tif (items[i].id == itemId) {\r\n\t\t\t\t\t\tvar newItems = items.slice();\r\n\t\t\t\t\t\tnewItems[i] = newItem;\r\n\r\n\t\t\t\t\t\tif (itemKey) {\r\n\t\t\t\t\t\t\tsetItemHolder(update(itemHolder, {\r\n\t\t\t\t\t\t\t\t[itemKey]: {\r\n\t\t\t\t\t\t\t\t\t$set: newItems\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tsetItemHolder(newItems);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"vote-widget\">\r\n\t\t\t<i\r\n\t\t\t\tclassName={`fas fa-arrow-up ${item.vote == 1 && \"sel\"}`}\r\n\t\t\t\tonClick={() => onVote(item.id, 1)} />\r\n\t\t\t{item.voteCount || 0}\r\n\t\t\t<i className={`fas fa-arrow-down ${item.vote == -1 && \"sel\"}`}\r\n\t\t\t\tonClick={() => onVote(item.id, -1)} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ViewsAndReplies(props) {\r\n\tconst viewCount = props.viewCount;\r\n\tconst replyCount = props.replyCount;\r\n\r\n\tconst viewsPlural = viewCount != 1;\r\n\tconst repliesPlural = replyCount != 1;\r\n\r\n\treturn `${viewCount} view${viewsPlural ? \"s\" : \"\"}, ${replyCount} repl${repliesPlural ? \"ies\" : \"y\"}`;\r\n}","import React, { useState, useContext, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { VoteWidget } from \"./Forums/Forums\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\nimport { Time, filterProfanity } from \"../../components/Basic\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { TextEditor } from \"../../components/Form\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport LoadingPage from \"../Loading\";\r\n\r\nimport \"../../css/forums.css\";\r\nimport \"../../css/comments.css\";\r\n\r\nexport default function Comments(props) {\r\n\tconst location = props.location;\r\n\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [comments, setComments] = useState([]);\r\n\tconst [showInput, setShowInput] = useState(false);\r\n\tconst [postContent, setPostContent] = useState(\"\");\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tsetComments([]);\r\n\t\tonCommentsPageNav(1);\r\n\t}, [location]);\r\n\r\n\tfunction onCommentsPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, comments, \"date\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/comment?location=${location}&${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tfor (let comment of res.data)\r\n\t\t\t\t\t\tcomment.content = filterProfanity(comment.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\t\tsetComments(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostSubmit() {\r\n\t\taxios.post(\"/comment\", { content: postContent, location })\r\n\t\t\t.then(() => {\r\n\t\t\t\tonCommentsPageNav(1);\r\n\t\t\t\tsetPostContent(\"\");\r\n\t\t\t\tsetShowInput(false);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostCancel() {\r\n\t\tsetShowInput(false);\r\n\t}\r\n\r\n\tconst commentRows = comments.map(comment => (\r\n\t\t<Comment\r\n\t\t\tlocation={location}\r\n\t\t\tcomment={comment}\r\n\t\t\tcomments={comments}\r\n\t\t\tsetComments={setComments}\r\n\t\t\tonDelete={() => onCommentsPageNav(page)}\r\n\t\t\tonRestore={() => onCommentsPageNav(page)}\r\n\t\t\tkey={comment.id} />\r\n\t));\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage className=\"under\" />;\r\n\r\n\treturn (\r\n\t\t<div className=\"comments-wrapper thread-wrapper\">\r\n\t\t\t<div className=\"comments-input-wrapper\">\r\n\t\t\t\t{!showInput && user.loggedIn && user.perms.postReply &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme\"\r\n\t\t\t\t\t\tonClick={() => setShowInput(true)}>\r\n\t\t\t\t\t\tPost Comment\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{showInput &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"reply-form span-panel\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={postContent}\r\n\t\t\t\t\t\t\tonChange={setPostContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onPostSubmit}>\r\n\t\t\t\t\t\t\t\tPost\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onPostCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"comments-page\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onCommentsPageNav} />\r\n\t\t\t\t{comments.length == 0 &&\r\n\t\t\t\t\t\"No comments yet\"\r\n\t\t\t\t}\r\n\t\t\t\t{commentRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onCommentsPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Comment(props) {\r\n\tconst location = props.location;\r\n\tconst comment = props.comment;\r\n\tconst comments = props.comments;\r\n\tconst setComments = props.setComments;\r\n\tconst onDelete = props.onDelete;\r\n\tconst onRestore = props.onRestore;\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete this?\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(`/comment/delete`, { comment: comment.id })\r\n\t\t\t.then(onDelete)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRestoreClick() {\r\n\t\taxios.post(`/comment/restore`, { comment: comment.id })\r\n\t\t\t.then(onRestore)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tvar content = comment.content;\r\n\r\n\tif (comment.deleted && user.settings.hideDeleted)\r\n\t\tcontent = \"*deleted*\";\r\n\r\n\treturn (\r\n\t\t<div className={`post ${comment.deleted ? \"deleted\" : \"\"} ${props.className || \"\"}`}>\r\n\t\t\t<div className=\"vote-wrapper\">\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={comment}\r\n\t\t\t\t\titemHolder={comments}\r\n\t\t\t\t\tsetItemHolder={setComments}\r\n\t\t\t\t\titemType=\"comment\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"main-wrapper\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t<div className=\"heading-left\">\r\n\t\t\t\t\t\t<div className=\"post-info\">\r\n\t\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\t\tid={comment.author.id}\r\n\t\t\t\t\t\t\t\tname={comment.author.name}\r\n\t\t\t\t\t\t\t\tavatar={comment.author.avatar}\r\n\t\t\t\t\t\t\t\tgroups={comment.author.groups} />\r\n\t\t\t\t\t\t\t<div className=\"post-date\">\r\n\t\t\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\t\t\tmillisec={Date.now() - comment.date} />\r\n\t\t\t\t\t\t\t\t{\" ago\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"btns-wrapper\">\r\n\t\t\t\t\t\t{!comment.deleted && (user.perms.deleteAnyPost \r\n\t\t\t\t\t\t\t\t|| (user.perms.deleteOwnPost && comment.author.id == user.id)\r\n\t\t\t\t\t\t\t\t|| (location == user.id)) &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash\"\r\n\t\t\t\t\t\t\t\tonClick={onDeleteClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{comment.deleted && user.perms.restoreDeleted &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash-restore\"\r\n\t\t\t\t\t\t\t\tonClick={onRestoreClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t<ReactMarkdown source={content} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useContext, useRef } from \"react\";\r\nimport { Link, Redirect, useLocation, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, PopoverContext, SiteInfoContext } from \"../../Contexts\"\r\nimport Setup from \"../../components/Setup\"\r\nimport { ButtonGroup, getPageNavFilterArg, PageNav, SubNav } from \"../../components/Nav\"\r\nimport { ItemList, Time, UserText } from \"../../components/Basic\"\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { camelCase } from \"../../utils\"\r\nimport LoadingPage from \"../Loading\";\r\nimport LandingPage from \"../Landing\";\r\nimport Comments from \"../Community/Comments\";\r\nimport { Lobbies } from \"../../Constants\";\r\n\r\nimport \"../../css/join.css\";\r\nimport { TopBarLink } from \"./Play\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\n\r\nexport default function Join(props) {\r\n    const defaultLobby = \"All\";\r\n\r\n    const [listType, setListType] = useState(\"All\");\r\n    const [page, setPage] = useState(1);\r\n    const [games, setGames] = useState([]);\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n\r\n    const user = useContext(UserContext);\r\n    const errorAlert = useErrorAlert();\r\n    const params = new URLSearchParams(location.search);\r\n    const [lobby, setLobby] = useState(params.get(\"lobby\") || localStorage.getItem(\"lobby\") || defaultLobby);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(\"lobby\", lobby);\r\n\r\n        if (params.get(\"lobby\") != lobby)\r\n            history.push(location.pathname + `?lobby=${lobby}`);\r\n\r\n        document.title = `Play (${lobby}) | BeyondMafia`;\r\n        getGameList(listType, 1);\r\n    }, [location.pathname, lobby]);\r\n\r\n    function getGameList(_listType, _page) {\r\n        var filterArg = getPageNavFilterArg(_page, page, games, \"endTime\");\r\n\r\n        if (filterArg == null)\r\n            return;\r\n\r\n        filterArg += `&page=${_page}`;\r\n        axios.get(`/game/list?list=${camelCase(_listType)}&lobby=${lobby}&${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length > 0 || _page == 1) {\r\n                    setListType(_listType);\r\n                    setPage(_page);\r\n                    setGames(res.data);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function lobbyNav(_lobby) {\r\n        setLobby(_lobby);\r\n\r\n        if (lobby == _lobby)\r\n            getGameList(listType, page);\r\n    }\r\n\r\n    if (lobby != \"All\" && Lobbies.indexOf(lobby) == -1)\r\n        setLobby(defaultLobby);\r\n\r\n    if (!user.loaded)\r\n        return <LoadingPage />;\r\n\r\n    if (user.loaded && !user.loggedIn)\r\n        return <LandingPage />;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"span-panel main join\">\r\n                <div className=\"left-panel\">\r\n\r\n                </div>\r\n                <div className=\"right-panel\">\r\n                    <div className=\"top-bar lobby-list\">\r\n                        <TopBarLink\r\n                            text=\"All\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"All\")} />\r\n                        <TopBarLink\r\n                            text=\"Main\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Main\")} />\r\n                        <TopBarLink\r\n                            text=\"Sandbox\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Sandbox\")} />\r\n                        <TopBarLink\r\n                            text=\"Competitive\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Competitive\")} />\r\n                        <TopBarLink\r\n                            text=\"Games\"\r\n                            sel={lobby}\r\n                            onClick={() => lobbyNav(\"Games\")} />\r\n                    </div>\r\n                    <ItemList\r\n                        className=\"games\"\r\n                        items={games}\r\n                        map={game => (\r\n                            <GameRow\r\n                                game={game}\r\n                                lobby={lobby}\r\n                                refresh={() => getGameList(listType, page)}\r\n                                odd={games.indexOf(game) % 2 == 1}\r\n                                key={game.id} />\r\n                        )}\r\n                        empty=\"No games\" />\r\n                    <PageNav\r\n                        page={page}\r\n                        onNav={(page) => getGameList(listType, page)} />\r\n                </div>\r\n            </div>\r\n            <div className=\"bottom-wrapper\">\r\n                <Comments\r\n                    location={lobby == \"Main\" || lobby == \"All\" ? \"lobby\" : `lobby-${lobby}`} />\r\n                <Announcements />\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport function GameRow(props) {\r\n    const [redirect, setRedirect] = useState(false);\r\n    const [reserved, setReserved] = useState(props.game.reserved);\r\n\r\n    const infoRef = useRef();\r\n    const user = useContext(UserContext);\r\n    const popover = useContext(PopoverContext);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    function onInfoClick(e) {\r\n        e.stopPropagation();\r\n        popover.onClick(\r\n            `/game/${props.game.id}/info`,\r\n            \"game\",\r\n            infoRef.current,\r\n            `Game ${props.game.id}`,\r\n        );\r\n    }\r\n\r\n    var linkPath, buttonText;\r\n    var buttonClass = \"btn \";\r\n\r\n    if (props.small)\r\n        buttonClass += \"btn-small \";\r\n\r\n    switch (props.game.status) {\r\n        case \"Open\":\r\n            linkPath = `/game/${props.game.id}`;\r\n            buttonClass += \"btn-join \";\r\n\r\n            if (props.game.scheduled <= Date.now())\r\n                buttonText = \"Join\";\r\n            break;\r\n        case \"In Progress\":\r\n            if (props.game.spectating || user.perms.canSpectateAny) {\r\n                linkPath = `/game/${props.game.id}`;\r\n                buttonClass += \"btn-spectate \";\r\n                buttonText = \"Spectate\";\r\n            }\r\n            else {\r\n                linkPath = \"/play\";\r\n                buttonClass += \"btn-in-progress \";\r\n                buttonText = \"In Progress\";\r\n            }\r\n            break;\r\n        case \"Finished\":\r\n            linkPath = `/game/${props.game.id}`;\r\n            buttonClass += \"btn-review \";\r\n            buttonText = \"Review\";\r\n            break;\r\n    }\r\n\r\n    function onRehostClick() {\r\n        var stateLengths = {};\r\n\r\n        for (let stateName in props.game.stateLengths)\r\n            stateLengths[stateName] = props.game.stateLengths[stateName] / 60000;\r\n\r\n        var lobby = props.lobby;\r\n\r\n        if (lobby == \"All\")\r\n            lobby = \"Main\";\r\n\r\n        axios.post(\"/game/host\", {\r\n            gameType: props.game.type,\r\n            setup: props.game.setup.id,\r\n            lobby: lobby,\r\n            guests: props.game.guests,\r\n            private: false,\r\n            ranked: props.game.ranked,\r\n            spectating: props.game.spectating,\r\n            voiceChat: props.game.voiceChat,\r\n            readyCheck: props.game.readyCheck,\r\n            stateLengths: stateLengths,\r\n            ...JSON.parse(props.game.gameTypeOptions)\r\n        })\r\n            .then(res => setRedirect(`/game/${res.data}`))\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onReserve() {\r\n        axios.post(\"/game/reserve\", { gameId: props.game.id })\r\n            .then(res => {\r\n                setReserved(!reserved);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onUnreserve() {\r\n        axios.post(\"/game/unreserve\", { gameId: props.game.id })\r\n            .then(res => {\r\n                setReserved(!reserved);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n    function onCancel() {\r\n        axios.post(\"/game/cancel\", { gameId: props.game.id })\r\n            .then(res => {\r\n                siteInfo.showAlert(res.data, \"success\");\r\n                props.refresh();\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    if (!props.game.setup)\r\n        return <></>;\r\n\r\n    return (\r\n        <div className={`row ${props.odd ? \"odd\" : \"\"} game-row`}>\r\n            {/* {!props.small && */}\r\n            <div className=\"btns-wrapper\">\r\n                {(user.loggedIn || props.status == \"Finished\") && !props.game.broken && !props.game.private &&\r\n                    <Link\r\n                        to={linkPath}\r\n                        className={buttonClass}\r\n                        disabled={props.status == \"In Progress\" && !props.game.spectating}>\r\n                        {buttonText}\r\n                    </Link>\r\n                }\r\n                {user.loggedIn && props.game.scheduled > Date.now() && !reserved &&\r\n                    <div\r\n                        className=\"btn btn-theme\"\r\n                        onClick={onReserve}>\r\n                        Reserve\r\n                    </div>\r\n                }\r\n                {user.loggedIn && props.game.scheduled > Date.now() && reserved &&\r\n                    <div\r\n                        className=\"btn btn-theme\"\r\n                        onClick={onUnreserve}>\r\n                        Unreserve\r\n                    </div>\r\n                }\r\n                {props.game.scheduled > Date.now() && user.id == props.game.hostId &&\r\n                    <div\r\n                        className=\"btn btn-theme-sec\"\r\n                        onClick={onCancel}>\r\n                        Cancel\r\n                    </div>\r\n                }\r\n                {props.game.broken &&\r\n                    <i className=\"fas fa-car-crash review-icon\" title=\"Broken\" />\r\n                }\r\n                {props.game.private &&\r\n                    <i className=\"fas fa-lock review-icon\" title=\"Private\" />\r\n                }\r\n            </div>\r\n            {/* } */}\r\n            <div className=\"player-count-wrapper\">\r\n                <PlayerCount game={props.game} />\r\n            </div>\r\n            <div className=\"setup-wrapper\">\r\n                <Setup\r\n                    setup={props.game.setup}\r\n                    maxRolesCount={props.small ? 3 : 5} />\r\n            </div>\r\n            {!props.small &&\r\n                <div className=\"setup-name\">\r\n                    {props.game.setup.name}\r\n                </div>\r\n            }\r\n            <div className=\"game-infos\">\r\n                {props.game.ranked &&\r\n                    <i\r\n                        className=\"ranked fas fa-chart-bar\"\r\n                        title=\"Ranked game\" />\r\n                }\r\n                {props.game.voiceChat &&\r\n                    <i\r\n                        className=\"voice-chat fas fa-microphone\"\r\n                        title=\"Voice chat game\" />\r\n                }\r\n                {props.game.status == \"Finished\" && user.loggedIn && !props.small &&\r\n                    <i\r\n                        className=\"rehost fas fa-redo\"\r\n                        title=\"Rehost\"\r\n                        onClick={onRehostClick} />\r\n                }\r\n                <i\r\n                    className=\"game-info fas fa-info-circle\"\r\n                    ref={infoRef}\r\n                    onClick={onInfoClick} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction PlayerCount(props) {\r\n    const game = props.game;\r\n    const circles = [];\r\n\r\n    for (let i = 0; i < game.setup.total; i++) {\r\n        circles.push(\r\n            <div\r\n                className={`player-circle ${i < game.players ? \"filled\" : \"\"}`}\r\n                key={i} />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"player-count\">\r\n            {circles}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Announcements() {\r\n    const [page, setPage] = useState(1);\r\n    const [announcements, setAnnouncements] = useState([]);\r\n\r\n    const errorAlert = useErrorAlert();\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        onPageNav(1);\r\n    }, []);\r\n\r\n    function onPageNav(_page) {\r\n        var filterArg = getPageNavFilterArg(_page, page, announcements, \"date\");\r\n\r\n        if (filterArg == null)\r\n            return;\r\n\r\n        axios.get(`/mod/announcements?${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length > 0) {\r\n                    setAnnouncements(res.data);\r\n                    setPage(_page);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const announcementRows = announcements.map(announcement => (\r\n        <div className=\"announcement\" key={announcement.id}>\r\n            <div className=\"top-row\">\r\n                <NameWithAvatar\r\n                    id={announcement.mod.id}\r\n                    name={announcement.mod.name}\r\n                    avatar={announcement.mod.avatar} />\r\n                <div className=\"date\">\r\n                    <Time\r\n                        minSec\r\n                        millisec={Date.now() - announcement.date}\r\n                        suffix=\" ago\" />\r\n                </div>\r\n            </div>\r\n            <div className=\"content\">\r\n                <UserText\r\n                    text={announcement.content}\r\n                    settings={user.settings}\r\n                    filterProfanity\r\n                    linkify\r\n                    emotify />\r\n            </div>\r\n        </div>\r\n    ));\r\n\r\n    return (\r\n        <div className=\"announcements box-panel\">\r\n            <div className=\"heading\">\r\n                Announcements\r\n            </div>\r\n            <PageNav\r\n                page={page}\r\n                onNav={onPageNav} />\r\n            {announcementRows}\r\n            <PageNav\r\n                page={page}\r\n                onNav={onPageNav} />\r\n        </div>\r\n    );\r\n} ","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useLocation, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../../Contexts\";\r\nimport { ButtonGroup, PageNav, SearchBar } from \"../../../components/Nav\";\r\nimport Setup from \"../../../components/Setup\";\r\nimport Form from \"../../../components/Form\";\r\nimport { ItemList, filterProfanity } from \"../../../components/Basic\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { camelCase } from \"../../../utils\";\r\n\r\nimport \"../../../css/host.css\";\r\nimport { TopBarLink } from \"../Play\";\r\n\r\nexport default function Host(props) {\r\n    const gameType = props.gameType;\r\n    const selSetup = props.selSetup;\r\n    const setSelSetup = props.setSelSetup;\r\n    const formFields = props.formFields;\r\n    const updateFormFields = props.updateFormFields;\r\n    const onHostGame = props.onHostGame;\r\n\r\n    const [listType, setListType] = useState(\"featured\");\r\n    const [page, setPage] = useState(1);\r\n    const [pageCount, setPageCount] = useState(1);\r\n    const [searchVal, setSearchVal] = useState(\"\");\r\n    const [setups, setSetups] = useState([]);\r\n\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n    const errorAlert = useErrorAlert();\r\n\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(location.search);\r\n\r\n        if (params.get(\"setup\")) {\r\n            getSetupList(\"id\", 1, params.get(\"setup\"));\r\n\r\n            axios.get(`/setup/${params.get(\"setup\")}`)\r\n                .then(res => {\r\n                    res.data.name = filterProfanity(res.data.name, user.settings);\r\n                    setSelSetup(res.data);\r\n                })\r\n                .catch(errorAlert);\r\n        }\r\n        else\r\n            getSetupList(listType, page)\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        updateFormFields({\r\n            ref: \"setup\",\r\n            prop: \"value\",\r\n            value: selSetup.name\r\n        });\r\n    }, [selSetup]);\r\n\r\n    function getSetupList(listType, page, query) {\r\n        axios.get(`/setup/${camelCase(listType)}?gameType=${props.gameType}&page=${page}&query=${query || \"\"}`)\r\n            .then(res => {\r\n                setListType(listType);\r\n                setPage(page);\r\n                setSetups(res.data.setups);\r\n                setPageCount(res.data.pages);\r\n            });\r\n    }\r\n\r\n    function onHostNavClick(listType) {\r\n        setSearchVal(\"\");\r\n        getSetupList(listType, 1);\r\n    }\r\n\r\n    function onSearchInput(query) {\r\n        setSearchVal(query);\r\n\r\n        if (query.length)\r\n            getSetupList(\"search\", 1, query);\r\n        else\r\n            getSetupList(\"featured\", 1);\r\n    }\r\n\r\n    function onPageNav(page) {\r\n        var args = [listType, page];\r\n\r\n        if (searchVal.length)\r\n            args.push(searchVal);\r\n\r\n        getSetupList(...args);\r\n    }\r\n\r\n    function onFavSetup(favSetup) {\r\n        axios.post(\"/setup/favorite\", { id: favSetup.id })\r\n            .catch(errorAlert);\r\n\r\n        var newSetups = [...setups];\r\n\r\n        for (let i in setups) {\r\n            if (setups[i].id == favSetup.id) {\r\n                newSetups[i].favorite = !setups[i].favorite;\r\n                break;\r\n            }\r\n        }\r\n\r\n        setSetups(newSetups);\r\n    }\r\n\r\n    function onEditSetup(setup) {\r\n        history.push(`/play/create?edit=${setup.id}`);\r\n    }\r\n\r\n    function onDelSetup(setup) {\r\n        axios.post(\"/setup/delete\", { id: setup.id })\r\n            .then(() => {\r\n                getSetupList(listType, page);\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const hostButtonLabels = [\"Featured\", \"Popular\", \"Ranked\", \"Favorites\", \"Yours\"];\r\n    const hostButtons = hostButtonLabels.map(label => (\r\n        <TopBarLink\r\n            text={label}\r\n            sel={listType}\r\n            onClick={() => onHostNavClick(label)}\r\n            key={label} />\r\n    ));\r\n\r\n    return (\r\n        <div className=\"span-panel main host\">\r\n            <div className=\"top-bar\">\r\n                {hostButtons}\r\n                <SearchBar value={searchVal} placeholder=\"Setup Name\" onInput={onSearchInput} />\r\n            </div>\r\n            <ItemList\r\n                items={setups}\r\n                map={setup => (\r\n                    <SetupRow\r\n                        setup={setup}\r\n                        sel={selSetup}\r\n                        listType={listType}\r\n                        onSelect={setSelSetup}\r\n                        onFav={onFavSetup}\r\n                        onEdit={onEditSetup}\r\n                        onDel={onDelSetup}\r\n                        odd={setups.indexOf(setup) % 2 == 1}\r\n                        key={setup.id} />\r\n                )}\r\n                empty=\"No setups\" />\r\n            <PageNav\r\n                page={page}\r\n                maxPage={pageCount}\r\n                onNav={onPageNav} />\r\n            {user.loggedIn &&\r\n                <Form\r\n                    fields={formFields}\r\n                    onChange={updateFormFields}\r\n                    submitText=\"Host\"\r\n                    onSubmit={onHostGame} />\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nfunction SetupRow(props) {\r\n    const user = useContext(UserContext);\r\n\r\n    let selIconFormat = \"far\";\r\n    let favIconFormat = \"far\";\r\n\r\n    if (props.sel.id == props.setup.id)\r\n        selIconFormat = \"fas\";\r\n\r\n    if (props.setup.favorite)\r\n        favIconFormat = \"fas\";\r\n\r\n    return (\r\n        <div className={`row ${props.odd ? \"odd\" : \"\"}`}>\r\n            {user.loggedIn &&\r\n                <i\r\n                    className={`select-setup fa-circle ${selIconFormat}`}\r\n                    onClick={() => props.onSelect(props.setup)} />\r\n            }\r\n            <div className=\"setup-wrapper\">\r\n                <Setup setup={props.setup} />\r\n            </div>\r\n            <div className=\"setup-name\">\r\n                {props.setup.name}\r\n            </div>\r\n            {user.loggedIn &&\r\n                <i\r\n                    className={`setup-btn fav-setup fa-star ${favIconFormat}`}\r\n                    onClick={() => props.onFav(props.setup)} />\r\n            }\r\n            {user.loggedIn && props.listType == \"Yours\" &&\r\n                <i\r\n                    className={`setup-btn edit-setup fa-pen-square fas`}\r\n                    onClick={() => props.onEdit(props.setup)} />\r\n            }\r\n            {user.loggedIn && props.listType == \"Yours\" &&\r\n                <i\r\n                    className={`setup-btn del-setup fa-times-circle fas`}\r\n                    onClick={() => props.onDel(props.setup)} />\r\n            }\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostMafia() {\r\n    const gameType = \"Mafia\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n\r\n    const defaults = JSON.parse(localStorage.getItem(\"mafiaHostOptions\") || null) ||\r\n        { private: false, guests: false, ranked: false, spectating: false, voiceChat: false, scheduled: false, readyCheck: false, dayLength: 10, nightLength: 2, extendLength: 3 };\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\",\r\n            value: defaults.private,\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\",\r\n            value: defaults.guests,\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Ranked\",\r\n            ref: \"ranked\",\r\n            type: \"boolean\",\r\n            value: defaults.ranked,\r\n            showIf: [\"!private\", \"!spectating\", \"!voiceChat\", \"!guests\"]\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\",\r\n            value: defaults.spectating,\r\n            showIf: \"!ranked\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\",\r\n        //     value: defaults.voiceChat,\r\n        //     showIf: \"!ranked\"\r\n        // },\r\n        // {\r\n        //     label: \"Scheduled\",\r\n        //     ref: \"scheduled\",\r\n        //     value: defaults.scheduled,\r\n        //     type: \"boolean\"\r\n        // },\r\n        // {\r\n        //     label: \"Start Date\",\r\n        //     ref: \"startDate\",\r\n        //     type: \"datetime-local\",\r\n        //     showIf: \"scheduled\",\r\n        //     value: Date.now() + (6 * 60 * 1000),\r\n        //     min: Date.now() + (6 * 60 * 1000),\r\n        //     max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        // },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            value: defaults.readyCheck,\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Day Length (minutes)\",\r\n            ref: \"dayLength\",\r\n            type: \"number\",\r\n            value: defaults.dayLength,\r\n            min: 1,\r\n            max: 30\r\n        },\r\n        {\r\n            label: \"Night Length (minutes)\",\r\n            ref: \"nightLength\",\r\n            type: \"number\",\r\n            value: defaults.nightLength,\r\n            min: 1,\r\n            max: 10\r\n        },\r\n        {\r\n            label: \"Extension Length (minutes)\",\r\n            ref: \"extendLength\",\r\n            type: \"number\",\r\n            value: defaults.extendLength,\r\n            min: 1,\r\n            max: 5\r\n        }\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Mafia | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        // var scheduled = getFormFieldValue(\"scheduled\");\r\n        var lobby = getFormFieldValue(\"lobby\");\r\n\r\n        if (lobby == \"All\")\r\n            lobby = \"Main\";\r\n\r\n        if (selSetup.id) {\r\n            axios.post(\"/game/host\", {\r\n                gameType,\r\n                lobby,\r\n                setup: selSetup.id,\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                ranked: getFormFieldValue(\"ranked\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                // scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Day\": getFormFieldValue(\"dayLength\"),\r\n                    \"Night\": getFormFieldValue(\"nightLength\")\r\n                },\r\n                extendLength: getFormFieldValue(\"extendLength\"),\r\n            })\r\n                .then(res => {\r\n                    // if (scheduled) {\r\n                    //     siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                    //     setRedirect(\"/\");\r\n                    // }\r\n                    // else\r\n                    setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n\r\n            defaults.private = getFormFieldValue(\"private\");\r\n            defaults.guests = getFormFieldValue(\"guests\");\r\n            defaults.ranked = getFormFieldValue(\"ranked\");\r\n            defaults.spectating = getFormFieldValue(\"spectating\");\r\n            // defaults.voiceChat = getFormFieldValue(\"voiceChat\");\r\n            // defaults.scheduled = getFormFieldValue(\"scheduled\");\r\n            defaults.readyCheck = getFormFieldValue(\"readyCheck\");\r\n            defaults.dayLength = getFormFieldValue(\"dayLength\");\r\n            defaults.nightLength = getFormFieldValue(\"nightLength\");\r\n            defaults.extendLength = getFormFieldValue(\"extendLength\");\r\n            localStorage.setItem(\"mafiaHostOptions\", JSON.stringify(defaults));\r\n        }\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useState, useEffect, useReducer, useContext } from \"react\";\r\nimport { Redirect, useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../../Contexts\";\r\nimport { RoleCount, RoleSearch } from \"../../../components/Roles\";\r\nimport Form from \"../../../components/Form\";\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nimport \"../../../css/createSetup.css\";\r\n\r\nexport default function CreateSetup(props) {\r\n\tconst gameType = props.gameType;\r\n\tconst formFields = props.formFields;\r\n\tconst updateFormFields = props.updateFormFields;\r\n\tconst closedField = props.closedField;\r\n\tconst resetFormFields = props.resetFormFields;\r\n\tconst formFieldValueMods = props.formFieldValueMods;\r\n\tconst onCreateSetup = props.onCreateSetup;\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [selRoleSet, setSelRoleSet] = useState(0);\r\n\tconst [redirect, setRedirect] = useState(\"\");\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [modifier, setModifier] = useState(\"None\");\r\n\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tconst [roleData, updateRoleData] = useReducer((roleData, action) => {\r\n\t\tvar newRoleData = { ...roleData };\r\n\r\n\t\tif (action.type != \"reset\" && action.type != \"setClosed\") {\r\n\t\t\tnewRoleData.roles = roleData.roles.slice();\r\n\r\n\t\t\tfor (let i in roleData.roles)\r\n\t\t\t\tnewRoleData.roles[i] = { ...roleData.roles[i] }\r\n\t\t}\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"reset\":\r\n\t\t\t\tnewRoleData.roles = [{}];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setClosed\":\r\n\t\t\t\tnewRoleData.closed = action.closed;\r\n\r\n\t\t\t\tif (action.closed)\r\n\t\t\t\t\tnewRoleData.roles = newRoleData.roles.slice(0, 1);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addRole\":\r\n\t\t\t\tvar roleSet = newRoleData.roles[selRoleSet];\r\n\r\n\t\t\t\tif (!roleSet[action.role])\r\n\t\t\t\t\troleSet[action.role] = 0;\r\n\r\n\t\t\t\troleSet[action.role]++;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeRole\":\r\n\t\t\t\tvar roleSet = newRoleData.roles[selRoleSet];\r\n\r\n\t\t\t\tif (roleSet[action.role])\r\n\t\t\t\t\troleSet[action.role]--;\r\n\r\n\t\t\t\tif (roleSet[action.role] < 1)\r\n\t\t\t\t\tdelete roleSet[action.role];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addRoleSet\":\r\n\t\t\t\tnewRoleData.roles.push({});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeRoleSet\":\r\n\t\t\t\tnewRoleData.roles.splice(action.index, 1);\r\n\r\n\t\t\t\tif (action.index == selRoleSet)\r\n\t\t\t\t\tsetSelRoleSet(0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setFromSetup\":\r\n\t\t\t\tnewRoleData.closed = action.closed;\r\n\t\t\t\tnewRoleData.roles = action.roles;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newRoleData;\r\n\t}, { roles: [{}], closed: false });\r\n\r\n\tconst user = useContext(UserContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdateRoleData({ type: \"setClosed\", closed: closedField.value });\r\n\t}, [closedField.value]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (params.get(\"edit\")) {\r\n\t\t\taxios.get(`/setup/${params.get(\"edit\")}`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tvar setup = res.data;\r\n\r\n\t\t\t\t\tsetEditing(true);\r\n\r\n\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\ttype: \"setFromSetup\",\r\n\t\t\t\t\t\troles: JSON.parse(setup.roles),\r\n\t\t\t\t\t\tclosed: setup.closed\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar formFieldChanges = [];\r\n\r\n\t\t\t\t\tfor (let field of formFields) {\r\n\t\t\t\t\t\tif (setup[field.ref]) {\r\n\t\t\t\t\t\t\tlet value = setup[field.ref];\r\n\r\n\t\t\t\t\t\t\tif (formFieldValueMods[field.ref])\r\n\t\t\t\t\t\t\t\tfor (let valueMod of formFieldValueMods[field.ref])\r\n\t\t\t\t\t\t\t\t\tvalue = valueMod(value);\r\n\r\n\t\t\t\t\t\t\tformFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: field.ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: value\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (setup.closed) {\r\n\t\t\t\t\t\tfor (let alignment in setup.count) {\r\n\t\t\t\t\t\t\tformFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: `count-${alignment}`,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: setup.count[alignment]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tupdateFormFields(formFieldChanges);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tfunction onAddRole(role) {\r\n\t\tupdateRoleData({\r\n\t\t\ttype: \"addRole\",\r\n\t\t\trole: `${role.name}:${modifier != \"None\" ? modifier : \"\"}`,\r\n\t\t\talignment: role.alignment\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onModifierChange(e) {\r\n\t\tvar modifier = e.target.value;\r\n\t\tsetModifier(modifier);\r\n\t}\r\n\r\n\tif (editing && !params.get(\"edit\")) {\r\n\t\tsetEditing(false);\r\n\t\tresetFormFields();\r\n\t\tupdateRoleData({ type: \"reset\" });\r\n\t}\r\n\r\n\tvar roleSets;\r\n\r\n\troleSets = roleData.roles.map((roleSet, i) => {\r\n\t\tlet roles = [];\r\n\r\n\t\tfor (let role in roleSet) {\r\n\t\t\troles.push(\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\trole={role}\r\n\t\t\t\t\tcount={roleSet[role]}\r\n\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\t\t\ttype: \"removeRole\",\r\n\t\t\t\t\t\t\t\trole: role\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkey={role} />\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<RoleSetRow\r\n\t\t\t\troles={roles}\r\n\t\t\t\tindex={i}\r\n\t\t\t\tsel={selRoleSet}\r\n\t\t\t\tonClick={() => setSelRoleSet(i)}\r\n\t\t\t\tonDelete={\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\t\ttype: \"removeRoleSet\",\r\n\t\t\t\t\t\t\tindex: i\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tkey={i} />\r\n\t\t);\r\n\t});\r\n\r\n\tvar modifiers = siteInfo.roles ? siteInfo.roles[\"Modifiers\"][gameType] : [];\r\n\r\n\tmodifiers = modifiers.map(modifier => (\r\n\t\t<option value={modifier} key={modifier}>\r\n\t\t\t{modifier}\r\n\t\t</option>\r\n\t));\r\n\r\n\tmodifiers.unshift((\r\n\t\t<option value=\"None\" key={\"None\"}>\r\n\t\t\tNone\r\n\t\t</option>\r\n\t));\r\n\r\n\tif ((params.get(\"edit\") && !editing))\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main create-setup\">\r\n\t\t\t<RoleSearch\r\n\t\t\t\tonAddClick={onAddRole}\r\n\t\t\t\tgameType={gameType} />\r\n\t\t\t{user.loggedIn &&\r\n\t\t\t\t(\r\n\t\t\t\t\t<div className=\"creation-options\">\r\n\t\t\t\t\t\t<Form\r\n\t\t\t\t\t\t\tfields={formFields}\r\n\t\t\t\t\t\t\tonChange={updateFormFields}\r\n\t\t\t\t\t\t\tsubmitText={editing ? \"Edit\" : \"Create\"}\r\n\t\t\t\t\t\t\tonSubmit={() => onCreateSetup(roleData, editing, setRedirect)} />\r\n\t\t\t\t\t\t<div className=\"rolesets-wrapper\">\r\n\t\t\t\t\t\t\t<div className=\"form\">\r\n\t\t\t\t\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t\t\t\tRole Modifier\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tvalue={modifier}\r\n\t\t\t\t\t\t\t\t\t\tonChange={onModifierChange}>\r\n\t\t\t\t\t\t\t\t\t\t{modifiers}\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"rolesets\">\r\n\t\t\t\t\t\t\t\t{roleSets}\r\n\t\t\t\t\t\t\t\t{!roleData.closed && roleData.roles.length < 10 &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"add-roleset fa-plus-circle fas\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => updateRoleData({ type: \"addRoleSet\" })} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\r\n\t\t\t}\r\n\t\t\t{redirect &&\r\n\t\t\t\t<Redirect to={`/play/host/?setup=${redirect}`} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction RoleSetRow(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`roleset ${props.sel == props.index ? \"sel\" : \"\"}`}\r\n\t\t\tonClick={props.onClick}>\r\n\t\t\t{props.roles}\r\n\t\t\t{props.index > 0 &&\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"del-roleset fa-times-circle fas\"\r\n\t\t\t\t\tonClick={props.onDelete} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateMafiaSetup() {\r\n\tconst gameType = \"Mafia\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Day Start\",\r\n\t\t\tref: \"startState\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Dawn\",\r\n\t\t\tref: \"dawn\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Last Wills\",\r\n\t\t\tref: \"lastWill\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Must Act\",\r\n\t\t\tref: \"mustAct\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"No Reveal\",\r\n\t\t\tref: \"noReveal\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Votes Invisible\",\r\n\t\t\tref: \"votesInvisible\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Village Count\",\r\n\t\t\tref: \"count-Village\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"7\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Mafia Count\",\r\n\t\t\tref: \"count-Mafia\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Monsters Count\",\r\n\t\t\tref: \"count-Monsters\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"0\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\r\n\tconst formFieldValueMods = {\r\n\t\tstartState: [\r\n\t\t\tvalue => value == \"Day\"\r\n\t\t]\r\n\t};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Mafia Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: formFields[1].value ? \"Day\" : \"Night\",\r\n\t\t\tdawn: formFields[2].value,\r\n\t\t\twhispers: formFields[3].value,\r\n\t\t\tleakPercentage: Number(formFields[4].value),\r\n\t\t\tlastWill: formFields[5].value,\r\n\t\t\tmustAct: formFields[6].value,\r\n\t\t\tnoReveal: formFields[7].value,\r\n\t\t\tvotesInvisible: formFields[8].value,\r\n\t\t\tunique: formFields[10].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Village\": Number(formFields[11].value),\r\n\t\t\t\t\"Mafia\": Number(formFields[12].value),\r\n\t\t\t\t\"Monsters\": Number(formFields[13].value),\r\n\t\t\t\t\"Independent\": Number(formFields[14].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[9]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\";\r\n\r\nexport default function LearnMafia(props) {\r\n\tconst gameType = \"Mafia\";\r\n\r\n\tvar items = [\r\n\t\t{\r\n\t\t\tname: \"Gun\",\r\n\t\t\ttext: \"Can be shot once during the day to kill a specific player.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Armor\",\r\n\t\t\ttext: \"Saves a player from being killed one time, not including being executed.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Bomb\",\r\n\t\t\ttext: \"When a player is killed while holding a bomb, the player who killed them will also die.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Crystal\",\r\n\t\t\ttext: \"The holder of the crystal can choose a person each night and if they die, their target's role will be revealed.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Knife\",\r\n\t\t\ttext: \"Can be used once during the day to stab a specific player, who will bleed out and die the following night.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Snowball\",\r\n\t\t\ttext: \"Can be used once during the day to freeze a specific player, who will be roleblocked the following night.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Key\",\r\n\t\t\ttext: \"Can be used once during the night to make the player untargetable. All actions on the player are cancelled\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Bread\",\r\n\t\t\ttext: \"Given out by the baker. Counts as 1 ration for each phase in a famine.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Yuzu Orange\",\r\n\t\t\ttext: \"Given out by the Capybara to invite players to relax at the hot springs. Counts as 1 ration for each phase in a famine.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Suit\",\r\n\t\t\ttext: \"Given by the tailor, a suit determines what role a user will appear as once dead.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Gasoline\",\r\n\t\t\ttext: \"Used by the arsonist to douse their victims in preparation for their ignition.\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Match\",\r\n\t\t\ttext: \"Used by the arsonist to ignite everyone doused with gasoline.\",\r\n\t\t},\r\n\t];\r\n\r\n\tvar mechanics = [\r\n\t\t{\r\n\t\t\tname: \"Whispers\",\r\n\t\t\ttext: \"Allow players to privately contact another player in the town meeting. If the whisper leaks then everyone will see it.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Last Wills\",\r\n\t\t\ttext: \"Allow players to write a message that will be revealed when they die.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Must Act\",\r\n\t\t\ttext: \"Players cannot select 'no one' for their actions.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"No Reveal\",\r\n\t\t\ttext: \"The roles of dead players are not revealed.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Closed Roles\",\r\n\t\t\ttext: \"Roles for each alignment are randomly chosen from the pool of roles in the setup.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Dawn\",\r\n\t\t\ttext: \"No actions can be taken the first night.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Full Moon\",\r\n\t\t\ttext: \"When a Lycan or Werewolf is present in the game, full moons will occur on odd nights.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Eclipse\",\r\n\t\t\ttext: \"Occurs during the day due to certain roles, making all votes and speech anonymous.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Famine\",\r\n\t\t\ttext: \"While active, each player consumes one item of food each day/night. Anyone who doesn't have food to consume dies.\"\r\n\t\t},\r\n\t];\r\n\r\n\tvar modifiers = [\r\n\t\t{\r\n\t\t\tname: \"Armed\",\r\n\t\t\ttext: \"Starts with a gun.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Armed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Explosive\",\r\n\t\t\ttext: \"Starts with a bomb.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Explosive\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Armored\",\r\n\t\t\ttext: \"Starts with armor.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Armored\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Exposed\",\r\n\t\t\ttext: \"Starts revealed to everyone.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Exposed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Chameleon\",\r\n\t\t\ttext: \"Appears as a Villager to investigative roles.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Chameleon\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Humble\",\r\n\t\t\ttext: \"Appears as Villager to self with no modifier.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Humble\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Scatterbrained\",\r\n\t\t\ttext: \"Appears as Visitor (if Village-aligned) or Trespasser (if Mafia-aligned) to self with no modifier.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Scatterbrained\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Lone\",\r\n\t\t\ttext: \"Does not attend the Mafia or Monsters meeting.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Lone\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Solitary\",\r\n\t\t\ttext: \"Does not attend the Cop or Templar meetings.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Solitary\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Delayed\",\r\n\t\t\ttext: \"Cannot attend secondary meetings for the first day and night.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Delayed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Even\",\r\n\t\t\ttext: \"Can only attend secondary meetings on even days and nights.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Even\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Odd\",\r\n\t\t\ttext: \"Can only attend secondary meetings on odd days and nights.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Odd\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"One Shot\",\r\n\t\t\ttext: \"Can only perform actions once.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-One-Shot\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Bloodthirsty\",\r\n\t\t\ttext: \"Needs to kill other players to stay alive.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Bloodthirsty\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Loud\",\r\n\t\t\ttext: \"All reports recieved are announced to everyone, with the player's role revealed.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Loud\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Astral\",\r\n\t\t\ttext: \"All actions done by this player do not appear as visits.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Astral\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Unblockable\",\r\n\t\t\ttext: \"All actions done by this player cannot be roleblocked or controlled.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Unblockable\" />\r\n\t\t},\r\n\t];\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Mafia | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tMafia is a game of social deception where an informed minority (the Mafia) compete against the uniformed majority (the Village).\r\n\t\t\t\t\t\tThe Mafia choose one player to kill each night, and they win the game if they successfully outnumber the non-mafia players at any point.\r\n\t\t\t\t\t\tEveryone votes to execute one person during the day, with the Village aiming to eliminate all mafia members.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn addition to the Village and the Mafia, there are two other alignments: Independent and Monsters. Independents are not aligned with a side and usually have their own unique win condition.\r\n\t\t\t\t\t\tMonsters meet together and win if they reach the majority just like the mafia, but they do not vote to kill someone each night.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAt the beginning of a game, each player is given a role. This role may grant the player special abilities, usually in the form of actions they can take to aid their side.\r\n\t\t\t\t\t\tA list of all roles and their abilities can be found below.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tItems\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={items} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tMechanics\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={mechanics} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tModifiers\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={modifiers} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostSplitDecision() {\r\n    const gameType = \"Split Decision\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\"\r\n        // },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Initial Round Length (minutes)\",\r\n            ref: \"initRoundLength\",\r\n            type: \"number\",\r\n            value: 3,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        {\r\n            label: \"Hostage Swap Length (minutes)\",\r\n            ref: \"hostageSwapLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 1,\r\n            step: 0.1\r\n        },\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Split Decision | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                ranked: getFormFieldValue(\"ranked\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Initial Round\": getFormFieldValue(\"initialRoundLength\"),\r\n                    \"Hostage Swap\": getFormFieldValue(\"hostageSwapLength\")\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateSplitDecisionSetup() {\r\n\tconst gameType = \"Split Decision\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Initial Swap Amount\",\r\n\t\t\tref: \"swapAmt\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"1\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"24\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Round Amount\",\r\n\t\t\tref: \"aroundAmt\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: 3,\r\n\t\t\tmin: 2,\r\n\t\t\tmax: 10\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Blue Count\",\r\n\t\t\tref: \"count-Blue\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Red Count\",\r\n\t\t\tref: \"count-Red\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"1\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\tconst formFieldValueMods = {};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Split Decision Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: \"Round\",\r\n\t\t\tswapAmt: Number(formFields[1].value),\r\n\t\t\troundAmt: Number(formFields[2].value),\r\n\t\t\twhispers: formFields[3].value,\r\n\t\t\tleakPercentage: Number(formFields[4].value),\r\n\t\t\tunique: formFields[6].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Red\": Number(formFields[7].value),\r\n\t\t\t\t\"Blue\": Number(formFields[8].value),\r\n\t\t\t\t\"Independent\": Number(formFields[9].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[5]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnSplitDecision(props) {\r\n\tconst gameType = \"Split Decision\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Split Decision | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on the card game <a href=\"https://www.tuesdayknightgames.com/tworoomsandaboom\" target=\"_blank\">2 Rooms and a Boom</a> by Tudesday Knight Games.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn Split Decision, all players are randomly a split among two rooms, as well as split among two teams: Red and Blue. One player is assigned the role of President, and another is the Bomber.\r\n\t\t\t\t\t\tThe game plays over a series of rounds, and in each round each room will elect a leader. Those leaders will then meet together and choose one or more players (the hostages) to swap between the rooms for the next round.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAs the game progresses the rounds will get shorter and the number of players swapped between rooms will decrease.\r\n\t\t\t\t\t\tIt is the goal of the Red team for the President and the Bomber to end up in the same room after the last round.\r\n\t\t\t\t\t\tIt is the goal of the Blue team for them to end up in different rooms.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostResistance() {\r\n    const gameType = \"Resistance\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\"\r\n        // },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Team Selection Length (minutes)\",\r\n            ref: \"teamSelLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        {\r\n            label: \"Team Approval Length (minutes)\",\r\n            ref: \"teamApprovalLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 2,\r\n            step: 0.1\r\n        },\r\n        {\r\n            label: \"Mission Length (minutes)\",\r\n            ref: \"missionLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 1,\r\n            step: 0.1\r\n        },\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Resistance | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Team Selection\": getFormFieldValue(\"teamSelLength\"),\r\n                    \"Team Approval\": getFormFieldValue(\"teamApprovalLength\"),\r\n                    \"Mission\": getFormFieldValue(\"missionLength\"),\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`)\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateResistanceSetup() {\r\n\tconst gameType = \"Resistance\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"First Team Size\",\r\n\t\t\tref: \"firstTeamSize\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Last Team Size\",\r\n\t\t\tref: \"lastTeamSize\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Number of Missions\",\r\n\t\t\tref: \"numMissions\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"10\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Team Formation Attempts\",\r\n\t\t\tref: \"teamFailLimit\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Resistance Count\",\r\n\t\t\tref: \"count-Resistance\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Spies Count\",\r\n\t\t\tref: \"count-Spies\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"49\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t]);\r\n\tconst formFieldValueMods = {};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Resistance Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: \"Team Selection\",\r\n\t\t\tfirstTeamSize: Number(formFields[1].value),\r\n\t\t\tlastTeamSize: Number(formFields[2].value),\r\n\t\t\tnumMissions: Number(formFields[3].value),\r\n\t\t\tteamFailLimit: Number(formFields[4].value),\r\n\t\t\twhispers: formFields[5].value,\r\n\t\t\tleakPercentage: Number(formFields[6].value),\r\n\t\t\tunique: formFields[8].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Resistance\": Number(formFields[9].value),\r\n\t\t\t\t\"Spies\": Number(formFields[10].value),\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[7]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnResistance(props) {\r\n\tconst gameType = \"Resistance\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Resistance | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on the card game <a href=\"https://www.boardgamegeek.com/boardgame/41114/resistance\" target=\"_blank\">The Resistance</a> by Don Eskridge.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn Resistance, a group of rebels is trying to overthrow the government by completing a series of missions.\r\n\t\t\t\t\t\tHowever, the government has caught word of the plan and has recruited spies to inflitrate the resistance and sabotage the missions.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAt the beginning of each mission a player is selected as the leader and must recruit several group members to the team.\r\n\t\t\t\t\t\tAll players vote on the selected team and if the majority approve then the mission will proceed. Otherwise, a new leader is chosen to make a new team.\r\n\t\t\t\t\t\tIf several leaders are unable to form a team then that mission automatically fails.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tDuring a mission the members of the teams who are spies can choose to either make the mission succeed or fail.\r\n\t\t\t\t\t\tIf at least one team member opts for it to fail then the entire mission will fail, otherwise it will succeed.\r\n\t\t\t\t\t\tThe game continues until a certain number of missions succeed or fail, with the Resistance and the Spies winning respectively.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostMafia() {\r\n    const gameType = \"One Night\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        // {\r\n        //     label: \"Voice Chat\",\r\n        //     ref: \"voiceChat\",\r\n        //     type: \"boolean\"\r\n        // },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Day Length (minutes)\",\r\n            ref: \"dayLength\",\r\n            type: \"number\",\r\n            value: 10,\r\n            min: 1,\r\n            max: 30\r\n        },\r\n        {\r\n            label: \"Night Length (minutes)\",\r\n            ref: \"nightLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 10\r\n        }\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host One Night | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                // voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Day\": getFormFieldValue(\"dayLength\"),\r\n                    \"Night\": getFormFieldValue(\"nightLength\")\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateOneNightSetup() {\r\n\tconst gameType = \"One Night\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Must Act\",\r\n\t\t\tref: \"mustAct\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Votes Invisible\",\r\n\t\t\tref: \"votesInvisible\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Excess Roles\",\r\n\t\t\tref: \"excessRoles\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"10\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Village Count\",\r\n\t\t\tref: \"count-Village\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"7\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Werewolves Count\",\r\n\t\t\tref: \"count-Werewolves\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"0\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\tconst formFieldValueMods = {\r\n\t\tstartState: [\r\n\t\t\tvalue => value == \"Day\"\r\n\t\t]\r\n\t};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create One Night Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\twhispers: formFields[1].value,\r\n\t\t\tleakPercentage: Number(formFields[2].value),\r\n\t\t\tmustAct: formFields[3].value,\r\n\t\t\tvotesInvisible: formFields[4].value,\r\n\t\t\texcessRoles: formFields[5].value,\r\n\t\t\tunique: formFields[7].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Village\": Number(formFields[8].value),\r\n\t\t\t\t\"Werewolves\": Number(formFields[9].value),\r\n\t\t\t\t\"Independent\": Number(formFields[10].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[6]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnOneNight(props) {\r\n\tconst gameType = \"One Night\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn One Night | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on <a href=\"https://beziergames.com/collections/one-night-ultimate-werewolf\" target=\"_blank\">One Night Ultimate Werewolf</a> by Bezier Games.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tOne Night is a game of logical deduction similar to Mafia, but with only one Night and one Day phase.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tThe Village side must kill one of the Werewolves to win, and Werewolves must kill one of the village. The Village also loses if\r\n\t\t\t\t\t\tthere are no Werewolves present but they kill a Village member.\r\n\t\t\t\t\t\tThe one night is typically eventful; the role you are given at the beginning of the night may not be the card you end up with.\r\n\t\t\t\t\t\tActions will all take place at once at the end of the night. The order of events is given by times in the role descriptions.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useContext, useEffect } from \"react\";\r\nimport { Route, Switch, Redirect, useLocation, useHistory } from \"react-router-dom\";\r\n\r\nimport Join from \"./Join\";\r\n\r\nimport HostMafia from \"./Host/HostMafia\";\r\nimport CreateMafiaSetup from \"./CreateSetup/CreateMafiaSetup\";\r\nimport LearnMafia from \"./Learn/LearnMafia\";\r\n\r\nimport HostSplitDecision from \"./Host/HostSplitDecision\";\r\nimport CreateSplitDecisionSetup from \"./CreateSetup/CreateSplitDecisionSetup\";\r\nimport LearnSplitDecision from \"./Learn/LearnSplitDecision\";\r\n\r\nimport HostResistance from \"./Host/HostResistance\";\r\nimport CreateResistanceSetup from \"./CreateSetup/CreateResistanceSetup\";\r\nimport LearnResistance from \"./Learn/LearnResistance\";\r\n\r\nimport HostOneNight from \"./Host/HostOneNight\";\r\nimport CreateOneNightSetup from \"./CreateSetup/CreateOneNightSetup\";\r\nimport LearnOneNight from \"./Learn/LearnOneNight\";\r\n\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport { GameTypes } from \"../../Constants\";\r\nimport { UserContext } from \"../../Contexts\";\r\n\r\nimport \"../../css/play.css\";\r\n\r\nexport default function Play(props) {\r\n    const defaultGameType = \"Mafia\";\r\n\r\n    const user = useContext(UserContext);\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n    const params = new URLSearchParams(location.search);\r\n    const inLobby = location.pathname == \"/play\";\r\n    const [gameType, setGameType] = useState(params.get(\"game\") || localStorage.getItem(\"gameType\") || defaultGameType);\r\n\r\n    const links = [\r\n        {\r\n            text: \"Play\",\r\n            path: \"/play\",\r\n            exact: true\r\n        },\r\n        {\r\n            text: \"Host\",\r\n            path: `/play/host`,\r\n            hide: !user.loggedIn\r\n        },\r\n        {\r\n            text: \"Create Setup\",\r\n            path: `/play/create`,\r\n            hide: !user.loggedIn\r\n        },\r\n        {\r\n            text: \"Learn\",\r\n            path: `/play/learn`\r\n        }\r\n    ];\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(\"gameType\", gameType);\r\n\r\n        if (!inLobby && !params.get(\"edit\") && params.get(\"game\") != gameType)\r\n            history.push(location.pathname + `?game=${gameType}`);\r\n    }, [location.pathname, gameType]);\r\n\r\n    function onFilterGameType(gameType) {\r\n        setGameType(gameType);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <SubNav\r\n                links={links}\r\n                showFilter={!inLobby}\r\n                filterSel={gameType}\r\n                filterOptions={GameTypes}\r\n                onFilter={onFilterGameType}\r\n                filterIcon={<i className=\"fas fa-gamepad\" />} />\r\n            <div className=\"inner-content play\">\r\n                <Switch>\r\n                    <Route exact path=\"/play\" render={() => <Join />} />\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/host\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <HostMafia />;\r\n                                    case \"Split Decision\":\r\n                                        return <HostSplitDecision />;\r\n                                    case \"Resistance\":\r\n                                        return <HostResistance />;\r\n                                    case \"One Night\":\r\n                                        return <HostOneNight />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/create\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <CreateMafiaSetup />;\r\n                                    case \"Split Decision\":\r\n                                        return <CreateSplitDecisionSetup />;\r\n                                    case \"Resistance\":\r\n                                        return <CreateResistanceSetup />;\r\n                                    case \"One Night\":\r\n                                        return <CreateOneNightSetup />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/learn\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <LearnMafia />;\r\n                                    case \"Split Decision\":\r\n                                        return <LearnSplitDecision />;\r\n                                    case \"Resistance\":\r\n                                        return <LearnResistance />;\r\n                                    case \"One Night\":\r\n                                        return <LearnOneNight />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route render={() => <Redirect to=\"/play\" />} />\r\n                </Switch>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport function TopBarLink(props) {\r\n    const active = props.sel.toLowerCase() == props.text.toLowerCase();\r\n\r\n    return (\r\n        <div\r\n            className={`top-link ${active ? \"active\" : \"\"}`}\r\n            onClick={props.onClick}>\r\n            {props.text}\r\n        </div>\r\n    );\r\n}","import React, { useState, useContext, useRef } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext, PopoverContext } from \"../Contexts\";\r\nimport { ButtonGroup, SearchBar } from \"./Nav\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\nimport { hyphenDelimit } from \"../utils\";\r\nimport { Alignments } from \"../Constants\";\r\nimport LoadingPage from \"../pages/Loading\";\r\nimport { TopBarLink } from \"../pages/Play/Play\";\r\n\r\nexport function RoleCount(props) {\r\n\tconst roleRef = useRef();\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\t// Display predicted icon\r\n\tconst isRolePrediction = props.isRolePrediction;\r\n\t// Choose from list of icons to predict from\r\n\tconst makeRolePrediction = props.makeRolePrediction;\r\n\r\n\tvar roleName, modifier;\r\n\r\n\tif (typeof props.role == \"string\") {\r\n\t\troleName = props.role.split(\":\")[0];\r\n\t\tmodifier = props.role.split(\":\")[1];\r\n\t}\r\n\telse if (props.role) {\r\n\t\troleName = props.role.name;\r\n\t\tmodifier = props.role.modifier;\r\n\t}\r\n\r\n\tif (isRolePrediction) {\r\n\t\tmodifier = \"Unknown\";\r\n\t}\r\n\r\n\tfunction onRoleClick() {\r\n\t\tif (props.onClick)\r\n\t\t\tprops.onClick();\r\n\r\n\t\tif (makeRolePrediction) {\r\n\t\t\tmakeRolePrediction(roleName);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!roleName || !props.showPopover || roleName === \"null\")\r\n\t\t\treturn;\r\n\r\n\t\tpopover.onClick(\r\n\t\t\t`/roles/${props.gameType}/${roleName}`,\r\n\t\t\t\"role\",\r\n\t\t\troleRef.current,\r\n\t\t\troleName\r\n\t\t);\r\n\t}\r\n\r\n\tfunction onRoleMouseEnter( event ) {\r\n\t\tif (props.onMouseEnter)\r\n\t\t\tprops.onMouseEnter();\r\n\r\n\t\tif (!roleName || !props.showSecondaryHover || roleName === \"null\")\r\n\t\t\treturn;\r\n\r\n\t\t// assumes that this is attached to a child in a popover\r\n\t\tpopover.onHover(\r\n\t\t\t`/roles/${props.gameType}/${roleName}`,\r\n\t\t\t\"role\",\r\n\t\t\troleRef.current,\r\n\t\t\troleName,\r\n\t\t\tnull,\r\n\t\t\tevent.clientY,\r\n\t\t);\r\n\t}\r\n\r\n\tif (!props.closed) {\r\n\t\tconst roleClass = roleName ? `${hyphenDelimit(props.gameType)}-${hyphenDelimit(roleName)}` : \"null\";\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"role-count-wrap\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={`role role-${roleClass} ${props.small ? \"small\" : \"\"} ${props.bg ? \"bg\" : \"\"}`}\r\n\t\t\t\t\ttitle={`${roleName || \"\"} ${modifier ? `(${modifier})` : \"\"}`}\r\n\t\t\t\t\tonClick={onRoleClick}\r\n\t\t\t\t\tonMouseEnter={onRoleMouseEnter}\r\n\t\t\t\t\tref={roleRef}>\r\n\t\t\t\t\t{modifier &&\r\n\t\t\t\t\t\t<div className={`modifier modifier-${props.gameType}-${hyphenDelimit(modifier)}`} />\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{props.count > 0 &&\r\n\t\t\t\t\t<div className=\"super\">{props.count}</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse if (props.count > 0 || props.hideCount) {\r\n\t\treturn (\r\n\t\t\t<div className=\"role-count-wrap\">\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName={`fas fa-question i-${props.alignment}`}\r\n\t\t\t\t\tonClick={props.onClick} />\r\n\t\t\t\t{!props.hideCount &&\r\n\t\t\t\t\t<div className=\"super\">{props.count}</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse {\r\n\t\treturn <></>;\r\n\t}\r\n}\r\n\r\nexport function RoleSearch(props) {\r\n\tconst [roleListType, setRoleListType] = useState(Alignments[props.gameType][0]);\r\n\tconst [searchVal, setSearchVal] = useState(\"\");\r\n\tconst roleCellRefs = useRef([]);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tfunction onAlignNavClick(alignment) {\r\n\t\tsetSearchVal(\"\");\r\n\t\tsetRoleListType(alignment);\r\n\t}\r\n\r\n\tfunction onSearchInput(query) {\r\n\t\tsetSearchVal(query.toLowerCase());\r\n\r\n\t\tif (query != \"\" && roleListType.length > 0)\r\n\t\t\tsetRoleListType(\"\");\r\n\t\telse if (query == \"\" && roleListType.length == 0)\r\n\t\t\tsetRoleListType(Alignments[props.gameType][0]);\r\n\t}\r\n\r\n\tfunction onRoleCellClick(roleCellEl, role) {\r\n\t\tpopover.onClick(\r\n\t\t\t`/roles/${props.gameType}/${role.name}`,\r\n\t\t\t\"role\",\r\n\t\t\troleCellEl,\r\n\t\t\trole.name\r\n\t\t);\r\n\t}\r\n\r\n\tconst alignButtons = Alignments[props.gameType].map(type => (\r\n\t\t<TopBarLink\r\n\t\t\ttext={type}\r\n\t\t\tsel={roleListType}\r\n\t\t\tonClick={() => onAlignNavClick(type)}\r\n\t\t\tkey={type} />\r\n\t));\r\n\r\n\tif (!siteInfo.roles)\r\n\t\treturn <LoadingPage className=\"roles-loading\" />;\r\n\r\n\tconst roleCells = siteInfo.roles[props.gameType].map((role, i) => {\r\n\t\tif (\r\n\t\t\t!role.disabled &&\r\n\t\t\t(role.alignment == roleListType ||\r\n\t\t\t(searchVal.length > 0 && role.name.toLowerCase().indexOf(searchVal) != -1))\r\n\t\t) {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"role-cell\" key={role.name}>\r\n\t\t\t\t\t{user.loggedIn && props.onAddClick &&\r\n\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\tclassName=\"add-role fa-plus-circle fas\"\r\n\t\t\t\t\t\t\tonClick={e => {\r\n\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\tprops.onAddClick(role);\r\n\t\t\t\t\t\t\t}} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"role-cell-content\"\r\n\t\t\t\t\t\tonClick={() => onRoleCellClick(roleCellRefs.current[i], role)}\r\n\t\t\t\t\t\tref={el => roleCellRefs.current[i] = el}>\r\n\t\t\t\t\t\t<RoleCount\r\n\t\t\t\t\t\t\trole={role.name}\r\n\t\t\t\t\t\t\tgameType={props.gameType} />\r\n\t\t\t\t\t\t{role.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"role-list-container\">\r\n\t\t\t<div className=\"top-bar\">\r\n\t\t\t\t{alignButtons}\r\n\t\t\t\t<SearchBar\r\n\t\t\t\t\tvalue={searchVal}\r\n\t\t\t\t\tplaceholder=\"Role Name\"\r\n\t\t\t\t\tonInput={onSearchInput} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"role-list\">\r\n\t\t\t\t{roleCells}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useContext, useRef } from \"react\";\r\n\r\nimport { GameContext, PopoverContext, UserContext } from \"../Contexts\";\r\nimport { RoleCount } from \"./Roles\";\r\nimport { Alignments } from \"../Constants\";\r\nimport { filterProfanity } from \"./Basic\";\r\nimport { hyphenDelimit } from \"../utils\";\r\n\r\nimport \"../css/setup.css\"\r\nimport \"../css/roles.css\"\r\n\r\nexport default function Setup(props) {\r\n\tconst user = useContext(UserContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\tconst setupRef = useRef();\r\n\tconst maxRolesCount = props.maxRolesCount || 5;\r\n\r\n\tvar roleCounts, multi;\r\n\tvar overSize = false;\r\n\r\n\tif (typeof props.setup.roles == \"string\")\r\n\t\tprops.setup.roles = JSON.parse(props.setup.roles);\r\n\r\n\tif (props.setup.closed) {\r\n\t\troleCounts = [];\r\n\r\n\t\tfor (let alignment of Alignments[props.setup.gameType]) {\r\n\t\t\troleCounts.push(\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\tclosed\r\n\t\t\t\t\talignment={alignment}\r\n\t\t\t\t\tcount={props.setup.count[alignment]}\r\n\t\t\t\t\tgameType={props.setup.gameType}\r\n\t\t\t\t\tkey={alignment} />\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tlet roleNames = Object.keys(props.setup.roles[0]);\r\n\t\tmulti = props.setup.roles.length > 1;\r\n\r\n\t\troleCounts = roleNames.map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\tsmall\r\n\t\t\t\trole={role}\r\n\t\t\t\tcount={props.setup.roles[0][role]}\r\n\t\t\t\tgameType={props.setup.gameType}\r\n\t\t\t\tkey={role} />\r\n\t\t));\r\n\r\n\t\tif (roleCounts.length > maxRolesCount) {\r\n\t\t\troleCounts = roleCounts.slice(0, maxRolesCount);\r\n\t\t\toverSize = true;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClick() {\r\n\t\tpopover.onClick(\r\n\t\t\t`/setup/${props.setup.id}`,\r\n\t\t\t\"setup\",\r\n\t\t\tsetupRef.current,\r\n\t\t\tfilterProfanity(props.setup.name, user.settings),\r\n\t\t\tdata => data.roles = JSON.parse(data.roles)\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"setup\" ref={setupRef} onClick={onClick}>\r\n\t\t\t<GameIcon gameType={props.setup.gameType} />\r\n\t\t\t{multi &&\r\n\t\t\t\t<i className=\"multi-setup-icon fas fa-list-alt\" />\r\n\t\t\t}\r\n\t\t\t{roleCounts}\r\n\t\t\t{overSize &&\r\n\t\t\t\t<i className=\"fas fa-ellipsis-h\" />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SmallRoleList(props) {\r\n\tvar roles;\r\n\r\n\tif (Array.isArray(props.roles)) {\r\n\t\troles = props.roles.map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\tsmall\r\n\t\t\t\trole={role}\r\n\t\t\t\tmakeRolePrediction={props.makeRolePrediction}\r\n\t\t\t\tkey={role || \"null\"}\r\n\t\t\t\tshowSecondaryHover\r\n\t\t\t\tgameType={props.gameType} />\r\n\t\t));\r\n\r\n\t}\r\n\t\t\r\n\telse\r\n\t\troles = Object.keys(props.roles).map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\trole={role}\r\n\t\t\t\tcount={props.roles[role]}\r\n\t\t\t\tsmall={true}\r\n\t\t\t\tgameType={props.gameType}\r\n\t\t\t\tshowSecondaryHover\r\n\t\t\t\tkey={role} />\r\n\t\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"small-role-list\">{roles}</div>\r\n\t);\r\n}\r\n\r\nexport function GameIcon(props) {\r\n\tconst gameType = hyphenDelimit(props.gameType);\r\n\treturn <div className={`game-icon ${gameType}`}></div>;\r\n}\r\n\r\nexport function GameStateIcon(props) {\r\n\tvar iconName;\r\n\r\n\tif (props.state == \"Day\")\r\n\t\ticonName = \"sun\";\r\n\telse if (props.state == \"Night\")\r\n\t\ticonName = \"moon\";\r\n\r\n\treturn <i className={`fa-${iconName} fas state-icon`} />\r\n}\r\n","const PING_INTERVAL = 10000;\r\n\r\nclass Socket {\r\n\r\n    constructor(socket) {\r\n        this.listeners = {};\r\n        this.sendQueue = [];\r\n        this.received = [];\r\n\r\n        this.setSocket(socket);\r\n    }\r\n\r\n    setSocket(socket) {\r\n        this.socket = socket;\r\n\r\n        this.configureListeners();\r\n\r\n        this.socket.addEventListener(\"open\", () => {\r\n            this.received = [];\r\n\r\n            for (let message of this.sendQueue)\r\n                this.socket.send(message);\r\n        });\r\n\r\n        this.socket.addEventListener(\"close\", () => {\r\n            this.triggerEvent(\"disconnected\");\r\n        });\r\n\r\n        this.socket.addEventListener(\"error\", () => {\r\n            this.terminate();\r\n        });\r\n    }\r\n\r\n    configureListeners() {\r\n        this.socket.addEventListener(\"message\", message => {\r\n            const [eventName, data] = parseMessage(message.data);\r\n            this.triggerEvent(eventName, data);\r\n            this.received.push({ eventName, data });\r\n        });\r\n    }\r\n\r\n    triggerEvent(eventName, data) {\r\n        const actions = this.listeners[eventName];\r\n\r\n        if (!actions)\r\n            return;\r\n\r\n        for (let i = 0; i < actions.length; i++)\r\n            actions[i](data);\r\n    }\r\n\r\n    on(eventName, action) {\r\n        if (!this.listeners[eventName])\r\n            this.listeners[eventName] = [];\r\n\r\n        action = action.bind(this);\r\n        this.listeners[eventName].push(action);\r\n\r\n        for (let message of this.received)\r\n            if (message.eventName == eventName)\r\n                action(message.data);\r\n    }\r\n\r\n    send(eventName, data) {\r\n        const message = stringifyMessage(eventName, data);\r\n\r\n        if (this.socket.readyState == 0)\r\n            this.sendQueue.push(message);\r\n        else if (this.socket.readyState == 1)\r\n            this.socket.send(message);\r\n    }\r\n\r\n    clearListeners() {\r\n        var newListeners = {};\r\n        newListeners[\"p\"] = this.listeners[\"p\"];\r\n        this.listeners = newListeners;\r\n    }\r\n\r\n    terminate() {\r\n        this.socket.close();\r\n    }\r\n\r\n    get readyState() {\r\n        if (this.socket)\r\n            return this.socket.readyState;\r\n        else\r\n            return 3;\r\n    }\r\n\r\n}\r\n\r\nexport class ClientSocket extends Socket {\r\n\r\n    constructor(path, persistent) {\r\n        super(new WebSocket(path));\r\n\r\n        this.path = path;\r\n        this.persistent = persistent;\r\n\r\n        this.configurePing();\r\n        this.configureClose();\r\n    }\r\n\r\n    reconnect() {\r\n        super.setSocket(new WebSocket(this.path));\r\n        this.heartbeat();\r\n        this.configureClose();\r\n    }\r\n\r\n    configurePing() {\r\n        this.heartbeat();\r\n        this.on(\"p\", () => this.heartbeat());\r\n    }\r\n\r\n    heartbeat() {\r\n        clearTimeout(this.pingTimeout);\r\n        this.send(\"p\");\r\n\r\n        this.pingTimeout = setTimeout(() => {\r\n            this.socket.close();\r\n        }, PING_INTERVAL + 1000);\r\n    }\r\n\r\n    configureClose() {\r\n        this.socket.addEventListener(\"close\", () => {\r\n            if (this.persistent)\r\n                this.reconnect();\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this.pingTimeout);\r\n\r\n        this.persistent = false;\r\n        this.listeners = {};\r\n        this.sendQueue = [];\r\n\r\n        if (this.socket)\r\n            this.socket.close();\r\n\r\n        this.socket = null;\r\n    }\r\n\r\n}\r\n\r\nexport function stringifyMessage(eventName, data) {\r\n    const type = typeof data;\r\n\r\n    if (type == \"undefined\")\r\n        return eventName;\r\n\r\n    if (type == \"object\")\r\n        data = JSON.stringify(data);\r\n    else if (type != \"string\")\r\n        data = String(data);\r\n\r\n    return `${eventName}:${type}:${data}`;\r\n}\r\n\r\nexport function parseMessage(message) {\r\n    var split = message.split(/:(.*)/s);\r\n    const eventName = split[0];\r\n\r\n    if (split.length < 2)\r\n        return [eventName];\r\n\r\n    split = split[1].split(/:(.*)/s);\r\n\r\n    if (split.length < 2)\r\n        return;\r\n\r\n    const type = split[0];\r\n    var data = split[1];\r\n\r\n    switch (type) {\r\n        case \"number\":\r\n            data = Number(data);\r\n            break;\r\n        case \"boolean\":\r\n            data = data != \"false\";\r\n            break;\r\n        case \"object\":\r\n            try {\r\n                data = JSON.parse(data);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n            break;\r\n    }\r\n\r\n    return [eventName, data];\r\n}","import React, { useState, useEffect, useLayoutEffect, useReducer, useContext, useRef } from \"react\";\r\nimport { useParams, Switch, Route, Redirect } from \"react-router-dom\";\r\nimport update from \"immutability-helper\";\r\nimport axios from \"axios\";\r\nimport AgoraRTC from \"agora-rtc-sdk-ng\";\r\nimport ReactLoading from \"react-loading\";\r\n\r\nimport { linkify, UserText } from \"../../components/Basic\";\r\nimport LoadingPage from \"../Loading\";\r\nimport MafiaGame from \"./MafiaGame\";\r\nimport SplitDecisionGame from \"./SplitDecisionGame\";\r\nimport ResistanceGame from \"./ResistanceGame\";\r\nimport OneNightGame from \"./OneNightGame\";\r\nimport { GameContext, PopoverContext, SiteInfoContext, UserContext } from \"../../Contexts\";\r\nimport Dropdown, { useDropdown } from \"../../components/Dropdown\";\r\nimport Setup from \"../../components/Setup\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\nimport { ClientSocket as Socket } from \"../../Socket\";\r\nimport { RoleCount, RolePrediction } from \"../../components/Roles\";\r\nimport Form, { useForm } from \"../../components/Form\";\r\nimport { Modal } from \"../../components/Modal\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { MaxGameMessageLength, MaxTextInputLength, MaxWillLength } from \"../../Constants\";\r\nimport { textIncludesSlurs } from \"../../lib/profanity\";\r\n\r\nimport \"../../css/game.css\";\r\nimport { adjustColor, flipTextColor } from \"../../utils\";\r\n\r\nexport default function Game() {\r\n    return (\r\n        <Switch>\r\n            <Route exact path=\"/game/:gameId\" render={(props) => <GameWrapper key={props.match.params.gameId} />} />\r\n            <Route exact path=\"/game/:gameId/review\" render={() => <GameWrapper review />} />\r\n            <Redirect to=\"/play\" />\r\n        </Switch>\r\n    );\r\n}\r\n\r\nfunction GameWrapper(props) {\r\n    const [loaded, setLoaded] = useState(false);\r\n    const [leave, setLeave] = useState(false);\r\n    const [finished, setFinished] = useState(false);\r\n    const [port, setPort] = useState();\r\n    const [gameType, setGameType] = useState();\r\n    const [token, setToken] = useState();\r\n    const [socket, setSocket] = useState({});\r\n    const [connected, setConnected] = useState(0);\r\n    const [setup, setSetup] = useState();\r\n    const [options, setOptions] = useState({});\r\n    const [emojis, setEmojis] = useState({});\r\n    const [history, updateHistory] = useHistoryReducer();\r\n    const [stateViewing, updateStateViewing] = useStateViewingReducer(history);\r\n    const [players, updatePlayers] = usePlayersReducer();\r\n    const [spectatorCount, setSpectatorCount] = useState(0);\r\n    const [isSpectator, setIsSpectator] = useState(false);\r\n    const [self, setSelf] = useState();\r\n    const [lastWill, setLastWill] = useState(\"\");\r\n    const [timers, updateTimers] = useTimersReducer();\r\n    const [settings, updateSettings] = useSettingsReducer();\r\n    const [showSettingsModal, setShowSettingsModal] = useState(false);\r\n    const [showFirstGameModal, setShowFirstGameModal] = useState(false);\r\n    const [speechFilters, setSpeechFilters] = useState({ from: \"\", contains: \"\" });\r\n    const [isolationEnabled, setIsolationEnabled] = useState(false);\r\n    const [isolatedPlayers, setIsolatedPlayers] = useState(new Set());\r\n    const [rolePredictions, setRolePredictions] = useState({});\r\n    const [activeVoiceChannel, setActiveVoiceChannel] = useState();\r\n    const [muted, setMuted] = useState(false);\r\n    const [deafened, setDeafened] = useState(false);\r\n    const [rehostId, setRehostId] = useState();\r\n    const [dev, setDev] = useState(false);\r\n\r\n    const playersRef = useRef();\r\n    const selfRef = useRef();\r\n    const agoraClient = useRef();\r\n    const localAudioTrack = useRef();\r\n    const noLeaveRef = useRef();\r\n\r\n    const [activity, updateActivity] = useActivity(agoraClient, localAudioTrack);\r\n    const [playAudio, loadAudioFiles, stopAudio, stopAudios, setVolume] = useAudio(settings);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const popover = useContext(PopoverContext);\r\n    const errorAlert = useErrorAlert();\r\n    const { gameId } = useParams();\r\n\r\n    const audioFileNames = [\"bell\", \"ping\", \"tick\"];\r\n    const audioLoops = [false, false, false];\r\n    const audioOverrides = [false, false, false];\r\n    const audioVolumes = [1, 1, 1];\r\n\r\n    const togglePlayerIsolation = (playerId) => {\r\n        const newIsolatedPlayers = new Set(isolatedPlayers);\r\n\r\n        if(newIsolatedPlayers.has(playerId)) {\r\n            newIsolatedPlayers.delete(playerId);\r\n        } else {\r\n            newIsolatedPlayers.add(playerId);\r\n        }\r\n        setIsolatedPlayers(newIsolatedPlayers);\r\n    }\r\n    \r\n    function toggleRolePrediction(playerId) {\r\n        return function (prediction) {\r\n            let newRolePredictions = rolePredictions;\r\n            newRolePredictions[playerId] = prediction;\r\n            if (prediction === null) {\r\n                delete newRolePredictions[playerId];\r\n            }\r\n            setRolePredictions(newRolePredictions);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (token == null)\r\n            return;\r\n\r\n        var socketURL;\r\n\r\n        if (process.env.REACT_APP_USE_PORT == \"true\")\r\n            socketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}:${port}`;\r\n        else\r\n            socketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}/${port}`;\r\n\r\n        var newSocket = new Socket(socketURL);\r\n        newSocket.on(\"connected\", () => setConnected(connected + 1));\r\n        newSocket.on(\"disconnected\", () => setConnected(connected - 1));\r\n        setSocket(newSocket);\r\n\r\n        return () => {\r\n            if (newSocket)\r\n                newSocket.clear();\r\n        };\r\n    }, [token]);\r\n\r\n    useEffect(() => {\r\n        if (finished) {\r\n            socket.clear();\r\n            setSocket({ send: () => { } });\r\n        }\r\n    }, [finished]);\r\n\r\n    useEffect(() => {\r\n        updateSettings({ type: \"load\" });\r\n\r\n        if (!props.review) {\r\n            document.title = `Game ${gameId} | BeyondMafia`;\r\n            loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n            requestNotificationAccess();\r\n\r\n            var timerInterval = setInterval(() => {\r\n                updateTimers({\r\n                    type: \"updateAll\",\r\n                    playAudio\r\n                });\r\n            }, 1000);\r\n\r\n            function onKeydown() {\r\n                var speechInput = document.getElementById(\"speechInput\");\r\n                var activeElName = document.activeElement.tagName;\r\n\r\n                if (speechInput && activeElName != \"INPUT\" && activeElName != \"TEXTAREA\")\r\n                    speechInput.focus();\r\n            }\r\n\r\n            window.addEventListener(\"keydown\", onKeydown);\r\n\r\n            return () => {\r\n                window.removeEventListener(\"keydown\", onKeydown);\r\n\r\n                clearInterval(timerInterval);\r\n                stopAudio();\r\n                agoraDisconnect();\r\n\r\n                if (localAudioTrack.current)\r\n                    localAudioTrack.current.close();\r\n\r\n            }\r\n        }\r\n        else {\r\n            document.title = `Review Game ${gameId} | BeyondMafia`;\r\n\r\n            axios.get(`/game/${gameId}/review/data`)\r\n                .then(res => {\r\n                    var data = res.data;\r\n\r\n                    if (data.broken) {\r\n                        setLeave(true);\r\n                        errorAlert(\"Game not found.\");\r\n                        return;\r\n                    }\r\n\r\n                    setGameType(data.type);\r\n                    setSetup(data.setup);\r\n\r\n                    setOptions({\r\n                        ranked: data.ranked,\r\n                        spectating: data.spectating,\r\n                        private: false\r\n                    });\r\n\r\n                    updateHistory({\r\n                        type: \"set\",\r\n                        history: JSON.parse(data.history)\r\n                    });\r\n\r\n                    var players = {};\r\n\r\n                    for (let i in data.players) {\r\n                        players[data.players[i]] = {\r\n                            id: data.players[i],\r\n                            name: data.names[i],\r\n                            userId: data.users[i] ? data.users[i].id : \"\",\r\n                            avatar: data.users[i] ? data.users[i].avatar : false,\r\n                            textColor: data.users[i] && data.users[i].settings.textColor,\r\n                            nameColor: data.users[i] && data.users[i].settings.nameColor,\r\n                            left: data.left.indexOf(data.players[i]) != -1\r\n                        };\r\n                    }\r\n\r\n                    updatePlayers({\r\n                        type: \"set\",\r\n                        players\r\n                    });\r\n\r\n                    setLoaded(true);\r\n                })\r\n                .catch((e) => {\r\n                    setLeave(true);\r\n                    errorAlert(e);\r\n                });\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        selfRef.current = self;\r\n    }, [self]);\r\n\r\n    useEffect(() => {\r\n        if (stateViewing == null)\r\n            updateStateViewing({ type: \"current\" });\r\n    }, [history.currentState]);\r\n\r\n    useEffect(() => {\r\n        playersRef.current = players;\r\n    }, [players]);\r\n\r\n    useEffect(() => {\r\n        if (!options.voiceChat || props.review)\r\n            return;\r\n\r\n        if (!activeVoiceChannel) {\r\n            agoraDisconnect();\r\n            return;\r\n        }\r\n\r\n        var state = history.states[history.currentState];\r\n        var meeting = state && state.meetings[activeVoiceChannel];\r\n        var vcToken = meeting && meeting.vcToken;\r\n\r\n        if (vcToken)\r\n            agoraConnect(activeVoiceChannel, vcToken);\r\n    }, [activeVoiceChannel]);\r\n\r\n    useEffect(() => {\r\n        if (socket.readyState != 1) {\r\n            if (\r\n                (socket.readyState == null || socket.readyState == 3) &&\r\n                !leave &&\r\n                !finished &&\r\n                !props.review) {\r\n                getConnectionInfo();\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (token)\r\n            socket.send(\"auth\", token);\r\n        else\r\n            socket.send(\"join\", { gameId, guestId: window.localStorage.getItem(\"cacheVal\") });\r\n\r\n        socket.on(\"authSuccess\", () => {\r\n            socket.send(\"join\", {\r\n                gameId,\r\n                isBot: window.location.search == \"?bot\"\r\n            });\r\n        });\r\n\r\n        socket.on(\"loaded\", () => {\r\n            setLoaded(true);\r\n        });\r\n\r\n        socket.on(\"setup\", data => {\r\n            setSetup(data);\r\n        });\r\n\r\n        socket.on(\"options\", options => {\r\n            setOptions(options);\r\n        });\r\n\r\n        socket.on(\"emojis\", emojis => {\r\n            setEmojis(emojis);\r\n        });\r\n\r\n        socket.on(\"state\", state => {\r\n            updateHistory({ type: \"addState\", state: state });\r\n        });\r\n\r\n        socket.on(\"history\", history => {\r\n            updateHistory({\r\n                type: \"set\",\r\n                history\r\n            });\r\n        });\r\n\r\n        socket.on(\"players\", players => {\r\n            updatePlayers({\r\n                type: \"set\",\r\n                players\r\n            });\r\n        });\r\n\r\n        socket.on(\"playerJoin\", player => {\r\n            updatePlayers({\r\n                type: \"add\",\r\n                player\r\n            });\r\n        });\r\n\r\n        socket.on(\"playerLeave\", playerId => {\r\n            updatePlayers({\r\n                type: \"remove\",\r\n                playerId\r\n            });\r\n        });\r\n\r\n        socket.on(\"spectatorCount\", count => {\r\n            setSpectatorCount(count);\r\n        });\r\n\r\n        socket.on(\"self\", playerId => {\r\n            setSelf(playerId);\r\n        });\r\n\r\n        socket.on(\"reveal\", info => {\r\n            toggleRolePrediction(info.playerId)(null);\r\n\r\n            updateHistory({\r\n                type: \"reveal\",\r\n                playerId: info.playerId,\r\n                role: info.role\r\n            });\r\n        });\r\n\r\n        socket.on(\"death\", playerId => {\r\n            updateHistory({\r\n                type: \"death\",\r\n                playerId,\r\n            });\r\n        });\r\n\r\n        socket.on(\"revival\", playerId => {\r\n            updateHistory({\r\n                type: \"revival\",\r\n                playerId,\r\n            });\r\n        });\r\n\r\n        socket.on(\"meeting\", meeting => {\r\n            updateHistory({\r\n                type: \"addMeeting\",\r\n                meeting\r\n            });\r\n        });\r\n\r\n        socket.on(\"members\", info => {\r\n            updateHistory({\r\n                type: \"meetingMembers\",\r\n                meetingId: info.meetingId,\r\n                members: info.members\r\n            });\r\n        });\r\n\r\n        socket.on(\"leftMeeting\", meetingId => {\r\n            updateHistory({\r\n                type: \"removeMeeting\",\r\n                meetingId\r\n            });\r\n        });\r\n\r\n        socket.on(\"stateEvents\", stateEvents => {\r\n            updateHistory({\r\n                type: \"stateEvents\",\r\n                stateEvents\r\n            });\r\n        });\r\n\r\n        socket.on(\"message\", message => {\r\n            updateHistory({\r\n                type: \"addMessage\",\r\n                message\r\n            });\r\n\r\n            const pings = message.content.match(/@[\\w-]*/gm) || [];\r\n\r\n            if (\r\n                selfRef.current && playersRef.current[selfRef.current] &&\r\n                (\r\n                    pings.indexOf(\"@\" + playersRef.current[selfRef.current].name) != -1 ||\r\n                    pings.indexOf(\"@everyone\") != -1\r\n                )\r\n            ) {\r\n                playAudio(\"ping\");\r\n            }\r\n        });\r\n\r\n        socket.on(\"quote\", quote => {\r\n            updateHistory({\r\n                type: \"addQuote\",\r\n                quote\r\n            });\r\n        });\r\n\r\n        socket.on(\"vote\", vote => {\r\n            updateHistory({\r\n                type: \"vote\",\r\n                vote\r\n            });\r\n        });\r\n\r\n        socket.on(\"unvote\", info => {\r\n            updateHistory({\r\n                type: \"unvote\",\r\n                info\r\n            });\r\n        });\r\n\r\n        socket.on(\"lastWill\", will => {\r\n            setLastWill(will);\r\n        });\r\n\r\n        socket.on(\"firstGame\", () => {\r\n            setShowFirstGameModal(true);\r\n        });\r\n\r\n        socket.on(\"timerInfo\", info => {\r\n            updateTimers({\r\n                type: \"create\",\r\n                timer: info\r\n            });\r\n\r\n            if (\r\n                info.name == \"pregameCountdown\" &&\r\n                Notification &&\r\n                Notification.permission == \"granted\" &&\r\n                !document.hasFocus()\r\n            ) {\r\n                new Notification(\"Your game is starting!\");\r\n            }\r\n        });\r\n\r\n        socket.on(\"clearTimer\", name => {\r\n            updateTimers({\r\n                type: \"clear\",\r\n                name\r\n            });\r\n        });\r\n\r\n        socket.on(\"time\", info => {\r\n            updateTimers({\r\n                type: \"update\",\r\n                name: info.name,\r\n                time: info.time\r\n            });\r\n        });\r\n\r\n        socket.on(\"typing\", info => {\r\n            updateActivity({\r\n                type: \"typing\",\r\n                playerId: info.playerId,\r\n                meetingId: info.meetingId\r\n            });\r\n        });\r\n\r\n        socket.on(\"isSpectator\", () => {\r\n            setIsSpectator(true);\r\n        });\r\n\r\n        socket.on(\"left\", () => {\r\n            if (!noLeaveRef.current) {\r\n                setLeave(true);\r\n                siteInfo.hideAllAlerts();\r\n            }\r\n        });\r\n\r\n        socket.on(\"finished\", () => {\r\n            setFinished(true);\r\n        });\r\n\r\n        socket.on(\"error\", error => {\r\n            setLeave(true);\r\n            errorAlert(error);\r\n        });\r\n\r\n        socket.on(\"dev\", () => {\r\n            setDev(true);\r\n        });\r\n    }, [connected]);\r\n\r\n    function getConnectionInfo() {\r\n        axios.get(`/game/${gameId}/connect`)\r\n            .then(res => {\r\n                setGameType(res.data.type);\r\n                setPort(res.data.port);\r\n                setToken(res.data.token || false);\r\n            })\r\n            .catch(e => {\r\n                var msg = e && e.response && e.response.data;\r\n\r\n                if (msg == \"Game not found.\")\r\n                    setLeave(\"review\");\r\n                else {\r\n                    setLeave(true);\r\n                    errorAlert(e);\r\n                }\r\n            });\r\n    }\r\n\r\n    function createAgoraClient() {\r\n        if (agoraClient.current)\r\n            return;\r\n\r\n        agoraClient.current = AgoraRTC.createClient({ mode: \"rtc\", codec: \"vp8\" });\r\n\r\n        agoraClient.current.on(\"user-published\", async (user, mediaType) => {\r\n            if (mediaType != \"audio\")\r\n                return;\r\n\r\n            await agoraClient.current.subscribe(user, mediaType);\r\n\r\n            if (deafened)\r\n                user.audioTrack.setVolume(0);\r\n\r\n            user.audioTrack.play();\r\n        });\r\n\r\n        agoraClient.current.on(\"user-unpublished\", user => {\r\n            var audioContainer = document.getElementById(user.uid);\r\n\r\n            if (audioContainer)\r\n                audioContainer.remove();\r\n        });\r\n    }\r\n\r\n    async function agoraConnect(meetingId, token) {\r\n        try {\r\n            if (!agoraClient.current)\r\n                createAgoraClient();\r\n            else\r\n                await agoraDisconnect();\r\n\r\n            await agoraClient.current.join(process.env.REACT_APP_AGORA_ID, meetingId, token, self);\r\n\r\n            if (!localAudioTrack.current) {\r\n                localAudioTrack.current = await AgoraRTC.createMicrophoneAudioTrack();\r\n\r\n                if (muted)\r\n                    localAudioTrack.current.setVolume(0);\r\n            }\r\n\r\n            await agoraClient.current.publish([localAudioTrack.current]);\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    async function agoraDisconnect() {\r\n        if (!agoraClient.current)\r\n            return;\r\n\r\n        agoraClient.current.remoteUsers.forEach(user => {\r\n            let audioContainer = document.getElementById(user.uid);\r\n\r\n            if (audioContainer)\r\n                audioContainer.remove();\r\n        });\r\n\r\n        await agoraClient.current.leave();\r\n    }\r\n\r\n    if (leave == \"review\")\r\n        return <Redirect to={`/game/${gameId}/review`} />;\r\n    else if (leave)\r\n        return <Redirect to=\"/play\" />;\r\n    else if (rehostId)\r\n        return <Redirect to={`/game/${rehostId}`} />;\r\n    else if (!loaded || stateViewing == null)\r\n        return (\r\n            <div className=\"game\">\r\n                <LoadingPage />\r\n            </div>\r\n        );\r\n    else {\r\n        const context = {\r\n            socket: socket,\r\n            review: props.review,\r\n            setup: setup,\r\n            history: history,\r\n            updateHistory: updateHistory,\r\n            stateViewing: stateViewing,\r\n            updateStateViewing: updateStateViewing,\r\n            self: self,\r\n            isSpectator: isSpectator,\r\n            players: players,\r\n            updatePlayers: updatePlayers,\r\n            timers: timers,\r\n            options: options,\r\n            spectatorCount: spectatorCount,\r\n            lastWill: lastWill,\r\n            emojis: emojis,\r\n            setLeave: setLeave,\r\n            finished: finished,\r\n            settings: settings,\r\n            updateSettings: updateSettings,\r\n            setShowSettingsModal: setShowSettingsModal,\r\n            speechFilters: speechFilters,\r\n            setSpeechFilters: setSpeechFilters,\r\n            isolationEnabled,\r\n            setIsolationEnabled,\r\n            isolatedPlayers,\r\n            togglePlayerIsolation,\r\n            rolePredictions,\r\n            toggleRolePrediction,\r\n            loadAudioFiles: loadAudioFiles,\r\n            playAudio: playAudio,\r\n            stopAudio: stopAudio,\r\n            stopAudios: stopAudios,\r\n            setRehostId: setRehostId,\r\n            agoraClient: agoraClient,\r\n            localAudioTrack: localAudioTrack,\r\n            setActiveVoiceChannel: setActiveVoiceChannel,\r\n            activity: activity,\r\n            muted: muted,\r\n            setMuted: setMuted,\r\n            deafened: deafened,\r\n            setDeafened: setDeafened,\r\n            noLeaveRef,\r\n            dev: dev,\r\n        };\r\n\r\n        return (\r\n            <GameContext.Provider value={context}>\r\n                <div className=\"game no-highlight\">\r\n                    <SettingsModal\r\n                        showModal={showSettingsModal}\r\n                        setShowModal={setShowSettingsModal}\r\n                        settings={settings}\r\n                        updateSettings={updateSettings} />\r\n                    <FirstGameModal\r\n                        showModal={showFirstGameModal}\r\n                        setShowModal={setShowFirstGameModal} />\r\n                    {gameType == \"Mafia\" &&\r\n                        <MafiaGame />\r\n                    }\r\n                    {gameType == \"Resistance\" &&\r\n                        <ResistanceGame />\r\n                    }\r\n                    {gameType == \"Split Decision\" &&\r\n                        <SplitDecisionGame />\r\n                    }\r\n                    {gameType == \"One Night\" &&\r\n                        <OneNightGame />\r\n                    }\r\n                </div>\r\n            </GameContext.Provider>\r\n        );\r\n    }\r\n}\r\n\r\nexport function useSocketListeners(listeners, socket) {\r\n    useEffect(() => {\r\n        if (!socket.on)\r\n            return;\r\n\r\n        listeners(socket);\r\n    }, [socket]);\r\n}\r\n\r\nexport function TopBar(props) {\r\n    const { gameId } = useParams();\r\n    const infoRef = useRef();\r\n    const errorAlert = useErrorAlert();\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const popover = useContext(PopoverContext);\r\n\r\n    function onInfoClick(e) {\r\n        e.stopPropagation();\r\n        popover.onClick(\r\n            `/game/${gameId}/info`,\r\n            \"game\",\r\n            infoRef.current,\r\n            `Game ${gameId}`,\r\n        );\r\n    }\r\n\r\n    function onLogoClick() {\r\n        window.open(process.env.REACT_APP_URL, \"_blank\");\r\n    }\r\n\r\n    function onSettingsClick() {\r\n        props.setShowSettingsModal(true);\r\n    }\r\n\r\n    function onTestClick() {\r\n        for (let i = 0; i < props.setup.total - 1; i++)\r\n            window.open(window.location + \"?bot\");\r\n    }\r\n\r\n    function onLeaveGameClick() {\r\n        const shouldLeave = props.finished || props.review || window.confirm(\"Are you sure you wish to leave?\");\r\n\r\n        if (!shouldLeave)\r\n            return;\r\n\r\n        if (props.finished)\r\n            siteInfo.hideAllAlerts();\r\n\r\n        if (props.socket.on)\r\n            props.socket.send(\"leave\");\r\n        else\r\n            props.setLeave(true);\r\n    }\r\n\r\n    function onRehostGameClick() {\r\n        props.noLeaveRef.current = true;\r\n\r\n        if (props.socket.on)\r\n            props.socket.send(\"leave\");\r\n\r\n        setTimeout(() => {\r\n            var stateLengths = {};\r\n\r\n            for (let stateName in props.options.stateLengths)\r\n                stateLengths[stateName] = props.options.stateLengths[stateName] / 60000;\r\n\r\n            axios.post(\"/game/host\", {\r\n                rehost: gameId,\r\n                gameType: props.gameType,\r\n                setup: props.setup.id,\r\n                lobby: props.options.lobby,\r\n                private: props.options.private,\r\n                spectating: props.options.spectating,\r\n                guests: props.options.guests,\r\n                ranked: props.options.ranked,\r\n                stateLengths: stateLengths,\r\n                ...props.options.gameTypeOptions\r\n            })\r\n                .then(res => props.setRehostId(res.data))\r\n                .catch((e) => {\r\n                    props.noLeaveRef.current = false;\r\n                    errorAlert(e);\r\n                });\r\n        }, 500);\r\n    }\r\n\r\n    return (\r\n        <div className=\"top\">\r\n            <div className=\"game-name-wrapper\" onClick={onLogoClick}>\r\n                {props.gameName}\r\n            </div>\r\n            <div className=\"state-wrapper\">\r\n                <StateSwitcher\r\n                    history={props.history}\r\n                    stateViewing={props.stateViewing}\r\n                    updateStateViewing={props.updateStateViewing} />\r\n                {props.timer}\r\n            </div>\r\n            <div className=\"misc-wrapper\">\r\n                <div className=\"misc-left\">\r\n                    <div className=\"misc-buttons\">\r\n                        {props.options.voiceChat &&\r\n                            <i className=\"misc-icon fas fa-microphone\" />\r\n                        }\r\n                        <i\r\n                            className=\"misc-icon fas fa-info-circle\"\r\n                            ref={infoRef}\r\n                            onClick={onInfoClick} />\r\n                        <i\r\n                            className=\"misc-icon fas fa-cog\"\r\n                            onClick={onSettingsClick} />\r\n                        {props.dev &&\r\n                            <i\r\n                                className=\"misc-icon fas fa-vial\"\r\n                                onClick={onTestClick} />\r\n                        }\r\n                    </div>\r\n                    <div className=\"options\">\r\n                        {!props.options.private && !props.review &&\r\n                            <i className=\"fas fa-lock-open\" />\r\n                        }\r\n                        {props.options.private && !props.review &&\r\n                            <i className=\"fas fa-lock\" />\r\n                        }\r\n                        {!props.review &&\r\n                            <div className=\"player-count\">\r\n                                <i className=\"fas fa-users\" />\r\n                                {Object.values(props.players).filter(p => !p.left).length} / {props.setup.total}\r\n                            </div>\r\n                        }\r\n                        {!props.options.spectating && !props.review &&\r\n                            <div className=\"no-spectator\">\r\n                                <i className=\"fas fa-eye-slash\" />\r\n                            </div>\r\n                        }\r\n                        {props.options.spectating && !props.review &&\r\n                            <div className=\"spectator-count\">\r\n                                <i className=\"fas fa-eye\" />\r\n                                {props.spectatorCount}\r\n                            </div>\r\n                        }\r\n                    </div>\r\n                </div>\r\n                {props.setup &&\r\n                    <Setup setup={props.setup} />\r\n                }\r\n                <div\r\n                    className=\"btn btn-theme leave-game\"\r\n                    onClick={onLeaveGameClick}>\r\n                    Leave\r\n                </div>\r\n                {!props.review && props.history.currentState == -2 &&\r\n                    < div\r\n                        className=\"btn btn-theme-sec rehost-game\"\r\n                        onClick={onRehostGameClick}>\r\n                        Rehost\r\n                    </div>\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function ThreePanelLayout(props) {\r\n    return (\r\n        <div className=\"main\">\r\n            <div className=\"left-panel panel\">\r\n                {props.leftPanelContent}\r\n            </div>\r\n            <div className=\"center-panel panel\">\r\n                {props.centerPanelContent}\r\n            </div>\r\n            <div className=\"right-panel panel\">\r\n                {props.rightPanelContent}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function TextMeetingLayout(props) {\r\n    const game = useContext(GameContext);\r\n    const { isolationEnabled, isolatedPlayers } = game;\r\n    const { history, players, stateViewing, updateHistory, setActiveVoiceChannel } = props\r\n\r\n    const stateInfo = history.states[stateViewing];\r\n    const meetings = stateInfo ? stateInfo.meetings : {};\r\n    const alerts = stateInfo ? stateInfo.alerts : [];\r\n    const selTab = stateInfo && stateInfo.selTab;\r\n\r\n    const [autoScroll, setAutoScroll] = useState(true);\r\n    const [mouseMoved, setMouseMoved] = useState(false);\r\n    const speechDisplayRef = useRef();\r\n\r\n    const speechMeetings = Object.values(meetings).filter(meeting => meeting.speech);\r\n\r\n    useLayoutEffect(() => doAutoScroll());\r\n\r\n    useEffect(() => {\r\n        if (stateViewing != null && !selTab && speechMeetings.length) {\r\n            updateHistory({\r\n                type: \"selTab\",\r\n                state: stateViewing,\r\n                meetingId: speechMeetings[0].id\r\n            });\r\n        }\r\n    }, [stateViewing, speechMeetings]);\r\n\r\n    useEffect(() => {\r\n        if (stateViewing == history.currentState)\r\n            setAutoScroll(true);\r\n        else\r\n            setAutoScroll(false);\r\n    }, [stateViewing]);\r\n\r\n    useEffect(() => {\r\n        function onMouseMove() {\r\n            setMouseMoved(true);\r\n            document.removeEventListener(\"mousemove\", onMouseMove);\r\n        }\r\n\r\n        document.addEventListener(\"mousemove\", onMouseMove);\r\n\r\n        return () => document.removeEventListener(\"mousemove\", onMouseMove);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!selTab || !meetings[selTab] || !meetings[selTab].vcToken)\r\n            setActiveVoiceChannel(null);\r\n\r\n        setActiveVoiceChannel(selTab);\r\n    }, [selTab, meetings]);\r\n\r\n    function doAutoScroll() {\r\n        if (autoScroll && speechDisplayRef.current)\r\n            speechDisplayRef.current.scrollTop = speechDisplayRef.current.scrollHeight;\r\n    }\r\n\r\n    function onTabClick(tabId) {\r\n        updateHistory({\r\n            type: \"selTab\",\r\n            state: stateViewing,\r\n            meetingId: tabId\r\n        });\r\n\r\n        setAutoScroll(true);\r\n    }\r\n\r\n    function onMessageQuote(message) {\r\n        if (!props.review && message.senderId != \"server\" && !message.isQuote && message.quotable) {\r\n            props.socket.send(\"quote\", {\r\n                messageId: message.id,\r\n                toMeetingId: history.states[history.currentState].selTab,\r\n                fromMeetingId: message.meetingId,\r\n                fromState: stateViewing\r\n            });\r\n        }\r\n    }\r\n\r\n    function onSpeechScroll() {\r\n        if (!mouseMoved) {\r\n            doAutoScroll();\r\n            return;\r\n        }\r\n\r\n        var speech = speechDisplayRef.current;\r\n\r\n        if (Math.round(speech.scrollTop + speech.clientHeight) >= Math.round(speech.scrollHeight))\r\n            setAutoScroll(true);\r\n        else\r\n            setAutoScroll(false);\r\n    }\r\n\r\n    const tabs = speechMeetings.map(meeting => {\r\n        return (\r\n            <div\r\n                className={`tab ${selTab == meeting.id ? \"sel\" : \"\"}`}\r\n                key={meeting.id}\r\n                onClick={() => onTabClick(meeting.id)}>\r\n                {meeting.name}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    var messages = getMessagesToDisplay(meetings, alerts, selTab, players, props.settings, props.filters);\r\n    messages = messages.map((message, i) => {\r\n        const isNotServerMessage = message.senderId !== \"server\";\r\n        const unfocusedMessage = isolationEnabled && isNotServerMessage && isolatedPlayers.size && !isolatedPlayers.has(message.senderId);\r\n\r\n        return (\r\n            <Message\r\n                message={message}\r\n                history={history}\r\n                players={players}\r\n                key={message.id || message.messageId + message.time || i}\r\n                onMessageQuote={onMessageQuote}\r\n                settings={props.settings}\r\n                unfocusedMessage={unfocusedMessage}\r\n            />\r\n        );\r\n    });\r\n\r\n    var canSpeak = selTab;\r\n    canSpeak = canSpeak && (meetings[selTab].members.length > 1 || history.currentState == -1);\r\n    canSpeak = canSpeak && stateViewing == history.currentState && meetings[selTab].amMember && meetings[selTab].canTalk;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"meeting-tabs\">\r\n                {tabs.length > 0 &&\r\n                    tabs\r\n                }\r\n                {tabs.length == 0 &&\r\n                    <div className=\"tab sel\">\r\n                        {stateInfo && stateInfo.name}\r\n                    </div>\r\n                }\r\n            </div>\r\n            <div className=\"speech-wrapper\">\r\n                <div\r\n                    className=\"speech-display\"\r\n                    onScroll={onSpeechScroll}\r\n                    ref={speechDisplayRef}>\r\n                    {messages}\r\n                </div>\r\n                {canSpeak &&\r\n                    <SpeechInput\r\n                        meetings={meetings}\r\n                        selTab={selTab}\r\n                        players={players}\r\n                        options={props.options}\r\n                        socket={props.socket}\r\n                        setAutoScroll={setAutoScroll}\r\n                        agoraClient={props.agoraClient}\r\n                        localAudioTrack={props.localAudioTrack}\r\n                        muted={props.muted}\r\n                        setMuted={props.setMuted}\r\n                        deafened={props.deafened}\r\n                        setDeafened={props.setDeafened} />\r\n                }\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nfunction getMessagesToDisplay(meetings, alerts, selTab, players, settings, filters) {\r\n    var messages;\r\n\r\n    if (selTab)\r\n        messages = [...meetings[selTab].messages];\r\n    else\r\n        messages = [];\r\n\r\n    if (filters && (filters.from || filters.contains))\r\n        messages = messages.filter(m => {\r\n            var content = m.content || \"\";\r\n            var matches = content.toLowerCase().indexOf(filters.contains.toLowerCase()) != -1;\r\n\r\n            var playerName = players[m.senderId]?.name || \"\";\r\n            matches = matches && playerName.toLowerCase().indexOf(filters.from.toLowerCase()) != -1;\r\n\r\n            return matches;\r\n        });\r\n\r\n    for (let alert of alerts) {\r\n        for (let i = 0; i <= messages.length; i++) {\r\n            if (i == messages.length) {\r\n                messages.push(alert);\r\n                break;\r\n            }\r\n            else if (alert.time < messages[i].time) {\r\n                messages.splice(i, 0, alert);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!settings.votingLog)\r\n        return messages;\r\n\r\n    var voteRecord;\r\n\r\n    if (selTab)\r\n        voteRecord = meetings[selTab].voteRecord;\r\n    else\r\n        voteRecord = [];\r\n\r\n    for (let meetingId in meetings)\r\n        if (!meetings[meetingId].speech)\r\n            voteRecord = voteRecord.concat(meetings[meetingId].voteRecord);\r\n\r\n    for (let vote of voteRecord) {\r\n        let isUnvote = vote.type == \"unvote\";\r\n        let voter = players[vote.voterId];\r\n        let voterName = voter ? voter.name : \"Anonymous\";\r\n        let target = vote.target;\r\n\r\n        if (!isUnvote) {\r\n            if (target != \"*\" && players[target])\r\n                target = players[target].name;\r\n            else if (target == \"*\")\r\n                target = \"no one\";\r\n        }\r\n\r\n        let voteMsg = {\r\n            senderId: \"vote\",\r\n            content: `${voterName} ${isUnvote ? \"unvotes\" : \"votes\"} ${isUnvote ? \"\" : target}`,\r\n            time: vote.time\r\n        };\r\n\r\n        for (let i = 0; i <= messages.length; i++) {\r\n            if (i == messages.length) {\r\n                messages.push(voteMsg);\r\n                break;\r\n            }\r\n            else if (vote.time < messages[i].time) {\r\n                messages.splice(i, 0, voteMsg);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    return messages;\r\n}\r\n\r\nfunction areSameDay(first, second) {\r\n    first = new Date(first);\r\n    second = new Date(second);\r\n    first.setYear(0);\r\n    second.setYear(0);\r\n    if (first.getMonth() === second.getMonth() &&\r\n        first.getDate() === second.getDate()) {\r\n            return true;\r\n        }\r\n        return false;\r\n}\r\n\r\nfunction Message(props) {\r\n    const history = props.history;\r\n    const players = props.players;\r\n    const user = useContext(UserContext);\r\n\r\n    var message = props.message;\r\n    var player, quotedMessage;\r\n    var contentClass = \"content \";\r\n    var isMe = false;\r\n    var currentState = props.history.currentState;\r\n    var meetings = history.states[currentState].meetings;\r\n\r\n    if (\r\n        message.senderId != \"server\" &&\r\n        message.senderId != \"vote\" &&\r\n        message.senderId != \"anonymous\"\r\n    ) {\r\n        player = players[message.senderId];\r\n    }\r\n\r\n    if (message.isQuote) {\r\n        var state = history.states[message.fromState];\r\n\r\n        if (!state)\r\n            return <></>;\r\n\r\n        var meeting = state.meetings[message.fromMeetingId];\r\n\r\n        if (!meeting)\r\n            return <></>;\r\n\r\n        for (let msg of meeting.messages) {\r\n            if (msg.id == message.messageId) {\r\n                quotedMessage = { ...msg };\r\n                quotedMessage.meetingName = meeting.name;\r\n\r\n                if (msg.senderId == \"anonymous\")\r\n                    quotedMessage.senderName = \"Anonymous\";\r\n                else\r\n                    quotedMessage.senderName = players[msg.senderId].name;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (message.isQuote && !quotedMessage)\r\n        return <></>;\r\n\r\n    if(meetings[message.meetingId] !== undefined){\r\n        if (meetings[message.meetingId].name === \"Party!\") {\r\n            contentClass += \"party \";\r\n        }\r\n    }\r\n\r\n    if ((player || message.senderId == \"anonymous\") && !message.isQuote)\r\n        contentClass += \"clickable \";\r\n\r\n    if (!message.isQuote && message.content.indexOf(\"/me \") == 0) {\r\n        isMe = true;\r\n        message = { ...message };\r\n        message.content = message.content.replace(\"/me \", \"\");\r\n    }\r\n\r\n    if (message.isQuote)\r\n        contentClass += \"quote \";\r\n    else if (message.senderId == \"server\")\r\n        contentClass += \"server \";\r\n    else if (message.senderId == \"vote\")\r\n        contentClass += \"vote-record \";\r\n    else if (isMe)\r\n        contentClass += \"me \";\r\n\r\n    const messageStyle = {};\r\n    if(props.unfocusedMessage) {\r\n        messageStyle.opacity = \"0.2\";\r\n    }\r\n\r\n    if(player !== undefined) {\r\n        if(player.birthday !== undefined) {\r\n            if (areSameDay(Date.now(), player.birthday)) {\r\n                contentClass += \" party \";\r\n            }\r\n        }\r\n    }\r\n\r\n    if (message.content?.startsWith(\">\")) {\r\n        contentClass += \"greentext \";\r\n    }\r\n\r\n    if (player !== undefined && player.textColor !== undefined) {\r\n        contentClass += `${adjustColor(player.textColor)}`;\r\n    }\r\n    \r\n    return (\r\n        <div\r\n            className=\"message\"\r\n            onDoubleClick={() => props.onMessageQuote(message)}\r\n            style={messageStyle}\r\n        >\r\n            <div className=\"sender\">\r\n                {props.settings.timestamps &&\r\n                    <Timestamp time={message.time} />\r\n                }\r\n                {player &&\r\n                    <NameWithAvatar\r\n                        id={player.userId}\r\n                        name={player.name}\r\n                        avatar={player.avatar}\r\n                        color={player.nameColor}\r\n                        noLink\r\n                        small />\r\n                }\r\n                {message.senderId == \"anonymous\" &&\r\n                    <div className=\"name-with-avatar\">\r\n                        Anonymous\r\n                    </div>\r\n                }\r\n            </div>\r\n            <div className={contentClass} style={player && player.textColor ? { color: flipTextColor(player.textColor) } : {}}>\r\n                {!message.isQuote &&\r\n                    <>\r\n                        {message.prefix &&\r\n                            <div className=\"prefix\">\r\n                                ({message.prefix})\r\n                            </div>\r\n                        }\r\n                        <UserText\r\n                            text={message.content}\r\n                            settings={user.settings}\r\n                            players={players}\r\n                            filterProfanity\r\n                            linkify\r\n                            emotify\r\n                            iconUsername />\r\n                    </>\r\n                }\r\n                {message.isQuote &&\r\n                    <>\r\n                        <i className=\"fas fa-quote-left\" />\r\n                        <Timestamp time={quotedMessage.time} />\r\n                        <div className=\"quote-info\">\r\n                            {`${quotedMessage.senderName} in ${quotedMessage.meetingName}: `}\r\n                        </div>\r\n                        <div className=\"quote-content\">\r\n                            <UserText\r\n                                text={quotedMessage.content}\r\n                                settings={user.settings}\r\n                                players={players}\r\n                                filterProfanity\r\n                                linkify\r\n                                emotify\r\n                                iconUsername />\r\n                        </div>\r\n                        <i className=\"fas fa-quote-right\" />\r\n                    </>\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function Timestamp(props) {\r\n    const time = new Date(props.time);\r\n    var hours = String(time.getHours()).padStart(2, \"0\");\r\n    var minutes = String(time.getMinutes()).padStart(2, \"0\");\r\n    var seconds = String(time.getSeconds()).padStart(2, \"0\");\r\n\r\n    return (\r\n        <div className=\"time\">\r\n            {hours}:{minutes}:{seconds}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SpeechInput(props) {\r\n    const socket = props.socket;\r\n    const meetings = props.meetings;\r\n    const selTab = props.selTab;\r\n    const players = props.players;\r\n    const options = props.options;\r\n    const agoraClient = props.agoraClient;\r\n    const localAudioTrack = props.localAudioTrack;\r\n    const muted = props.muted;\r\n    const setMuted = props.setMuted;\r\n    const deafened = props.deafened;\r\n    const setDeafened = props.setDeafened;\r\n\r\n    const [speechInput, setSpeechInput] = useState(\"\");\r\n    const [speechDropdownOptions, setSpeechDropdownOptions] = useState([]);\r\n    const [speechDropdownValue, setSpeechDropdownValue] = useState(\"Say\");\r\n    const [lastTyped, setLastTyped] = useState(0);\r\n    const [typingIn, setTypingIn] = useState();\r\n    const [clearTyping, setClearTyping] = useState();\r\n\r\n    var placeholder = \"\";\r\n\r\n    for (let option of speechDropdownOptions) {\r\n        if (speechDropdownValue == option.id) {\r\n            placeholder = option.placeholder || \"\";\r\n            break;\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!selTab)\r\n            return <></>;\r\n\r\n        const speechAbilities = meetings[selTab].speechAbilities;\r\n        const newDropdownOptions = [{ label: \"Say\", id: \"Say\", placeholder: \"to everyone\" }];\r\n\r\n        for (let ability of speechAbilities) {\r\n            newDropdownOptions.push(\"divider\");\r\n\r\n            for (let target of ability.targets) {\r\n                let targetDisplay = target;\r\n\r\n                if (ability.targetType == \"player\")\r\n                    targetDisplay = players[target].name;\r\n\r\n                newDropdownOptions.push({\r\n                    label: ability.name,\r\n                    placeholder: `${ability.verb} ${targetDisplay}`,\r\n                    id: `${ability.name}:${target}`\r\n                });\r\n            }\r\n        }\r\n\r\n        setSpeechDropdownOptions(newDropdownOptions);\r\n    }, [selTab]);\r\n\r\n    useEffect(() => {\r\n        if (lastTyped > 0) {\r\n            clearTimeout(clearTyping);\r\n            setClearTyping(setTimeout(() => setLastTyped(0), 1000));\r\n\r\n            if (typingIn != selTab) {\r\n                setTypingIn(selTab);\r\n\r\n                if (typingIn != null)\r\n                    socket.send(\"typing\", { meetingId: typingIn, isTyping: false });\r\n\r\n                socket.send(\"typing\", { meetingId: selTab, isTyping: true });\r\n            }\r\n        }\r\n        else if (typingIn != null) {\r\n            setTypingIn(null);\r\n            socket.send(\"typing\", { meetingId: typingIn, isTyping: false });\r\n        }\r\n\r\n    }, [lastTyped]);\r\n\r\n    function onSpeechDropdownChange(value) {\r\n        setSpeechDropdownValue(value);\r\n    }\r\n\r\n    function onSpeechType(e) {\r\n        setSpeechInput(e.target.value);\r\n\r\n        if (\r\n            e.target.value.length > 0 &&\r\n            (e.target.value[0] != \"/\" || e.target.value.slice(0, 4) == \"/me \") &&\r\n            !meetings[selTab].anonymous &&\r\n            speechDropdownValue == \"Say\"\r\n        ) {\r\n            setLastTyped(Date.now());\r\n        }\r\n    }\r\n\r\n    function onSpeechSubmit(e) {\r\n        if (e.key === \"Enter\" && selTab && speechInput.length) {\r\n            const abilityInfo = speechDropdownValue.split(\":\");\r\n            var abilityName = abilityInfo[0];\r\n            var abilityTarget = abilityInfo[1];\r\n\r\n            if (abilityName == \"Say\")\r\n                abilityName = null;\r\n\r\n            if (textIncludesSlurs(speechInput)) {\r\n                socket.send(\"slurDetected\");\r\n            } else {\r\n                socket.send(\"speak\", {\r\n                    content: speechInput,\r\n                    meetingId: selTab,\r\n                    abilityName,\r\n                    abilityTarget\r\n                });\r\n                props.setAutoScroll(true);\r\n           }\r\n            \r\n            setSpeechInput(\"\");\r\n\r\n        } else if (e.key === \"Tab\") {\r\n            e.preventDefault();\r\n            const words = speechInput.split(\" \");\r\n            const word = words.pop();\r\n            // Removing non-word characters before the string.\r\n            const seedString = word.match(/[^\\w-]?([\\w-]*)$/)[1].toLowerCase();\r\n            const prefix = word.substring(0, word.length - seedString.length);\r\n            if (!seedString.length)\r\n                return;\r\n\r\n            const playerNames = Object.values(players).map(player => player.name);\r\n            const playerSeeds = playerNames.map(playerName => playerName.toLowerCase().substring(0, seedString.length));\r\n            const matchedPlayers = [];\r\n            for (const i in playerSeeds) { // Checking seed string against characters in player names.\r\n                if (playerSeeds[i] === seedString) {\r\n                    matchedPlayers.push(playerNames[i]);\r\n                }\r\n            }\r\n            if (matchedPlayers.length) {\r\n                if (matchedPlayers.length === 1) { // If one matching player, autocomplete entire name.\r\n                    words.push(prefix + matchedPlayers[0]);\r\n                } else { // If multiple matching players, autocomplete until player names diverge.\r\n                    let autocompleted = \"\";\r\n                    let i = 1;\r\n                    while (matchedPlayers.every(playerName => playerName[i] === matchedPlayers[0][i])) {\r\n                        i += 1;\r\n                    }\r\n                    words.push(prefix + matchedPlayers[0].substring(0, i));\r\n                }\r\n                setSpeechInput(words.join(\" \"));\r\n            } else if (word.toLowerCase() === \"@everyone\".substring(0, word.length)) { // Check for @everyone.\r\n                words.push(\"@everyone\");\r\n                setSpeechInput(words.join(\" \"));\r\n            }\r\n        }\r\n    }\r\n\r\n    function onMute() {\r\n        if (localAudioTrack.current) {\r\n            var volume = muted ? 100 : 0;\r\n\r\n            localAudioTrack.current.setVolume(volume);\r\n            setMuted(!muted);\r\n        }\r\n    }\r\n\r\n    function onDeafen() {\r\n        if (agoraClient.current) {\r\n            var volume = deafened ? 100 : 0;\r\n\r\n            agoraClient.current.remoteUsers.forEach(user => {\r\n                user.audioTrack && user.audioTrack.setVolume(volume);\r\n            });\r\n\r\n            setDeafened(!deafened);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"speech-input-area\">\r\n            <div className=\"speech-input-wrapper\">\r\n                <Dropdown\r\n                    className=\"speech-dropdown\"\r\n                    options={speechDropdownOptions}\r\n                    onChange={onSpeechDropdownChange}\r\n                    value={speechDropdownValue} />\r\n                <input\r\n                    id=\"speechInput\"\r\n                    className=\"speech-input\"\r\n                    type=\"text\"\r\n                    autoComplete=\"off\"\r\n                    value={speechInput}\r\n                    placeholder={placeholder}\r\n                    maxLength={MaxGameMessageLength}\r\n                    onChange={onSpeechType}\r\n                    enterKeyHint=\"done\"\r\n                    onKeyDown={onSpeechSubmit} />\r\n            </div>\r\n            {options.voiceChat &&\r\n                <>\r\n                    <i className={`fas fa-microphone ${muted ? \"disabled\" : \"\"}`} onClick={onMute} />\r\n                    <i className={`fas fa-headphones ${deafened ? \"disabled\" : \"\"}`} onClick={onDeafen} />\r\n                </>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function StateSwitcher(props) {\r\n    const history = props.history;\r\n    const stateViewing = props.stateViewing;\r\n    const stateName = history.states[stateViewing] ? history.states[stateViewing].name : \"\";\r\n\r\n    const leftArrowVisible = props.stateViewing != -1;\r\n    const rigthArrowVisible =\r\n        props.stateViewing < history.currentState ||\r\n        (history.currentState == -2 && props.stateViewing != history.currentState);\r\n\r\n    function onStateNameClick() {\r\n        props.updateStateViewing({ type: \"current\" });\r\n    }\r\n\r\n    return (\r\n        <div className=\"state-nav\">\r\n            <i\r\n                className={`hist-arrow fas fa-caret-left ${leftArrowVisible ? \"\" : \"invisible\"}`}\r\n                onClick={() => props.updateStateViewing({ type: \"backward\" })} />\r\n            <div\r\n                className=\"state-name\"\r\n                onClick={onStateNameClick}>\r\n                {stateName.toUpperCase()}\r\n            </div>\r\n            <i\r\n                className={`hist-arrow fas fa-caret-right ${rigthArrowVisible ? \"\" : \"invisible\"}`}\r\n                onClick={() => props.updateStateViewing({ type: \"forward\" })} />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function formatTimerTime(time) {\r\n    if (time > 0)\r\n        time = Math.round(time / 1000);\r\n    else\r\n        time = 0;\r\n\r\n    const minutes = String(Math.floor(time / 60)).padStart(2, \"0\");\r\n    const seconds = String(time % 60).padStart(2, \"0\");\r\n\r\n    return `${minutes}:${seconds}`;\r\n}\r\n\r\nexport function SideMenu(props) {\r\n    return (\r\n        <div className={`side-menu ${props.scrollable ? \"scrollable\" : \"\"}`}>\r\n            <div className=\"side-menu-title\">\r\n                {props.title}\r\n            </div>\r\n            <div className=\"side-menu-content\">\r\n                {props.content}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction RoleMarkerToggle(props) {\r\n    const roleMarkerRef = useRef();\r\n    const popover = useContext(PopoverContext);\r\n    const game = useContext(GameContext);\r\n    const { toggleRolePrediction } = game;\r\n    const playerId = props.playerId;\r\n\r\n    function onRoleMarkerClick() {\r\n\t\tif (props.onClick)\r\n\t\t\tprops.onClick();        \r\n        \r\n        popover.onClick(\r\n            `/setup/${game.setup.id}`,\r\n            \"rolePrediction\",\r\n            roleMarkerRef.current,\r\n            \"Mark Role as\",\r\n            data => {\r\n                data.roles = JSON.parse(data.roles)[0];\r\n                data.toggleRolePrediction = toggleRolePrediction(playerId);\r\n            }\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"role-marker\" \r\n            onClick={onRoleMarkerClick}\r\n            ref={roleMarkerRef}>\r\n\r\n            <i className=\"fas fa-user-edit\"></i>\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nexport function PlayerRows(props) {\r\n    const game = useContext(GameContext);\r\n    const { isolationEnabled, togglePlayerIsolation, isolatedPlayers } = game;\r\n    const { rolePredictions } = game;\r\n    const history = props.history;\r\n    const players = props.players;\r\n    const activity = props.activity;\r\n    const stateViewingInfo = history.states[props.stateViewing];\r\n    const selTab = stateViewingInfo && stateViewingInfo.selTab;\r\n\r\n    const isPlayerIsolated = playerId => isolatedPlayers.has(playerId);\r\n\r\n    const rows = players.map(player => {\r\n        const isolationCheckbox = isolationEnabled && (\r\n            <input\r\n                type=\"checkbox\"\r\n                checked={isPlayerIsolated(player.id)}\r\n                onChange={() => togglePlayerIsolation(player.id)}\r\n            />\r\n        )\r\n\r\n        const rolePrediction = rolePredictions[player.id];\r\n        const roleToShow = rolePrediction ? rolePrediction : stateViewingInfo.roles[player.id];\r\n\r\n        var colorAutoScheme = false;\r\n        var bubbleColor = \"black\";\r\n        if (document.documentElement.classList.length === 0) {\r\n                colorAutoScheme = true;\r\n        }\r\n        else {\r\n             if (!document.documentElement.classList.contains(\"light-mode\")) {\r\n                 if (!document.documentElement.classList.contains(\"dark-mode\")) {\r\n                     colorAutoScheme = true;\r\n                 }\r\n                 else {\r\n                     bubbleColor = \"white\";\r\n                 }\r\n             }\r\n             else {\r\n                 bubbleColor = \"black\";\r\n             }\r\n        }\r\n\r\n        if (colorAutoScheme) {\r\n            if (window.matchMedia(\"(prefers-color-scheme: dark)\").matches) {\r\n                bubbleColor = \"white\";\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div\r\n                className={`player ${props.className ? props.className : \"\"}`}\r\n                key={player.id}>\r\n                {isolationCheckbox}\r\n                {props.stateViewing != -1 &&\r\n                    <RoleMarkerToggle\r\n                        playerId={player.id}\r\n                        />\r\n                }\r\n                {props.stateViewing != -1 &&\r\n                    <RoleCount\r\n                        role={roleToShow}\r\n                        isRolePrediction={rolePrediction !== undefined}\r\n                        gameType={props.gameType}\r\n                        showPopover />\r\n                }\r\n                <NameWithAvatar\r\n                    id={player.userId}\r\n                    name={player.name}\r\n                    avatar={player.avatar}\r\n                    color={player.nameColor}\r\n                    active={activity.speaking[player.id]}\r\n                    newTab />\r\n                {selTab && activity.typing[player.id] == selTab &&\r\n                    <ReactLoading\r\n                        className={`typing-icon ${props.stateViewing != -1 ? \"has-role\" : \"\"}`}\r\n                        type=\"bubbles\"\r\n                        color={bubbleColor}\r\n                        width=\"20\"\r\n                        height=\"20\" />\r\n                }\r\n            </div>\r\n        )\r\n    });\r\n\r\n    return rows;\r\n}\r\n\r\nexport function PlayerList(props) {\r\n    const history = props.history;\r\n    const stateViewingInfo = history.states[props.stateViewing];\r\n    const alivePlayers = Object.values(props.players).filter(p => !stateViewingInfo.dead[p.id] && !p.left);\r\n    const deadPlayers = Object.values(props.players).filter(p => stateViewingInfo.dead[p.id] && !p.left);\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Players\"\r\n            scrollable\r\n            content={\r\n                <div className=\"player-list\">\r\n                    <PlayerRows\r\n                        players={alivePlayers}\r\n                        history={history}\r\n                        gameType={props.gameType}\r\n                        stateViewing={props.stateViewing}\r\n                        activity={props.activity} />\r\n                    {deadPlayers.length > 0 &&\r\n                        <div className=\"section-title\">\r\n                            <i className=\"fas fa-skull\" />\r\n                            Graveyard\r\n                        </div>\r\n                    }\r\n                    <PlayerRows\r\n                        players={deadPlayers}\r\n                        history={history}\r\n                        gameType={props.gameType}\r\n                        stateViewing={props.stateViewing}\r\n                        activity={props.activity}\r\n                        className=\"dead\" />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nexport function ActionList(props) {\r\n    const actions = Object.values(props.meetings).reduce((actions, meeting) => {\r\n        if (meeting.voting) {\r\n            var action;\r\n\r\n            switch (meeting.inputType) {\r\n                case \"player\":\r\n                case \"boolean\":\r\n                case \"role\":\r\n                case \"alignment\":\r\n                case \"custom\":\r\n                case \"select\":\r\n                    action =\r\n                        <ActionSelect\r\n                            key={meeting.id}\r\n                            socket={props.socket}\r\n                            meeting={meeting}\r\n                            players={props.players}\r\n                            self={props.self}\r\n                            history={props.history}\r\n                            stateViewing={props.stateViewing} />;\r\n                    break;\r\n                case \"button\":\r\n                    action =\r\n                        <ActionButton\r\n                            key={meeting.id}\r\n                            socket={props.socket}\r\n                            meeting={meeting}\r\n                            players={props.players}\r\n                            self={props.self}\r\n                            history={props.history}\r\n                            stateViewing={props.stateViewing} />;\r\n                    break;\r\n                case \"text\":\r\n                    action =\r\n                        <ActionText\r\n                            key={meeting.id}\r\n                            socket={props.socket}\r\n                            meeting={meeting}\r\n                            players={props.players}\r\n                            self={props.self}\r\n                            history={props.history}\r\n                            stateViewing={props.stateViewing} />;\r\n                    break;\r\n            }\r\n\r\n            actions.push(action);\r\n        }\r\n        return actions;\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            {actions.length > 0 &&\r\n                <SideMenu\r\n                    scrollable\r\n                    title=\"Actions\"\r\n                    content={\r\n                        <div className=\"action-list\">\r\n                            {actions}\r\n                        </div>\r\n                    } />\r\n            }\r\n        </>\r\n    );\r\n}\r\n\r\nfunction ActionSelect(props) {\r\n    const [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n    const [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef] = useDropdown();\r\n\r\n    const targets = meeting.targets.map(target => {\r\n        var targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n        return (\r\n            <div\r\n                className=\"target dropdown-menu-option\"\r\n                key={target}\r\n                onClick={() => onSelectVote(target)}>\r\n                {targetDisplay}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    const votes = Object.values(meeting.members).map(member => {\r\n        var selection = meeting.votes[member.id];\r\n        var player = props.players[member.id];\r\n        selection = getTargetDisplay(selection, meeting, props.players);\r\n        \r\n        return (\r\n            <div\r\n                className={`vote ${meeting.multi ? \"multi\" : \"\"}`}\r\n                key={member.id}>\r\n                <div\r\n                    className=\"voter\"\r\n                    onClick={() => onSelectVote(member.id)}>\r\n                    {(player && player.name) || \"Anonymous\"}\r\n                </div>\r\n                {\r\n                    !member.canVote &&\r\n                    <div className=\"selection\">\r\n                        does not vote\r\n                    </div>\r\n                }\r\n                {\r\n                    member.canVote &&\r\n                    selection.length > 0 &&\r\n                    <div className=\"italic\">\r\n                        votes\r\n                    </div>\r\n                }\r\n                {\r\n                    member.canVote &&\r\n                    <div className=\"selection\">\r\n                        {selection.join(\", \")}\r\n                    </div>\r\n                }\r\n            </div>\r\n        );\r\n    });\r\n\r\n    function onSelectVote(sel) {\r\n        setMenuVisible(false);\r\n        onVote(sel);\r\n    }\r\n\r\n    function onActionClick() {\r\n        if (!notClickable)\r\n            setMenuVisible(!menuVisible);\r\n    }\r\n\r\n    return (\r\n        <div className=\"action\">\r\n            <div\r\n                className={`action-name dropdown-control ${notClickable ? \"not-clickable\" : \"\"}`}\r\n                ref={dropdownContainerRef}\r\n                onClick={onActionClick}>\r\n                {meeting.actionName}\r\n                <i className=\"fas fa-angle-down dropdown-arrow\" />\r\n            </div>\r\n            {menuVisible &&\r\n                <div\r\n                    className=\"targets dropdown-menu\"\r\n                    ref={dropdownMenuRef}>\r\n                    {targets}\r\n                </div>\r\n            }\r\n            <div className=\"votes\">\r\n                {votes}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ActionButton(props) {\r\n    const [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n    if (notClickable) {\r\n        return null;\r\n    }\r\n    const votes = { ...meeting.votes };\r\n\r\n    for (let playerId in votes)\r\n        votes[playerId] = getTargetDisplay(votes[playerId], meeting, props.players);\r\n\r\n    const buttons = meeting.targets.map(target => {\r\n        var targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n        return (\r\n            <div\r\n                className={`btn btn-theme ${votes[props.self] == targetDisplay ? \"sel\" : \"\"}`}\r\n                key={target}\r\n                disabled={votes[props.self] && !meeting.canUnvote}\r\n                onClick={() => onVote(target)}>\r\n                {targetDisplay}\r\n            </div>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <div className=\"action\">\r\n            <div className=\"action-name\">\r\n                {meeting.actionName}\r\n            </div>\r\n            {buttons}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ActionText(props) {\r\n    const meeting = props.meeting;\r\n    const self = props.self;\r\n\r\n    // text settings\r\n    const textOptions = meeting.textOptions || {}\r\n    const minLength = textOptions.minLength || 0;\r\n    const maxLength = textOptions.maxLength || MaxTextInputLength\r\n\r\n    const [textData, setTextData] = useState(\"\");\r\n\r\n    function handleOnChange(e) {\r\n        var textInput = e.target.value;\r\n        // disable new lines by default\r\n        textInput = textInput.replace(/\\n/g, \" \");\r\n\r\n        if (textOptions.alphaOnly) {\r\n            textInput = textInput.replace(/[^a-z]/gi, '');\r\n        }\r\n        if (textOptions.toLowerCase) {\r\n            textInput = textInput.toLowerCase();\r\n        }\r\n\r\n        textInput = textInput.substring(0, maxLength);\r\n        setTextData(textInput);\r\n    }\r\n\r\n    function handleOnSubmit(e) {\r\n        if (textData.length < minLength) {\r\n            return;\r\n        }\r\n\r\n        meeting.votes[self] = textData;\r\n        props.socket.send(\"vote\", {\r\n            meetingId: meeting.id,\r\n            selection: textData\r\n        });\r\n    }\r\n\r\n    return (\r\n        <div className=\"action\">\r\n            <div className=\"action-name\">\r\n                {meeting.actionName}\r\n            </div>\r\n            <textarea\r\n                value={textData}\r\n                onChange={handleOnChange} />\r\n            <div\r\n                className=\"btn btn-theme\"\r\n                onClick={handleOnSubmit}>\r\n                {textOptions.submit || \"Submit\"}\r\n            </div>\r\n            {meeting.votes[self]}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction useAction(props) {\r\n    const meeting = props.meeting;\r\n    const history = props.history;\r\n    const stateViewing = props.stateViewing;\r\n    const isCurrentState = stateViewing == history.currentState;\r\n\r\n    const notClickable = !isCurrentState || !meeting.amMember || !meeting.canVote || (meeting.instant && meeting.votes[props.self]);\r\n\r\n    function onVote(sel) {\r\n        var isUnvote;\r\n\r\n        if (!Array.isArray(meeting.votes[props.self]))\r\n            isUnvote = sel == meeting.votes[props.self];\r\n        else\r\n            isUnvote = meeting.votes[props.self].indexOf(sel) != -1;\r\n\r\n        if (!isUnvote) {\r\n            props.socket.send(\"vote\", {\r\n                meetingId: meeting.id,\r\n                selection: sel\r\n            });\r\n        }\r\n        else {\r\n            props.socket.send(\"unvote\", {\r\n                meetingId: meeting.id,\r\n                selection: sel\r\n            });\r\n        }\r\n    }\r\n\r\n    return [meeting, history, stateViewing, isCurrentState, notClickable, onVote];\r\n}\r\n\r\nfunction getTargetDisplay(targets, meeting, players) {\r\n    if (!Array.isArray(targets) && targets)\r\n        targets = [targets];\r\n    else if (!targets)\r\n        targets = [];\r\n    else\r\n        targets = [...targets];\r\n\r\n    for (let i in targets) {\r\n        let target = targets[i];\r\n\r\n        switch (meeting.inputType) {\r\n            case \"player\":\r\n                if (target == \"*\")\r\n                    target = \"no one\";\r\n                else if (target)\r\n                    target = players[target].name;\r\n                else\r\n                    target = \"\";\r\n                break;\r\n            case \"boolean\":\r\n                if (target == \"*\")\r\n                    target = \"No\";\r\n                else if (!target)\r\n                    target = \"\";\r\n            default:\r\n                if (target == \"*\")\r\n                    target = \"None\";\r\n                else if (!target)\r\n                    target = \"\";\r\n        }\r\n\r\n        targets[i] = target;\r\n    }\r\n\r\n    return targets;\r\n}\r\n\r\nexport function Timer(props) {\r\n    var timerName;\r\n\r\n    if (props.history.currentState == -1)\r\n        timerName = \"pregameCountdown\";\r\n    else if (props.history.currentState == -2)\r\n        timerName = \"postgame\";\r\n    else if (props.timers[\"secondary\"])\r\n        timerName = \"secondary\";\r\n    else if (props.timers[\"vegKick\"])\r\n        timerName = \"vegKick\";\r\n    else\r\n        timerName = \"main\";\r\n\r\n    const timer = props.timers[timerName];\r\n\r\n    if (!timer)\r\n        return <div className=\"state-timer\"></div>;\r\n\r\n    var time = timer.delay - timer.time;\r\n\r\n    if (props.timers[\"secondary\"]) {\r\n        // show main timer if needed\r\n        const mainTimer = props.timers[\"main\"];\r\n        if (mainTimer) {\r\n            var mainTime = mainTimer.delay - mainTimer.time;\r\n            time = Math.min(time, mainTime);\r\n        }\r\n    }\r\n\r\n    time = formatTimerTime(time);\r\n\r\n    if(timerName === \"vegKick\"){\r\n        return (\r\n            <div className=\"state-timer\">\r\n                Kicking in {time}\r\n            </div>\r\n        );\r\n    }\r\n    return (\r\n        <div className=\"state-timer\">\r\n            {time}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function LastWillEntry(props) {\r\n    const [lastWill, setLastWill] = useState(props.lastWill);\r\n\r\n    function onWillChange(e) {\r\n        var newWill = e.target.value.slice(0, MaxWillLength);\r\n        setLastWill(newWill);\r\n        props.socket.send(\"lastWill\", newWill);\r\n    }\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Last Will\"\r\n            content={\r\n                <div className=\"last-will-wrapper\">\r\n                    <textarea\r\n                        className=\"last-will-entry\"\r\n                        value={lastWill}\r\n                        onChange={onWillChange} />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nfunction SettingsModal(props) {\r\n    const settings = props.settings;\r\n    const updateSettings = props.updateSettings;\r\n    const showModal = props.showModal;\r\n    const setShowModal = props.setShowModal;\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Voting Log\",\r\n            ref: \"votingLog\",\r\n            type: \"boolean\",\r\n            value: settings.votingLog\r\n        },\r\n        {\r\n            label: \"Timestamps\",\r\n            ref: \"timestamps\",\r\n            type: \"boolean\",\r\n            value: settings.timestamps\r\n        },\r\n        {\r\n            label: \"Sounds\",\r\n            ref: \"sounds\",\r\n            type: \"boolean\",\r\n            value: settings.sounds\r\n        },\r\n        {\r\n            label: \"Volume\",\r\n            ref: \"volume\",\r\n            type: \"range\",\r\n            min: 0,\r\n            max: 1,\r\n            step: 0.1,\r\n            value: settings.volume\r\n        },\r\n    ]);\r\n\r\n    const modalHeader = \"Settings\";\r\n\r\n    const modalContent = (\r\n        <Form\r\n            fields={formFields}\r\n            onChange={updateFormFields} />\r\n    );\r\n\r\n    const modalFooter = (\r\n        <div className=\"settings-control\">\r\n            <div\r\n                className=\"settings-save btn btn-theme\"\r\n                onClick={saveSettings}>\r\n                Save\r\n            </div>\r\n            <div\r\n                className=\"settings-cancel btn btn-theme-third\"\r\n                onClick={cancel}>\r\n                Cancel\r\n            </div>\r\n        </div>\r\n    );\r\n    function cancel() {\r\n        for (let field of formFields) {\r\n            updateFormFields({\r\n                ref: field.ref,\r\n                prop: \"value\",\r\n                value: settings[field.ref]\r\n            });\r\n        }\r\n\r\n        setShowModal(false);\r\n    }\r\n\r\n    function saveSettings() {\r\n        var newSettings = {};\r\n\r\n        for (let field of formFields)\r\n            newSettings[field.ref] = field.value;\r\n\r\n        updateSettings({\r\n            type: \"set\",\r\n            settings: newSettings\r\n        });\r\n\r\n        setShowModal(false);\r\n    }\r\n\r\n    return (\r\n        <Modal\r\n            className=\"settings\"\r\n            show={showModal}\r\n            header={modalHeader}\r\n            content={modalContent}\r\n            footer={modalFooter}\r\n            onBgClick={cancel} />\r\n    );\r\n}\r\n\r\nfunction FirstGameModal(props) {\r\n    const showModal = props.showModal;\r\n    const setShowModal = props.setShowModal;\r\n\r\n    const modalHeader = \"Welcome to BeyondMafia\";\r\n\r\n    const modalContent = (\r\n        <>\r\n            <div className=\"paragraph\">\r\n                To keep games fun and competitive for all, please don't:\r\n            </div>\r\n\r\n            <div className=\"paragraph\">\r\n                <div>\r\n                    - Communicate with other players using anything which isn't part of the game.\r\n                </div>\r\n                <div>\r\n                    - Form alliances or other out-of-game arrangements with other users.\r\n                </div>\r\n                <div>\r\n                    - Attempt to play a game using more than one account.\r\n                </div>\r\n                <div>\r\n                    - Send screenshots or \"prove\" anything with images or video.\r\n                </div>\r\n                <div>\r\n                    - Copy exactly any system messages you recieve (blue text).\r\n                </div>\r\n                <div>\r\n                    - Try to lose the game on purpose.\r\n                </div>\r\n                <div>\r\n                    - Give up or leave partway through the game.\r\n                </div>\r\n                <div>\r\n                    - Issue out-of-game bribes or threats to sway other players, including threatening to leave.\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"paragraph\">\r\n                Breaking game conduct may result in necessary action being taken against your account.\r\n            </div>\r\n            <div className=\"paragraph\">\r\n                A full description of these rules as well as site and community rules is found <a href=\"/community/forums/board/-2z5mOHaYp\">here</a>.\r\n            </div>\r\n            <div className=\"paragraph\">\r\n                You can also find tutorials, tips, and strategy guides <a href=\"/community/forums/board/ht4TEuL6lG\">here</a>. Good luck, and have fun!\r\n            </div>\r\n        </>\r\n    );\r\n\r\n    const modalFooter = (\r\n        <div\r\n            className=\"btn btn-theme\"\r\n            onClick={cancel}>\r\n            Close\r\n        </div>\r\n    );\r\n\r\n    function cancel() {\r\n        setShowModal(false);\r\n    }\r\n\r\n    return (\r\n        <Modal\r\n            className=\"first-game\"\r\n            show={showModal}\r\n            header={modalHeader}\r\n            content={modalContent}\r\n            footer={modalFooter}\r\n            onBgClick={cancel} />\r\n    );\r\n}\r\n\r\nexport function SpeechFilter(props) {\r\n    const game = useContext(GameContext);\r\n    const { isolationEnabled, setIsolationEnabled } = game;\r\n    const { filters, setFilters, stateViewing } = props;\r\n\r\n    const toggleIsolationEnabled = () => setIsolationEnabled(!isolationEnabled);\r\n\r\n    function onFilter(type, value) {\r\n        setFilters(update(filters, {\r\n            [type]: {\r\n                $set: value\r\n            }\r\n        }));\r\n    }\r\n\r\n    if (stateViewing < 0)\r\n        return <></>;\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Speech Filters\"\r\n            content={\r\n                <div className=\"speech-filters\">\r\n                    <div style={{marginBottom: \"10px\"}}>\r\n                        <input\r\n                            id=\"isolateMessagesCheckbox\"\r\n                            type=\"checkbox\"\r\n                            value={isolationEnabled}\r\n                            onChange={toggleIsolationEnabled} />\r\n                        <label htmlFor=\"isolateMessagesCheckbox\"> Isolate messages</label>\r\n                    </div>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"From user\"\r\n                        value={filters.from}\r\n                        onChange={(e) => onFilter(\"from\", e.target.value)}\r\n                        style={{marginBottom: \"10px\"}}\r\n                    />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Contains\"\r\n                        value={filters.contains}\r\n                        onChange={(e) => onFilter(\"contains\", e.target.value)} />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nexport function Notes(props) {\r\n    const stateViewing = props.stateViewing;\r\n    const [notes, setNotes] = useState(\"\");\r\n    const { gameId } = useParams();\r\n\r\n    useEffect(() => {\r\n        var notesData = window.localStorage.getItem(\"notesData\");\r\n\r\n        if (notesData) {\r\n            notesData = JSON.parse(notesData);\r\n\r\n            if (notesData.game != gameId)\r\n                window.localStorage.removeItem(\"notesData\");\r\n            else\r\n                setNotes(notesData.notes);\r\n        }\r\n    }, []);\r\n\r\n    function onNotesUpdate(_notes) {\r\n        setNotes(_notes);\r\n        window.localStorage.setItem(\"notesData\", JSON.stringify({ game: gameId, notes: _notes }));\r\n    }\r\n\r\n    if (stateViewing < 0)\r\n        return <></>;\r\n\r\n    return (\r\n        <SideMenu\r\n            title=\"Notes\"\r\n            content={\r\n                <div className=\"notes-wrapper\">\r\n                    <textarea\r\n                        className=\"notes-entry\"\r\n                        value={notes}\r\n                        onChange={(e) => onNotesUpdate(e.target.value)} />\r\n                </div>\r\n            } />\r\n    );\r\n}\r\n\r\nfunction useHistoryReducer() {\r\n    return useReducer((history, action) => {\r\n        var newHistory;\r\n\r\n        switch (action.type) {\r\n            case \"set\":\r\n                var stateIds = Object.keys(action.history).sort((a, b) => a - b);\r\n                newHistory = { states: action.history };\r\n\r\n                if (stateIds[0] == -2)\r\n                    newHistory.currentState = -2;\r\n                else\r\n                    newHistory.currentState = stateIds[stateIds.length - 1];\r\n                break;\r\n            case \"addState\":\r\n                if (!history.states[action.state.id]) {\r\n                    var prevState;\r\n\r\n                    if (action.state.id != -2)\r\n                        prevState = action.state.id - 1;\r\n                    else\r\n                        prevState = Object.keys(history.states).sort((a, b) => b - a)[0];\r\n\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [action.state.id]: {\r\n                                $set: {\r\n                                    name: action.state.name,\r\n                                    meetings: {},\r\n                                    alerts: [],\r\n                                    stateEvents: [],\r\n                                    roles: { ...history.states[prevState].roles },\r\n                                    dead: { ...history.states[prevState].dead },\r\n                                    extraInfo: { ...action.state.extraInfo }\r\n                                }\r\n                            }\r\n                        },\r\n                        currentState: {\r\n                            $set: action.state.id\r\n                        }\r\n                    });\r\n                }\r\n                else\r\n                    newHistory = history;\r\n                break;\r\n            case \"addMeeting\":\r\n                var state = history.states[history.currentState];\r\n\r\n                if (state) {\r\n                    if (!state.meetings) {\r\n                        newHistory = update(history, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    meetings: {\r\n                                        $set: {}\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    newHistory = update(newHistory || history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.meeting.id]: {\r\n                                        $set: action.meeting\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"meetingMembers\":\r\n                if (\r\n                    history.states[history.currentState] &&\r\n                    history.states[history.currentState].meetings[action.meetingId]\r\n                ) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.meetingId]: {\r\n                                        members: {\r\n                                            $set: action.members\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"removeMeeting\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    $unset: [action.meetingId]\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    if (newHistory.states[history.currentState].selTab == action.meetingId) {\r\n                        newHistory = update(newHistory, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    $unset: [\"selTab\"]\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            case \"addMessage\":\r\n                if (history.states[history.currentState]) {\r\n                    if (action.message.meetingId) {\r\n                        if (history.states[history.currentState].meetings[action.message.meetingId]) {\r\n                            newHistory = update(history, {\r\n                                states: {\r\n                                    [history.currentState]: {\r\n                                        meetings: {\r\n                                            [action.message.meetingId]: {\r\n                                                messages: {\r\n                                                    $push: [action.message]\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    else {\r\n                        newHistory = update(history, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    alerts: {\r\n                                        $push: [action.message]\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            case \"addQuote\":\r\n                if (\r\n                    history.states[history.currentState] &&\r\n                    history.states[history.currentState].meetings[action.quote.toMeetingId]\r\n                ) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.quote.toMeetingId]: {\r\n                                        messages: {\r\n                                            $push: [action.quote]\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"vote\":\r\n                var target = action.vote.target;\r\n                var state = history.states[history.currentState];\r\n                var meeting = state && state.meetings[action.vote.meetingId];\r\n\r\n                if (meeting) {\r\n                    if (meeting.multi)\r\n                        target = [...(meeting.votes[action.vote.voterId] || []), target];\r\n\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.vote.meetingId]: {\r\n                                        votes: {\r\n                                            [action.vote.voterId]: {\r\n                                                $set: target\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    if (!action.vote.noLog) {\r\n                        newHistory = update(newHistory, {\r\n                            states: {\r\n                                [history.currentState]: {\r\n                                    meetings: {\r\n                                        [action.vote.meetingId]: {\r\n                                            voteRecord: {\r\n                                                $push: [{\r\n                                                    type: \"vote\",\r\n                                                    voterId: action.vote.voterId,\r\n                                                    target: action.vote.target,\r\n                                                    time: Date.now()\r\n                                                }]\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            case \"unvote\":\r\n                var target = undefined;\r\n                var state = history.states[history.currentState];\r\n                var meeting = state && state.meetings[action.info.meetingId];\r\n\r\n                if (meeting) {\r\n                    if (meeting.multi)\r\n                        target = (meeting.votes[action.info.voterId] || []).filter(t => t != action.info.target);\r\n\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                meetings: {\r\n                                    [action.info.meetingId]: {\r\n                                        votes: {\r\n                                            [action.info.voterId]: {\r\n                                                $set: target\r\n                                            }\r\n                                        },\r\n                                        voteRecord: {\r\n                                            $push: [{\r\n                                                type: \"unvote\",\r\n                                                voterId: action.info.voterId,\r\n                                                time: Date.now()\r\n                                            }]\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"stateEvents\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                stateEvents: {\r\n                                    $set: action.stateEvents\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"selTab\":\r\n                if (history.states[action.state]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [action.state]: {\r\n                                selTab: {\r\n                                    $set: action.meetingId\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"reveal\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                roles: {\r\n                                    [action.playerId]: {\r\n                                        $set: action.role\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"death\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                dead: {\r\n                                    [action.playerId]: {\r\n                                        $set: true\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"revival\":\r\n                if (history.states[history.currentState]) {\r\n                    newHistory = update(history, {\r\n                        states: {\r\n                            [history.currentState]: {\r\n                                dead: {\r\n                                    [action.playerId]: {\r\n                                        $set: false\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n        }\r\n\r\n        return newHistory || history;\r\n    }, { states: {} });\r\n}\r\n\r\nexport function useStateViewingReducer(history) {\r\n    return useReducer((state, action) => {\r\n        var newState;\r\n\r\n        switch (action.type) {\r\n            case \"backward\":\r\n                if (state > -2)\r\n                    newState = state - 1;\r\n                else\r\n                    newState = Math.max(...Object.keys(history.states));\r\n                break;\r\n            case \"forward\":\r\n                if (history.states[state + 1])\r\n                    newState = state + 1;\r\n                else\r\n                    newState = -2;\r\n                break;\r\n            case \"current\":\r\n                newState = history.currentState;\r\n                break;\r\n            case \"first\":\r\n                newState = -1;\r\n                break;\r\n            default:\r\n                newState = state;\r\n        }\r\n\r\n        if (history.states[newState])\r\n            return newState;\r\n        else\r\n            return state;\r\n    }, history.currentState);\r\n}\r\n\r\nexport function useTimersReducer() {\r\n    return useReducer((timers, action) => {\r\n        var newTimers = { ...timers };\r\n\r\n        switch (action.type) {\r\n            case \"create\":\r\n                newTimers[action.timer.name] = {\r\n                    delay: action.timer.delay,\r\n                    time: 0\r\n                };\r\n                break;\r\n            case \"clear\":\r\n                delete newTimers[action.name];\r\n                break;\r\n            case \"update\":\r\n                newTimers[action.name].time = action.time;\r\n                break;\r\n            case \"updateAll\":\r\n                for (var timerName in newTimers)\r\n                    newTimers[timerName].time += 1000;\r\n\r\n                const timer = newTimers[\"pregameCountdown\"] || newTimers[\"secondary\"] || newTimers[\"main\"];\r\n\r\n                if (!timer)\r\n                    break;\r\n\r\n                const intTime = Math.round((timer.delay - timer.time) / 1000);\r\n\r\n                if (intTime < 16 && intTime > 0)\r\n                    action.playAudio(\"tick\");\r\n                break;\r\n        }\r\n\r\n        return newTimers;\r\n    }, {});\r\n}\r\n\r\nexport function usePlayersReducer() {\r\n    return useReducer((players, action) => {\r\n        var newPlayers;\r\n\r\n        switch (action.type) {\r\n            case \"set\":\r\n                newPlayers = action.players;\r\n                break;\r\n            case \"add\":\r\n                if (!players[action.player.id]) {\r\n                    newPlayers = update(players, {\r\n                        [action.player.id]: {\r\n                            $set: action.player\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    newPlayers = update(players, {\r\n                        [action.player.id]: {\r\n                            $unset: [\"left\"]\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case \"remove\":\r\n                newPlayers = update(players, {\r\n                    [action.playerId]: {\r\n                        left: {\r\n                            $set: true\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            case \"setProp\":\r\n                newPlayers = update(players, {\r\n                    [action.playerId]: {\r\n                        [action.propName]: {\r\n                            $set: action.propVal\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newPlayers || players;\r\n    }, {});\r\n}\r\n\r\nexport function useSettingsReducer() {\r\n    const defaultSettings = {\r\n        votingLog: true,\r\n        timestamps: true,\r\n        sounds: true,\r\n        volume: 1,\r\n    };\r\n\r\n    return useReducer((settings, action) => {\r\n        var newSettings;\r\n\r\n        switch (action.type) {\r\n            case \"load\":\r\n                try {\r\n                    newSettings = window.localStorage.getItem(\"gameSettings\");\r\n                    newSettings = JSON.parse(newSettings);\r\n                }\r\n                catch (e) {\r\n                    newSettings = settings;\r\n                }\r\n                break;\r\n            case \"set\":\r\n                newSettings = action.settings;\r\n                window.localStorage.setItem(\"gameSettings\", JSON.stringify(newSettings));\r\n                break;\r\n            case \"setProp\":\r\n                newSettings = update(settings, {\r\n                    [action.propName]: {\r\n                        $set: action.propval\r\n                    }\r\n                });\r\n\r\n                window.localStorage.setItem(\"gameSettings\", JSON.stringify(newSettings));\r\n                break;\r\n        }\r\n\r\n        return newSettings || settings;\r\n    }, defaultSettings);\r\n}\r\n\r\nexport function useActivity(agoraClient, localAudioTrack) {\r\n    const volumeThreshold = 0.001;\r\n    const [activity, updateActivity] = useReducer((activity, action) => {\r\n        var newActivity;\r\n\r\n        switch (action.type) {\r\n            case \"typing\":\r\n                newActivity = update(activity, {\r\n                    typing: {\r\n                        [action.playerId]: {\r\n                            $set: action.meetingId\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            case \"speaking\":\r\n                var newSpeaking = action.players.reduce((speaking, playerId) => {\r\n                    speaking[playerId] = true;\r\n                    return speaking;\r\n                }, {});\r\n\r\n                newActivity = update(activity, {\r\n                    speaking: {\r\n                        $set: newSpeaking\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newActivity || activity;\r\n    }, { typing: {}, speaking: {} });\r\n\r\n    useEffect(() => {\r\n        var activityInterval = setInterval(() => {\r\n            if (agoraClient.current) {\r\n                var speaking = [];\r\n\r\n                if (localAudioTrack.current && localAudioTrack.current.getVolumeLevel() > volumeThreshold) {\r\n                    speaking.push(agoraClient.current.uid);\r\n                }\r\n\r\n                agoraClient.current.remoteUsers.forEach(user => {\r\n                    if (user.audioTrack && user.audioTrack.getVolumeLevel() > volumeThreshold)\r\n                        speaking.push(user.uid);\r\n                });\r\n\r\n                updateActivity({\r\n                    type: \"speaking\",\r\n                    players: speaking\r\n                });\r\n            }\r\n        }, 50);\r\n\r\n        return () => clearInterval(activityInterval);\r\n    });\r\n\r\n    return [activity, updateActivity];\r\n}\r\n\r\nexport function useAudio(settings) {\r\n    const audioRef = useRef({});\r\n\r\n    const [audioInfo, updateAudio] = useReducer((audioInfo, action) => {\r\n        var newAudioInfo;\r\n\r\n        switch (action.type) {\r\n            case \"play\":\r\n                if (!settings.sounds)\r\n                    return audioInfo;\r\n\r\n                if (audioInfo.overrides[action.audioName])\r\n                    for (let audioName in audioInfo.overrides)\r\n                        if (audioInfo.overrides[audioName] && audioRef.current[audioName])\r\n                            audioRef.current[audioName].pause();\r\n\r\n                if (audioRef.current[action.audioName]) {\r\n                    audioRef.current[action.audioName].currentTime = 0;\r\n                    audioRef.current[action.audioName].play().catch(e => { });\r\n                }\r\n                break;\r\n            case \"load\":\r\n                newAudioInfo = {\r\n                    overrides: { ...audioInfo.overrides },\r\n                    volumes: { ...audioInfo.volumes }\r\n                };\r\n\r\n                for (let i in action.files) {\r\n                    let fileName = action.files[i];\r\n\r\n                    if (!audioRef.current[fileName]) {\r\n                        audioRef.current[fileName] = new Audio(`/audio/${fileName}.mp3`);\r\n                        audioRef.current[fileName].load();\r\n                        audioRef.current[fileName].loop = action.loops[i];\r\n                    }\r\n\r\n                    newAudioInfo.overrides[fileName] = action.overrides[i];\r\n                    newAudioInfo.volumes[fileName] = action.volumes[i];\r\n                }\r\n                break;\r\n            case \"volume\":\r\n                for (let audioName in audioRef.current) {\r\n                    if (audioInfo.volumes[audioName])\r\n                        audioRef.current[audioName].volume = audioInfo.volumes[audioName] * action.volume;\r\n                }\r\n                break;\r\n        }\r\n\r\n        return newAudioInfo || audioInfo;\r\n    }, { overrides: {}, volumes: {} });\r\n\r\n    useEffect(() => {\r\n        updateAudio({\r\n            type: \"volume\",\r\n            volume: settings.volume\r\n        });\r\n    }, [settings.volume, audioInfo]);\r\n\r\n    function playAudio(audioName) {\r\n        updateAudio({\r\n            type: \"play\",\r\n            audioName\r\n        });\r\n    }\r\n\r\n    function loadAudioFiles(files, loops, overrides, volumes) {\r\n        updateAudio({\r\n            type: \"load\",\r\n            files,\r\n            loops,\r\n            overrides,\r\n            volumes\r\n        });\r\n    }\r\n\r\n    function stopAudio() {\r\n        for (let audioName in audioRef.current)\r\n            audioRef.current[audioName].pause();\r\n    }\r\n\r\n    function stopAudios(audios) {\r\n        for (let audioName of audios)\r\n            audioRef.current[audioName].pause();\r\n    }\r\n\r\n    function setVolume(volume) {\r\n        updateAudio({\r\n            type: \"volume\",\r\n            volume\r\n        });\r\n    }\r\n\r\n    return [playAudio, loadAudioFiles, stopAudio, stopAudios, setVolume];\r\n}\r\n\r\nasync function requestNotificationAccess() {\r\n    if (!Notification)\r\n        return;\r\n\r\n    await Notification.requestPermission();\r\n}\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\n\r\nimport \"../../css/userSearch.css\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { Time } from \"../../components/Basic\";\r\n\r\nexport default function UserSearch(props) {\r\n\tconst [userList, setUserList] = useState([]);\r\n\tconst [searchVal, setSearchVal] = useState(\"\");\r\n\r\n\tconst user = useContext(UserContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Users | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchVal.length > 0) {\r\n\t\t\taxios.get(`/user/searchName?query=${searchVal}`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetUserList(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(useErrorAlert);\r\n\t\t}\r\n\t\telse {\r\n\t\t\taxios.get(\"/user/online\")\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetUserList(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(useErrorAlert);\r\n\t\t}\r\n\t}, [searchVal]);\r\n\r\n\tconst users = userList.map(user => (\r\n\t\t<div className=\"user-cell\">\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<StatusIcon status={user.status} />\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"user-search-page\">\r\n\t\t\t<div className=\"span-panel main\">\r\n\t\t\t\t<div className=\"form\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder=\"Username\"\r\n\t\t\t\t\t\tvalue={searchVal}\r\n\t\t\t\t\t\tonChange={(e) => setSearchVal(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"users\">\r\n\t\t\t\t\t{users}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"user-lists\">\r\n\t\t\t\t<NewestUsers />\r\n\t\t\t\t{user.perms.viewFlagged &&\r\n\t\t\t\t\t<FlaggedUsers />\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction NewestUsers(props) {\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [users, setUsers] = useState([]);\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tonPageNav(1);\r\n\t}, []);\r\n\r\n\tfunction onPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, users, \"joined\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/newest?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tsetUsers(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst userRows = users.map(user => (\r\n\t\t<div className=\"user-row\" key={user.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<div className=\"joined\">\r\n\t\t\t\t<Time\r\n\t\t\t\t\tminSec\r\n\t\t\t\t\tmillisec={Date.now() - user.joined}\r\n\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"newest-users box-panel\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tNewest Users\r\n\t\t\t</div>\r\n\t\t\t<div className=\"users-list\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t\t{userRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction FlaggedUsers(props) {\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [users, setUsers] = useState([]);\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tonPageNav(1);\r\n\t}, []);\r\n\r\n\tfunction onPageNav(_page) {\r\n\t\tvar filterArg = getPageNavFilterArg(_page, page, users, \"joined\");\r\n\r\n\t\tif (filterArg == null)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/flagged?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tsetUsers(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst userRows = users.map(user => (\r\n\t\t<div className=\"user-row\" key={user.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<div className=\"joined\">\r\n\t\t\t\t<Time\r\n\t\t\t\t\tminSec\r\n\t\t\t\t\tmillisec={Date.now() - user.joined}\r\n\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"flagged-users box-panel\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tFlagged Users\r\n\t\t\t</div>\r\n\t\t\t<div className=\"users-list\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t\t{userRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onPageNav}\r\n\t\t\t\t\tinverted />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { SearchSelect, UserSearchSelect } from \"../../components/Form\";\r\nimport { SiteInfoContext, UserContext } from \"../../Contexts\";\r\nimport { Badge, NameWithAvatar, StatusIcon } from \"../User/User\";\r\nimport LoadingPage from \"../Loading\";\r\nimport { MaxBoardNameLength, MaxCategoryNameLength, MaxGroupNameLength, MaxBoardDescLength } from \"../../Constants\";\r\n\r\nimport \"../../css/moderation.css\";\r\nimport { getPageNavFilterArg, PageNav } from \"../../components/Nav\";\r\nimport { Time } from \"../../components/Basic\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nexport default function Moderation() {\r\n    const [groups, setGroups] = useState([]);\r\n    const [loaded, setLoaded] = useState(false);\r\n\r\n    const user = useContext(UserContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    useEffect(() => {\r\n        document.title = \"Moderation | BeyondMafia\";\r\n\r\n        axios.get(\"/mod/groups\")\r\n            .then((res) => {\r\n                setGroups(res.data.sort((a, b) => b.rank - a.rank));\r\n                setLoaded(true);\r\n            })\r\n            .catch((e) => {\r\n                setLoaded(true);\r\n                errorAlert(e);\r\n            });\r\n    }, []);\r\n\r\n    const groupsPanels = groups.map(group => {\r\n        const members = group.members.map(member => (\r\n            <div className=\"member user-cell\" key={member.id}>\r\n                <NameWithAvatar\r\n                    id={member.id}\r\n                    name={member.name}\r\n                    avatar={member.avatar} />\r\n                <StatusIcon status={member.status} />\r\n            </div>\r\n        ));\r\n\r\n        return (\r\n            <div className=\"span-panel group-panel\" key={group.name}>\r\n                <div className=\"title\">\r\n                    {group.badge &&\r\n                        <Badge\r\n                            icon={group.badge}\r\n                            color={group.badgeColor || \"black\"}\r\n                            name={group.name} />\r\n                    }\r\n                    {group.name + \"s\"}\r\n                </div>\r\n                <div className=\"members\">\r\n                    {members}\r\n                </div>\r\n            </div>\r\n        );\r\n    });\r\n\r\n    if (!loaded)\r\n        return <LoadingPage />;\r\n\r\n    return (\r\n        <div className=\"moderation\">\r\n            <div className=\"main-section\">\r\n                {user.perms.viewModActions &&\r\n                    <div className=\"span-panel action-panel\">\r\n                        <div className=\"title\">\r\n                            Do Action\r\n                        </div>\r\n                        <ModCommands />\r\n                    </div>\r\n                }\r\n                {groupsPanels}\r\n            </div>\r\n            <div className=\"side-column\">\r\n                <ModActions />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ModCommands() {\r\n    const [command, setCommand] = useState();\r\n    const [argValues, setArgValues] = useState({});\r\n    const modCommands = useModCommands(argValues, commandRan);\r\n\r\n    const user = useContext(UserContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    var options = [];\r\n    var args = [];\r\n\r\n    for (let commandName in modCommands)\r\n        if (user.perms[modCommands[commandName].perm] && !modCommands[commandName].hidden)\r\n            options.push(commandName);\r\n\r\n    if (command) {\r\n        args = modCommands[command].args.map(arg => {\r\n            var placeholder = arg.label;\r\n\r\n            if (arg.default != null)\r\n                placeholder = `${placeholder} (${arg.default})`;\r\n            else if (arg.optional)\r\n                placeholder = `[${placeholder}]`;\r\n\r\n            if (arg.type == \"user_search\") {\r\n                return (\r\n                    <UserSearchSelect\r\n                        value={argValues[arg.name] || \"\"}\r\n                        setValue={(value) => updateArgValue(arg.name, value, arg.isArray)}\r\n                        placeholder={placeholder}\r\n                        key={arg.name} />\r\n                );\r\n            }\r\n\r\n            return (\r\n                <input\r\n                    className=\"arg\"\r\n                    type={arg.type}\r\n                    placeholder={placeholder}\r\n                    maxLength={arg.maxlength}\r\n                    onChange={(e) => updateArgValue(arg.name, e.target.value, arg.isArray)}\r\n                    key={arg.name} />\r\n            );\r\n        });\r\n    }\r\n\r\n    function updateArgValue(name, value, isArray) {\r\n        if (isArray)\r\n            value = value.split(/ *, */);\r\n\r\n        setArgValues(\r\n            update(argValues, {\r\n                [name]: {\r\n                    $set: value\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    function commandRan() {\r\n        setCommand(null);\r\n        setArgValues({});\r\n    }\r\n\r\n    function onRunClick() {\r\n        for (let arg of modCommands[command].args) {\r\n            if (argValues[arg.name] == null) {\r\n                if (arg.default != null)\r\n                    argValues[arg.name] = arg.default;\r\n                else if (!arg.optional) {\r\n                    errorAlert(\"Missing arguments.\");\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        modCommands[command].run();\r\n    }\r\n\r\n    return (\r\n        <div className=\"mod-commands\">\r\n            <div className=\"inputs\">\r\n                <SearchSelect\r\n                    options={options}\r\n                    value={command}\r\n                    setValue={setCommand} />\r\n                {args}\r\n            </div>\r\n            {command &&\r\n                <div\r\n                    className=\"btn btn-theme-sec submit\"\r\n                    onClick={onRunClick}>\r\n                    Run\r\n                </div>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction useModCommands(argValues, commandRan) {\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    return {\r\n        \"Create Group\": {\r\n            perm: \"createGroup\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxGroupNameLength\r\n                },\r\n                {\r\n                    label: \"Rank\",\r\n                    name: \"rank\",\r\n                    type: \"number\",\r\n                    default: 0\r\n                },\r\n                {\r\n                    label: \"Badge\",\r\n                    name: \"badge\",\r\n                    type: \"text\",\r\n                    optional: true\r\n                },\r\n                {\r\n                    label: \"Badge Color\",\r\n                    name: \"badgeColor\",\r\n                    type: \"text\",\r\n                    optional: true\r\n                },\r\n                {\r\n                    label: \"Permissions\",\r\n                    name: \"permissions\",\r\n                    type: \"text\",\r\n                    optional: true,\r\n                    isArray: true\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/group\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Group created.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Delete Group\": {\r\n            perm: \"deleteGroup\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxGroupNameLength\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/group/delete\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Group deleted.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Create Forum Category\": {\r\n            perm: \"createCategory\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxCategoryNameLength\r\n                },\r\n                {\r\n                    label: \"Rank\",\r\n                    name: \"rank\",\r\n                    type: \"number\",\r\n                    default: 0\r\n                },\r\n                {\r\n                    label: \"Position\",\r\n                    name: \"position\",\r\n                    type: \"number\",\r\n                    default: 0\r\n                }\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/forums/category\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Category created.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Create Forum Board\": {\r\n            perm: \"createBoard\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxBoardNameLength\r\n                },\r\n                {\r\n                    label: \"Category\",\r\n                    name: \"category\",\r\n                    type: \"text\",\r\n                    maxlength: MaxCategoryNameLength\r\n                },\r\n                {\r\n                    label: \"Description\",\r\n                    name: \"description\",\r\n                    type: \"text\",\r\n                    maxlength: MaxBoardDescLength\r\n                },\r\n                {\r\n                    label: \"Icon\",\r\n                    name: \"icon\",\r\n                    type: \"text\",\r\n                    optional: true\r\n                },\r\n                {\r\n                    label: \"Rank\",\r\n                    name: \"rank\",\r\n                    type: \"number\",\r\n                    optional: true\r\n                },\r\n                {\r\n                    label: \"Position\",\r\n                    name: \"position\",\r\n                    type: \"number\",\r\n                    optional: true\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/forums/board\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Board created.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Update Group Permissions\": {\r\n            perm: \"updateGroupPerms\",\r\n            args: [\r\n                {\r\n                    label: \"Group Name\",\r\n                    name: \"groupName\",\r\n                    type: \"text\",\r\n                    maxlength: MaxGroupNameLength\r\n                },\r\n                {\r\n                    label: \"Permissions to Add\",\r\n                    name: \"addPermissions\",\r\n                    type: \"text\",\r\n                    optional: true,\r\n                    isArray: true\r\n                },\r\n                {\r\n                    label: \"Permissions to Remove\",\r\n                    name: \"removePermissions\",\r\n                    type: \"text\",\r\n                    optional: true,\r\n                    isArray: true\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/groupPerms\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Group permissions updated.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Add User to Group\": {\r\n            perm: \"giveGroup\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Group Name\",\r\n                    name: \"groupName\",\r\n                    type: \"text\",\r\n                    maxlength: MaxGroupNameLength\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/addToGroup\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User added to group.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Remove User from Group\": {\r\n            perm: \"removeFromGroup\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Group Name\",\r\n                    name: \"groupName\",\r\n                    type: \"text\",\r\n                    maxlength: MaxGroupNameLength\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/removeFromGroup\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User removed from group.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Get Group Permissions\": {\r\n            perm: \"viewPerms\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxGroupNameLength\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.get(`/mod/groupPerms?name=${argValues.name}`)\r\n                    .then(res => {\r\n                        alert(res.data.join(\", \"), \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Get User Permissions\": {\r\n            perm: \"viewPerms\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.get(`/mod/userPerms?userId=${argValues.userId}`)\r\n                    .then(res => {\r\n                        alert(res.data.join(\", \"), \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Delete Forum Board\": {\r\n            perm: \"deleteBoard\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxBoardNameLength\r\n                }\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/forums/board/delete\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Board deleted.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Move Forum Thread\": {\r\n            perm: \"moveThread\",\r\n            args: [\r\n                {\r\n                    label: \"Thread ID\",\r\n                    name: \"thread\",\r\n                    type: \"text\"\r\n                },\r\n                {\r\n                    label: \"Board Name\",\r\n                    name: \"board\",\r\n                    type: \"text\"\r\n                }\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/forums/thread/move\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Thread moved.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Create Chat Room\": {\r\n            perm: \"createRoom\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                    maxlength: MaxBoardNameLength\r\n                },\r\n                {\r\n                    label: \"Position\",\r\n                    name: \"position\",\r\n                    type: \"number\",\r\n                    optional: true\r\n                },\r\n                {\r\n                    label: \"Rank\",\r\n                    name: \"rank\",\r\n                    type: \"number\",\r\n                    optional: true\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/chat/room\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Room created.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Delete Chat Room\": {\r\n            perm: \"deleteRoom\",\r\n            args: [\r\n                {\r\n                    label: \"Room Name\",\r\n                    name: \"name\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/chat/room/delete\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Room deleted.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Forum Ban\": {\r\n            perm: \"forumBan\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Length\",\r\n                    name: \"length\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/forumBan\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User forum banned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Chat Ban\": {\r\n            perm: \"chatBan\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Length\",\r\n                    name: \"length\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/chatBan\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User chat banned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Game Ban\": {\r\n            perm: \"gameBan\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Length\",\r\n                    name: \"length\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/gameBan\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User game banned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Ranked Ban\": {\r\n            perm: \"rankedBan\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Length\",\r\n                    name: \"length\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/rankedBan\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User ranked banned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Site Ban\": {\r\n            perm: \"siteBan\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Length\",\r\n                    name: \"length\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/siteBan\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User site banned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Force Sign Out\": {\r\n            perm: \"forceSignOut\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/logout\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User logged out.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Forum Unban\": {\r\n            perm: \"forumUnban\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/forumUnban\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User forum unbanned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Chat Unban\": {\r\n            perm: \"chatUnban\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/chatUnban\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User chat unbanned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Game Unban\": {\r\n            perm: \"gameUnban\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/gameUnban\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User game unbanned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Ranked Unban\": {\r\n            perm: \"rankedUnban\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/rankedUnban\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User ranked unbanned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Site Unban\": {\r\n            perm: \"siteUnban\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/siteUnban\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User site unbanned.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Get Alt Accounts\": {\r\n            perm: \"viewAlts\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.get(`/mod/alts?userId=${argValues.userId}`)\r\n                    .then(res => {\r\n                        alert(res.data.map(u => `${u.name} (${u.id})`).join(\", \"));\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Get Bans\": {\r\n            perm: \"viewBans\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.get(`/mod/bans?userId=${argValues.userId}`)\r\n                    .then(res => {\r\n                        alert(res.data.map(ban => `Type: ${ban.type}, mod: ${ban.modId}, expires: ${(new Date(ban.expires)).toLocaleString()}`).join(\"\\n\"));\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Check Flagged\": {\r\n            perm: \"viewFlagged\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.get(`/mod/flagged?userId=${argValues.userId}`)\r\n                    .then(res => {\r\n                        if (res.data)\r\n                            alert(\"Flagged!\")\r\n                        else\r\n                            alert(\"Not flagged\")\r\n\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear Setup Name\": {\r\n            perm: \"clearSetupName\",\r\n            args: [\r\n                {\r\n                    label: \"Setup Id\",\r\n                    name: \"setupId\",\r\n                    type: \"text\",\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearSetupName\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Setup name cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear Bio\": {\r\n            perm: \"clearBio\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearBio\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Bio cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear Video\": {\r\n            perm: \"clearBio\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearVideo\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Video cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear Account Display\": {\r\n            perm: \"clearAccountDisplay\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearAccountDisplay\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Account display cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear Name\": {\r\n            perm: \"clearName\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearName\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Name cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear Avatar\": {\r\n            perm: \"clearAvi\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearAvi\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Avatar cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear All User Content\": {\r\n            perm: \"clearAllUserContent\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/clearAllContent\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User content cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Change Name\": {\r\n            perm: \"changeName\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"New Name\",\r\n                    name: \"name\",\r\n                    type: \"text\",\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/changeName\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Name changed.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Give Coins\": {\r\n            perm: \"giveCoins\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n                {\r\n                    label: \"Amount\",\r\n                    name: \"amount\",\r\n                    type: \"number\",\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/giveCoins\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Coins given.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Break Game\": {\r\n            perm: \"breakGame\",\r\n            args: [\r\n                {\r\n                    label: \"Game Id\",\r\n                    name: \"gameId\",\r\n                    type: \"text\",\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/breakGame\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Game broken.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Toggle Featured Setup\": {\r\n            perm: \"featureSetup\",\r\n            args: [\r\n                {\r\n                    label: \"Setup Id\",\r\n                    name: \"setupId\",\r\n                    type: \"text\",\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/setup/feature\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Setup feature toggled.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Clear All IPs\": {\r\n            perm: \"clearAllIPs\",\r\n            args: [],\r\n            run: function () {\r\n                axios.post(\"/mod/clearAllIPs\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"IPs cleared.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Whitelist\": {\r\n            perm: \"whitelist\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/whitelist\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User whitelisted.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Blacklist\": {\r\n            perm: \"whitelist\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/blacklist\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User blacklisted.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Schedule Restart\": {\r\n            perm: \"scheduleRestart\",\r\n            args: [\r\n                {\r\n                    label: \"When\",\r\n                    name: \"when\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/scheduleRestart\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Restart scheduled.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Kick Player\": {\r\n            perm: \"kick\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/kick\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Kicked player.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Break Port Games\": {\r\n            perm: \"breakPortGames\",\r\n            args: [\r\n                {\r\n                    label: \"Port\",\r\n                    name: \"port\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/breakPortGames\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Games broken.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Make Announcement\": {\r\n            perm: \"announce\",\r\n            args: [\r\n                {\r\n                    label: \"Content\",\r\n                    name: \"content\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/announcement\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Announcement created.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Block Name\": {\r\n            perm: \"blockName\",\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                    name: \"name\",\r\n                    type: \"text\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/blockName\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Name blocked.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Toggle Ranked Setup\": {\r\n            perm: \"approveRanked\",\r\n            args: [\r\n                {\r\n                    label: \"Setup Id\",\r\n                    name: \"setupId\",\r\n                    type: \"text\",\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/setup/ranked\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"Setup ranked status toggled.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Ranked Approve\": {\r\n            perm: \"approveRanked\",\r\n            args: [\r\n                {\r\n                    label: \"User\",\r\n                    name: \"userId\",\r\n                    type: \"user_search\"\r\n                },\r\n            ],\r\n            run: function () {\r\n                axios.post(\"/mod/rankedApprove\", argValues)\r\n                    .then(() => {\r\n                        siteInfo.showAlert(\"User approved for ranked play.\", \"success\");\r\n                        commandRan();\r\n                    })\r\n                    .catch(errorAlert);\r\n            }\r\n        },\r\n        \"Delete Forum Board\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                },\r\n            ],\r\n        },\r\n        \"Update Board Description\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Name\",\r\n                },\r\n            ],\r\n        },\r\n        \"Delete Forum Thread\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Thread ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Restore Forum Thread\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Thread ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Toggle Forum Thread Pin\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Thread ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Toggle Forum Thread Lock\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Thread ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Delete Forum Reply\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Reply ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Restore Forum Reply\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Reply ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Delete Comment\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Comment ID\",\r\n                },\r\n            ],\r\n        },\r\n        \"Restore Comment\": {\r\n            hidden: true,\r\n            args: [\r\n                {\r\n                    label: \"Comment ID\",\r\n                },\r\n            ],\r\n        },\r\n    };\r\n}\r\n\r\nfunction ModActions(props) {\r\n    const [page, setPage] = useState(1);\r\n    const [actions, setActions] = useState([]);\r\n\r\n    const modCommands = useModCommands({}, () => { });\r\n    const errorAlert = useErrorAlert();\r\n\r\n    useEffect(() => {\r\n        onPageNav(1);\r\n    }, []);\r\n\r\n    function onPageNav(_page) {\r\n        var filterArg = getPageNavFilterArg(_page, page, actions, \"date\");\r\n\r\n        if (filterArg == null)\r\n            return;\r\n\r\n        axios.get(`/mod/actions?${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length > 0) {\r\n                    setActions(res.data);\r\n                    setPage(_page);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const actionRows = actions.map(action => {\r\n        let command = modCommands[action.name];\r\n        let actionArgs = action.args.map((arg, i) => {\r\n            let label = command.args[i].label;\r\n\r\n            if (label == \"User\")\r\n                arg = <Link to={`/user/${arg}`}>{arg}</Link>\r\n\r\n            return (\r\n                <div className=\"action-arg\" key={i}>\r\n                    {label}: {arg}\r\n                </div>\r\n            );\r\n        });\r\n\r\n        return (\r\n            <div className=\"action\" key={action.id}>\r\n                <div className=\"top-row\">\r\n                    <NameWithAvatar\r\n                        id={action.mod.id}\r\n                        name={action.mod.name}\r\n                        avatar={action.mod.avatar} />\r\n                    <div className=\"date\">\r\n                        <Time\r\n                            minSec\r\n                            millisec={Date.now() - action.date}\r\n                            suffix=\" ago\" />\r\n                    </div>\r\n                </div>\r\n                <div className=\"action-name\">\r\n                    {action.name}\r\n                </div>\r\n                <div className=\"action-args\">\r\n                    {actionArgs}\r\n                </div>\r\n            </div>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <div className=\"box-panel\">\r\n            <div className=\"heading\">\r\n                Mod Actions\r\n            </div>\r\n            <div className=\"actions-wrapper\">\r\n                <PageNav\r\n                    page={page}\r\n                    onNav={onPageNav} />\r\n                {actionRows}\r\n                <PageNav\r\n                    page={page}\r\n                    onNav={onPageNav} />\r\n            </div>\r\n        </div>\r\n    );\r\n}","import React from \"react\";\r\nimport { Route, Switch, Redirect } from \"react-router-dom\";\r\n\r\nimport Forums from \"./Forums/Forums\";\r\nimport UserSearch from \"./UserSearch\";\r\nimport Moderation from \"./Moderation\";\r\nimport { SubNav } from \"../../components/Nav\";\r\n\r\nexport default function Community() {\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Forums\",\r\n\t\t\tpath: `/community/forums`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Users\",\r\n\t\t\tpath: `/community/users`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Moderation\",\r\n\t\t\tpath: `/community/moderation`\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route path=\"/community/forums\" render={() => <Forums />} />\r\n\t\t\t\t\t<Route path=\"/community/users\" render={() => <UserSearch />} />\r\n\t\t\t\t\t<Route path=\"/community/moderation\" render={() => <Moderation />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/community/forums\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, sendEmailVerification } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { Modal } from \"../../components/Modal\";\r\nimport { SiteInfoContext } from \"../../Contexts\";\r\nimport { verifyRecaptcha } from \"../../utils\";\r\n\r\nexport default function LogIn() {\r\n\tconst [email, setEmail] = useState(\"\");\r\n\tconst [password, setPassword] = useState(\"\");\r\n\tconst [submitDisabled, setSubmitDisabled] = useState(true);\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [showResetPw, setShowResetPw] = useState(false);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Log In | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetSubmitDisabled(email.length == 0 || password.length == 0);\r\n\t}, [email, password]);\r\n\r\n\tasync function onSubmit(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (submitDisabled)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tsetLoading(true);\r\n\t\t\tawait verifyRecaptcha(\"auth\");\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tconst userCred = await signInWithEmailAndPassword(auth, email, password);\r\n\t\t\tconst idToken = await userCred.user.getIdToken(true);\r\n\t\t\taxios.post(\"/auth\", { idToken })\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t\tsetLoading(false);\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (e.response && e.response.status == 403)\r\n\t\t\t\t\t\t\tsendEmailVerification(userCred.user);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tsetLoading(false);\r\n\r\n\t\t\tif (!e || !e.message)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (e.message.indexOf(\"(auth/wrong-password)\") != -1)\r\n\t\t\t\terrorAlert(\"Incorrect password.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/invalid-email)\") != -1)\r\n\t\t\t\terrorAlert(\"Invalid email.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/user-not-found)\") != -1)\r\n\t\t\t\terrorAlert(\"Account does not exist.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/too-many-requests)\") != -1)\r\n\t\t\t\terrorAlert(\"Too many login attempts on this account. Please try again later.\");\r\n\t\t\telse\r\n\t\t\t\terrorAlert(e);\r\n\t\t}\r\n\t}\r\n\r\n\tasync function onResetPw(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetShowResetPw(false);\r\n\t\t\tsetLoading(true);\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tawait sendPasswordResetEmail(auth, email);\r\n\r\n\t\t\tsiteInfo.showAlert(\"Password reset email sent.\", \"success\");\r\n\t\t\tsetLoading(false);\r\n\t\t} catch (e) {\r\n\t\t\terrorAlert(\"Error resetting password.\");\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}\r\n\r\n\tconst modalContent = (\r\n\t\t<form className=\"form\" onSubmit={onResetPw}>\r\n\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tEmail\r\n\t\t\t\t</div>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={email}\r\n\t\t\t\t\tonChange={(e) => setEmail(e.target.value)} />\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t);\r\n\tconst modalFooter = (\r\n\t\t<div className=\"control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"reset btn btn-theme\"\r\n\t\t\t\tonClick={onResetPw}>\r\n\t\t\t\tReset\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={() => setShowResetPw(false)}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tif (loading)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main login\">\r\n\t\t\t<form className=\"form\" onSubmit={onSubmit}>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tEmail\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={e => setEmail(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tPassword\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\t\tvalue={password}\r\n\t\t\t\t\t\tonChange={e => setPassword(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<a\r\n\t\t\t\t\tclassName=\"forgot-pw\"\r\n\t\t\t\t\thref=\"#\"\r\n\t\t\t\t\tonClick={() => setShowResetPw(true)}>\r\n\t\t\t\t\tForgot password?\r\n\t\t\t\t</a>\r\n\t\t\t\t<input className={`auth-btn ${submitDisabled ? \"disabled\" : \"\"}`} type=\"submit\" value=\"Log In\" />\r\n\t\t\t</form>\r\n\t\t\t<div className=\"legal\">\r\n\t\t\t\tBy logging in you agree to follow our <Link to=\"/legal/tos\">Terms of Service </Link>\r\n\t\t\t\tand accept our <Link to=\"/legal/privacy\">Privacy Policy</Link>.\r\n\t\t\t</div>\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"reset-pw\"\r\n\t\t\t\tshow={showResetPw}\r\n\t\t\t\tonBgClick={() => setShowResetPw(false)}\r\n\t\t\t\theader={\"Reset Password\"}\r\n\t\t\t\tcontent={modalContent}\r\n\t\t\t\tfooter={modalFooter} />\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link, Redirect } from \"react-router-dom\";\r\nimport { createUserWithEmailAndPassword, getAuth, sendEmailVerification } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../Contexts\";\r\nimport { verifyRecaptcha } from \"../../utils\";\r\n\r\nexport default function SignUp() {\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [passwordConf, setPasswordConf] = useState(\"\");\r\n    const [submitDisabled, setSubmitDisabled] = useState(true);\r\n    const [loading, setLoading] = useState(false);\r\n    const [signedUp, setSignedUp] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    const allowedEmailDomans = JSON.parse(process.env.REACT_APP_EMAIL_DOMAINS);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Sign Up | BeyondMafia\";\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setSubmitDisabled(email.length == 0 || password.length == 0 || password != passwordConf);\r\n    }, [email, password, passwordConf]);\r\n\r\n    async function onSubmit(e) {\r\n        try {\r\n            e.preventDefault();\r\n\r\n            if (submitDisabled)\r\n                return;\r\n\r\n            var emailDomain = email.split(\"@\")[1] || \"\";\r\n\r\n            if (allowedEmailDomans.indexOf(emailDomain) == -1) {\r\n                errorAlert(\"Email domain must be one of the following: \" + allowedEmailDomans.join(\", \"));\r\n                return;\r\n            }\r\n\r\n            setLoading(true);\r\n            await verifyRecaptcha(\"auth\");\r\n\r\n            const auth = getAuth();\r\n            const userCred = await createUserWithEmailAndPassword(auth, email, password);\r\n            await sendEmailVerification(userCred.user);\r\n\r\n            siteInfo.showAlert(\"Account created. Please click the verification link in your email before logging in. Be sure to check your spam folder.\", \"success\", true);\r\n            setSignedUp(true);\r\n            setLoading(false);\r\n        } catch (e) {\r\n            setLoading(false);\r\n\r\n            if (!e || !e.message)\r\n                return;\r\n\r\n            if (e.message.indexOf(\"(auth/invalid-email)\") != -1)\r\n                errorAlert(\"Invalid email.\");\r\n            else if (e.message.indexOf(\"(auth/weak-password)\") != -1)\r\n                errorAlert(\"Password should be at least 6 characters.\");\r\n            else if (e.message.indexOf(\"(auth/email-already-in-use)\") != -1)\r\n                errorAlert(\"Email already in use.\");\r\n            else\r\n                errorAlert(e);\r\n        }\r\n    }\r\n\r\n    if (loading)\r\n        return <LoadingPage />;\r\n\r\n    if (signedUp)\r\n        return <Redirect to=\"/auth/login\" />;\r\n\r\n    return (\r\n        <div className=\"span-panel main login\">\r\n            <form className=\"form\" onSubmit={onSubmit}>\r\n                <div className=\"field-wrapper\">\r\n                    <div className=\"label\">\r\n                        Email\r\n                    </div>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={email}\r\n                        onChange={e => setEmail(e.target.value)} />\r\n                </div>\r\n                <div className=\"field-wrapper\">\r\n                    <div className=\"label\">\r\n                        Password\r\n                    </div>\r\n                    <input\r\n                        type=\"password\"\r\n                        value={password}\r\n                        onChange={e => setPassword(e.target.value)} />\r\n                </div>\r\n                <div className=\"field-wrapper\">\r\n                    <div className=\"label\">\r\n                        Confirm Password\r\n                    </div>\r\n                    <input\r\n                        type=\"password\"\r\n                        value={passwordConf}\r\n                        onChange={e => setPasswordConf(e.target.value)} />\r\n                </div>\r\n                <input className={`auth-btn ${submitDisabled ? \"disabled\" : \"\"}`} type=\"submit\" value=\"Sign Up\" />\r\n            </form>\r\n            <div className=\"legal\">\r\n                By signing up you agree to follow our <Link to=\"/legal/tos\">Terms of Service </Link>\r\n                and accept our <Link to=\"/legal/privacy\">Privacy Policy</Link>, and that you are at least 13 years of age.\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import React, { useContext, useEffect } from \"react\";\r\nimport { Redirect, Switch, Route, useLocation } from \"react-router-dom\";\r\nimport { initializeApp } from \"firebase/app\";\r\nimport { getAuth, inMemoryPersistence } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LogIn from \"./LogIn\";\r\nimport SignUp from \"./SignUp\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport LoadingPage from \"../Loading\";\r\n\r\nimport \"../../css/auth.css\"\r\n\r\nexport default function Auth() {\r\n\tconst user = useContext(UserContext);\r\n\tconst location = useLocation();\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Log In\",\r\n\t\t\tpath: \"/auth/login\",\r\n\t\t\texact: true\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Sign Up\",\r\n\t\t\tpath: \"/auth/signup\",\r\n\t\t\texact: true\r\n\t\t}\r\n\t];\r\n\r\n\tuseEffect(() => {\r\n\t\tconst params = new URLSearchParams(location.search);\r\n\r\n\t\tif (params.get(\"ref\"))\r\n\t\t\twindow.localStorage.setItem(\"referrer\", params.get(\"ref\"));\r\n\r\n\t\tconst fbConfig = {\r\n\t\t\tapiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n\t\t\tauthDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n\t\t\tprojectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\r\n\t\t\tstorageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n\t\t\tmessagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n\t\t\tappId: process.env.REACT_APP_FIREBASE_APP_ID,\r\n\t\t\tmeasurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\r\n\t\t};\r\n\t\tinitializeApp(fbConfig);\r\n\t\tgetAuth().setPersistence(inMemoryPersistence);\r\n\t}, []);\r\n\r\n\tif (!user.loaded)\r\n\t\treturn <LoadingPage />;\r\n\telse if (user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"auth inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/auth/login\">\r\n\t\t\t\t\t\t<LogIn />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/auth/signup\">\r\n\t\t\t\t\t\t<SignUp />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/auth/login\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import React, { useEffect } from \"react\";\r\n\r\nexport default function PrivacyPolicy() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Privacy Policy | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>Privacy Policy of BeyondMafia</h1>\r\n\t\t\t<p>BeyondMafia operates the BeyondMafia.org website, which provides the SERVICE.</p>\r\n\t\t\t<p>This page is used to inform website visitors regarding our policies with the collection, use, and disclosure of Personal Information if anyone decided to use our Service, the BeyondMafia website.</p>\r\n\t\t\t<p>If you choose to use our Service, then you agree to the collection and use of information in relation with this policy. The Personal Information that we collect are used for providing and improving the Service. We will not use or share your information with anyone except as described in this Privacy Policy.</p>\t\t\t<p>The terms used in this Privacy Policy have the same meanings as in our Terms and Conditions, which is accessible at BeyondMafia.org, unless otherwise defined in this Privacy Policy. Our Privacy Policy was created with the help of the <a href=\"https://www.privacypolicytemplate.net\">Privacy Policy Template</a> and the <a href=\"https://www.disclaimer-template.net\">Disclaimer Template</a>.</p>\r\n\t\t\t<h2>Information Collection and Use</h2>\r\n\t\t\t<p>For a better experience while using our Service, we may require you to provide us with certain personally identifiable information, including but not limited to your email address and usernames on other services. You may also voluntarily upload any of your own personal information you wish for your profile, including but not limited to photos and textual data.</p>\r\n\t\t\t<h2>Log Data</h2>\r\n\t\t\t<p>We want to inform you that whenever you visit our Service, we collect information that your browser sends to us that is called Log Data. This Log Data may include information such as your computers Internet Protocol (\"IP\") address, browser version, pages of our Service that you visit, the time and date of your visit, the time spent on those pages, and other statistics.</p>\r\n\t\t\t<h2>Cookies</h2>\r\n\t\t\t<p>Cookies are files with small amount of data that is commonly used an anonymous unique identifier. These are sent to your browser from the website that you visit and are stored on your computers hard drive.</p>\r\n\t\t\t<p>Our website uses these \"cookies\" to collection information and to improve our Service. You have the option to either accept or refuse these cookies by either loggin in or choosing not to log in. If you choose to refuse our cookies, you may not be able to use some portions of our Service, which includes any features that require a user to be signed in.</p>\r\n\t\t\t<h2>Service Providers</h2>\r\n\t\t\t<p>We may employ third-party companies and individuals due to the following reasons:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>To facilitate our Service;</li>\r\n\t\t\t\t<li>To provide the Service on our behalf;</li>\r\n\t\t\t\t<li>To perform Service-related services; or</li>\r\n\t\t\t\t<li>To assist us in analyzing how our Service is used.</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>We want to inform our Service users that these third parties have access to your Personal Information. The reason is to perform the tasks assigned to them on our behalf. However, they are obligated not to disclose or use the information for any other purpose.</p>\r\n\t\t\t<h2>Security</h2>\r\n\t\t\t<p>We value your trust in providing us your Personal Information, thus we are striving to use commercially acceptable means of protecting it. But remember that no method of transmission over the internet, or method of electronic storage is 100% secure and reliable, and we cannot guarantee its absolute security.</p>\r\n\t\t\t<h2>Links to Other Sites</h2>\r\n\t\t\t<p>Our Service may contain links to other sites. If you click on a third-party link, you will be directed to that site. Note that these external sites are not operated by us. Therefore, we strongly advise you to review the Privacy Policy of these websites. We have no control over, and assume no responsibility for the content, privacy policies, or practices of any third-party sites or services.</p>\r\n\t\t\t<p>Childrens Privacy</p>\r\n\t\t\t<p>Our Services do not address anyone under the age of 13. We do not knowingly collect personal identifiable information from children under 13. In the case we discover that a child under 13 has provided us with personal information, we immediately delete this from our servers. If you are a parent or guardian and you are aware that your child has provided us with personal information, please contact us so that we will be able to do necessary actions.</p>\r\n\t\t\t<h2>Changes to This Privacy Policy</h2>\r\n\t\t\t<p>We may update our Privacy Policy from time to time. Thus, we advise you to review this page periodically for any changes. We will notify you of any changes by posting the new Privacy Policy on this page. These changes are effective immediately, after they are posted on this page.</p>\r\n\t\t\t<h2>Contact Us</h2>\r\n\t\t\t<p>If you have any questions or suggestions about our Privacy Policy, do not hesitate to contact us.</p>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useEffect } from \"react\";\r\n\r\nexport default function PrivacyPolicy() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Terms of Service | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>BeyondMafia Terms and Conditions of Use</h1>\r\n\t\t\t<h2>1. Terms</h2>\r\n\t\t\t<p>By accessing this Website, accessible from BeyondMafia.org, you are agreeing to be bound by these Website Terms and Conditions of Use and agree that you are responsible for the agreement with any applicable local laws. If you disagree with any of these terms, you are prohibited from accessing this site. The materials contained in this Website are protected by copyright and trade mark law. These Terms of Service has been created with the help of the <a href=\"https://www.termsofservicegenerator.net\">Terms of Service Generator</a> and the <a href=\"https://www.termsconditionsexample.com\">Terms & Conditions Example</a>.</p>\r\n\t\t\t<h2>2. Use License</h2>\r\n\t\t\t<p>Permission is granted to temporarily download one copy of the materials on BeyondMafia's Website for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title, and under this license you may not:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>modify or copy the materials;</li>\r\n\t\t\t\t<li>use the materials for any commercial purpose or for any public display;</li>\r\n\t\t\t\t<li>attempt to reverse engineer any software contained on BeyondMafia's Website;</li>\r\n\t\t\t\t<li>remove any copyright or other proprietary notations from the materials; or</li>\r\n\t\t\t\t<li>transferring the materials to another person or \"mirror\" the materials on any other server.</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>This will let BeyondMafia to terminate upon violations of any of these restrictions. Upon termination, your viewing right will also be terminated and you should destroy any downloaded materials in your possession whether it is printed or electronic format.</p>\r\n\t\t\t<h2>3. Disclaimer</h2>\r\n\t\t\t<p>All the materials on BeyondMafias Website are provided \"as is\". BeyondMafia makes no warranties, may it be expressed or implied, therefore negates all other warranties. Furthermore, BeyondMafia does not make any representations concerning the accuracy or reliability of the use of the materials on its Website or otherwise relating to such materials or any sites linked to this Website.</p>\r\n\t\t\t<h2>4. Limitations</h2>\r\n\t\t\t<p>BeyondMafia or its suppliers will not be hold accountable for any damages that will arise with the use or inability to use the materials on BeyondMafias Website, even if BeyondMafia or an authorize representative of this Website has been notified, orally or written, of the possibility of such damage. Some jurisdiction does not allow limitations on implied warranties or limitations of liability for incidental damages, these limitations may not apply to you.</p>\r\n\t\t\t<h2>5. Revisions and Errata</h2>\r\n\t\t\t<p>The materials appearing on BeyondMafias Website may include technical, typographical, or photographic errors. BeyondMafia will not promise that any of the materials in this Website are accurate, complete, or current. BeyondMafia may change the materials contained on its Website at any time without notice. BeyondMafia does not make any commitment to update the materials.</p>\r\n\t\t\t<h2>6. Links</h2>\r\n\t\t\t<p>BeyondMafia has not reviewed all of the sites linked to its Website and is not responsible for the contents of any such linked site. The presence of any link does not imply endorsement by BeyondMafia of the site. The use of any linked website is at the users own risk.</p>\r\n\t\t\t<h2>7. Site Terms of Use Modifications</h2>\r\n\t\t\t<p>BeyondMafia may revise these Terms of Use for its Website at any time without prior notice. By using this Website, you are agreeing to be bound by the current version of these Terms and Conditions of Use.</p>\r\n\t\t\t<h2>8. Your Privacy</h2>\r\n\t\t\t<p>Please read <a href=\"/legal/privacy\">our Privacy Policy</a>.</p>\r\n\t\t\t<h2>9. Governing Law</h2>\r\n\t\t\t<p>Any claim related to BeyondMafia's Website shall be governed by the laws of us without regards to its conflict of law provisions.</p>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Route, Switch, Redirect } from \"react-router-dom\";\r\n\r\nimport PrivacyPolicy from \"./PrivacyPolicy\";\r\nimport TermsOfService from \"./TermsOfService\";\r\nimport { SubNav } from \"../../components/Nav\";\r\n\r\nimport \"../../css/legal.css\";\r\n\r\nexport default function Legal(props) {\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Terms of Service\",\r\n\t\t\tpath: \"/legal/tos\",\r\n\t\t\texact: true\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Privacy Policy\",\r\n\t\t\tpath: \"/legal/privacy\",\r\n\t\t\texact: true\r\n\t\t}\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/legal/tos\" render={() => <TermsOfService />} />\r\n\t\t\t\t\t<Route exact path=\"/legal/privacy\" render={() => <PrivacyPolicy />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/legal/tos\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useContext, useRef, useEffect, useLayoutEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { GameContext, PopoverContext, SiteInfoContext } from \"../Contexts\";\r\nimport { Time } from \"./Basic\";\r\nimport { SmallRoleList, GameStateIcon } from \"./Setup\";\r\nimport { NameWithAvatar } from \"../pages/User/User\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\nimport { GameStates, Alignments } from \"../Constants\";\r\nimport { useOnOutsideClick } from \"./Basic\";\r\n\r\nimport \"../css/popover.css\";\r\n\r\nexport default function Popover() {\r\n    const popover = useContext(PopoverContext);\r\n    const popoverRef = useRef();\r\n    const triangleRef = useRef();\r\n    const sideContentRef = useRef();\r\n\r\n    useOnOutsideClick(\r\n        [\r\n            { current: popover.boundingEl },\r\n            popoverRef\r\n        ],\r\n        () => {\r\n            if (!popover.loadingRef.current) {\r\n                popover.setVisible(false);\r\n                popover.setSideContentVisible(false);\r\n                popover.setBoundingEl(null);\r\n            }\r\n        }\r\n    );\r\n\r\n    useLayoutEffect(() => {\r\n        if (!popover.visible)\r\n            return;\r\n\r\n        const boundingRect = popover.boundingEl.getBoundingClientRect();\r\n        const popoverRect = popoverRef.current.getBoundingClientRect();\r\n\r\n        var triangleLeft = boundingRect.left + boundingRect.width;\r\n        var triangleTop = boundingRect.top - 10 + (boundingRect.height / 2) + window.scrollY;\r\n\r\n        var popoverLeft = boundingRect.left + boundingRect.width + 10;\r\n        var popoverTop = boundingRect.top - (popoverRect.height / 2) + (boundingRect.height / 2) + window.scrollY;\r\n        var popoverHorzShift = window.innerWidth - (popoverLeft + popoverRect.width);\r\n\r\n        if (popoverTop < window.scrollY)\r\n            popoverTop = window.scrollY;\r\n\r\n        if (popoverHorzShift < 0) {\r\n            if (popoverLeft + popoverHorzShift < 0)\r\n                popoverHorzShift -= (popoverLeft + popoverHorzShift);\r\n        }\r\n        else\r\n            popoverHorzShift = 0;\r\n\r\n        popoverLeft += popoverHorzShift;\r\n        triangleLeft += popoverHorzShift;\r\n\r\n        triangleRef.current.style.left = triangleLeft + \"px\";\r\n        triangleRef.current.style.top = triangleTop + \"px\";\r\n        triangleRef.current.style.visibility = \"visible\";\r\n\r\n        popoverRef.current.style.top = popoverTop + \"px\";\r\n        popoverRef.current.style.left = popoverLeft + \"px\";\r\n        popoverRef.current.style.visibility = \"visible\";\r\n\r\n        if (popover.sideContentVisible) {\r\n            sideContentRef.current.style.width = popoverRect.width + \"px\"; // Gives consistent styling + just makes loading not funky\r\n\r\n            const useLeft = popoverRect.x > window.innerWidth - (popoverRect.x + popoverRect.width)\r\n                ? (popoverRect.x - popoverRect.width)\r\n                : popoverRect.x + popoverRect.width\r\n\r\n            sideContentRef.current.style.top = popover.sideContentMouseY + \"px\";\r\n            sideContentRef.current.style.left = useLeft + \"px\";\r\n            sideContentRef.current.style.visibility = \"visible\";\r\n        }\r\n    });\r\n\r\n    return (\r\n        popover.visible &&\r\n        <>\r\n            <div\r\n                className=\"triangle triangle-left\"\r\n                ref={triangleRef} />\r\n            <div\r\n                className={`popover-window`}\r\n                ref={popoverRef}>\r\n                <div className=\"popover-title\">\r\n                    {popover.title}\r\n                </div>\r\n                {!popover.loading &&\r\n                    <div className=\"popover-content\">\r\n                        {popover.content}\r\n                    </div>\r\n                }\r\n            </div>\r\n            {popover.sideContentVisible && <div\r\n                className={`popover-window`}\r\n                ref={sideContentRef}>\r\n                <div className=\"popover-title\">\r\n                    {popover.sideContentTitle}\r\n                </div>\r\n                {!popover.sideContentLoading &&\r\n                    <div className=\"popover-content\">\r\n                        {popover.sideContent}\r\n                    </div>\r\n                }\r\n            </div>}\r\n        </>\r\n    );\r\n}\r\n\r\nexport function usePopover(siteInfo) {\r\n    const [visible, setVisible] = useState(false);\r\n    const [boundingEl, setBoundingEl] = useState();\r\n    const [title, setTitle] = useState(\"\");\r\n    const [content, setContent] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n    const [sideContent, setSideContent] = useState(\"\");\r\n    const [sideContentTitle, setSideContentTitle] = useState(\"\");\r\n    const [sideContentVisible, setSideContentVisible] = useState(\"\");\r\n    const [sideContentLoading, setSideContentLoading] = useState(false);\r\n    const [sideContentMouseY, setSideContentMouseY] = useState(0);\r\n\r\n    const loadingRef = useRef();\r\n    const errorAlert = useErrorAlert(siteInfo);\r\n\r\n    function onClick(path, type, _boundingEl, title, dataMod) {\r\n        if (_boundingEl == boundingEl) {\r\n            setVisible(false);\r\n            setSideContentVisible(false);\r\n            setBoundingEl(null);\r\n        }\r\n        else\r\n            load(path, type, _boundingEl, title, dataMod);\r\n    }\r\n\r\n    function onHover(path, type, _boundingEl, title, dataMod, mouseY) {\r\n        if (!sideContentLoading && title !== sideContentTitle) { // using this just so requests aren't massive\r\n            setSideContentMouseY(mouseY);\r\n            load(path, type, _boundingEl, title, dataMod, true);\r\n        }\r\n    }\r\n\r\n    function open(boundingEl, title, sideload) {\r\n        if (sideload) {\r\n            setSideContentTitle(title);\r\n            setSideContentLoading(true);\r\n            setSideContentVisible(true);\r\n        } else {\r\n            setBoundingEl(boundingEl);\r\n\r\n            setTitle(title);\r\n            setSideContentVisible(false);\r\n            setLoading(true);\r\n            setVisible(true);\r\n\r\n            loadingRef.current = true;\r\n        }\r\n    }\r\n\r\n    function ready(content, type, title, sideload) {\r\n        switch (type) {\r\n            case \"setup\":\r\n                content = parseSetupPopover(content, siteInfo.roles);\r\n                break;\r\n            case \"rolePrediction\":\r\n                content = parseRolePredictionPopover(content);\r\n                break;\r\n            case \"role\":\r\n                content = parseRolePopover(content);\r\n                break;\r\n            case \"game\":\r\n                content = parseGamePopover(content);\r\n                break;\r\n        }\r\n\r\n        if (sideload) {\r\n            setSideContent(content);\r\n            setSideContentTitle(title); // doing this here guarentees the content + title are synced if multiple hovers are firing at once\r\n            setSideContentLoading(false);\r\n        } else {\r\n            setContent(content);\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    function load(path, type, boundingEl, title, dataMod, sideload) {\r\n        open(boundingEl, title, sideload);\r\n\r\n        axios.get(path)\r\n            .then(res => {\r\n                if (dataMod)\r\n                    dataMod(res.data);\r\n\r\n                loadingRef.current = false;\r\n                ready(res.data, type, title, sideload)\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    return {\r\n        visible,\r\n        setVisible,\r\n        boundingEl,\r\n        setBoundingEl,\r\n        title,\r\n        setTitle,\r\n        content,\r\n        setContent,\r\n        loading,\r\n        setLoading,\r\n        onClick,\r\n        onHover,\r\n        open,\r\n        ready,\r\n        load,\r\n        loadingRef,\r\n        sideContent,\r\n        sideContentVisible,\r\n        setSideContentVisible,\r\n        sideContentTitle,\r\n        sideContentLoading,\r\n        sideContentMouseY,\r\n    };\r\n}\r\n\r\nfunction InfoRow(props) {\r\n    return (\r\n        <div className=\"info-row\">\r\n            <div className=\"title\">{props.title}</div>\r\n            <div className=\"content\">{props.content}</div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function parseSetupPopover(setup, roleData) {\r\n    const result = [];\r\n\r\n    // ID\r\n    result.push(<InfoRow title=\"ID\" content={setup.id} key=\"id\" />);\r\n\r\n    //Creator\r\n    if (setup.creator) {\r\n        const name =\r\n            <NameWithAvatar\r\n                small\r\n                id={setup.creator.id}\r\n                name={setup.creator.name}\r\n                avatar={setup.creator.avatar} />\r\n        result.push(<InfoRow title=\"Created By\" content={name} key=\"createdBy\" />);\r\n    }\r\n\r\n    //Total\r\n    result.push(<InfoRow title=\"Players\" content={setup.total} key=\"players\" />);\r\n\r\n    //Ranked\r\n    result.push(<InfoRow title=\"Ranked Allowed\" content={setup.ranked ? \"Yes\" : \"No\"} key=\"ranked\" />);\r\n\r\n    //Whispers\r\n    const whisperContent = [];\r\n    whisperContent.push(<div key=\"whispers\">{setup.whispers ? \"Yes\" : \"No\"}</div>);\r\n\r\n    if (setup.whispers)\r\n        whisperContent.push(<div key=\"whispersLeak\">{setup.leakPercentage}% leak rate</div>);\r\n\r\n    result.push(<InfoRow title=\"Whispers\" content={whisperContent} key=\"whispers\" />);\r\n\r\n    //Must act\r\n    result.push(<InfoRow title=\"Must Act\" content={setup.mustAct ? \"Yes\" : \"No\"} key=\"mustAct\" />);\r\n\r\n    //Game settings\r\n    switch (setup.gameType) {\r\n        case \"Mafia\":\r\n            //Starting state\r\n            result.push(<InfoRow title=\"Starting State\" content={<GameStateIcon state={setup.startState} />} key=\"startState\" />);\r\n\r\n            //Dawn\r\n            result.push(<InfoRow title=\"Dawn\" content={setup.dawn ? \"Yes\" : \"No\"} key=\"dawn\" />);\r\n\r\n            //Last will\r\n            result.push(<InfoRow title=\"Last Will\" content={setup.lastWill ? \"Yes\" : \"No\"} key=\"lastWill\" />);\r\n\r\n            //No reveal\r\n            result.push(<InfoRow title=\"No Reveal\" content={setup.noReveal ? \"Yes\" : \"No\"} key=\"noReveal\" />);\r\n\r\n            //Votes invisible\r\n            result.push(<InfoRow title=\"Votes Invisible\" content={setup.votesInvisible ? \"Yes\" : \"No\"} key=\"votesInvis\" />);\r\n            break;\r\n        case \"Split Decision\":\r\n            //Initial swap amount\r\n            result.push(<InfoRow title=\"Initial Swap Amount\" content={setup.swapAmt} key=\"initSwapAmt\" />);\r\n\r\n            //Round amount\r\n            result.push(<InfoRow title=\"Round Amount\" content={setup.roundAmt} key=\"roundAmt\" />);\r\n            break;\r\n        case \"Resistance\":\r\n            //First team size\r\n            result.push(<InfoRow title=\"First Team Size\" content={setup.firstTeamSize} key=\"firstTeamSize\" />);\r\n\r\n            //Last team size\r\n            result.push(<InfoRow title=\"Last Team Size\" content={setup.lastTeamSize} key=\"lastTeamSize\" />);\r\n\r\n            //Number of Missions\r\n            result.push(<InfoRow title=\"Number of Missions\" content={setup.numMissions} key=\"numMissions\" />);\r\n\r\n            //Team Formation Attempts\r\n            result.push(<InfoRow title=\"Team Formation Attempts\" content={setup.teamFailLimit} key=\"teamFailLimit\" />);\r\n            break;\r\n        case \"One Night\":\r\n            //Votes invisible\r\n            result.push(<InfoRow title=\"Votes Invisible\" content={setup.votesInvisible ? \"Yes\" : \"No\"} key=\"votesInvis\" />);\r\n\r\n            //Excess roles\r\n            result.push(<InfoRow title=\"Excess Roles\" content={setup.excessRoles} key=\"excessRoles\" />);\r\n            break;\r\n    }\r\n\r\n    //Roles\r\n    if (setup.closed) {\r\n        result.push(<InfoRow title=\"Unique Roles\" content={setup.unique ? \"Yes\" : \"No\"} key=\"uniqueRoles\" />);\r\n\r\n        const roleset = setup.roles[0];\r\n        var rolesByAlignment = {};\r\n\r\n        for (let role in roleset) {\r\n            let roleName = role.split(\":\")[0];\r\n\r\n            for (let roleObj of roleData[setup.gameType]) {\r\n                if (roleObj.name == roleName) {\r\n                    let alignment = roleObj.alignment;\r\n\r\n                    if (!rolesByAlignment[alignment])\r\n                        rolesByAlignment[alignment] = {};\r\n\r\n                    rolesByAlignment[alignment][role] = roleset[role];\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let alignment in rolesByAlignment) {\r\n            result.push(\r\n                <InfoRow\r\n                    title={`${alignment} roles`}\r\n                    content={\r\n                        <SmallRoleList\r\n                            roles={rolesByAlignment[alignment]}\r\n                            gameType={setup.gameType} />\r\n                    }\r\n                    key={alignment} />\r\n            );\r\n        }\r\n    }\r\n    else {\r\n        const rolesets = [];\r\n        const sectionName = setup.roles.length > 1 ? \"Role Sets\" : \"Roles\";\r\n\r\n        for (let i in setup.roles) {\r\n            let roleset = setup.roles[i];\r\n            rolesets.push(\r\n                <SmallRoleList\r\n                    roles={roleset}\r\n                    gameType={setup.gameType}\r\n                    key={i} />\r\n            );\r\n        }\r\n\r\n        result.push(<InfoRow title={sectionName} content={rolesets} key=\"roles\" />);\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function parseRolePredictionPopover(data) {\r\n    let roleset = Object.keys(data.roles);\r\n    roleset.unshift(undefined);\r\n\r\n    return (\r\n        <SmallRoleList\r\n            roles={roleset}\r\n            makeRolePrediction={data.toggleRolePrediction}\r\n            gameType={data.gameType} />\r\n    )\r\n}\r\n\r\nexport function parseGamePopover(game) {\r\n    const result = [];\r\n\r\n    //Scheduled\r\n    if (game.settings.scheduled)\r\n        result.push(<InfoRow title=\"Scheduled For\" content={(new Date(game.settings.scheduled)).toLocaleString()} key=\"scheduledFor\" />);\r\n\r\n    //Players\r\n    const playerList = [];\r\n\r\n    for (let i = 0; i < game.players.length; i++) {\r\n        playerList.push(\r\n            <NameWithAvatar\r\n                small\r\n                id={game.players[i].id}\r\n                name={game.players[i].name}\r\n                avatar={game.players[i].avatar}\r\n                key={game.players[i].id} />\r\n        );\r\n    }\r\n\r\n    while (playerList.length < game.totalPlayers) {\r\n        playerList.push(\r\n            <NameWithAvatar\r\n                small\r\n                name=\"[Guest]\"\r\n                key={playerList.length} />\r\n        );\r\n    }\r\n\r\n    result.push(<InfoRow title=\"Players\" content={playerList} key=\"players\" />);\r\n\r\n    //State lengths\r\n    const stateLengths = [];\r\n\r\n    for (let stateName of GameStates[game.type]) {\r\n        stateLengths.push(<div key={stateName}>{stateName}: <Time millisec={game.settings.stateLengths[stateName]} /></div>);\r\n    }\r\n\r\n    result.push(<InfoRow title=\"State Lengths\" content={stateLengths} key=\"stateLengths\" />);\r\n\r\n    //Ranked\r\n    result.push(<InfoRow title=\"Ranked\" content={game.settings.ranked ? \"Yes\" : \"No\"} key=\"ranked\" />);\r\n\r\n    //Spectating\r\n    result.push(<InfoRow title=\"Spectating\" content={game.settings.spectating ? \"Yes\" : \"No\"} key=\"spectating\" />);\r\n\r\n    //Guests\r\n    result.push(<InfoRow title=\"Guests Allowed\" content={game.settings.guests ? \"Yes\" : \"No\"} key=\"guests\" />);\r\n\r\n    //Ready Check\r\n    result.push(<InfoRow title=\"Ready Check\" content={game.settings.readyCheck ? \"Yes\" : \"No\"} key=\"readyCheck\" />);\r\n\r\n    switch (game.type) {\r\n        case \"Mafia\":\r\n            var extendLength = game.settings.gameTypeOptions.extendLength || 3;\r\n            result.push(<InfoRow title=\"Extension Length\" content={<Time millisec={extendLength * 60 * 1000} />} key=\"extendLength\" />);\r\n            break;\r\n    }\r\n\r\n    //Created at\r\n    if (game.createTime)\r\n        result.push(<InfoRow title=\"Created At\" content={(new Date(game.createTime)).toLocaleString()} key=\"createdAt\" />);\r\n\r\n    //Started at\r\n    if (game.startTime)\r\n        result.push(<InfoRow title=\"Started At\" content={(new Date(game.startTime)).toLocaleString()} key=\"startedAt\" />);\r\n\r\n    //Ended at\r\n    if (game.endTime)\r\n        result.push(<InfoRow title=\"Ended At\" content={(new Date(game.endTime)).toLocaleString()} key=\"endedAt\" />);\r\n\r\n    return result;\r\n}\r\n\r\nexport function parseRolePopover(role) {\r\n    const result = [];\r\n\r\n    //Alignment\r\n    result.push(<InfoRow title=\"Alignment\" content={role.alignment} key=\"alignment\" />);\r\n\r\n    //Description\r\n    const descLines = [];\r\n\r\n    for (let i in role.description)\r\n        descLines.push(<li key={i}>{role.description[i]}</li>);\r\n\r\n    result.push(<InfoRow title=\"Description\" content={<ul>{descLines}</ul>} key=\"desc\" />);\r\n\r\n    return result;\r\n}\r\n","import React, { useState, useEffect, useLayoutEffect, useRef, useReducer, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { ClientSocket as Socket } from \"../../Socket\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport { MaxChatMessageLength } from \"../../Constants\";\r\nimport { Time, UserText } from \"../../components/Basic\";\r\nimport { NotificationHolder, filterProfanity, useOnOutsideClick } from \"../../components/Basic\";\r\n\r\nimport \"../../css/chat.css\";\r\nimport { flipTextColor } from \"../../utils\";\r\n\r\nexport default function Chat() {\r\n\tconst [showWindow, setShowWindow] = useState(false);\r\n\tconst [connected, setConnected] = useState(0);\r\n\tconst [token, setToken] = useState(\"\");\r\n\tconst [socket, setSocket] = useState({});\r\n\tconst [chatInfo, updateChatInfo] = useChatInfoReducer();\r\n\tconst [currentTab, setCurrentTab] = useState(\"rooms\");\r\n\tconst [currentChannelId, setCurrentChannelId] = useState();\r\n\tconst [channel, updateChannel] = useChannelReducer();\r\n\tconst [newDMUsers, setNewDMUsers] = useState({});\r\n\tconst [textInput, setTextInput] = useState(\"\");\r\n\tconst [autoScroll, setAutoScroll] = useState(true);\r\n\tconst [userSearchVal, setUserSearchVal] = useState(\"\");\r\n\r\n\tconst messageListRef = useRef();\r\n\tconst oldScrollHeight = useRef();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseLayoutEffect(() => manageScroll());\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!user.loggedIn && token)\r\n\t\t\tsetToken(\"\");\r\n\t}, [user.loggedIn]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token)\r\n\t\t\treturn;\r\n\r\n\t\tvar socketURL;\r\n\r\n\t\tif (process.env.REACT_APP_USE_PORT == \"true\")\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}:${process.env.REACT_APP_CHAT_PORT}`;\r\n\t\telse\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}/chatSocket`;\r\n\r\n\t\tvar newSocket = new Socket(socketURL);\r\n\t\tnewSocket.on(\"connected\", () => setConnected(connected + 1));\r\n\t\tnewSocket.on(\"disconnected\", () => setConnected(connected - 1));\r\n\t\tsetSocket(newSocket);\r\n\r\n\t\treturn () => {\r\n\t\t\tif (newSocket)\r\n\t\t\t\tnewSocket.clear();\r\n\t\t};\r\n\t}, [token]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (socket.readyState != 1) {\r\n\t\t\tif (socket.readyState == null || socket.readyState == 3)\r\n\t\t\t\tgetToken();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsocket.send(\"auth\", token);\r\n\r\n\t\tsocket.on(\"chatInfo\", chatInfo => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tchatInfo\r\n\t\t\t});\r\n\r\n\t\t\tif (chatInfo.rooms && chatInfo.rooms.length > 0) {\r\n\t\t\t\tif (!currentChannelId) {\r\n\t\t\t\t\tvar roomId = chatInfo.rooms[0].id;\r\n\t\t\t\t\tsetCurrentChannelId(roomId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"channel\", channel => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tchannel\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"message\", message => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"message\",\r\n\t\t\t\tmessage\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"oldMessages\", messages => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"oldMessages\",\r\n\t\t\t\tmessages,\r\n\t\t\t\tmessageListRef\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"users\", users => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"users\",\r\n\t\t\t\tusers\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"newDirectChannel\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"directs\",\r\n\t\t\t\tchannel: info.channel\r\n\t\t\t});\r\n\r\n\t\t\tif (info.focus) {\r\n\t\t\t\tsetCurrentTab(\"directs\");\r\n\t\t\t\tsetCurrentChannelId(info.channel.id);\r\n\t\t\t\tsocket.send(\"getChannel\", info.channel.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"openDM\", channelId => {\r\n\t\t\tsetCurrentTab(\"directs\");\r\n\t\t\tsetCurrentChannelId(channelId);\r\n\t\t\tsocket.send(\"getChannel\", channelId);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"dateUpdate\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"date\",\r\n\t\t\t\tchannelId: info.channel,\r\n\t\t\t\tdate: info.date\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"newNotif\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"addNotif\",\r\n\t\t\t\tchannelId: info.notif.channelId\r\n\t\t\t});\r\n\r\n\t\t\tif (document.hidden && document.title.indexOf(\"\") == -1)\r\n\t\t\t\tdocument.title = document.title + \"\";\r\n\t\t});\r\n\r\n\t\tsocket.on(\"messageDeleted\", messageId => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"deleteMessage\",\r\n\t\t\t\tmessageId\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"error\", error => {\r\n\t\t\terrorAlert(error);\r\n\t\t});\r\n\t}, [connected]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!channel.id)\r\n\t\t\treturn;\r\n\r\n\t\tif (chatInfo.notifs.byChannel[channel.id])\r\n\t\t\tsocket.send(\"readNotifsInChannel\", channel.id);\r\n\r\n\t\tupdateChatInfo({\r\n\t\t\ttype: \"readNotifs\",\r\n\t\t\tchannelId: channel.id\r\n\t\t});\r\n\t}, [channel]);\r\n\r\n\tfunction getToken() {\r\n\t\taxios.get(\"/chat/connect\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetToken(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onTopBarClick() {\r\n\t\tsetShowWindow(!showWindow);\r\n\t\tsetAutoScroll(true);\r\n\r\n\t\tif (!showWindow) {\r\n\t\t\tif (currentChannelId)\r\n\t\t\t\tsocket.send(\"getChannel\", currentChannelId);\r\n\r\n\t\t\tif (currentChannelId) {\r\n\t\t\t\tif (chatInfo.notifs.byChannel[currentChannelId])\r\n\t\t\t\t\tsocket.send(\"readNotifsInChannel\", currentChannelId);\r\n\r\n\t\t\t\tupdateChatInfo({\r\n\t\t\t\t\ttype: \"readNotifs\",\r\n\t\t\t\t\tchannelId: currentChannelId\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t\tsocket.send(\"closedChat\");\r\n\t}\r\n\r\n\tfunction onTabClick(type) {\r\n\t\tsetCurrentTab(type);\r\n\r\n\t\tif (type == \"users\")\r\n\t\t\tsocket.send(\"getUsers\", userSearchVal);\r\n\t}\r\n\r\n\tfunction onChannelClick(id) {\r\n\t\tif (currentTab != \"users\") {\r\n\t\t\tsocket.send(\"getChannel\", id);\r\n\r\n\t\t\tsetCurrentChannelId(id);\r\n\t\t\tsetAutoScroll(true);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!newDMUsers[id]) {\r\n\t\t\t\tsetNewDMUsers(update(newDMUsers, {\r\n\t\t\t\t\t[id]: {\r\n\t\t\t\t\t\t$set: true\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsetNewDMUsers(update(newDMUsers, {\r\n\t\t\t\t\t$unset: [id]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onSendMessage(e) {\r\n\t\tif (e.key == \"Enter\" && textInput.length) {\r\n\t\t\tconst message = e.target.value;\r\n\t\t\tsocket.send(\"sendMessage\", message);\r\n\t\t\tsetTextInput(\"\");\r\n\t\t\tsetAutoScroll(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onMessagesScroll() {\r\n\t\tvar messageList = messageListRef.current;\r\n\r\n\t\tif (Math.round(messageList.scrollTop + messageList.clientHeight) >= Math.round(messageList.scrollHeight))\r\n\t\t\tsetAutoScroll(true);\r\n\t\telse {\r\n\t\t\tsetAutoScroll(false);\r\n\r\n\t\t\tif (messageList.scrollTop == 0)\r\n\t\t\t\tsocket.send(\"getOldMessages\", channel.messages[0].date);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction manageScroll() {\r\n\t\tif (messageListRef.current) {\r\n\t\t\tif (oldScrollHeight.current == null)\r\n\t\t\t\toldScrollHeight.current = messageListRef.current.scrollHeight;\r\n\t\t\telse if (oldScrollHeight.current != messageListRef.current.scrollHeight) {\r\n\t\t\t\tif (messageListRef.current.scrollTop == 0) {\r\n\t\t\t\t\tvar scrollTo = messageListRef.current.scrollHeight * (1 - (oldScrollHeight.current / messageListRef.current.scrollHeight));\r\n\t\t\t\t\tmessageListRef.current.scrollTop = scrollTo - 5;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toldScrollHeight.current = messageListRef.current.scrollHeight;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (autoScroll && messageListRef.current)\r\n\t\t\tmessageListRef.current.scrollTop = messageListRef.current.scrollHeight;\r\n\t}\r\n\r\n\tfunction onUserSearch(e) {\r\n\t\tconst query = e.target.value;\r\n\t\tsetUserSearchVal(query);\r\n\t\tsocket.send(\"getUsers\", query);\r\n\t}\r\n\r\n\tfunction onCreateDM() {\r\n\t\tvar users = Object.keys(newDMUsers);\r\n\t\tsocket.send(\"newDMChannel\", users);\r\n\t\tsetNewDMUsers({});\r\n\t}\r\n\r\n\tfunction onCloseDM(channelId) {\r\n\t\tsocket.send(\"closeDM\", channelId);\r\n\r\n\t\tsetCurrentChannelId(null);\r\n\t\tupdateChannel({ type: \"clear\" });\r\n\t\tupdateChatInfo({\r\n\t\t\ttype: \"remove\",\r\n\t\t\tchannelType: currentTab,\r\n\t\t\tchannelId\r\n\t\t});\r\n\t}\r\n\r\n\tvar channels = chatInfo[currentTab];\r\n\r\n\tif (currentTab == \"directs\")\r\n\t\tchannels = channels.sort(sortDMs);\r\n\r\n\tchannels = channels.reduce((channels, channel) => {\r\n\t\tif (currentTab == \"users\" && channel.id == user.id)\r\n\t\t\treturn channels;\r\n\r\n\t\tvar className = \"channel\";\r\n\r\n\t\tif (currentTab != \"users\" && channel.id == currentChannelId)\r\n\t\t\tclassName += \" sel\";\r\n\t\telse if (currentTab == \"users\" && newDMUsers[channel.id])\r\n\t\t\tclassName += \" sel\";\r\n\r\n\t\tchannels.push(\r\n\t\t\t<NotificationHolder\r\n\t\t\t\tclassName={className}\r\n\t\t\t\tkey={channel.id}\r\n\t\t\t\tnotifCount={chatInfo.notifs.byChannel[channel.id]}\r\n\t\t\t\tonClick={() => onChannelClick(channel.id)}>\r\n\t\t\t\t<ChannelName\r\n\t\t\t\t\tshort\r\n\t\t\t\t\tchannelType={currentTab}\r\n\t\t\t\t\tchannel={channel}\r\n\t\t\t\t\tuser={user} />\r\n\t\t\t</NotificationHolder>\r\n\t\t);\r\n\r\n\t\treturn channels;\r\n\t}, []);\r\n\r\n\tconst messages = channel.messages.map(message => (\r\n\t\t<Message\r\n\t\t\tmessage={message}\r\n\t\t\tsocket={socket}\r\n\t\t\tkey={message.id} />\r\n\t));\r\n\r\n\treturn (\r\n\t\ttoken &&\r\n\t\t<NotificationHolder\r\n\t\t\tclassName=\"chat-wrapper\"\r\n\t\t\tnotifCount={chatInfo.notifs.all}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"top-bar\"\r\n\t\t\t\tonClick={onTopBarClick}>\r\n\t\t\t\t<i className=\"fas fa-comment\" />\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tChat\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{showWindow &&\r\n\t\t\t\t<div className=\"window\">\r\n\t\t\t\t\t<div className=\"left-panel\">\r\n\t\t\t\t\t\t<div className=\"channel-type-nav\">\r\n\t\t\t\t\t\t\t<NotificationHolder\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"rooms\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tnotifCount={chatInfo.notifs.byChannelType[\"rooms\"]}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"rooms\")}>\r\n\t\t\t\t\t\t\t\tRooms\r\n\t\t\t\t\t\t\t</NotificationHolder>\r\n\t\t\t\t\t\t\t<NotificationHolder\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"directs\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tnotifCount={chatInfo.notifs.byChannelType[\"directs\"]}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"directs\")}>\r\n\t\t\t\t\t\t\t\tDirects\r\n\t\t\t\t\t\t\t</NotificationHolder>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"users\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"users\")}>\r\n\t\t\t\t\t\t\t\tUsers\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{currentTab == \"users\" &&\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\tclassName=\"user-search\"\r\n\t\t\t\t\t\t\t\tvalue={userSearchVal}\r\n\t\t\t\t\t\t\t\tplaceholder={\"Search\"}\r\n\t\t\t\t\t\t\t\tonChange={onUserSearch} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"channel-list\">\r\n\t\t\t\t\t\t\t{channels}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{currentTab == \"users\" && Object.keys(newDMUsers).length > 0 &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"create-dm-btn btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onCreateDM}>\r\n\t\t\t\t\t\t\t\t<i className=\"fas fa-plus\" />\r\n\t\t\t\t\t\t\t\tCreate DM ({Object.keys(newDMUsers).length})\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"right-panel\">\r\n\t\t\t\t\t\t{channel.id &&\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t<div className=\"channel-top\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"channel-name\">\r\n\t\t\t\t\t\t\t\t\t\t<ChannelName\r\n\t\t\t\t\t\t\t\t\t\t\tchannelType={channel.public ? \"rooms\" : \"directs\"}\r\n\t\t\t\t\t\t\t\t\t\t\tchannel={channel}\r\n\t\t\t\t\t\t\t\t\t\t\tuser={user} />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{!channel.public &&\r\n\t\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"close-dm fas fa-times\"\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => onCloseDM(channel.id)} />\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName=\"channel-messages\"\r\n\t\t\t\t\t\t\t\t\tref={messageListRef}\r\n\t\t\t\t\t\t\t\t\tonScroll={onMessagesScroll}>\r\n\t\t\t\t\t\t\t\t\t{messages}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"channel-input-wrapper\">\r\n\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"channel-input\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={textInput}\r\n\t\t\t\t\t\t\t\t\t\tmaxLength={MaxChatMessageLength}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setTextInput(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\tonKeyPress={onSendMessage} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</NotificationHolder>\r\n\t);\r\n}\r\n\r\nfunction Message(props) {\r\n\tconst message = props.message;\r\n\tconst socket = props.socket;\r\n\r\n\tconst [showContextMenu, setShowContextMenu] = useState(false);\r\n\tconst [clickCoords, setClickCoords] = useState({});\r\n\r\n\tconst messageRef = useRef();\r\n\tconst contextMenuRef = useRef();\r\n\tconst user = useContext(UserContext);\r\n\tconst isSelf = message.sender.id == user.id;\r\n\tconst age = Date.now() - message.date;\r\n\r\n\tuseOnOutsideClick(messageRef, () => setShowContextMenu(false));\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!contextMenuRef.current)\r\n\t\t\treturn;\r\n\r\n\t\tconst messageRect = messageRef.current.getBoundingClientRect();\r\n\r\n\t\tcontextMenuRef.current.style.top = (clickCoords.y - messageRect.top) + \"px\";\r\n\r\n\t\tif (!isSelf)\r\n\t\t\tcontextMenuRef.current.style.left = (clickCoords.x - messageRect.left) + \"px\";\r\n\t\telse\r\n\t\t\tcontextMenuRef.current.style.right = (messageRect.right - clickCoords.x) + \"px\";\r\n\r\n\t\tcontextMenuRef.current.style.visibility = \"visible\";\r\n\t}, [clickCoords]);\r\n\r\n\tfunction onMessageClick(e) {\r\n\t\tif (e.type == \"contextmenu\") {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetShowContextMenu(true);\r\n\t\t\tsetClickCoords({ x: e.clientX, y: e.clientY });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tsocket.send(\"deleteMessage\", message.id);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className={`message ${isSelf ? \"self\" : \"\"}`}>\r\n\t\t\t<div className=\"info\">\r\n\t\t\t\t{!isSelf &&\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={message.sender.id}\r\n\t\t\t\t\t\tname={message.sender.name}\r\n\t\t\t\t\t\tavatar={message.sender.avatar}\r\n\t\t\t\t\t\tcolor={message.sender.settings && flipTextColor(message.sender.settings.nameColor)}\r\n\t\t\t\t\t\tgroups={message.sender.groups} />\r\n\t\t\t\t}\r\n\t\t\t\t{age > 1000 * 60 &&\r\n\t\t\t\t\t<div className=\"timestamp\">\r\n\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\tmillisec={age}\r\n\t\t\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"content\"\r\n\t\t\t\tstyle={message.sender.settings && message.sender.settings.textColor ? { color: flipTextColor(message.sender.settings.textColor) } : {}}\r\n\t\t\t\tonContextMenu={onMessageClick}\r\n\t\t\t\tref={messageRef}>\r\n\t\t\t\t{/* {linkify(message.content)} */}\r\n\t\t\t\t<UserText\r\n\t\t\t\t\ttext={message.content}\r\n\t\t\t\t\tsettings={user.settings}\r\n\t\t\t\t\tfilterProfanity\r\n\t\t\t\t\tlinkify\r\n\t\t\t\t\temotify />\r\n\t\t\t</div>\r\n\t\t\t{showContextMenu && (user.id == message.sender.id || user.perms.deleteChatMessage) &&\r\n\t\t\t\t<div className=\"context\" ref={contextMenuRef}>\r\n\t\t\t\t\t<div className=\"item\" onClick={onDeleteClick}>\r\n\t\t\t\t\t\tDelete\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ChannelName(props) {\r\n\tconst channelType = props.channelType;\r\n\tconst channel = props.channel;\r\n\tconst user = props.user;\r\n\tconst short = props.short;\r\n\r\n\tswitch (channelType) {\r\n\t\tcase \"rooms\":\r\n\t\t\treturn channel.name;\r\n\t\tcase \"directs\":\r\n\t\t\tif (short) {\r\n\t\t\t\tvar memberNames = channel.members.filter(m => m.id != user.id).map(m => m.name);\r\n\t\t\t\tvar name = memberNames.join(\", \");\r\n\r\n\t\t\t\tif (memberNames.length > 1 && name.length > 20)\r\n\t\t\t\t\tname = name.slice(0, 17) + \"...\";\r\n\r\n\t\t\t\treturn name;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar members = channel.members.filter(m => m.id != user.id);\r\n\t\t\t\treturn members.map(\r\n\t\t\t\t\tm => (\r\n\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\t\tid={m.id}\r\n\t\t\t\t\t\t\tname={m.name}\r\n\t\t\t\t\t\t\tavatar={m.avatar}\r\n\t\t\t\t\t\t\tkey={m.id} />\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\tcase \"users\":\r\n\t\t\treturn (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tnoLink\r\n\t\t\t\t\t\tid={channel.id}\r\n\t\t\t\t\t\tname={channel.name}\r\n\t\t\t\t\t\tavatar={channel.avatar} />\r\n\t\t\t\t\t<StatusIcon status={channel.status} />\r\n\t\t\t\t</>\r\n\t\t\t);\r\n\t}\r\n}\r\n\r\nfunction sortDMs(a, b) {\r\n\treturn b.lastMessageDate - a.lastMessageDate;\r\n}\r\n\r\nfunction useChatInfoReducer() {\r\n\treturn useReducer((chatInfo, action) => {\r\n\t\tvar newChatInfo = chatInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tvar notifsArray = action.chatInfo.notifs;\r\n\t\t\t\tvar notifsTotal = 0;\r\n\t\t\t\tvar notifsByChannelType = { rooms: 0, directs: 0 };\r\n\t\t\t\tvar notifsByChannel = {};\r\n\r\n\t\t\t\tfor (let notif of notifsArray) {\r\n\t\t\t\t\tif (!notifsByChannel[notif.channelId])\r\n\t\t\t\t\t\tnotifsByChannel[notif.channelId] = 0;\r\n\r\n\t\t\t\t\tlet channelType = notif.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\r\n\t\t\t\t\tnotifsTotal += 1;\r\n\t\t\t\t\tnotifsByChannelType[channelType] += 1;\r\n\t\t\t\t\tnotifsByChannel[notif.channelId] += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewChatInfo = { ...action.chatInfo, notifs: chatInfo.notifs };\r\n\t\t\t\tnewChatInfo = update(newChatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: notifsTotal\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t$set: notifsByChannelType\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t$set: notifsByChannel\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"directs\":\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tdirects: {\r\n\t\t\t\t\t\t$unshift: [action.channel]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"users\":\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tusers: {\r\n\t\t\t\t\t\t$set: action.users\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"remove\":\r\n\t\t\t\tvar newChannels = chatInfo[action.channelType];\r\n\t\t\t\tnewChannels = newChannels.filter(channel => channel.id != action.channelId);\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\t[action.channelType]: {\r\n\t\t\t\t\t\t$set: newChannels\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"date\":\r\n\t\t\t\tvar newDirects = chatInfo.directs.map(channel => {\r\n\t\t\t\t\tif (channel.id == action.channelId)\r\n\t\t\t\t\t\tchannel.lastMessageDate = action.date;\r\n\r\n\t\t\t\t\treturn channel;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tdirects: {\r\n\t\t\t\t\t\t$set: newDirects\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addNotif\":\r\n\t\t\t\tvar channelType = action.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\t\t\t\tvar newAll = chatInfo.notifs.all + 1;\r\n\t\t\t\tvar newByChannelType = chatInfo.notifs[channelType] ? chatInfo.notifs[channelType] + 1 : 1;\r\n\t\t\t\tvar newByChannel = chatInfo.notifs[action.channelId] ? chatInfo.notifs[action.channelId] + 1 : 1;\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: newAll\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t[channelType]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannelType\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t[action.channelId]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannel\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"readNotifs\":\r\n\t\t\t\tvar amt = chatInfo.notifs.byChannel[action.channelId] || 0;\r\n\t\t\t\tvar channelType = action.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\t\t\t\tvar newAll = chatInfo.notifs.all - amt;\r\n\t\t\t\tvar newByChannelType = chatInfo.notifs.byChannelType[channelType] - amt;\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: newAll\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t[channelType]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannelType\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t[action.channelId]: {\r\n\t\t\t\t\t\t\t\t$set: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newChatInfo;\r\n\t}, { rooms: [], directs: [], users: [], notifs: { all: 0, byChannelType: {}, byChannel: {} } });\r\n}\r\n\r\nfunction useChannelReducer() {\r\n\treturn useReducer((channel, action) => {\r\n\t\tvar newChannel = channel;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tnewChannel = action.channel;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"message\":\r\n\t\t\t\tif (action.message.channel != channel.id)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t$push: [action.message]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"deleteMessage\":\r\n\t\t\t\tvar index = -1;\r\n\r\n\t\t\t\tfor (let i in channel.messages) {\r\n\t\t\t\t\tlet message = channel.messages[i];\r\n\r\n\t\t\t\t\tif (message.id == action.messageId) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index != -1) {\r\n\t\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t\t$splice: [[index, 1]]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"oldMessages\":\r\n\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t$unshift: action.messages\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"clear\":\r\n\t\t\t\tnewChannel = { messages: [] };\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newChannel;\r\n\t}, { messages: [] });\r\n}","import React, { useEffect } from \"react\";\r\nimport { Emotes, emotify } from \"../../components/Emotes\";\r\nimport \"../../css/emotes.css\";\r\n\r\nexport default function EmoteList() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Emotes | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>List of Emotes {emotify(\":doge:\")}</h1>\r\n            <div>{getEmotes()}</div>\r\n        </div>\r\n\t);\r\n    \r\n}\r\n\r\nfunction getEmotes() {\r\n    const emotesList = Object.keys(Emotes);\r\n    return (\r\n        <ul className=\"emote-list\">\r\n            {emotesList.map((emote) => (\r\n                <li key={emote}>\r\n                    {emote} {emotify(emote)}\r\n                </li>\r\n            ))}\r\n        </ul>\r\n    )\r\n}\r\n","import React, { useState, useContext, useRef, useEffect, useLayoutEffect } from \"react\";\r\nimport { Route, Link, NavLink, Switch, Redirect, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { UserContext, SiteInfoContext, PopoverContext, useSiteInfo } from \"./Contexts\";\r\nimport { AlertList, useErrorAlert } from \"./components/Alerts\";\r\nimport { NotificationHolder, useOnOutsideClick, Time } from \"./components/Basic\";\r\nimport { Nav } from \"./components/Nav\";\r\nimport Game from \"./pages/Game/Game\";\r\nimport Play from \"./pages/Play/Play\";\r\nimport Community from \"./pages/Community/Community\";\r\nimport Auth from \"./pages/Auth/Auth\";\r\nimport User, { Avatar, useUser } from \"./pages/User/User\";\r\nimport Legal from \"./pages/Legal/Legal\";\r\nimport Popover, { usePopover } from \"./components/Popover\";\r\nimport Chat from \"./pages/Chat/Chat\";\r\nimport Emotes from \"./pages/Chat/EmoteList\";\r\n\r\nimport \"./css/main.css\";\r\nimport { useReducer } from \"react\";\r\nimport { setCaptchaVisible } from \"./utils\";\r\n\r\nfunction Main() {\r\n    var cacheVal = window.localStorage.getItem(\"cacheVal\");\r\n\r\n    if (!cacheVal) {\r\n        cacheVal = Date.now();\r\n        window.localStorage.setItem(\"cacheVal\", cacheVal);\r\n    }\r\n\r\n    const user = useUser();\r\n    const siteInfo = useSiteInfo({\r\n        alerts: [],\r\n        cacheVal\r\n    });\r\n    const popover = usePopover(siteInfo);\r\n    const errorAlert = useErrorAlert(siteInfo);\r\n\r\n    function onGameLeave(index) {\r\n        axios.post(\"/game/leave\")\r\n            .then(() => {\r\n                siteInfo.hideAlert(index);\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    var userColourScheme = \"\";\r\n\r\n    if (user.settings?.siteColorScheme === false) {\r\n        userColourScheme = \"light\";\r\n    }\r\n    else if (user.settings?.siteColorScheme === true) {\r\n        userColourScheme = \"dark\";\r\n    }\r\n    else {\r\n        userColourScheme = user.settings?.siteColorScheme || \"auto\";\r\n    }\r\n    \r\n    if (userColourScheme === \"light\") {\r\n        if (document.documentElement.classList.contains(\"dark-mode\")) {\r\n            document.documentElement.classList.remove(\"dark-mode\");\r\n        }\r\n        document.documentElement.classList.add(\"light-mode\");\r\n    }\r\n    else if (userColourScheme === \"dark\") {\r\n        if (document.documentElement.classList.contains(\"light-mode\")) {\r\n            document.documentElement.classList.remove(\"light-mode\");\r\n        }\r\n        document.documentElement.classList.add(\"dark-mode\");\r\n    }\r\n    else if (userColourScheme === \"auto\") {\r\n        if (document.documentElement.classList.contains(\"dark-mode\")) {\r\n            document.documentElement.classList.remove(\"dark-mode\");\r\n        }\r\n        if (document.documentElement.classList.contains(\"light-mode\")) {\r\n            document.documentElement.classList.remove(\"light-mode\");\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function getInfo() {\r\n            try {\r\n                var res = await axios.get(\"/user/info\");\r\n\r\n                if (res.data.id) {\r\n                    setCaptchaVisible(false);\r\n\r\n                    axios.defaults.headers.common['x-csrf'] = res.data.csrf;\r\n                    axios.post(\"/user/online\");\r\n\r\n                    res.data.loggedIn = true;\r\n                    res.data.loaded = true;\r\n                    res.data.rank = Number(res.data.rank);\r\n                    user.set(res.data);\r\n\r\n                    var referrer = window.localStorage.getItem(\"referrer\");\r\n\r\n                    if (referrer) {\r\n                        axios.post(\"/user/referred\", { referrer });\r\n                        window.localStorage.removeItem(\"referrer\");\r\n                    }\r\n                }\r\n                else {\r\n                    user.clear();\r\n                    setCaptchaVisible(true);\r\n                }\r\n\r\n                if (res.data.nameChanged == false) {\r\n                    siteInfo.showAlert(() => (\r\n                        <div>\r\n                            New account created, you can change your username once in your <Link to={`/user/settings`}>settings</Link>.\r\n                        </div>\r\n                    ), \"basic\", true);\r\n                }\r\n\r\n                if (res.data.inGame) {\r\n                    siteInfo.showAlert(index => (\r\n                        <div>\r\n                            Return to game <Link to={`/game/${res.data.inGame}`}>{res.data.inGame}</Link> or <a onClick={() => onGameLeave(index)}>leave</a>.\r\n                        </div>\r\n                    ), \"basic\", true);\r\n                }\r\n\r\n                res = await axios.get(\"/roles/all\");\r\n                siteInfo.update(\"roles\", res.data);\r\n            }\r\n            catch (e) {\r\n                errorAlert(e);\r\n            }\r\n\r\n        }\r\n\r\n        getInfo();\r\n\r\n        var onlineInterval = setInterval(() => {\r\n            axios.post(\"/user/online\");\r\n        }, 1000 * 30);\r\n\r\n        return () => {\r\n            clearInterval(onlineInterval);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <UserContext.Provider value={user}>\r\n            <SiteInfoContext.Provider value={siteInfo}>\r\n                <PopoverContext.Provider value={popover}>\r\n                    <Switch>\r\n                        <Route path=\"/game\">\r\n                            <Game />\r\n                        </Route>\r\n                        <Route path=\"/\">\r\n                            <div className=\"site-wrapper\">\r\n                                <div className=\"main-container\">\r\n                                    <Header />\r\n                                    <div className=\"inner-container\">\r\n                                        <Switch>\r\n                                            <Route path=\"/play\" render={() => <Play />} />\r\n                                            <Route path=\"/community\" render={() => <Community />} />\r\n                                            <Route path=\"/auth\" render={() => <Auth />} />\r\n                                            <Route path=\"/user\" render={() => <User />} />\r\n                                            <Route path=\"/legal\" render={() => <Legal />} />\r\n                                            <Route path=\"/emotes\" render={() => <Emotes />} />\r\n                                            <Route render={() => <Redirect to=\"/play\" />} />\r\n                                        </Switch>\r\n                                    </div>\r\n                                    <Footer />\r\n                                    <AlertList />\r\n                                    <Chat />\r\n                                </div>\r\n                            </div>\r\n                        </Route>\r\n                    </Switch>\r\n                    <Popover />\r\n                </PopoverContext.Provider>\r\n            </SiteInfoContext.Provider>\r\n        </UserContext.Provider>\r\n    );\r\n}\r\n\r\nfunction Header(props) {\r\n    const user = useContext(UserContext);\r\n\r\n    return (\r\n        <div className=\"header\">\r\n            <div className=\"nav-wrapper left\">\r\n                <Nav>\r\n                    <NavLink to=\"/play\">Lobby</NavLink>\r\n                    <NavLink to=\"/community\">Community</NavLink>\r\n                </Nav>\r\n            </div>\r\n            <Link to=\"/\" className=\"logo-wrapper\">\r\n                <div className=\"logo\" />\r\n            </Link>\r\n            <div className=\"nav-wrapper right\">\r\n                <Nav>\r\n                    <a href=\"https://beyondmafia.fandom.com\" target=\"_blank\">Wiki</a>\r\n                    {!user.loggedIn &&\r\n                        <NavLink to=\"/auth\" className=\"nav-link\">Log In</NavLink>\r\n                    }\r\n                    {user.loggedIn &&\r\n                        <div className=\"user-wrapper\">\r\n                            <SiteNotifs />\r\n                            <Link to=\"/user\" className=\"profile-link\">\r\n                                <Avatar\r\n                                    id={user.id}\r\n                                    name={user.name}\r\n                                    hasImage={user.avatar} />\r\n                            </Link>\r\n                        </div>\r\n\r\n                    }\r\n                </Nav>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SiteNotifs() {\r\n    const [showNotifList, setShowNotifList] = useState(false);\r\n    const [notifInfo, updateNotifInfo] = useNotifInfoReducer();\r\n    const [nextRestart, setNextRestart] = useState();\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const history = useHistory();\r\n\r\n    const bellRef = useRef();\r\n    const notifListRef = useRef();\r\n\r\n    useOnOutsideClick([bellRef, notifListRef], () => setShowNotifList(false));\r\n\r\n    useEffect(() => {\r\n        getNotifs();\r\n        var notifGetInterval = setInterval(() => getNotifs(), 10 * 1000);\r\n        return () => clearInterval(notifGetInterval);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (showNotifList)\r\n            viewedNotifs();\r\n    }, [notifInfo.notifs]);\r\n\r\n    useEffect(() => {\r\n        if (nextRestart && nextRestart > Date.now()) {\r\n            var restartMinutes = Math.ceil((nextRestart - Date.now()) / 1000 / 60);\r\n            siteInfo.showAlert(`The server will be restarting in ${restartMinutes} minutes.`, \"basic\", true);\r\n        }\r\n    }, [nextRestart]);\r\n\r\n    useLayoutEffect(() => {\r\n        if (!showNotifList)\r\n            return;\r\n\r\n        const listRect = notifListRef.current.getBoundingClientRect();\r\n        const listRight = listRect.left + listRect.width;\r\n\r\n        if (listRight > window.innerWidth)\r\n            notifListRef.current.style.left = (window.innerWidth - listRight) + \"px\";\r\n\r\n        notifListRef.current.style.visibility = \"visible\";\r\n    });\r\n\r\n    function getNotifs() {\r\n        axios.get(\"/notifs\")\r\n            .then(res => {\r\n                var nextRestart = res.data[0];\r\n                var notifs = res.data.slice(1);\r\n\r\n                setNextRestart(nextRestart);\r\n\r\n                updateNotifInfo({\r\n                    type: \"add\",\r\n                    notifs: notifs\r\n                });\r\n            })\r\n            .catch(() => { });\r\n    }\r\n\r\n    function viewedNotifs() {\r\n        axios.post(\"/notifs/viewed\")\r\n            .then(() => {\r\n                updateNotifInfo({ type: \"viewed\" });\r\n            })\r\n            .catch(() => { });\r\n    }\r\n\r\n    function onShowNotifsClick() {\r\n        setShowNotifList(!showNotifList);\r\n\r\n        if (!showNotifList && notifInfo.unread > 0)\r\n            viewedNotifs();\r\n    }\r\n\r\n    function onNotifClick(e, notif) {\r\n        if (!notif.link)\r\n            e.preventDefault();\r\n        else if (window.location.pathname == notif.link.split(\"?\")[0])\r\n            history.go(0);\r\n    }\r\n\r\n    const notifs = notifInfo.notifs.map(notif => (\r\n        <Link\r\n            className=\"notif\"\r\n            key={notif.id}\r\n            to={notif.link}\r\n            onClick={e => onNotifClick(e, notif)}>\r\n            {notif.icon &&\r\n                <i className={`fas fa-${notif.icon}`} />\r\n            }\r\n            <div className=\"info\">\r\n                <div className=\"time\">\r\n                    <Time\r\n                        millisec={Date.now() - notif.date}\r\n                        suffix=\" ago\" />\r\n                </div>\r\n                <div className=\"content\">\r\n                    {notif.content}\r\n                </div>\r\n            </div>\r\n        </Link>\r\n    ));\r\n\r\n    return (\r\n        <div className=\"notifs-wrapper\">\r\n            <NotificationHolder\r\n                lOffset\r\n                notifCount={notifInfo.unread}\r\n                onClick={onShowNotifsClick}\r\n                fwdRef={bellRef}>\r\n                <i className=\"fas fa-bell\" />\r\n            </NotificationHolder>\r\n            {showNotifList &&\r\n                <div\r\n                    className=\"notif-list\"\r\n                    ref={notifListRef}>\r\n                    {notifs}\r\n                    {notifs.length == 0 &&\r\n                        \"No unread notifications\"\r\n                    }\r\n                </div>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction useNotifInfoReducer() {\r\n    return useReducer((notifInfo, action) => {\r\n        var newNotifInfo;\r\n\r\n        switch (action.type) {\r\n            case \"add\":\r\n                var existingNotifIds = notifInfo.notifs.map(notif => notif.id);\r\n                var newNotifs = action.notifs.filter(notif => existingNotifIds.indexOf(notif.id) == -1);\r\n\r\n                newNotifInfo = update(notifInfo, {\r\n                    notifs: {\r\n                        $set: newNotifs.concat(notifInfo.notifs)\r\n                    },\r\n                    unread: {\r\n                        $set: notifInfo.unread + newNotifs.length\r\n                    }\r\n                });\r\n\r\n                // if (newNotifs.length > 0 && document.hidden && document.title.indexOf(\"\") == -1)\r\n                //     document.title = document.title + \"\";\r\n                break;\r\n            case \"viewed\":\r\n                newNotifInfo = update(notifInfo, {\r\n                    unread: {\r\n                        $set: 0\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newNotifInfo || notifInfo;\r\n    }, { notifs: [], unread: 0 });\r\n}\r\n\r\nfunction Footer() {\r\n    let year = (new Date()).getYear() + 1900;\r\n\r\n    return (\r\n        <div className=\"footer\">\r\n            <div className=\"footer-inner\">\r\n                <p> {year} BeyondMafia</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Main;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\n\r\nimport Main from \"./Main\";\r\n\r\nReactDOM.render((\r\n    <Router>\r\n        <Main />\r\n    </Router>\r\n), document.getElementById(\"root\"));"],"sourceRoot":""}