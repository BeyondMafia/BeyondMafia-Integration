{"version":3,"sources":["Constants.jsx","Contexts.jsx","components/Alerts.jsx","components/Emotes.jsx","json/badWords.js","json/slurs.js","components/Basic.jsx","components/Dropdown.jsx","utils.jsx","components/Nav.jsx","pages/Loading.jsx","pages/Game/MafiaGame.jsx","pages/Game/SplitDecisionGame.jsx","pages/Game/ResistanceGame.jsx","pages/Game/OneNightGame.jsx","pages/Landing.jsx","components/Form.jsx","pages/User/Profile.jsx","pages/User/Settings.jsx","pages/User/Shop.jsx","pages/User/User.jsx","pages/Community/Forums/Categories.jsx","components/Modal.jsx","pages/Community/Forums/Board.jsx","pages/Community/Forums/Thread.jsx","pages/Community/Forums/Forums.jsx","pages/Community/Comments.jsx","pages/Play/Join.jsx","pages/Play/Host/Host.jsx","pages/Play/Host/HostMafia.jsx","pages/Play/CreateSetup/CreateSetup.jsx","pages/Play/CreateSetup/CreateMafiaSetup.jsx","pages/Play/Learn/LearnMafia.jsx","pages/Play/Host/HostSplitDecision.jsx","pages/Play/CreateSetup/CreateSplitDecisionSetup.jsx","pages/Play/Learn/LearnSplitDecision.jsx","pages/Play/Host/HostResistance.jsx","pages/Play/CreateSetup/CreateResistanceSetup.jsx","pages/Play/Learn/LearnResistance.jsx","pages/Play/Host/HostOneNight.jsx","pages/Play/CreateSetup/CreateOneNightSetup.jsx","pages/Play/Learn/LearnOneNight.jsx","pages/Play/Play.jsx","components/Roles.jsx","components/Setup.jsx","Socket.js","pages/Game/Game.jsx","pages/Community/UserSearch.jsx","pages/Community/Moderation.jsx","pages/Community/Community.jsx","pages/Auth/LogIn.jsx","pages/Auth/SignUp.jsx","pages/Auth/Auth.jsx","pages/Legal/PrivacyPolicy.jsx","pages/Legal/TermsOfService.jsx","pages/Legal/Legal.jsx","components/Popover.jsx","pages/Chat/Chat.jsx","Main.jsx","index.jsx"],"names":["GameTypes","Lobbies","Alignments","GameStates","RatingThresholds","UserContext","React","createContext","SiteInfoContext","PopoverContext","GameContext","useSiteInfo","initData","useReducer","siteInfo","action","newSiteInfo","type","prop","value","update","$set","text","alerts","length","$push","alertType","id","$splice","index","i","updateSiteInfo","setSiteInfoProp","showAlert","noFade","alertId","Math","random","setTimeout","alert","document","getElementById","style","opacity","fadeAlert","hideAlert","hideAllAlerts","clearCache","cacheVal","Date","now","window","localStorage","setItem","AlertList","props","useContext","map","Alert","onHide","key","className","onClick","useErrorAlert","siteInfoContext","e","message","response","data","Emote","emoteKey","emote","toLowerCase","Emotes","title","name","backgroundImage","EmoteKeys","Object","keys","ItemList","itemRows","items","PanelGrid","panels","panel","icon","Time","unit","millisec","suffix","minSec","units","scale","floor","NotificationHolder","notifCount","lOffset","ref","fwdRef","children","UserText","useState","content","setContent","useEffect","filterProfanity","settings","profChar","linkify","Array","isArray","linkRegex","_segment","segment","lastIndex","regexRes","exec","push","slice","href","target","flat","emotify","words","split","j","word","k","regex","RegExp","match","char","disablePg13Censor","filterProfanitySegment","badWords","disableAllCensors","slurs","profanity","replacement","repeat","splice","join","useOnOutsideClick","refs","onOutsideClick","current","contains","addEventListener","removeEventListener","Dropdown","useDropdown","menuVisible","setMenuVisible","dropdownContainerRef","dropdownMenuRef","selOption","options","filter","option","selLabel","label","menuItems","optionId","onChange","placeholder","caret","useRef","useLayoutEffect","containerRect","getBoundingClientRect","menuRect","menuLeft","left","menuTop","top","height","scrollY","menuHorzShift","innerWidith","width","innerHeight","visibility","hyphenDelimit","roleName","replace","camelCase","string","subStrings","result","charAt","toUpperCase","substring","pad","amt","dateToHTMLString","date","day","toLocaleDateString","time","toTimeString","Nav","SubNav","links","link","hide","exact","to","path","showFilter","filterSel","filterOptions","onFilter","filterIcon","PageNav","page","maxPage","range","onNav","inverted","noRange","sel","list","changed","unshift","pages","updatePages","pageNums","SearchBar","event","onInput","LoadingPage","color","MafiaGame","game","history","updateHistory","stateViewing","updatePlayers","updateStateViewing","self","players","isSpectator","playBellRef","meetings","states","audioFileNames","stateEvents","audioLoops","audioOverrides","audioVolumes","currentState","loadAudioFiles","review","useSocketListeners","socket","on","state","playAudio","winners","TopBar","gameType","setup","spectatorCount","setLeave","finished","setShowSettingsModal","setRehostId","dev","gameName","timer","Timer","timers","ThreePanelLayout","leftPanelContent","PlayerList","activity","SpeechFilter","filters","speechFilters","setFilters","setSpeechFilters","centerPanelContent","TextMeetingLayout","setTyping","agoraClient","localAudioTrack","setActiveVoiceChannel","muted","setMuted","deafened","setDeafened","rightPanelContent","ActionList","lastWill","LastWillEntry","Notes","SplitDecisionGame","ResistanceGame","OneNightGame","LandingPage","Form","field","localOnly","min","Number","max","formFields","fields","showIf","disabled","deps","fieldWrapperClass","fixed","saveBtn","highlight","select","saveBtnDiffer","confirm","saveBtnOnClick","step","Switch","ColorPicker","default","alpha","noReset","submitText","onSubmit","picking","setPicking","pickerRef","backgroundColor","disableAlpha","onChangeComplete","hex","HiddenUpload","inputRef","shouldInput","click","onFileUpload","files","useForm","initialFormFields","initFields","actions","newFormFields","newField","updateFields","updates","SearchSelect","setValue","inputValue","setInputValue","optionsVisible","setOptionsVisible","hoveringOptions","setHoveringOptions","matchingOptions","setMatchingOptions","searchSelectRef","optionsRef","searchSelectRect","optionsRect","optionsTop","includes","onOptionClick","tabIndex","onFocus","onBlur","onInputChange","onKeyDown","onMouseEnter","onMouseLeave","UserSearchSelect","setOptions","idMap","setIdMap","query","setQuery","valueName","setValueName","axios","get","then","res","newIdMap","userData","user","catch","TextEditor","tab","setTab","selectedTab","onTabChange","classes","generateMarkdownPreview","markdown","Promise","resolve","source","Profile","profileLoaded","setProfileLoaded","setName","avatar","setAvatar","banner","setBanner","bio","setBio","oldBio","setOldBio","editingBio","setEditingBio","isFriend","setIsFriend","setSettings","accounts","setAccounts","recentGames","setRecentGames","createdSetups","setCreatedSetups","bustCache","setBustCache","friendsPage","setFriendsPage","maxFriendsPage","setMaxFriendsPage","friends","setFriends","friendRequests","setFriendRequests","Mafia","stats","setStats","useHistory","errorAlert","userId","useParams","isSelf","isBlocked","blockedUsers","indexOf","formData","FormData","append","getElementsByClassName","post","onFriendsPageNav","filterArg","lastActive","games","setups","ratings","mainPanelStyle","bannerStyle","bannerFormat","backgroundSize","statName","stat","total","round","count","letter","letters","reverse","recentGamesRows","GameRow","status","smallSetup","createdSetupRows","Setup","friendRequestRows","NameWithAvatar","_userId","newFriendRequests","u","friendRows","friend","loaded","loggedIn","itemsOwned","customProfile","Avatar","large","hasImage","edit","onUpload","blockUserToggle","discord","showDiscord","twitch","showTwitch","steam","showSteam","stopPropagation","Comments","location","Settings","settingsLoaded","setSettingsLoaded","accountsLoaded","setAccountsLoaded","process","perms","viewDeleted","siteFields","updateSiteFields","code","reservedNames","prompt","set","nameChange","profileFields","updateProfileFields","textColors","gameFields","updateGameFields","onSettingChange","updateSetting","siteFormFieldChanges","profileFormFieldChanges","gameFormFieldChanges","clear","Shop","shopItems","balance","shopInfo","setShopInfo","setLoaded","item","desc","price","limit","onBuyItem","User","render","size","small","imageUrl","active","colors","rand","charCodeAt","abs","pow","noLink","newTab","popover","setVisible","preventDefault","StatusIcon","Categories","categoryInfo","setCategoryInfo","sortItems","a","b","position","updateForumNavInfo","categories","sort","category","boards","board","newestThreads","thread","author","ViewsAndReplies","viewCount","replyCount","recentReplies","reply","postDate","description","Modal","show","onBgClick","header","footer","Board","boardInfo","setBoardInfo","showCreateModal","setShowCreateModal","newThreadTitle","setNewThreadTitle","newThreadContent","setNewThreadContent","boardPage","setBoardPage","sortType","redirect","setRedirect","boardId","onBoardPageNav","threads","console","log","threadRowsMap","deleted","VoteWidget","itemType","itemHolder","setItemHolder","itemKey","locked","pinned","pinnedThreads","CreateThreadModal","setShow","threadTitle","setThreadTitle","threadContent","setThreadContent","createThread","onCancel","Thread","threadInfo","setThreadInfo","showReplyForm","setShowReplyForm","replyContent","setReplyContent","setPage","scrolled","setScrolled","replyFormRef","threadId","useLocation","params","URLSearchParams","search","onReplyClick","postInLocked","newContent","quotedContent","scrollIntoView","onThreadPageNav","replies","boardName","Post","postInfo","voteItem","voteItemHolder","setVoteItemHolder","permaLink","onDelete","onRestore","onEdit","onNotifyToggled","replyNotify","onPinToggled","onLockToggled","hasTitle","body","scrollTop","scrollHeight","pageCount","editing","setEditing","editContent","setEditContent","hideDeleted","pinThreads","lockThreads","deleteAnyPost","deleteOwnPost","editPost","navigator","clipboard","writeText","origin","postReply","restoreDeleted","Forums","info","newInfo","forumNavInfo","ForumNav","onVote","itemId","direction","vote","newDirection","newItem","voteCount","updateItemVoteCount","newItems","viewsPlural","repliesPlural","comments","setComments","showInput","setShowInput","postContent","setPostContent","onCommentsPageNav","_page","comment","commentRows","Comment","Join","listType","setListType","setGames","getItem","lobby","setLobby","getGameList","_listType","endTime","pathname","TopBarLink","refresh","odd","empty","linkPath","buttonText","reserved","setReserved","infoRef","buttonClass","scheduled","spectating","canSpectateAny","onRehostClick","stateLengths","stateName","guests","private","ranked","voiceChat","readyCheck","JSON","parse","gameTypeOptions","broken","gameId","hostId","PlayerCount","maxRolesCount","circles","Host","selSetup","setSelSetup","updateFormFields","onHostGame","setPageCount","searchVal","setSearchVal","setSetups","getSetupList","onFavSetup","favSetup","newSetups","favorite","onEditSetup","onDelSetup","hostButtons","onHostNavClick","SetupRow","onSelect","onFav","onDel","args","selIconFormat","favIconFormat","HostMafia","getFormFieldValue","getTime","extendLength","CreateSetup","roleSets","closedField","resetFormFields","formFieldValueMods","onCreateSetup","selRoleSet","setSelRoleSet","modifier","setModifier","roleData","newRoleData","roles","closed","roleSet","role","updateRoleData","formFieldChanges","valueMod","alignment","RoleCount","RoleSetRow","modifiers","RoleSearch","onAddClick","CreateMafiaSetup","startState","dawn","whispers","leakPercentage","mustAct","noReveal","votesInvisible","unique","LearnMafia","HostSplitDecision","CreateSplitDecisionSetup","swapAmt","roundAmt","LearnSplitDecision","HostResistance","CreateResistanceSetup","firstTeamSize","lastTeamSize","numMissions","teamFailLimit","LearnResistance","CreateOneNightSetup","excessRoles","LearnOneNight","Play","inLobby","setGameType","roleRef","hideCount","roleClass","bg","showPopover","roleListType","setRoleListType","roleCellRefs","alignButtons","roleCells","roleCellEl","onRoleCellClick","el","roleCounts","multi","setupRef","overSize","roleNames","GameIcon","SmallRoleList","GameStateIcon","iconName","ClientSocket","persistent","WebSocket","configurePing","configureClose","this","heartbeat","clearTimeout","pingTimeout","send","close","PING_INTERVAL","reconnect","listeners","sendQueue","received","setSocket","configureListeners","triggerEvent","terminate","eventName","parseMessage","bind","stringify","String","stringifyMessage","readyState","newListeners","Game","GameWrapper","leave","setFinished","port","setPort","token","setToken","connected","setConnected","setSetup","emojis","setEmojis","newHistory","stateIds","prevState","dead","meeting","meetingId","members","$unset","selTab","messages","quote","toMeetingId","votes","voterId","noLog","voteRecord","undefined","t","playerId","newState","useStateViewingReducer","newPlayers","player","propName","propVal","setSpectatorCount","setIsSpectator","setSelf","setLastWill","newTimers","delay","timerName","intTime","updateTimers","newSettings","propval","votingLog","timestamps","sounds","volume","updateSettings","showSettingsModal","showFirstGameModal","setShowFirstGameModal","from","activeVoiceChannel","rehostId","setDev","playersRef","selfRef","newActivity","typing","newSpeaking","reduce","speaking","updateActivity","activityInterval","setInterval","getVolumeLevel","uid","remoteUsers","forEach","audioTrack","clearInterval","useActivity","audioRef","audioInfo","newAudioInfo","overrides","audioName","pause","currentTime","play","volumes","fileName","Audio","load","loop","loops","updateAudio","audios","useAudio","stopAudio","stopAudios","createAgoraClient","AgoraRTC","createClient","mode","codec","mediaType","subscribe","setVolume","audioContainer","remove","agoraDisconnect","createMicrophoneAudioTrack","publish","error","socketURL","newSocket","Socket","onKeydown","speechInput","activeElName","activeElement","tagName","focus","requestNotificationAccess","timerInterval","names","users","textColor","nameColor","vcToken","agoraConnect","guestId","isBot","pings","will","Notification","permission","hasFocus","context","Provider","SettingsModal","showModal","setShowModal","FirstGameModal","StateSwitcher","open","values","p","rehost","stateInfo","autoScroll","setAutoScroll","mouseMoved","setMouseMoved","speechDisplayRef","speechMeetings","speech","doAutoScroll","onMessageQuote","senderId","isQuote","quotable","messageId","fromMeetingId","fromState","onMouseMove","tabs","tabId","m","matches","playerName","concat","isUnvote","voter","voterName","voteMsg","getMessagesToDisplay","Message","canSpeak","amMember","canTalk","onScroll","clientHeight","SpeechInput","quotedMessage","contentClass","isMe","msg","meetingName","senderName","onDoubleClick","Timestamp","prefix","hours","getHours","padStart","minutes","getMinutes","seconds","getSeconds","setSpeechInput","speechDropdownOptions","setSpeechDropdownOptions","speechDropdownValue","setSpeechDropdownValue","lastTyped","setLastTyped","typingIn","setTypingIn","clearTyping","setClearTyping","speechAbilities","newDropdownOptions","ability","targets","targetDisplay","targetType","verb","isTyping","autoComplete","maxLength","onKeyPress","abilityInfo","abilityName","abilityTarget","leftArrowVisible","rigthArrowVisible","SideMenu","scrollable","PlayerRows","stateViewingInfo","alivePlayers","deadPlayers","voting","inputType","ActionSelect","ActionButton","ActionText","useAction","notClickable","getTargetDisplay","member","canVote","selection","actionName","buttons","canUnvote","isCurrentState","instant","formatTimerTime","newWill","modalContent","modalFooter","cancel","notes","setNotes","notesData","removeItem","_notes","requestPermission","userList","setUserList","Moderation","groups","setGroups","rank","groupsPanels","group","viewModActions","ModCommands","command","setCommand","argValues","setArgValues","modCommands","commandRan","perm","maxlength","optional","run","ban","modId","expires","toLocaleString","useModCommands","commandName","updateArgValue","arg","Community","LogIn","email","setEmail","password","setPassword","submitDisabled","setSubmitDisabled","loading","setLoading","showResetPw","setShowResetPw","auth","getAuth","signInWithEmailAndPassword","userCred","getIdToken","idToken","reload","sendEmailVerification","onResetPw","sendPasswordResetEmail","SignUp","passwordConf","setPasswordConf","signedUp","setSignedUp","createUserWithEmailAndPassword","Auth","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","setPersistence","inMemoryPersistence","PrivacyPolicy","Legal","Popover","popoverRef","triangleRef","boundingEl","loadingRef","setBoundingEl","visible","boundingRect","popoverRect","triangleLeft","triangleTop","popoverLeft","popoverTop","popoverHorzShift","innerWidth","usePopover","setTitle","ready","InfoRow","creator","whisperContent","roleset","rolesByAlignment","roleObj","rolesets","sectionName","parseSetupPopover","descLines","parseRolePopover","playerList","totalPlayers","createTime","startTime","parseGamePopover","dataMod","_boundingEl","Chat","showWindow","setShowWindow","chatInfo","newChatInfo","notifsArray","notifs","notifsTotal","notifsByChannelType","rooms","directs","notifsByChannel","notif","channelId","channelType","all","byChannelType","byChannel","$unshift","channel","newChannels","newDirects","lastMessageDate","newAll","newByChannelType","newByChannel","updateChatInfo","currentTab","setCurrentTab","currentChannelId","setCurrentChannelId","newChannel","updateChannel","newDMUsers","setNewDMUsers","textInput","setTextInput","userSearchVal","setUserSearchVal","messageListRef","oldScrollHeight","onTabClick","scrollTo","manageScroll","roomId","hidden","channels","sortDMs","ChannelName","short","public","messageList","showContextMenu","setShowContextMenu","clickCoords","setClickCoords","messageRef","contextMenuRef","sender","age","messageRect","y","right","x","onContextMenu","clientX","clientY","deleteChatMessage","memberNames","Header","SiteNotifs","showNotifList","setShowNotifList","notifInfo","newNotifInfo","existingNotifIds","newNotifs","unread","updateNotifInfo","nextRestart","setNextRestart","bellRef","notifListRef","getNotifs","viewedNotifs","notifGetInterval","restartMinutes","ceil","listRect","listRight","go","onNotifClick","Footer","year","getYear","Main","setUser","userIndex","useUser","onGameLeave","defaults","headers","common","csrf","referrer","nameChanged","inGame","getInfo","onlineInterval","ReactDOM"],"mappings":"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","file":"static/js/main.a75bd412.chunk.js","sourcesContent":["export const GameTypes = [\"Mafia\", \"Split Decision\", \"Resistance\", \"One Night\"];\r\nexport const Lobbies = [\"Main\", \"Sandbox\", \"Competitive\", \"Games\"];\r\n\r\nexport const Alignments = {\r\n\t\"Mafia\": [\"Village\", \"Mafia\", \"Monsters\", \"Independent\"],\r\n\t\"Split Decision\": [\"Blue\", \"Red\", \"Independent\"],\r\n\t\"Resistance\": [\"Resistance\", \"Spies\"],\r\n\t\"One Night\": [\"Village\", \"Werewolves\", \"Independent\"],\r\n};\r\n\r\nexport const GameStates = {\r\n\t\"Mafia\": [\"Day\", \"Night\"],\r\n\t\"Split Decision\": [\"Initial Round\", \"Hostage Swap\"],\r\n\t\"Resistance\": [\"Team Selection\", \"Team Approval\", \"Mission\"],\r\n\t\"One Night\": [\"Day\", \"Night\"],\r\n};\r\n\r\nexport const RatingThresholds = {\r\n\t\"reads\": {\r\n\t\t\"S\": 0.95,\r\n\t\t\"A\": 0.9,\r\n\t\t\"B\": 0.8,\r\n\t\t\"C\": 0.7,\r\n\t\t\"D\": 0.6,\r\n\t\t\"E\": 0.5,\r\n\t},\r\n\t\"survival\": {\r\n\t\t\"S\": 0.95,\r\n\t\t\"A\": 0.9,\r\n\t\t\"B\": 0.8,\r\n\t\t\"C\": 0.7,\r\n\t\t\"D\": 0.6,\r\n\t\t\"E\": 0.5,\r\n\t},\r\n\t\"participation\": {\r\n\t\t\"S\": 0.95,\r\n\t\t\"A\": 0.9,\r\n\t\t\"B\": 0.8,\r\n\t\t\"C\": 0.7,\r\n\t\t\"D\": 0.6,\r\n\t\t\"E\": 0.5,\r\n\t},\r\n};\r\n\r\nexport const RequiredTotalForStats = 1;\r\n\r\nexport const MaxGameMessageLength = 240;\r\nexport const MaxWillLength = 100;\r\n\r\nexport const MaxGroupNameLength = 20;\r\nexport const MaxCategoryNameLength = 20;\r\nexport const MaxBoardNameLength = 20;\r\nexport const MaxBoardDescLength = 60;\r\nexport const MaxThreadTitleLength = 50;\r\nexport const MaxThreadContentLength = 5000;\r\nexport const MaxReplyLength = 1000;\r\n\r\nexport const MaxChatMessageLength = 240;\r\n\r\nexport const AlertFadeTimeout = 3000;\r\nexport const AlertFadeDuration = 500;\r\n\r\n","import React, { useState, useReducer } from \"react\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { AlertFadeTimeout, AlertFadeDuration } from \"./Constants\";\r\n\r\nexport const UserContext = React.createContext();\r\nexport const SiteInfoContext = React.createContext();\r\nexport const PopoverContext = React.createContext();\r\nexport const GameContext = React.createContext();\r\n\r\nexport function useSiteInfo(initData) {\r\n\tconst [siteInfo, updateSiteInfo] = useReducer((siteInfo, action) => {\r\n\t\tvar newSiteInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"setProp\":\r\n\t\t\t\tif (siteInfo[action.prop] != action.value) {\r\n\t\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\t\t[action.prop]: {\r\n\t\t\t\t\t\t\t$set: action.value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showAlert\":\r\n\t\t\t\tif (typeof action.text == \"function\")\r\n\t\t\t\t\taction.text = action.text(siteInfo.alerts.length);\r\n\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$push: [{ \r\n\t\t\t\t\t\t\ttext: action.text, \r\n\t\t\t\t\t\t\ttype: action.alertType || \"\" ,\r\n\t\t\t\t\t\t\tid: action.id\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAlert\":\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$splice: [[action.index, 1]]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAlertById\":\r\n\t\t\t\tfor (let i = 0; i < siteInfo.alerts.length; i++) {\r\n\t\t\t\t\tif (siteInfo.alerts[i].id == action.id) {\r\n\t\t\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t\t\t$splice: [[i, 1]]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hideAllAlerts\":\r\n\t\t\t\tnewSiteInfo = update(siteInfo, {\r\n\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t$set: []\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newSiteInfo || siteInfo;\r\n\t}, initData);\r\n\r\n\tfunction setSiteInfoProp(prop, value) {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"setProp\",\r\n\t\t\tprop,\r\n\t\t\tvalue\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showAlert(text, alertType, noFade) {\r\n\t\tvar alertId = Math.random();\r\n\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"showAlert\",\r\n\t\t\ttext,\r\n\t\t\talertType,\r\n\t\t\tid: alertId\r\n\t\t});\r\n\r\n\t\tif (!noFade)\r\n\t\t\tsetTimeout(() => fadeAlert(alertId), AlertFadeTimeout);\r\n\t}\r\n\r\n\tfunction hideAlert(index) {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"hideAlert\",\r\n\t\t\tindex\r\n\t\t});\r\n\t}\r\n\r\n\tfunction hideAllAlerts() {\r\n\t\tupdateSiteInfo({\r\n\t\t\ttype: \"hideAllAlerts\"\r\n\t\t});\r\n\t}\r\n\r\n\tfunction clearCache() {\r\n\t\tvar cacheVal = Date.now();\r\n\t\tsetSiteInfoProp(\"cacheVal\", cacheVal);\r\n\t\twindow.localStorage.setItem(\"cacheVal\", cacheVal);\r\n\t}\r\n\r\n\tfunction fadeAlert(id) {\r\n\t\tvar alert = document.getElementById(`alert-id-${id}`);\r\n\r\n\t\tif (!alert)\r\n\t\t\treturn;\r\n\r\n\t\talert.style.opacity = 0;\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tupdateSiteInfo({\r\n\t\t\t\ttype: \"hideAlertById\",\r\n\t\t\t\tid\r\n\t\t\t});\r\n\t\t}, AlertFadeDuration);\r\n\t}\r\n\r\n\treturn {\r\n\t\t...siteInfo,\r\n\t\tupdate: setSiteInfoProp,\r\n\t\tshowAlert,\r\n\t\thideAlert,\r\n\t\thideAllAlerts,\r\n\t\tclearCache\r\n\t};\r\n}","import React, { useContext } from \"react\";\r\nimport { SiteInfoContext } from \"../Contexts\";\r\n\r\nimport \"../css/alerts.css\";\r\n\r\nexport function AlertList(props) {\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tconst alerts = siteInfo.alerts.map((alert, i) => {\r\n\t\treturn (\r\n\t\t\t<Alert\r\n\t\t\t\tid={alert.id}\r\n\t\t\t\tindex={i}\r\n\t\t\t\ttext={alert.text}\r\n\t\t\t\ttype={alert.type}\r\n\t\t\t\tonHide={siteInfo.hideAlert}\r\n\t\t\t\tkey={alert.id} />\r\n\t\t)\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"alert-list\">\r\n\t\t\t{alerts}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Alert(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tid={`alert-id-${props.id}`}\r\n\t\t\tclassName={`alert alert-${props.type}`}>\r\n\t\t\t<i\r\n\t\t\t\tclassName={`hide-alert fa-times-circle fas`}\r\n\t\t\t\tonClick={() => props.onHide(props.index)} />\r\n\t\t\t{props.text}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport function useErrorAlert(siteInfo) {\r\n\tconst siteInfoContext = useContext(SiteInfoContext);\r\n\tsiteInfo = siteInfo || siteInfoContext;\r\n\r\n\treturn (e) => {\r\n\t\tvar message;\r\n\r\n\t\tif (e && e.response)\r\n\t\t\tmessage = e.response.data;\r\n\t\telse if (e && e.message)\r\n\t\t\tmessage = e.message;\r\n\t\telse if (typeof e == \"string\")\r\n\t\t\tmessage = e;\r\n\t\telse\r\n\t\t\tmessage = \"Error loading data\";\r\n\r\n\t\tif (message.length > 200)\r\n\t\t\tmessage = \"Connection error\";\r\n\r\n\t\tsiteInfo.showAlert(message, \"error\");\r\n\t};\r\n}","import React, { useEffect } from \"react\";\r\n\r\nimport \"../css/emotes.css\";\r\n\r\nexport function Emote(props) {\r\n\tconst emoteKey = props.emote.toLowerCase();\r\n\tconst emote = Emotes[emoteKey];\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"emote\"\r\n\t\t\ttitle={emote.name}\r\n\t\t\tstyle={{ backgroundImage: `url('/images/emotes/${emoteKey}.${emote.type}')` }} />\r\n\t);\r\n}\r\n\r\nexport function emotify(text) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\r\n\tfor (let i in text) {\r\n\t\tlet segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tconst words = segment.split(\" \");\r\n\r\n\t\tfor (let j in words) {\r\n\t\t\tlet word = words[j];\r\n\r\n\t\t\tfor (let k in EmoteKeys) {\r\n\t\t\t\tlet key = EmoteKeys[k];\r\n\t\t\t\tlet regex = new RegExp(`^${key}$`, \"i\");\r\n\r\n\t\t\t\tif (word.match(regex)) {\r\n\t\t\t\t\twords[j] = <Emote emote={key} />;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (k == EmoteKeys.length - 1)\r\n\t\t\t\t\twords[j] = words[j] + \" \";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext[i] = words;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport const Emotes = {\r\n\t\"ez\": {\r\n\t\tname: \"EZ\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"feelsdankman\": {\r\n\t\tname: \"FeelsDankMan\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"feelsokayman\": {\r\n\t\tname: \"FeelsOkayMan\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"kapp\": {\r\n\t\tname: \"Kapp\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"monkagun\": {\r\n\t\tname: \"MonkaGun\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"monkahmm\": {\r\n\t\tname: \"MonkaHmm\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"monkas\": {\r\n\t\tname: \"MonkaS\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"nodders\": {\r\n\t\tname: \"Nodders\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\"nopers\": {\r\n\t\tname: \"Nopers\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\"omegalul\": {\r\n\t\tname: \"Omegalul\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"peepohappy\": {\r\n\t\tname: \"PeepoHappy\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"peeposad\": {\r\n\t\tname: \"PeepoSad\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"peepowtf\": {\r\n\t\tname: \"PeepoWtf\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"pepega\": {\r\n\t\tname: \"Pepega\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"pepegaaim\": {\r\n\t\tname: \"PepegaAim\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\"pepehands\": {\r\n\t\tname: \"PepeHands\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"pepelaugh\": {\r\n\t\tname: \"PepeLaugh\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"pepemeltdown\": {\r\n\t\tname: \"PepeMeltdown\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n\t\"pepepains\": {\r\n\t\tname: \"PepePains\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"pepog\": {\r\n\t\tname: \"PepoG\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"sadge\": {\r\n\t\tname: \"Sadge\",\r\n\t\ttype: \"png\"\r\n\t},\r\n\t\"pepepls\": {\r\n\t\tname: \"PepePls\",\r\n\t\ttype: \"gif\"\r\n\t},\r\n};\r\n\r\nexport const EmoteKeys = Object.keys(Emotes);","export default [\r\n\t\"fuck\",\r\n\t\"shit\",\r\n\t\"bitch\",\r\n]","export default [\r\n\t\"chink\",\r\n\t\"faggot\",\r\n\t\"fag\",\r\n\t\"nazi\",\r\n\t\"nigga\",\r\n\t\"nigger\",\r\n\t\"retard\",\r\n\t\"wetback\",\r\n]","import React, { useEffect, useState } from \"react\";\r\n\r\nimport { emotify } from \"./Emotes\";\r\nimport badWords from \"../json/badWords\";\r\nimport slurs from \"../json/slurs\";\r\n\r\nexport function ItemList(props) {\r\n\tconst items = props.items;\r\n\tconst itemRows = items.map(props.map);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`item-list ${props.className || \"\"}`}>\r\n\t\t\t{itemRows}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PanelGrid(props) {\r\n\tconst panels = props.panels.map((panel, i) => (\r\n\t\t<div className=\"box-panel\" key={i}>\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\t{panel.icon}\r\n\t\t\t\t<div className=\"heading-text\">\r\n\t\t\t\t\t{panel.name}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"content\">\r\n\t\t\t\t{panel.text}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\treturn (\r\n\t\t<div className=\"panel-grid\">\r\n\t\t\t{panels}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Time(props) {\r\n\tvar unit = \"millisecond\";\r\n\tvar value = props.millisec;\r\n\tvar suffix = props.suffix || \"\";\r\n\tvar minSec = props.minSec;\r\n\r\n\tconst units = [\r\n\t\t{\r\n\t\t\tname: \"second\",\r\n\t\t\tscale: 1000\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"minute\",\r\n\t\t\tscale: 60\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"hour\",\r\n\t\t\tscale: 60\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"day\",\r\n\t\t\tscale: 24\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"week\",\r\n\t\t\tscale: 7\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"year\",\r\n\t\t\tscale: 52\r\n\t\t}\r\n\t];\r\n\r\n\tlet i = 0;\r\n\twhile (i < units.length - 1 && value >= units[i].scale) {\r\n\t\tvalue /= units[i].scale;\r\n\t\tunit = units[i].name;\r\n\t\ti++;\r\n\t}\r\n\r\n\tif (minSec && unit == \"millisecond\")\r\n\t\treturn `Less than a second${suffix}`;\r\n\r\n\tvalue = Math.floor(value);\r\n\r\n\tif (value > 1)\r\n\t\tunit += \"s\";\r\n\r\n\treturn `${value} ${unit}${suffix}`;\r\n}\r\n\r\nexport function NotificationHolder(props) {\r\n\tconst notifCount = props.notifCount;\r\n\tconst onClick = props.onClick;\r\n\tconst lOffset = props.lOffset;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`notif-bound ${props.className || \"\"}`}\r\n\t\t\tonClick={onClick}\r\n\t\t\tref={props.fwdRef}>\r\n\t\t\t{notifCount > 0 &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<i className={`fas fa-circle notif-icon ${lOffset ? \"l-offset\" : \"\"}`}>\r\n\t\t\t\t\t\t<div className=\"notif-count\">\r\n\t\t\t\t\t\t\t{notifCount}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</i>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserText(props) {\r\n\tconst [content, setContent] = useState(props.text);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (props.text == null)\r\n\t\t\treturn;\r\n\r\n\t\tlet text = props.text;\r\n\r\n\t\tif (props.filterProfanity)\r\n\t\t\ttext = filterProfanity(text, props.settings, props.profChar);\r\n\r\n\t\tif (props.linkify)\r\n\t\t\ttext = linkify(text);\r\n\r\n\t\tif (props.emotify)\r\n\t\t\ttext = emotify(text);\r\n\r\n\t\tsetContent(text);\r\n\t}, [props.content]);\r\n\r\n\treturn content;\r\n}\r\n\r\nexport function linkify(text) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tconst linkRegex = /http(s{0,1}):\\/\\/([\\w.]+)\\.(\\w+)([^\\s]*)/g;\r\n\r\n\tfor (let i in text) {\r\n\t\tlet _segment = text[i];\r\n\t\tlet segment = [];\r\n\t\tlet lastIndex = 0;\r\n\t\tlet regexRes = linkRegex.exec(_segment);\r\n\r\n\t\twhile (regexRes) {\r\n\t\t\tsegment.push(_segment.slice(lastIndex, regexRes.index));\r\n\t\t\tsegment.push(<a href={regexRes[0]} target=\"blank\" key={lastIndex}>{regexRes[0]}</a>);\r\n\r\n\t\t\tlastIndex = linkRegex.lastIndex;\r\n\t\t\tregexRes = linkRegex.exec(_segment);\r\n\t\t}\r\n\r\n\t\tsegment.push(_segment.slice(lastIndex, _segment.length));\r\n\t\ttext[i] = segment;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nexport function filterProfanity(text, settings, char) {\r\n\tif (text == null)\r\n\t\treturn;\r\n\r\n\tif (!Array.isArray(text))\r\n\t\ttext = [text];\r\n\r\n\tsettings = settings || {};\r\n\r\n\tfor (let i in text) {\r\n\t\tlet segment = text[i];\r\n\r\n\t\tif (typeof segment != \"string\")\r\n\t\t\tcontinue;\r\n\r\n\t\tchar = char || \"*\";\r\n\r\n\t\tif (!settings.disablePg13Censor)\r\n\t\t\tsegment = filterProfanitySegment(badWords, segment, char);\r\n\r\n\t\tif (!settings.disableAllCensors)\r\n\t\t\tsegment = filterProfanitySegment(slurs, segment, char);\r\n\r\n\t\ttext[i] = segment;\r\n\t}\r\n\r\n\ttext = text.flat();\r\n\treturn text.length == 1 ? text[0] : text;\r\n}\r\n\r\nfunction filterProfanitySegment(profanity, segment, char) {\r\n\tfor (let word of profanity) {\r\n\t\tlet regex = new RegExp(word, \"i\");\r\n\t\tlet regexRes = regex.exec(segment);\r\n\r\n\t\twhile (regexRes) {\r\n\t\t\tlet index = regexRes.index;\r\n\t\t\tlet length = regexRes[0].length;\r\n\t\t\tlet replacement = char.repeat(length);\r\n\r\n\t\t\tsegment = segment.split(\"\");\r\n\t\t\tsegment.splice(index, length, replacement);\r\n\t\t\tsegment = segment.join(\"\");\r\n\t\t\tregexRes = regex.exec(segment);\r\n\t\t}\r\n\t}\r\n\r\n\treturn segment;\r\n}\r\n\r\nexport function useOnOutsideClick(refs, action) {\r\n\tif (!Array.isArray(refs))\r\n\t\trefs = [refs];\r\n\r\n\tfunction onOutsideClick(e) {\r\n\t\tfor (let ref of refs)\r\n\t\t\tif (!ref || !ref.current || ref.current.contains(e.target))\r\n\t\t\t\treturn;\r\n\r\n\t\taction();\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.addEventListener(\"click\", onOutsideClick);\r\n\t\tdocument.addEventListener(\"contextmenu\", onOutsideClick);\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener(\"click\", onOutsideClick);\r\n\t\t};\r\n\t}, refs);\r\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from \"react\";\r\n\r\nimport { useOnOutsideClick } from \"./Basic\";\r\n\r\nexport default function Dropdown(props) {\r\n\tconst [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef] = useDropdown();\r\n\tconst selOption = props.options.filter(option => option == props.value || option.id == props.value)[0];\r\n\tconst selLabel = selOption ? selOption.label || selOption : \"\";\r\n\r\n\tconst menuItems = props.options.map(option => {\r\n\t\tif (option == \"divider\")\r\n\t\t\treturn (<div className=\"dropdown-divider\" />);\r\n\r\n\t\tif (typeof option == \"string\")\r\n\t\t\toption = { id: option, label: option };\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"dropdown-menu-option\"\r\n\t\t\t\tkey={option.id}\r\n\t\t\t\tonClick={() => onMenuItemClick(option.id)}>\r\n\t\t\t\t{option.label} {option.placeholder}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\r\n\tfunction onMenuItemClick(optionId) {\r\n\t\tsetMenuVisible(false);\r\n\t\tprops.onChange(optionId);\r\n\t}\r\n\r\n\tfunction onControlClick() {\r\n\t\tsetMenuVisible(!menuVisible);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`dropdown ${props.className || \"\"}`}\r\n\t\t\tref={dropdownContainerRef}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"dropdown-control\"\r\n\t\t\t\tonClick={onControlClick}>\r\n\t\t\t\t{props.icon}\r\n\t\t\t\t{selLabel}\r\n\t\t\t\t{props.caret &&\r\n\t\t\t\t\t<i className=\"fas fa-caret-down\" />\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t{menuVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"dropdown-menu\"\r\n\t\t\t\t\tref={dropdownMenuRef}>\r\n\t\t\t\t\t{menuItems}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useDropdown() {\r\n\tconst [menuVisible, setMenuVisible] = useState(false);\r\n\tconst dropdownContainerRef = useRef();\r\n\tconst dropdownMenuRef = useRef();\r\n\r\n\tuseOnOutsideClick([dropdownMenuRef, dropdownContainerRef], () => setMenuVisible(false));\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!menuVisible)\r\n\t\t\treturn;\r\n\r\n\t\tconst containerRect = dropdownContainerRef.current.getBoundingClientRect();\r\n\t\tconst menuRect = dropdownMenuRef.current.getBoundingClientRect();\r\n\r\n\t\tvar menuLeft = containerRect.left;\r\n\t\tvar menuTop = containerRect.top + containerRect.height + 1 + window.scrollY;\r\n\t\tvar menuHorzShift = window.innerWidith - (menuLeft + menuRect.width);\r\n\r\n\t\tif (menuTop + menuRect.height - window.scrollY > window.innerHeight)\r\n\t\t\tmenuTop = containerRect.top - menuRect.height - 2;\r\n\r\n\t\tif (menuHorzShift < 0) {\r\n\t\t\tif (menuLeft + menuHorzShift < 0)\r\n\t\t\t\tmenuHorzShift -= (menuLeft + menuHorzShift);\r\n\t\t}\r\n\t\telse \r\n\t\t\tmenuHorzShift = 0;\r\n\r\n\t\tdropdownMenuRef.current.style.left = menuLeft + \"px\";\r\n\t\tdropdownMenuRef.current.style.top = menuTop + \"px\";\r\n\t\tdropdownMenuRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\treturn [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef];\r\n}","export function hyphenDelimit(roleName) {\r\n\troleName = roleName.slice();\r\n\r\n\tfor (let i = 0; i < roleName.length; i++) {\r\n\t\tif (roleName[i] == \" \")\r\n\t\t\troleName = roleName.replace(\" \", \"-\");\r\n\t}\r\n\r\n\treturn roleName;\r\n}\r\n\r\nexport function capitalize(string) {\r\n\treturn string.charAt(0).toUpperCase() + string.substring(1);\r\n}\r\n\r\nexport function camelCase(string) {\r\n\tlet subStrings = string.toLowerCase().split(\" \");\r\n\tlet result = \"\";\r\n\r\n\tfor (let i = 0; i < subStrings.length; i++) {\r\n\t\tif (i == 0)\r\n\t\t\tresult += subStrings[i];\r\n\t\telse\r\n\t\t\tresult += subStrings[i].charAt(0).toUpperCase() + subStrings[i].substring(1);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function pascalCase(string) {\r\n\tvar parts = string.split(\" \");\r\n\tvar res = \"\";\r\n\r\n\tfor (let i = 0; i < parts.length; i++) {\r\n\t\tlet part = parts[i];\r\n\t\tres += (part[0].toUpperCase() + part.slice(1, part.length));\r\n\t}\r\n\r\n\treturn res;\r\n}\r\n\r\nexport function replaceAll(string, from, to) {\r\n\twhile (string.indexOf(from) != -1)\r\n\t\tstring = string.replace(from, to);\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function pad(value, amt, char) {\r\n\twhile (value.length < amt)\r\n\t\tvalue = char + value;\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function dateToHTMLString(date) {\r\n\tif (!date)\r\n\t\treturn \"\";\r\n\telse if (typeof date == \"string\")\r\n\t\treturn date;\r\n\r\n\tdate = (new Date(date));\r\n\r\n\tvar day = date.toLocaleDateString();\r\n\tvar time = date.toTimeString();\r\n\t\r\n\tday = day.split(\"/\");\r\n\tday = pad(day[2], 2, \"0\") + \"-\" + pad(day[0], 2, \"0\") + \"-\" + pad(day[1], 2, \"0\");\r\n\r\n\ttime = time.split(\":\");\r\n\ttime = time[0] + \":\" + time[1];\r\n\r\n\tdate = day + \"T\" + time;\r\n\treturn date;\r\n}","import React, { useState, useEffect, useReducer } from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nimport Dropdown from \"./Dropdown\";\r\nimport { camelCase } from \"../utils\";\r\n\r\nimport \"../css/nav.css\"\r\n\r\nexport function Nav(props) {\r\n\treturn (\r\n\t\t<div className=\"nav\">\r\n\t\t\t{props.children}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SubNav(props) {\r\n\tconst links = props.links.map((link, i) => {\r\n\t\treturn (!link.hide &&\r\n\t\t\t<NavLink\r\n\t\t\t\texact={link.exact}\r\n\t\t\t\tto={link.path}\r\n\t\t\t\tkey={link.path}>\r\n\t\t\t\t{link.text}\r\n\t\t\t</NavLink>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"sub-nav\">\r\n\t\t\t{links}\r\n\t\t\t{props.showFilter &&\r\n\t\t\t\t<div className=\"filter\">\r\n\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\tvalue={props.filterSel}\r\n\t\t\t\t\t\toptions={props.filterOptions}\r\n\t\t\t\t\t\tonChange={props.onFilter}\r\n\t\t\t\t\t\ticon={props.filterIcon}\r\n\t\t\t\t\t\tcaret />\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ButtonGroup(props) {\r\n\tconst sel = camelCase(props.sel);\r\n\tconst buttons = props.buttons.map((button, i) => {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`btn ${sel == camelCase(button) ? \"btn-sel\" : \"\"}`}\r\n\t\t\t\tonClick={() => props.onClick(button)}\r\n\t\t\t\tkey={i}>\r\n\t\t\t\t{button}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"btn-group\">\r\n\t\t\t{buttons}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PageNav(props) {\r\n\tconst page = props.page;\r\n\tconst maxPage = props.maxPage;\r\n\tconst range = props.range || 5;\r\n\tconst onNav = props.onNav;\r\n\tconst inverted = props.inverted;\r\n\tconst noRange = maxPage == null;\r\n\r\n\tconst [pages, updatePages] = useReducer(\r\n\t\t() => {\r\n\t\t\tif (noRange)\r\n\t\t\t\treturn [page];\r\n\r\n\t\t\tvar sel = page <= maxPage ? page : 1;\r\n\t\t\tvar i = sel;\r\n\t\t\tvar j = sel + 1;\r\n\t\t\tvar list = [];\r\n\t\t\tvar changed = true;\r\n\r\n\t\t\twhile (changed) {\r\n\t\t\t\tchanged = false;\r\n\r\n\t\t\t\tif (list.length < range && i >= 1) {\r\n\t\t\t\t\tlist.unshift(i--);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (list.length < range && j <= maxPage) {\r\n\t\t\t\t\tlist.push(j++);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\tmaxPage,\r\n\t\t(pages) => {\r\n\t\t\tif (noRange)\r\n\t\t\t\treturn [1];\r\n\r\n\t\t\tvar list = [];\r\n\r\n\t\t\tfor (let i = 0; i < pages; i++)\r\n\t\t\t\tlist.push(i + 1);\r\n\r\n\t\t\treturn list;\r\n\t\t}\r\n\t);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdatePages();\r\n\t}, [page, range, maxPage]);\r\n\r\n\tfunction onClick(page) {\r\n\t\tif (page >= 1 && (noRange || page <= maxPage))\r\n\t\t\tonNav(page);\r\n\t}\r\n\r\n\tconst pageNums = pages.map(page => {\r\n\t\tvar className = \"page-num\";\r\n\r\n\t\tif (props.page == page)\r\n\t\t\tclassName += \" page-sel\";\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={className}\r\n\t\t\t\tonClick={() => onClick(page)}\r\n\t\t\t\tkey={page}>\r\n\t\t\t\t{page}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className={`page-nav ${inverted ? \"inverted\" : \"\"}`}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"page-nav-left max\"\r\n\t\t\t\tonClick={() => onClick(1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"page-nav-left\"\r\n\t\t\t\tonClick={() => onClick(page - 1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t{pageNums}\r\n\t\t\t<div\r\n\t\t\t\tclassName={`page-nav-right ${noRange ? \"max\" : \"\"}`}\r\n\t\t\t\tonClick={() => onClick(page + 1)}>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t{!noRange &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"page-nav-right max\"\r\n\t\t\t\t\tonClick={() => onClick(maxPage)}>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SearchBar(props) {\r\n\tfunction onInput(event) {\r\n\t\tprops.onInput(event.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"search-bar\">\r\n\t\t\t<input\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\tvalue={props.value}\r\n\t\t\t\tplaceholder={props.placeholder}\r\n\t\t\t\tonChange={onInput} />\r\n\t\t\t<div className=\"search-icon\">\r\n\t\t\t\t<i className=\"fas fa-search\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport ReactLoading from \"react-loading\";\r\n\r\nexport default function LoadingPage(props) {\r\n\treturn (\r\n\t\t<div className={`loading-page ${props.className || \"\"}`}>\r\n\t\t\t<ReactLoading type=\"bars\" color=\"#ffffff\" />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function LoadingIcon() {\r\n\treturn (\r\n\t\t<div className=\"loading-page\">\r\n\t\t\t<ReactLoading type=\"bars\" color=\"#ffffff\" width=\"50\" height=\"50\" />\r\n\t\t</div>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, LastWillEntry, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function MafiaGame() {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Mafia\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Day\", \"Night\", \"Sunset\"];\r\n\tconst audioFileNames = [/*\"Day\", \"Night\", \"Sunset\", \"nonvillagewin\", \"villagewin\", */\"gunshot\"];\r\n\tconst audioLoops = [/*true, true, true, false, false, */false];\r\n\tconst audioOverrides = [/*true, true, true, false, false, */false];\r\n\tconst audioVolumes = [/*1, 1, 1, 1, 1, */1];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Village\") != -1)\r\n\t\t\t// \tgame.playAudio(\"villagewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"nonvillagewin\");\r\n\t\t});\r\n\r\n\t\tsocket.on(\"gunshot\", () => {\r\n\t\t\tgame.playAudio(\"gunshot\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>M</span>afia\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\treview={game.review}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tsetTyping={game.setTyping}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!game.review && !isSpectator && history.currentState >= 0 && game.setup.lastWill &&\r\n\t\t\t\t\t\t\t<LastWillEntry\r\n\t\t\t\t\t\t\t\tlastWill={game.lastWill}\r\n\t\t\t\t\t\t\t\tsocket={game.socket} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{!game.review && !isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function SplitDecisionGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Split Decision\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Round\", \"Hostage Swap\"];\r\n\tconst audioFileNames = [];\r\n\tconst audioLoops = [];\r\n\tconst audioOverrides = [];\r\n\tconst audioVolumes = [];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Blue\") != -1)\r\n\t\t\t// \tgame.playAudio(\"bluewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"redwin\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>Split</span> Decision\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function ResistanceGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"Resistance\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Team Selection\", \"Team Approval\", \"Mission\"];\r\n\tconst audioFileNames = [];\r\n\tconst audioLoops = [];\r\n\tconst audioOverrides = [];\r\n\tconst audioVolumes = [];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Resistance\") != -1)\r\n\t\t\t// \tgame.playAudio(\"resistancewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"spieswin\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>R</span>esistance\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useRef, useEffect, useContext } from \"react\";\r\n\r\nimport { useSocketListeners, useStateViewingReducer, ThreePanelLayout, TopBar, TextMeetingLayout, ActionList, PlayerList, LastWillEntry, Timer, SpeechFilter, Notes } from \"./Game\";\r\nimport { GameContext } from \"../../Contexts\";\r\n\r\nexport default function OneNightGame(props) {\r\n\tconst game = useContext(GameContext);\r\n\r\n\tconst history = game.history;\r\n\tconst updateHistory = game.updateHistory;\r\n\tconst updatePlayers = game.updatePlayers;\r\n\tconst stateViewing = game.stateViewing;\r\n\tconst updateStateViewing = game.updateStateViewing;\r\n\tconst self = game.self;\r\n\tconst players = game.players;\r\n\tconst isSpectator = game.isSpectator;\r\n\r\n\tconst playBellRef = useRef(false);\r\n\r\n\tconst gameType = \"One Night\";\r\n\tconst meetings = history.states[stateViewing] ? history.states[stateViewing].meetings : {};\r\n\tconst stateEvents = history.states[stateViewing] ? history.states[stateViewing].stateEvents : [];\r\n\tconst stateNames = [\"Day\", \"Night\"];\r\n\tconst audioFileNames = [/*\"Day\", \"Night\", \"nonvillagewin\", \"villagewin\", */\"gunshot\"];\r\n\tconst audioLoops = [/*true, true, true, false, false, */false];\r\n\tconst audioOverrides = [/*true, true, true, false, false, */false];\r\n\tconst audioVolumes = [/*1, 1, 1, 1, 1, */1];\r\n\r\n\t// Make player view current state when it changes\r\n\tuseEffect(() => {\r\n\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgame.loadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\r\n\t\t// Make game review start at pregame\r\n\t\tif (game.review)\r\n\t\t\tupdateStateViewing({ type: \"first\" });\r\n\t}, []);\r\n\r\n\tuseSocketListeners(socket => {\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tif (playBellRef.current)\r\n\t\t\t\tgame.playAudio(\"bell\");\r\n\r\n\t\t\tplayBellRef.current = true;\r\n\r\n\r\n\t\t\t// for (let stateName of stateNames)\r\n\t\t\t// \tif (state.name.indexOf(stateName) == 0)\r\n\t\t\t// \t\tgame.playAudio(stateName);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"winners\", winners => {\r\n\t\t\t// game.stopAudios(stateNames);\r\n\r\n\t\t\t// if (winners.groups.indexOf(\"Village\") != -1)\r\n\t\t\t// \tgame.playAudio(\"villagewin\");\r\n\t\t\t// else\r\n\t\t\t// \tgame.playAudio(\"nonvillagewin\");\r\n\t\t});\r\n\r\n\t\tsocket.on(\"gunshot\", () => {\r\n\t\t\tgame.playAudio(\"gunshot\");\r\n\t\t});\r\n\t}, game.socket);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TopBar\r\n\t\t\t\tgameType={gameType}\r\n\t\t\t\tsetup={game.setup}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\tupdateStateViewing={updateStateViewing}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tsocket={game.socket}\r\n\t\t\t\toptions={game.options}\r\n\t\t\t\tspectatorCount={game.spectatorCount}\r\n\t\t\t\tsetLeave={game.setLeave}\r\n\t\t\t\tfinished={game.finished}\r\n\t\t\t\treview={game.review}\r\n\t\t\t\tsetShowSettingsModal={game.setShowSettingsModal}\r\n\t\t\t\tsetRehostId={game.setRehostId}\r\n\t\t\t\tdev={game.dev}\r\n\t\t\t\tgameName={\r\n\t\t\t\t\t<div className=\"game-name\">\r\n\t\t\t\t\t\t<span>One</span> Night\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\ttimer={\r\n\t\t\t\t\t<Timer\r\n\t\t\t\t\t\ttimers={game.timers}\r\n\t\t\t\t\t\thistory={history} />\r\n\t\t\t\t} />\r\n\t\t\t<ThreePanelLayout\r\n\t\t\t\tleftPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PlayerList\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tactivity={game.activity} />\r\n\t\t\t\t\t\t<SpeechFilter\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\tsetFilters={game.setSpeechFilters}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tcenterPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<TextMeetingLayout\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tupdateHistory={updateHistory}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing}\r\n\t\t\t\t\t\t\tsettings={game.settings}\r\n\t\t\t\t\t\t\tfilters={game.speechFilters}\r\n\t\t\t\t\t\t\toptions={game.options}\r\n\t\t\t\t\t\t\tagoraClient={game.agoraClient}\r\n\t\t\t\t\t\t\tlocalAudioTrack={game.localAudioTrack}\r\n\t\t\t\t\t\t\tsetActiveVoiceChannel={game.setActiveVoiceChannel}\r\n\t\t\t\t\t\t\tmuted={game.muted}\r\n\t\t\t\t\t\t\tsetMuted={game.setMuted}\r\n\t\t\t\t\t\t\tdeafened={game.deafened}\r\n\t\t\t\t\t\t\tsetDeafened={game.setDeafened} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\trightPanelContent={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ActionList\r\n\t\t\t\t\t\t\tsocket={game.socket}\r\n\t\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\t\tself={self}\r\n\t\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t{!isSpectator &&\r\n\t\t\t\t\t\t\t<Notes\r\n\t\t\t\t\t\t\t\tstateViewing={stateViewing} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t</>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport \"../css/landing.css\"\r\n\r\nexport default function LandingPage(props) {\r\n\treturn (\r\n\t\t<div className=\"span-panel main landing-page\">\r\n\t\t\t<div className=\"banner\">\r\n\t\t\t\t<div className=\"logo\" />\r\n\t\t\t\t<div className=\"characters-circle\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"play-break\">\r\n\t\t\t\t<div className=\"play-btn-wrapper\">\r\n\t\t\t\t\t<Link to=\"/auth/signup\">\r\n\t\t\t\t\t\tPlay Mafia\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"intro\">\r\n\t\t\t\tBeyondMafia is the mafia site that is revolutionary in design, safety, and has a thriving community of users from all walks of life. With competitive and casual live mafia, and other gamemodes like Resistance, you're sure to find something that suits how YOU want to play.\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mafia-features\">\r\n\t\t\t\t<div className=\"chat-mafia\">\r\n\t\t\t\t\t<div className=\"village-character\" />\r\n\t\t\t\t\t<div className=\"feature-title\">Chat Mafia</div>\r\n\t\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\t\t10-20 minute games with a variety of roles! Play wiht classic roles, or try out something different in the Sandbox lobby. You can create your own custom roles, too, using modifiers or by contributing to the open source codebase!\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-mafia\">\r\n\t\t\t\t\t<div className=\"cop-character\" />\r\n\t\t\t\t\t<div className=\"feature-title\">Forum Mafia</div>\r\n\t\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\t\tPlay Mafia in the forums. More features are coming soon with the planned forum game engine!\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"other-games\">\r\n\t\t\t\t<div className=\"other-games-img\" />\r\n\t\t\t\t<div className=\"feature-title\">Other Games</div>\r\n\t\t\t\t<div className=\"feature-desc\">\r\n\t\t\t\t\tExplore other Mafia-esque games like Resistance, One Night Ultimate Werewolf, and 2 Rooms and a Boom.\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"play-break\">\r\n\t\t\t\t<div className=\"play-btn-wrapper\">\r\n\t\t\t\t\t<Link to=\"/auth/signup\">\r\n\t\t\t\t\t\tPlay Mafia\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useReducer, useRef, useEffect } from \"react\";\r\nimport { ChromePicker } from \"react-color\";\r\nimport ReactMde from \"react-mde\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport axios from \"axios\";\r\n\r\nimport { useOnOutsideClick } from \"./Basic\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\n\r\nimport \"react-mde/lib/styles/css/react-mde.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-editor.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-toolbar.css\";\r\nimport \"react-mde/lib/styles/css/react-mde-suggestions.css\";\r\n\r\nimport \"../css/form.css\";\r\nimport \"../css/markdown.css\";\r\nimport { dateToHTMLString } from \"../utils\";\r\n\r\nexport default function Form(props) {\r\n\tfunction onChange(event, field, localOnly) {\r\n\t\tvar value = event.target.value;\r\n\r\n\t\tif (field.min != null && Number(value) < field.min)\r\n\t\t\tvalue = field.min;\r\n\t\telse if (field.max != null && Number(value) > field.max)\r\n\t\t\tvalue = field.max;\r\n\r\n\t\tprops.onChange({\r\n\t\t\tref: field.ref,\r\n\t\t\tprop: \"value\",\r\n\t\t\tvalue: value,\r\n\t\t\tlocalOnly\r\n\t\t});\r\n\t}\r\n\r\n\tconst formFields = props.fields.map((field, i) => {\r\n\t\tconst disabled = typeof field.disabled == \"function\" ? field.disabled(props.deps) : field.disabled;\r\n\t\tconst fieldWrapperClass = `field-wrapper ${disabled ? \"disabled\" : \"\"}`;\r\n\t\tvar showIf;\r\n\r\n\t\tif (typeof field.showIf == \"string\")\r\n\t\t\tshowIf = [field.showIf];\r\n\t\telse\r\n\t\t\tshowIf = field.showIf;\r\n\r\n\t\tif (Array.isArray(showIf)) {\r\n\t\t\tfor (let ref of showIf) {\r\n\t\t\t\tlet inverted = ref[0] == \"!\";\r\n\r\n\t\t\t\tif (inverted)\r\n\t\t\t\t\tref = ref.slice(1);\r\n\r\n\t\t\t\tfor (let field of props.fields) {\r\n\t\t\t\t\tif (field.ref == ref && field.type == \"boolean\") {\r\n\t\t\t\t\t\tlet value = field.value == true;\r\n\r\n\t\t\t\t\t\tif ((value ^ inverted) == 0)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (typeof showIf == \"function\")\r\n\t\t\tif (!showIf(props.deps))\r\n\t\t\t\treturn;\r\n\r\n\t\tconst value = typeof field.value == \"function\" ? field.value(props.deps) : field.value;\r\n\r\n\t\tswitch (field.type) {\r\n\t\t\tcase \"text\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype={field.type}\r\n\t\t\t\t\t\t\tvalue={value || \"\"}\r\n\t\t\t\t\t\t\tplaceholder={field.placeholder}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={(e) => !field.fixed && onChange(e, field, field.saveBtn)}\r\n\t\t\t\t\t\t\tonClick={(e) => field.highlight && e.target.select()} />\r\n\t\t\t\t\t\t{field.saveBtn && props.deps[field.saveBtnDiffer] != field.value &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\tlet conf = !field.confirm || window.confirm(field.confirm);\r\n\r\n\t\t\t\t\t\t\t\t\tif (conf) {\r\n\t\t\t\t\t\t\t\t\t\tif (field.saveBtnOnClick)\r\n\t\t\t\t\t\t\t\t\t\t\tfield.saveBtnOnClick(field.value, props.deps);\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tonChange(e, field);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t{field.saveBtn}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"number\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\tvalue={field.value || \"0\"}\r\n\t\t\t\t\t\t\tmin={field.min}\r\n\t\t\t\t\t\t\tmax={field.max}\r\n\t\t\t\t\t\t\tstep={field.step}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={(e) => onChange(e, field)} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"boolean\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"switch-wrapper\">\r\n\t\t\t\t\t\t\t<Switch\r\n\t\t\t\t\t\t\t\tvalue={field.value || false}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"select\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tvalue={field.value || field.options[0].ref}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={e => onChange(e, field)}>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfield.options.map(option => (\r\n\t\t\t\t\t\t\t\t\t<option value={option.value} key={option.value}>\r\n\t\t\t\t\t\t\t\t\t\t{option.label}\r\n\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"range\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"range-wrapper\">\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\t\t\tmin={field.min}\r\n\t\t\t\t\t\t\t\tmax={field.max}\r\n\t\t\t\t\t\t\t\tstep={field.step}\r\n\t\t\t\t\t\t\t\tvalue={field.value}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"color\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<ColorPicker\r\n\t\t\t\t\t\t\tvalue={field.value}\r\n\t\t\t\t\t\t\tdefault={field.default}\r\n\t\t\t\t\t\t\talpha={field.alpha}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t{!field.noReset && field.value != field.default && field.value &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme extra\"\r\n\t\t\t\t\t\t\t\tonClick={() => onChange({ target: { value: field.default } }, field)}>\r\n\t\t\t\t\t\t\t\tReset\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\tcase \"datetime-local\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className={fieldWrapperClass} key={field.ref}>\r\n\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t{field.label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"datetime-wrapper\">\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\r\n\t\t\t\t\t\t\t\tmin={dateToHTMLString(field.min)}\r\n\t\t\t\t\t\t\t\tmax={dateToHTMLString(field.max)}\r\n\t\t\t\t\t\t\t\tvalue={dateToHTMLString(field.value)}\r\n\t\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\t\tonChange={e => onChange(e, field)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"form\">\r\n\t\t\t{formFields}\r\n\t\t\t{props.submitText &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\tonClick={props.onSubmit}>\r\n\t\t\t\t\t{props.submitText}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Switch(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`switch ${props.value ? \"on\" : \"\"}`}\r\n\t\t\tonClick={() => !props.disabled && props.onChange({ target: { value: !props.value } })}>\r\n\t\t\t<div className=\"track\" />\r\n\t\t\t<div className=\"thumb\" />\r\n\t\t\t<input\r\n\t\t\t\ttype=\"hidden\"\r\n\t\t\t\tvalue={props.value} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ColorPicker(props) {\r\n\tconst [picking, setPicking] = useState(false);\r\n\tconst pickerRef = useRef();\r\n\tconst value = props.value || props.default;\r\n\tconst disabled = props.disabled;\r\n\r\n\tfunction onClick(e) {\r\n\t\tif (!disabled && e.target == pickerRef.current)\r\n\t\t\tsetPicking(!picking);\r\n\t}\r\n\r\n\tfunction onChangeComplete(color, event) {\r\n\t\tprops.onChange({ target: { value: color.hex } });\r\n\t}\r\n\r\n\tuseOnOutsideClick(pickerRef, () => setPicking(false));\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`color-picker ${disabled ? \"disabled\" : \"\"}`}\r\n\t\t\tstyle={{ backgroundColor: value }}\r\n\t\t\tonClick={onClick}\r\n\t\t\tref={pickerRef}>\r\n\t\t\t{picking &&\r\n\t\t\t\t<ChromePicker\r\n\t\t\t\t\tcolor={value}\r\n\t\t\t\t\tdisableAlpha={!props.alpha}\r\n\t\t\t\t\tonChangeComplete={onChangeComplete} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function HiddenUpload(props) {\r\n\tconst inputRef = useRef();\r\n\r\n\tfunction onClick() {\r\n\t\tvar shouldInput = true;\r\n\r\n\t\tif (props.onClick)\r\n\t\t\tshouldInput = props.onClick();\r\n\r\n\t\tif (shouldInput)\r\n\t\t\tshowFileUploadDialog();\r\n\t}\r\n\r\n\tfunction showFileUploadDialog() {\r\n\t\tinputRef.current.click();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={props.className}\r\n\t\t\tonClick={onClick}>\r\n\t\t\t{props.children}\r\n\t\t\t<input\r\n\t\t\t\tclassName=\"hidden-upload\"\r\n\t\t\t\tref={inputRef}\r\n\t\t\t\ttype=\"file\"\r\n\t\t\t\tonChange={e => props.onFileUpload(e.target.files, props.name)} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function useForm(initialFormFields) {\r\n\tconst [initFields] = useState(initialFormFields);\r\n\tconst [fields, updateFields] = useReducer((formFields, actions) => {\r\n\t\tconst newFormFields = [...formFields];\r\n\r\n\t\tif (!Array.isArray(actions))\r\n\t\t\tactions = [actions];\r\n\r\n\t\tfor (let i in newFormFields) {\r\n\t\t\tlet field = newFormFields[i];\r\n\t\t\tlet newField = { ...field };\r\n\r\n\t\t\tfor (let action of actions) {\r\n\t\t\t\tif (field.ref && field.ref == action.ref) {\r\n\t\t\t\t\tif (typeof action.value == \"string\" && field.type == \"boolean\")\r\n\t\t\t\t\t\taction.value = action.value == \"true\";\r\n\r\n\t\t\t\t\tnewField[action.prop] = action.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tnewFormFields[i] = newField;\r\n\t\t}\r\n\r\n\t\treturn newFormFields;\r\n\t}, initialFormFields);\r\n\r\n\tfunction resetFields() {\r\n\t\tvar updates = [];\r\n\r\n\t\tfor (let field of initFields) {\r\n\t\t\tupdates.push({\r\n\t\t\t\tref: field.ref,\r\n\t\t\t\tprop: \"value\",\r\n\t\t\t\tvalue: field.value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tupdateFields(updates);\r\n\t}\r\n\r\n\treturn [fields, updateFields, resetFields];\r\n}\r\n\r\nexport function SearchSelect(props) {\r\n\tconst value = props.value;\r\n\tconst setValue = props.setValue;\r\n\r\n\tconst [inputValue, setInputValue] = useState(\"\");\r\n\tconst [optionsVisible, setOptionsVisible] = useState(false);\r\n\tconst [hoveringOptions, setHoveringOptions] = useState(false);\r\n\tconst [matchingOptions, setMatchingOptions] = useState(props.options);\r\n\tconst searchSelectRef = useRef();\r\n\tconst optionsRef = useRef();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!optionsVisible)\r\n\t\t\treturn;\r\n\r\n\t\tconst searchSelectRect = searchSelectRef.current.getBoundingClientRect();\r\n\t\tconst optionsRect = optionsRef.current.getBoundingClientRect();\r\n\r\n\t\tvar optionsTop = searchSelectRect.top + searchSelectRect.height + 1;\r\n\r\n\t\tif (optionsTop + optionsRect.height > window.innerHeight)\r\n\t\t\toptionsTop = searchSelectRect.top - optionsRect.height - 2;\r\n\r\n\t\toptionsRef.current.style.top = optionsTop + \"px\";\r\n\t\toptionsRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (inputValue == \"\")\r\n\t\t\tsetMatchingOptions(props.options);\r\n\t\telse {\r\n\t\t\tvar options = props.options.filter(option => (\r\n\t\t\t\toption.toLowerCase().includes(inputValue.toLowerCase())\r\n\t\t\t));\r\n\r\n\t\t\tsetMatchingOptions(options);\r\n\t\t}\r\n\t}, [inputValue, props.options]);\r\n\r\n\tconst options = matchingOptions.map(option => (\r\n\t\t<div\r\n\t\t\tclassName=\"option-row\"\r\n\t\t\tonClick={() => onOptionClick(option)}\r\n\t\t\tkey={option}>\r\n\t\t\t{option}\r\n\t\t</div>\r\n\t));\r\n\r\n\tfunction onOptionClick(option) {\r\n\t\tsetValue(option);\r\n\t\tsetInputValue(\"\");\r\n\t\tsetOptionsVisible(false);\r\n\t\tsetHoveringOptions(false);\r\n\r\n\t\tif (props.onChange)\r\n\t\t\tprops.onChange(option);\r\n\t}\r\n\r\n\tfunction onKeyDown(e) {\r\n\t\tif (e.key == \"Enter\") {\r\n\t\t\tsetValue(matchingOptions[0]);\r\n\t\t\tsetInputValue(\"\");\r\n\t\t\tsetOptionsVisible(false);\r\n\t\t\tsetHoveringOptions(false);\r\n\r\n\t\t\tif (props.onChange)\r\n\t\t\t\tprops.onChange(matchingOptions[0]);\r\n\t\t}\r\n\t\telse if (!optionsVisible)\r\n\t\t\tsetOptionsVisible(true);\r\n\t}\r\n\r\n\tfunction onMouseEnterOptionsList() {\r\n\t\tsetHoveringOptions(true);\r\n\t}\r\n\r\n\tfunction onMouseLeaveOptionsList() {\r\n\t\tsetHoveringOptions(false);\r\n\t}\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tsetInputValue(e.target.value);\r\n\r\n\t\tif (props.onInputChange)\r\n\t\t\tprops.onInputChange(e);\r\n\t}\r\n\r\n\tfunction onSelectFocus() {\r\n\t\tsetOptionsVisible(true);\r\n\t}\r\n\r\n\tfunction onSelectBlur() {\r\n\t\tif (hoveringOptions)\r\n\t\t\treturn;\r\n\r\n\t\tsetOptionsVisible(false);\r\n\t\tsetInputValue(\"\");\r\n\t\tsetMatchingOptions(props.options);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"search-select\"\r\n\t\t\ttabIndex=\"0\"\r\n\t\t\tonFocus={onSelectFocus}\r\n\t\t\tonBlur={onSelectBlur}\r\n\t\t\tref={searchSelectRef}>\r\n\t\t\t<input\r\n\t\t\t\tvalue={inputValue}\r\n\t\t\t\tplaceholder={value || props.placeholder}\r\n\t\t\t\tonChange={onInputChange}\r\n\t\t\t\tonKeyDown={onKeyDown} />\r\n\t\t\t<div className=\"icon-wrapper\">\r\n\t\t\t\t<i className=\"fas fa-chevron-down\" />\r\n\t\t\t</div>\r\n\t\t\t{optionsVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"option-list\"\r\n\t\t\t\t\tonMouseEnter={onMouseEnterOptionsList}\r\n\t\t\t\t\tonMouseLeave={onMouseLeaveOptionsList}\r\n\t\t\t\t\tref={optionsRef}>\r\n\t\t\t\t\t{options.length > 0 &&\r\n\t\t\t\t\t\toptions\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{!options.length &&\r\n\t\t\t\t\t\t<div className=\"no-options\">\r\n\t\t\t\t\t\t\tNo Options\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserSearchSelect(props) {\r\n\tconst [options, setOptions] = useState([]);\r\n\tconst [idMap, setIdMap] = useState({});\r\n\tconst [query, setQuery] = useState(\"\");\r\n\tconst [valueName, setValueName] = useState(\"\");\r\n\r\n\tuseEffect(() => {\r\n\t\tif (query.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/searchName?query=${query}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar newIdMap = {};\r\n\r\n\t\t\t\tfor (let userData of res.data)\r\n\t\t\t\t\tnewIdMap[userData.name] = userData.id;\r\n\r\n\t\t\t\tsetIdMap(newIdMap);\r\n\t\t\t\tsetOptions(res.data.map(user => user.name));\r\n\t\t\t})\r\n\t\t\t.catch(useErrorAlert);\r\n\t}, [query]);\r\n\r\n\tfunction setValue(option) {\r\n\t\tsetValueName(option);\r\n\t\tprops.setValue(idMap[option]);\r\n\t}\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tsetQuery(e.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<SearchSelect\r\n\t\t\t{...props}\r\n\t\t\toptions={options}\r\n\t\t\tvalue={valueName}\r\n\t\t\tsetValue={setValue}\r\n\t\t\tonInputChange={onInputChange} />\r\n\t);\r\n}\r\n\r\nexport function TextEditor(props) {\r\n\tconst [tab, setTab] = useState(\"write\");\r\n\r\n\treturn (\r\n\t\t<ReactMde\r\n\t\t\tvalue={props.value}\r\n\t\t\tonChange={props.onChange}\r\n\t\t\tselectedTab={tab}\r\n\t\t\tonTabChange={setTab}\r\n\t\t\tclasses={{ \"preview\": \"md-content\" }}\r\n\t\t\tgenerateMarkdownPreview={\r\n\t\t\t\t(markdown) => Promise.resolve(<ReactMarkdown source={markdown} />)\r\n\t\t\t} />\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useParams, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { Avatar, NameWithAvatar } from \"./User\";\r\nimport { HiddenUpload, TextEditor } from \"../../components/Form\";\r\nimport LoadingPage from \"../Loading\";\r\nimport Setup from \"../../components/Setup\";\r\nimport { GameRow } from \"../Play/Join\";\r\nimport { Time, filterProfanity } from \"../../components/Basic\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { PageNav } from \"../../components/Nav\";\r\nimport { RatingThresholds, RequiredTotalForStats } from \"../../Constants\";\r\nimport { capitalize } from \"../../utils\";\r\nimport Comments from \"../Community/Comments\";\r\n\r\nimport \"../../css/user.css\";\r\n\r\nexport default function Profile() {\r\n\tconst [profileLoaded, setProfileLoaded] = useState(false);\r\n\tconst [name, setName] = useState();\r\n\tconst [avatar, setAvatar] = useState();\r\n\tconst [banner, setBanner] = useState();\r\n\tconst [bio, setBio] = useState(\"\");\r\n\tconst [oldBio, setOldBio] = useState();\r\n\tconst [editingBio, setEditingBio] = useState(false);\r\n\tconst [isFriend, setIsFriend] = useState(false);\r\n\tconst [settings, setSettings] = useState({});\r\n\tconst [accounts, setAccounts] = useState({});\r\n\tconst [recentGames, setRecentGames] = useState([]);\r\n\tconst [createdSetups, setCreatedSetups] = useState([]);\r\n\tconst [bustCache, setBustCache] = useState(false);\r\n\tconst [friendsPage, setFriendsPage] = useState(1);\r\n\tconst [maxFriendsPage, setMaxFriendsPage] = useState(1);\r\n\tconst [friends, setFriends] = useState([]);\r\n\tconst [friendRequests, setFriendRequests] = useState([]);\r\n\tconst [stats, setStats] = useState({ Mafia: {} });\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst history = useHistory();\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst { userId } = useParams();\r\n\r\n\tconst isSelf = userId == user.id;\r\n\tconst isBlocked = !isSelf && user.blockedUsers.indexOf(userId) != -1;\r\n\r\n\tuseEffect(() => {\r\n\t\tif (bustCache)\r\n\t\t\tsetBustCache(false);\r\n\t}, [bustCache]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (userId) {\r\n\t\t\tsetProfileLoaded(false);\r\n\r\n\t\t\taxios.get(`/user/${userId}/profile`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetProfileLoaded(true);\r\n\t\t\t\t\tsetName(res.data.name);\r\n\t\t\t\t\tsetAvatar(res.data.avatar);\r\n\t\t\t\t\tsetBanner(res.data.banner);\r\n\t\t\t\t\tsetBio(filterProfanity(res.data.bio, user.settings, \"\\\\*\") || \"\");\r\n\t\t\t\t\tsetIsFriend(res.data.isFriend);\r\n\t\t\t\t\tsetSettings(res.data.settings);\r\n\t\t\t\t\tsetAccounts(res.data.accounts || {});\r\n\t\t\t\t\tsetRecentGames(res.data.games);\r\n\t\t\t\t\tsetCreatedSetups(res.data.setups);\r\n\t\t\t\t\tsetMaxFriendsPage(res.data.maxFriendsPage);\r\n\t\t\t\t\tsetFriendRequests(res.data.friendRequests);\r\n\t\t\t\t\tsetStats(res.data.stats);\r\n\r\n\t\t\t\t\tdocument.title = `${res.data.name}'s Profile | BeyondMafia`;\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t\thistory.push(\"/play\");\r\n\t\t\t\t});\r\n\r\n\t\t\taxios.get(`/user/${userId}/friends`)\r\n\t\t\t\t.then((res) => {\r\n\t\t\t\t\tsetFriends(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\t}, [userId]);\r\n\r\n\tfunction onEditBanner(files, type) {\r\n\t\tif (!user.itemsOwned.customProfile) {\r\n\t\t\terrorAlert(\"You must purchase profile customization with coins from the Shop.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction onFileUpload(files, type) {\r\n\t\tif (files.length) {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append(\"image\", files[0]);\r\n\r\n\t\t\tfor (let el of document.getElementsByClassName(\"hidden-upload\"))\r\n\t\t\t\tel.value = \"\";\r\n\r\n\t\t\taxios.post(`/user/${type}`, formData)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\tcase \"avatar\":\r\n\t\t\t\t\t\t\tsetAvatar(true);\r\n\t\t\t\t\t\t\tsiteInfo.clearCache();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"banner\":\r\n\t\t\t\t\t\t\tsetBanner(true);\r\n\t\t\t\t\t\t\tsiteInfo.clearCache();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onFriendUserClick() {\r\n\t\tif (isFriend) {\r\n\t\t\tvar shouldUnfriend = window.confirm(\"Are you sure you wish to unfriend or cancel your friend request?\");\r\n\t\t\tif (!shouldUnfriend)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\taxios.post(\"/user/friend\", { user: userId })\r\n\t\t\t.then((res) => {\r\n\t\t\t\tsetIsFriend(!isFriend);\r\n\t\t\t\tsiteInfo.showAlert(res.data, \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onBlockUserClick() {\r\n\t\tif (!isBlocked) {\r\n\t\t\tvar shouldBlock = window.confirm(\"Are you sure you wish to block this user?\");\r\n\t\t\tif (!shouldBlock)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\taxios.post(\"/user/block\", { user: userId })\r\n\t\t\t.then(() => {\r\n\t\t\t\tuser.blockUserToggle(userId);\r\n\r\n\t\t\t\tif (isBlocked)\r\n\t\t\t\t\tsiteInfo.showAlert(\"User unblocked.\", \"success\");\r\n\t\t\t\telse\r\n\t\t\t\t\tsiteInfo.showAlert(\"User blocked.\", \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onBioClick() {\r\n\t\tsetEditingBio(isSelf);\r\n\t\tsetOldBio(bio);\r\n\t}\r\n\r\n\tfunction onEditBio(e) {\r\n\t\taxios.post(`/user/bio`, { bio: bio })\r\n\t\t\t.then(() => {\r\n\t\t\t\tsetEditingBio(false);\r\n\t\t\t\tsetBio(filterProfanity(bio, user.settings, \"\\\\*\"));\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onCancelEditBio(e) {\r\n\t\te.stopPropagation();\r\n\t\tsetEditingBio(false);\r\n\t\tsetBio(oldBio);\r\n\t}\r\n\r\n\tfunction onAcceptFriend(_userId) {\r\n\t\taxios.post(\"/user/friend\", { user: _userId })\r\n\t\t\t.then((res) => {\r\n\t\t\t\tvar newFriendRequests = friendRequests.slice().filter(u => u.id != _userId);\r\n\t\t\t\tsetFriendRequests(newFriendRequests);\r\n\t\t\t\tsiteInfo.showAlert(res.data, \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRejectFriend(_userId) {\r\n\t\taxios.post(\"/user/friend/reject\", { user: _userId })\r\n\t\t\t.then((res) => {\r\n\t\t\t\tvar newFriendRequests = friendRequests.slice().filter(u => u.id != _userId);\r\n\t\t\t\tsetFriendRequests(newFriendRequests);\r\n\t\t\t\tsiteInfo.showAlert(res.data, \"success\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onFriendsPageNav(page) {\r\n\t\tvar filterArg;\r\n\r\n\t\tif (page == 1)\r\n\t\t\tfilterArg = \"last=Infinity\";\r\n\t\telse if (page == maxFriendsPage)\r\n\t\t\tfilterArg = \"first=-1\";\r\n\t\tif (page < friendsPage)\r\n\t\t\tfilterArg = `first=${friends[0].lastActive}`;\r\n\t\telse if (page > friendsPage)\r\n\t\t\tfilterArg = `last=${friends[friends.length - 1].lastActive}`;\r\n\t\telse\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/user/${userId}/friends?${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetFriends(res.data);\r\n\t\t\t\tsetFriendsPage(page);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst mainPanelStyle = {};\r\n\tconst bannerStyle = {};\r\n\r\n\tif (settings.backgroundColor)\r\n\t\tmainPanelStyle.backgroundColor = settings.backgroundColor;\r\n\r\n\tif (banner)\r\n\t\tbannerStyle.backgroundImage = `url(/uploads/${userId}_banner.jpg?t=${siteInfo.cacheVal})`;\r\n\r\n\tif (settings.bannerFormat == \"stretch\")\r\n\t\tbannerStyle.backgroundSize = \"100% 100%\";\r\n\r\n\tvar ratings;\r\n\r\n\tratings = Object.keys(stats[\"Mafia\"]).map(statName => {\r\n\t\tvar stat = stats[\"Mafia\"][statName];\r\n\r\n\t\tif (stat.total < RequiredTotalForStats)\r\n\t\t\tstat = \"-\";\r\n\t\telse if (statName == \"wins\")\r\n\t\t\tstat = `${Math.round((stat.count / stat.total) * 100)}%`;\r\n\t\telse {\r\n\t\t\tvar letter = \"F\";\r\n\t\t\tvar letters = Object.keys(RatingThresholds[statName]).reverse();\r\n\t\t\tvar i = 0;\r\n\r\n\t\t\tstat = stat.count / stat.total;\r\n\r\n\t\t\twhile (stat >= RatingThresholds[statName][letters[i]] && i < letters.length)\r\n\t\t\t\tletter = letters[i++];\r\n\r\n\t\t\tstat = letter;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"rating\" key={statName}>\r\n\t\t\t\t<div className=\"name\">\r\n\t\t\t\t\t{capitalize(statName)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"score\">\r\n\t\t\t\t\t{stat}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tconst recentGamesRows = recentGames.map(game => (\r\n\t\t<GameRow\r\n\t\t\tgame={game}\r\n\t\t\ttype={game.status || \"Finished\"}\r\n\t\t\tkey={game.id}\r\n\t\t\tsmallSetup />\r\n\t));\r\n\r\n\tconst createdSetupRows = createdSetups.map(setup => (\r\n\t\t<Setup setup={setup} key={setup.id} />\r\n\t));\r\n\r\n\tconst friendRequestRows = friendRequests.map(user => (\r\n\t\t<div className=\"friend-request\" key={user.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<div className=\"btns\">\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"fas fa-check\"\r\n\t\t\t\t\tonClick={() => onAcceptFriend(user.id)} />\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"fas fa-times\"\r\n\t\t\t\t\tonClick={() => onRejectFriend(user.id)} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tconst friendRows = friends.map(friend => (\r\n\t\t<div className=\"friend\" key={friend.id}>\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={friend.id}\r\n\t\t\t\tname={friend.name}\r\n\t\t\t\tavatar={friend.avatar} />\r\n\t\t\t<div className=\"last-active\">\r\n\t\t\t\t<Time\r\n\t\t\t\t\tminSec\r\n\t\t\t\t\tmillisec={Date.now() - friend.lastActive}\r\n\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tif (user.loaded && !user.loggedIn && !userId)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (user.loaded && user.loggedIn && !userId)\r\n\t\treturn <Redirect to={`/user/${user.id}`} />;\r\n\r\n\tif (!profileLoaded || !user.loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"profile\">\r\n\t\t\t\t<div className=\"main-panel\" style={mainPanelStyle}>\r\n\t\t\t\t\t<div className=\"banner\" style={bannerStyle}>\r\n\t\t\t\t\t\t{isSelf &&\r\n\t\t\t\t\t\t\t<HiddenUpload\r\n\t\t\t\t\t\t\t\tclassName=\"edit\"\r\n\t\t\t\t\t\t\t\tname=\"banner\"\r\n\t\t\t\t\t\t\t\tonClick={onEditBanner}\r\n\t\t\t\t\t\t\t\tonFileUpload={onFileUpload}>\r\n\t\t\t\t\t\t\t\t<i className=\"far fa-file-image\" />\r\n\t\t\t\t\t\t\t</HiddenUpload>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"user-info\">\r\n\t\t\t\t\t\t<div className=\"avi-name-row\">\r\n\t\t\t\t\t\t\t<div className=\"avi-name\">\r\n\t\t\t\t\t\t\t\t{!bustCache &&\r\n\t\t\t\t\t\t\t\t\t<Avatar\r\n\t\t\t\t\t\t\t\t\t\tlarge\r\n\t\t\t\t\t\t\t\t\t\tid={userId}\r\n\t\t\t\t\t\t\t\t\t\thasImage={avatar}\r\n\t\t\t\t\t\t\t\t\t\tbustCache={bustCache}\r\n\t\t\t\t\t\t\t\t\t\tname={name}\r\n\t\t\t\t\t\t\t\t\t\tedit={isSelf}\r\n\t\t\t\t\t\t\t\t\t\tonUpload={onFileUpload} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t<div className=\"name\">\r\n\t\t\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{!isSelf && user.loggedIn &&\r\n\t\t\t\t\t\t\t<div className=\"options\">\r\n\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\tclassName={`fas fa-user-plus ${isFriend ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\tonClick={onFriendUserClick} />\r\n\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\tclassName={`fas fa-ban ${isBlocked ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\tonClick={onBlockUserClick}\r\n\t\t\t\t\t\t\t\t\ttitle=\"Block user\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"accounts\">\r\n\t\t\t\t\t\t\t{accounts.discord && settings.showDiscord &&\r\n\t\t\t\t\t\t\t\t<div className=\"account-badge\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"icon discord-icon\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"username-wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"username\">\r\n\t\t\t\t\t\t\t\t\t\t\t{accounts.discord}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{accounts.twitch && settings.showTwitch &&\r\n\t\t\t\t\t\t\t\t<div className=\"account-badge\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"icon twitch-icon\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"username-wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"username\">\r\n\t\t\t\t\t\t\t\t\t\t\t{accounts.twitch}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{accounts.steam && settings.showSteam &&\r\n\t\t\t\t\t\t\t\t<div className=\"account-badge\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"icon steam-icon\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"username-wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"username\">\r\n\t\t\t\t\t\t\t\t\t\t\t{accounts.steam}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName={`bio ${isSelf && !editingBio ? \"edit\" : \"\"}`}\r\n\t\t\t\t\t\t\tonClick={onBioClick}>\r\n\t\t\t\t\t\t\t{!editingBio &&\r\n\t\t\t\t\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t\t\t\t\t<ReactMarkdown source={bio} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{editingBio &&\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\t\t\t\tvalue={bio}\r\n\t\t\t\t\t\t\t\t\t\tonChange={setBio} />\r\n\t\t\t\t\t\t\t\t\t<div className=\"buttons\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"btn btn-theme\" onClick={onEditBio}>Submit</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"btn btn-theme-sec\" onClick={onCancelEditBio}>Cancel</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"side column\">\r\n\t\t\t\t\t{ratings.length > 0 &&\r\n\t\t\t\t\t\t<div className=\"box-panel ratings\">\r\n\t\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\t\tMafia Ratings\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t\t{ratings}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div className=\"box-panel recent-games\">\r\n\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\tRecent Games\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t{recentGamesRows}\r\n\t\t\t\t\t\t\t{recentGames.length == 0 &&\r\n\t\t\t\t\t\t\t\t\"No games\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{friendRequests.length > 0 &&\r\n\t\t\t\t\t\t<div className=\"box-panel friend-requests\">\r\n\t\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\t\tFriend Requests\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t\t{friendRequestRows}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div className=\"box-panel friends\">\r\n\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\tFriends\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t<PageNav\r\n\t\t\t\t\t\t\t\tinverted\r\n\t\t\t\t\t\t\t\tpage={friendsPage}\r\n\t\t\t\t\t\t\t\tmaxPage={maxFriendsPage}\r\n\t\t\t\t\t\t\t\tonNav={onFriendsPageNav} />\r\n\t\t\t\t\t\t\t{friendRows}\r\n\t\t\t\t\t\t\t{friends.length == 0 &&\r\n\t\t\t\t\t\t\t\t\"No friends yet\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t<PageNav\r\n\t\t\t\t\t\t\t\tinverted\r\n\t\t\t\t\t\t\t\tpage={friendsPage}\r\n\t\t\t\t\t\t\t\tmaxPage={maxFriendsPage}\r\n\t\t\t\t\t\t\t\tonNav={onFriendsPageNav} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"box-panel created-setups\">\r\n\t\t\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t\t\tSetups Created\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t\t\t{createdSetupRows}\r\n\t\t\t\t\t\t\t{createdSetups.length == 0 &&\r\n\t\t\t\t\t\t\t\t\"No setups\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<Comments location={userId} />\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport LoadingPage from \"../Loading\";\r\nimport Form, { useForm } from \"../../components/Form\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\n\r\nimport \"../../css/settings.css\";\r\n\r\nexport default function Settings(props) {\r\n\tconst [settingsLoaded, setSettingsLoaded] = useState(false);\r\n\tconst [accountsLoaded, setAccountsLoaded] = useState(false);\r\n\tconst [accounts, setAccounts] = useState({});\r\n\tconst history = useHistory();\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tconst [siteFields, updateSiteFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Referral URL\",\r\n\t\t\tref: \"referralURL\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tvalue: (deps) => `${process.env.REACT_APP_URL}/auth/login?ref=${deps.user.id}`,\r\n\t\t\tfixed: true,\r\n\t\t\thighlight: true\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"DMs from Friends Only\",\r\n\t\t\tref: \"onlyFriendDMs\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Disable PG-13 Censor\",\r\n\t\t\tref: \"disablePg13Censor\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"!disableAllCensors\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Disable All Censors\",\r\n\t\t\tref: \"disableAllCensors\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.perms.disableAllCensors\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Hide Deleted Posts\",\r\n\t\t\tref: \"hideDeleted\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.user.perms.viewDeleted\r\n\t\t}\r\n\t]);\r\n\r\n\tconst [profileFields, updateProfileFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Name\",\r\n\t\t\tref: \"username\",\r\n\t\t\ttype: \"text\",\r\n\t\t\tsaveBtn: \"Change\",\r\n\t\t\tsaveBtnDiffer: \"name\",\r\n\t\t\tsaveBtnOnClick: onUsernameSave,\r\n\t\t\tconfirm: \"Are you sure you wish to change your username?\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Show Discord\",\r\n\t\t\tref: \"showDiscord\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.discord && deps.accounts.discord.id\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Show Twitch\",\r\n\t\t\tref: \"showTwitch\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.twitch && deps.accounts.twitch.id\r\n\t\t},\r\n\t\t// {\r\n\t\t// \tlabel: \"Show Google\",\r\n\t\t// \tref: \"showGoogle\",\r\n\t\t// \ttype: \"boolean\",\r\n\t\t// \tshowIf: (deps) => deps.accounts.google && deps.accounts.google.id\r\n\t\t// },\r\n\t\t{\r\n\t\t\tlabel: \"Show Steam\",\r\n\t\t\tref: \"showSteam\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: (deps) => deps.accounts.steam && deps.accounts.steam.id\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Background Color\",\r\n\t\t\tref: \"backgroundColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#5357a5\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.customProfile\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Banner Format\",\r\n\t\t\tref: \"bannerFormat\",\r\n\t\t\ttype: \"select\",\r\n\t\t\toptions: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Tile\",\r\n\t\t\t\t\tvalue: \"tile\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Stretch\",\r\n\t\t\t\t\tvalue: \"stretch\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.customProfile\r\n\t\t}\r\n\t], [accounts]);\r\n\r\n\tconst [gameFields, updateGameFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Name Color\",\r\n\t\t\tref: \"nameColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#fff\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.textColors\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Text Color\",\r\n\t\t\tref: \"textColor\",\r\n\t\t\ttype: \"color\",\r\n\t\t\tdefault: \"#fff\",\r\n\t\t\tdisabled: (deps) => !deps.user.itemsOwned.textColors\r\n\t\t}\r\n\t]);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Settings | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (user.loaded && user.loggedIn) {\r\n\t\t\tif (!settingsLoaded) {\r\n\t\t\t\taxios.get(\"/user/settings/data\")\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tlet siteFormFieldChanges = [];\r\n\t\t\t\t\t\tlet profileFormFieldChanges = [];\r\n\t\t\t\t\t\tlet gameFormFieldChanges = [];\r\n\r\n\t\t\t\t\t\tfor (let ref in res.data) {\r\n\t\t\t\t\t\t\tif (!res.data[ref]) continue;\r\n\r\n\t\t\t\t\t\t\tsiteFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tprofileFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tgameFormFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: res.data[ref]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tupdateSiteFields(siteFormFieldChanges);\r\n\t\t\t\t\t\tupdateProfileFields(profileFormFieldChanges);\r\n\t\t\t\t\t\tupdateGameFields(gameFormFieldChanges);\r\n\t\t\t\t\t\tsetSettingsLoaded(true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\r\n\t\t\tif (!accountsLoaded) {\r\n\t\t\t\taxios.get(\"/user/accounts\")\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tsetAccounts(res.data);\r\n\t\t\t\t\t\tsetAccountsLoaded(true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [user]);\r\n\r\n\tfunction onSettingChange(action, update) {\r\n\t\tif (action.prop == \"value\" && !action.localOnly) {\r\n\t\t\taxios.post(\"/user/settings/update\", {\r\n\t\t\t\tprop: action.ref,\r\n\t\t\t\tvalue: action.value\r\n\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tuser.updateSetting(action.ref, action.value);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\r\n\t\tupdate(action);\r\n\t}\r\n\r\n\tfunction onUsernameSave(name, deps) {\r\n\t\tvar code = \"\";\r\n\r\n\t\tif (reservedNames.indexOf(name.toLowerCase()) != -1)\r\n\t\t\tcode = window.prompt(\"This name is reserved, please enter your reservation code.\");\r\n\r\n\t\taxios.post(\"/user/name\", { name, code })\r\n\t\t\t.then(res => {\r\n\t\t\t\tdeps.siteInfo.showAlert(\"Username changed\", \"success\");\r\n\r\n\t\t\t\tdeps.user.set(update(deps.user, {\r\n\t\t\t\t\tname: { $set: name },\r\n\t\t\t\t\titemsOwned: {\r\n\t\t\t\t\t\tnameChange: {\r\n\t\t\t\t\t\t\t$set: deps.user.itemsOwned.nameChange - 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(deps.errorAlert);\r\n\t}\r\n\r\n\tfunction onLogoutClick() {\r\n\t\taxios.post(\"/user/logout\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tuser.clear();\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete your account? This is irreversible.\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/user/delete\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tuser.clear();\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tif (user.loaded && !user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (!settingsLoaded || !accountsLoaded || !user.loaded)\r\n\t\treturn <LoadingPage />\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main settings\">\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tSite\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={siteFields}\r\n\t\t\t\tdeps={{ user }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateSiteFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tProfile\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={profileFields}\r\n\t\t\t\tdeps={{ name: user.name, user, accounts, siteInfo, errorAlert }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateProfileFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tGame\r\n\t\t\t</div>\r\n\t\t\t<Form\r\n\t\t\t\tfields={gameFields}\r\n\t\t\t\tdeps={{ user }}\r\n\t\t\t\tonChange={action => onSettingChange(action, updateGameFields)} />\r\n\t\t\t<div className=\"heading\">\r\n\t\t\t\tAccounts\r\n\t\t\t</div>\r\n\t\t\t<div className=\"accounts-row\">\r\n\t\t\t\t<div className=\"accounts-column\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme-sec logout\"\r\n\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\tSign Out\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn delete-account\"\r\n\t\t\t\t\t\tonClick={onDeleteClick}>\r\n\t\t\t\t\t\tDelete Account\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nconst reservedNames = [\r\n\t\"admin\",\r\n\t\"administrator\",\r\n\t\"mod\",\r\n\t\"moderator\",\r\n\t\"dev\",\r\n\t\"developer\",\r\n\t\"giga\",\r\n\t\"rend\",\r\n\t\"arcbell\",\r\n];","import React, { useState, useEffect, useContext, useRef } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\n\r\nimport \"../../css/shop.css\";\r\n\r\nexport default function Shop(props) {\r\n\tconst [shopInfo, setShopInfo] = useState({ shopItems: [], balance: 0 });\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Shop | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!user.loaded || !user.loggedIn)\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(\"/shop/info\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetShopInfo(res.data);\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}, [user.loaded]);\r\n\r\n\tfunction onBuyItem(index) {\r\n\t\tconst item = shopInfo.shopItems[index];\r\n\t\tconst shouldBuy = window.confirm(`Are you sure you wish to buy ${item.name} for ${item.price} coins?`);\r\n\r\n\t\tif (!shouldBuy)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/shop/spendCoins\", { item: index })\r\n\t\t\t.then(() => {\r\n\t\t\t\tsiteInfo.showAlert(\"Item purchased.\", \"success\");\r\n\r\n\t\t\t\tsetShopInfo(update(shopInfo, {\r\n\t\t\t\t\tbalance: {\r\n\t\t\t\t\t\t$set: shopInfo.balance - item.price\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tuser.set(update(user.state, {\r\n\t\t\t\t\titemsOwned: {\r\n\t\t\t\t\t\t[item.key]: {\r\n\t\t\t\t\t\t\t$set: user.itemsOwned[item.key] + 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tconst shopItems = shopInfo.shopItems.map((item, i) => (\r\n\t\t<div className=\"shop-item\" key={i}>\r\n\t\t\t<div className=\"name\">\r\n\t\t\t\t{item.name}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"desc\">\r\n\t\t\t\t{item.desc}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"bottom\">\r\n\t\t\t\t<div className=\"price\">\r\n\t\t\t\t\t<i className=\"fas fa-coins\" />\r\n\t\t\t\t\t{item.price} coins\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"owned\">\r\n\t\t\t\t\tOwned:\r\n\t\t\t\t\t<div className=\"amt\">\r\n\t\t\t\t\t\t{user.itemsOwned[item.key]}\r\n\t\t\t\t\t\t{item.limit != null &&\r\n\t\t\t\t\t\t\t` / ${item.limit}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={`buy btn btn-theme`}\r\n\t\t\t\t\tdisabled={item.limit != null && user.itemsOwned[item.key] >= item.limit}\r\n\t\t\t\t\tonClick={() => onBuyItem(i)}>\r\n\t\t\t\t\tBuy\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\tif (user.loaded && !user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main shop\">\r\n\t\t\t<div className=\"top-bar\">\r\n\t\t\t\t<div className=\"balance\">\r\n\t\t\t\t\t<i className=\"fas fa-coins\" />\r\n\t\t\t\t\t{shopInfo.balance}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"shop-items\">\r\n\t\t\t\t{shopItems}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useContext } from \"react\";\r\nimport { Link, Route, Switch, Redirect } from \"react-router-dom\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport Profile from \"./Profile\";\r\nimport Settings from \"./Settings\";\r\nimport Shop from \"./Shop\";\r\nimport { UserContext, PopoverContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport { HiddenUpload } from \"../../components/Form\";\r\n\r\nimport \"../../css/user.css\"\r\n\r\nexport default function User(props) {\r\n\tconst user = useContext(UserContext);\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Profile\",\r\n\t\t\tpath: user.id ? `/user/${user.id}` : \"/user\",\r\n\t\t\texact: true,\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Settings\",\r\n\t\t\tpath: \"/user/settings\",\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Shop\",\r\n\t\t\tpath: \"/user/shop\",\r\n\t\t\thide: !user.loggedIn\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/user\" render={() => <Profile />} />\r\n\t\t\t\t\t<Route exact path=\"/user/settings\" render={() => <Settings />} />\r\n\t\t\t\t\t<Route exact path=\"/user/shop\" render={() => <Shop />} />\r\n\t\t\t\t\t<Route exact path=\"/user/:userId\" render={() => <Profile />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/user\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport function Avatar(props) {\r\n\tconst small = props.small;\r\n\tconst large = props.large;\r\n\tconst id = props.id;\r\n\tconst name = props.name;\r\n\tconst hasImage = props.hasImage;\r\n\tconst imageUrl = props.imageUrl;\r\n\tconst edit = props.edit;\r\n\tconst onUpload = props.onUpload;\r\n\tconst active = props.active;\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst style = {};\r\n\tconst colors = [\"#fff59d\", \"#ef9a9a\", \"#9fa8da\", \"#ce93d8\", \"#a5d6a7\", \"#f48fb1\", \"#ffcc80\", \"#90deea\", \"#80cbc4\"]; //yellow, red, blue, purple, green, pink, orange, cyan, teal\r\n\tvar size;\r\n\r\n\tif (small)\r\n\t\tsize = \"small\";\r\n\telse if (large)\r\n\t\tsize = \"large\";\r\n\telse\r\n\t\tsize = \"\";\r\n\r\n\tif (hasImage && !imageUrl && id) {\r\n\t\tstyle.backgroundImage = `url(/uploads/${id}_avatar.jpg?t=${siteInfo.cacheVal})`;\r\n\t}\r\n\telse if (hasImage && imageUrl) {\r\n\t\tstyle.backgroundImage = `url(${imageUrl})`;\r\n\t}\r\n\telse if (name) {\r\n\t\tvar rand = 0;\r\n\r\n\t\tfor (let i = 0; i < name.length; i++)\r\n\t\t\trand ^= name.charCodeAt(i);\r\n\r\n\t\trand ^= name.charCodeAt(1);\r\n\t\trand ^= rand << 13;\r\n\t\trand ^= rand >> 7;\r\n\t\trand ^= rand << 17;\r\n\t\trand = Math.abs(rand) / Math.pow(2, 31);\r\n\r\n\t\tstyle.backgroundColor = colors[Math.floor(rand * colors.length)];\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`avatar ${size} ${active ? \"active\" : \"\"}`}\r\n\t\t\tstyle={style}>\r\n\t\t\t{edit &&\r\n\t\t\t\t<HiddenUpload\r\n\t\t\t\t\tclassName=\"edit\"\r\n\t\t\t\t\tname=\"avatar\"\r\n\t\t\t\t\tonFileUpload={onUpload}>\r\n\t\t\t\t\t<i className=\"far fa-file-image\" />\r\n\t\t\t\t</HiddenUpload>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function NameWithAvatar(props) {\r\n\tconst id = props.id;\r\n\tconst name = props.name || \"[deleted]\";\r\n\tconst avatar = props.avatar;\r\n\tconst noLink = props.name ? props.noLink : true;\r\n\tconst color = props.color;\r\n\tconst newTab = props.newTab;\r\n\tconst small = props.small;\r\n\tconst active = props.active;\r\n\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\treturn (\r\n\t\t<Link\r\n\t\t\tclassName={`name-with-avatar ${noLink ? \"no-link\" : \"\"}`}\r\n\t\t\tto={`/user/${id}`}\r\n\t\t\ttarget={newTab ? \"_blank\" : \"\"}\r\n\t\t\tonClick={(e) => {\r\n\t\t\t\tpopover.setVisible(false);\r\n\r\n\t\t\t\tif (noLink)\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t}}>\r\n\t\t\t<Avatar\r\n\t\t\t\thasImage={avatar}\r\n\t\t\t\tid={id}\r\n\t\t\t\tname={name}\r\n\t\t\t\tsmall={small}\r\n\t\t\t\tactive={active} />\r\n\t\t\t<div className=\"user-name\" style={color ? { color: color } : {}}>{name}</div>\r\n\t\t</Link>\r\n\t);\r\n}\r\n\r\nexport function StatusIcon(props) {\r\n\treturn (\r\n\t\t<div className={`status-icon ${props.status}`} />\r\n\t);\r\n}\r\n\r\nexport function useUser() {\r\n\tconst [user, setUser] = useState({\r\n\t\tloggedIn: false,\r\n\t\tloaded: false,\r\n\t\tperms: {},\r\n\t\trank: 0,\r\n\t\tblockedUsers: [],\r\n\t\tsettings: {},\r\n\t\titemsOwned: {}\r\n\t});\r\n\r\n\tfunction clear() {\r\n\t\tsetUser({\r\n\t\t\tloggedIn: false,\r\n\t\t\tloaded: true,\r\n\t\t\tperms: {},\r\n\t\t\trank: 0,\r\n\t\t\tblockedUsers: []\r\n\t\t});\r\n\t}\r\n\r\n\tfunction blockUserToggle(userId) {\r\n\t\tvar userIndex = user.blockedUsers.indexOf(userId);\r\n\r\n\t\tif (userIndex == -1) {\r\n\t\t\tsetUser(update(user, {\r\n\t\t\t\tblockedUsers: {\r\n\t\t\t\t\t$push: [userId]\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsetUser(update(user, {\r\n\t\t\t\tblockedUsers: {\r\n\t\t\t\t\t$splice: [[userIndex, 1]]\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateSetting(prop, value) {\r\n\t\tsetUser(update(user, {\r\n\t\t\tsettings: {\r\n\t\t\t\t[prop]: {\r\n\t\t\t\t\t$set: value\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\treturn {\r\n\t\t...user,\r\n\t\tstate: user,\r\n\t\tset: setUser,\r\n\t\tblockUserToggle,\r\n\t\tupdateSetting,\r\n\t\tclear\r\n\t};\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Time } from \"../../../components/Basic\";\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { ViewsAndReplies } from \"./Forums\";\r\n\r\nexport default function Categories(props) {\r\n\tconst [categoryInfo, setCategoryInfo] = useState([]);\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Categories | BeyondMafia\";\r\n\t\tprops.updateForumNavInfo({ action: \"home\" });\r\n\r\n\t\taxios.get(\"/forums/categories\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar categories = res.data.sort(sortItems);\r\n\r\n\t\t\t\tfor (let category of categories)\r\n\t\t\t\t\tcategory.boards = category.boards.sort(sortItems);\r\n\r\n\t\t\t\tsetCategoryInfo(categories);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"home\"\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}, []);\r\n\r\n\tfunction sortItems(a, b) {\r\n\t\treturn a.position - b.position;\r\n\t}\r\n\r\n\tconst categories = categoryInfo.map(category => {\r\n\t\tconst boards = category.boards.map(board => {\r\n\t\t\tconst newestThreads = board.newestThreads.map(thread => (\r\n\t\t\t\t<div className=\"column-item\" key={thread.id}>\r\n\t\t\t\t\t<div className=\"thread-link-wrapper\">\r\n\t\t\t\t\t\t<Link to={`/community/forums/thread/${thread.id}`}>\r\n\t\t\t\t\t\t\t{thread.title}\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={thread.author.id}\r\n\t\t\t\t\t\tname={thread.author.name}\r\n\t\t\t\t\t\tavatar={thread.author.avatar} />\r\n\t\t\t\t\t<div className=\"thread-counts\">\r\n\t\t\t\t\t\t<ViewsAndReplies\r\n\t\t\t\t\t\t\tviewCount={thread.viewCount || 0}\r\n\t\t\t\t\t\t\treplyCount={thread.replyCount || 0} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t));\r\n\r\n\t\t\tconst recentReplies = board.recentReplies.map(reply => (\r\n\t\t\t\t<div className=\"column-item\" key={reply.id}>\r\n\t\t\t\t\t<div className=\"thread-link-wrapper\">\r\n\t\t\t\t\t\t<Link to={`/community/forums/thread/${reply.thread.id}?reply=${reply.id}`}>\r\n\t\t\t\t\t\t\t{reply.thread.title}\r\n\t\t\t\t\t\t</Link>\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={reply.author.id}\r\n\t\t\t\t\t\tname={reply.author.name}\r\n\t\t\t\t\t\tavatar={reply.author.avatar} />\r\n\t\t\t\t\t<div className=\"reply-age\">\r\n\t\t\t\t\t\t<Time millisec={Date.now() - reply.postDate} />\r\n\t\t\t\t\t\t{` ago`}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t));\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"board\" key={board.id}>\r\n\t\t\t\t\t<i className={`fas fa-${board.icon || \"comments\"} board-icon`} />\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tclassName=\"board-info\"\r\n\t\t\t\t\t\tto={`/community/forums/board/${board.id}`}>\r\n\t\t\t\t\t\t<div className=\"board-name\">\r\n\t\t\t\t\t\t\t{board.name}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"board-desc\">\r\n\t\t\t\t\t\t\t{board.description}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<div className=\"forum-column tall\">\r\n\t\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\t\tNewest Thread\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={`column-content ${newestThreads.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t\t{newestThreads.length == 0 &&\r\n\t\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\t\tNo threads yet\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{newestThreads}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"forum-column tall three\">\r\n\t\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\t\tRecent Replies\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={`column-content ${recentReplies.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t\t{recentReplies.length == 0 &&\r\n\t\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\t\tNo replies yet\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{recentReplies}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"span-panel forum-category\" key={category.id}>\r\n\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t{category.name}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"boards\">\r\n\t\t\t\t\t{boards}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn categories;\r\n}","import React, { } from \"react\";\r\n\r\nimport \"../css/modal.css\";\r\n\r\nexport function Modal(props) {\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{props.show &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclassName=\"modal-bg\"\r\n\t\t\t\t\t\tonClick={props.onBgClick} />\r\n\t\t\t\t\t<div className={`modal ${props.className ? props.className : \"\"}`}>\r\n\t\t\t\t\t\t<div className=\"modal-header\">\r\n\t\t\t\t\t\t\t{props.header}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"modal-content\">\r\n\t\t\t\t\t\t\t{props.content}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"modal-footer\">\r\n\t\t\t\t\t\t\t{props.footer}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect, useParams, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { PageNav } from \"../../../components/Nav\";\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Modal } from \"../../../components/Modal\";\r\nimport { VoteWidget, ViewsAndReplies } from \"./Forums\";\r\nimport { TextEditor } from \"../../../components/Form\";\r\nimport { Time } from \"../../../components/Basic\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nexport default function Board(props) {\r\n\tconst [boardInfo, setBoardInfo] = useState({});\r\n\tconst [showCreateModal, setShowCreateModal] = useState(false);\r\n\tconst [newThreadTitle, setNewThreadTitle] = useState(\"\");\r\n\tconst [newThreadContent, setNewThreadContent] = useState(\"\");\r\n\tconst [boardPage, setBoardPage] = useState(1);\r\n\tconst [sortType, setSortType] = useState(\"bumpDate\");\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [redirect, setRedirect] = useState();\r\n\r\n\tconst { boardId } = useParams();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Mafia Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.get(`/forums/board/${boardId}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetBoardInfo(res.data);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tdocument.title = `${res.data.name} | BeyondMafia`;\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"board\",\r\n\t\t\t\t\tid: boardId,\r\n\t\t\t\t\tname: res.data.name\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t\tsetRedirect(\"/community/forums\");\r\n\t\t\t});\r\n\t}, [boardId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (loaded) {\r\n\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\taction: \"board\",\r\n\t\t\t\tid: boardInfo.id,\r\n\t\t\t\tname: boardInfo.name\r\n\t\t\t});\r\n\t\t}\r\n\t}, [loaded, boardInfo]);\r\n\r\n\tfunction onCreateThreadClick() {\r\n\t\tsetShowCreateModal(true);\r\n\t}\r\n\r\n\tfunction onBoardPageNav(page) {\r\n\t\tvar filterArg;\r\n\r\n\t\tif (page == 1)\r\n\t\t\tfilterArg = \"last=Infinity\";\r\n\t\telse if (page < boardPage && boardInfo.threads.length)\r\n\t\t\tfilterArg = `first=${boardInfo.threads[0][sortType]}`;\r\n\t\telse if (page > boardPage && boardInfo.threads.length)\r\n\t\t\tfilterArg = `last=${boardInfo.threads[boardInfo.threads.length - 1][sortType]}`;\r\n\t\telse\r\n\t\t\treturn;\r\n\r\n\t\tconsole.log(page);\r\n\t\taxios.get(`/forums/board/${boardId}?sortType=${sortType}&${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (res.data.threads.length > 0) {\r\n\t\t\t\t\tsetBoardInfo(res.data);\r\n\t\t\t\t\tsetBoardPage(page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction threadRowsMap(thread) {\r\n\t\tconst recentReplies = thread.recentReplies.map(reply => (\r\n\t\t\t<div className=\"column-item\" key={reply.id}>\r\n\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\tsmall\r\n\t\t\t\t\tid={reply.author.id}\r\n\t\t\t\t\tname={reply.author.name}\r\n\t\t\t\t\tavatar={reply.author.avatar} />\r\n\t\t\t\t<Link\r\n\t\t\t\t\tclassName=\"reply-age\"\r\n\t\t\t\t\tto={`/community/forums/thread/${thread.id}?reply=${reply.id}`}>\r\n\t\t\t\t\t<Time millisec={Date.now() - reply.postDate} />\r\n\t\t\t\t\t{` ago`}\r\n\t\t\t\t</Link>\r\n\t\t\t</div>\r\n\t\t));\r\n\r\n\t\treturn (\r\n\t\t\t<div className={`thread ${thread.deleted ? \"deleted\" : \"\"}`} key={thread.id}>\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={thread}\r\n\t\t\t\t\titemType=\"thread\"\r\n\t\t\t\t\titemHolder={boardInfo}\r\n\t\t\t\t\tsetItemHolder={setBoardInfo}\r\n\t\t\t\t\titemKey=\"threads\" />\r\n\t\t\t\t<div className=\"thread-info\">\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tclassName=\"thread-title\"\r\n\t\t\t\t\t\tto={`/community/forums/thread/${thread.id}`}>\r\n\t\t\t\t\t\t{thread.locked &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{thread.pinned &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-thumbtack\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{thread.title}\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={thread.author.id}\r\n\t\t\t\t\t\tavatar={thread.author.avatar}\r\n\t\t\t\t\t\tname={thread.author.name} />\r\n\t\t\t\t\t<div className=\"counts\">\r\n\t\t\t\t\t\t<ViewsAndReplies\r\n\t\t\t\t\t\t\tviewCount={thread.viewCount || 0}\r\n\t\t\t\t\t\t\treplyCount={thread.replyCount || 0} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-column\">\r\n\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\tPost Date\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"column-content\">\r\n\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t<Time millisec={Date.now() - thread.postDate} />\r\n\t\t\t\t\t\t\t{` ago`}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"forum-column three\">\r\n\t\t\t\t\t<div className=\"column-title\">\r\n\t\t\t\t\t\tRecent Replies\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className={`column-content ${recentReplies.length == 0 ? \"center-content\" : \"\"}`}>\r\n\t\t\t\t\t\t{recentReplies.length == 0 &&\r\n\t\t\t\t\t\t\t<div className=\"column-item center-item\">\r\n\t\t\t\t\t\t\t\tNo replies yet\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{recentReplies}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tif (redirect)\r\n\t\treturn <Redirect to={redirect} />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tconst threads = boardInfo.threads.map(threadRowsMap);\r\n\tconst pinnedThreads = boardInfo.pinnedThreads.map(threadRowsMap);\r\n\r\n\treturn (\r\n\t\t<div className=\"board-wrapper\">\r\n\t\t\t<CreateThreadModal\r\n\t\t\t\tboardId={boardId}\r\n\t\t\t\tshow={showCreateModal}\r\n\t\t\t\tsetShow={setShowCreateModal}\r\n\t\t\t\tthreadTitle={newThreadTitle}\r\n\t\t\t\tsetThreadTitle={setNewThreadTitle}\r\n\t\t\t\tthreadContent={newThreadContent}\r\n\t\t\t\tsetThreadContent={setNewThreadContent}\r\n\t\t\t\tsetRedirect={setRedirect} />\r\n\t\t\t<div className=\"board-info\">\r\n\t\t\t\t<div className=\"board-title-wrapper\">\r\n\t\t\t\t\t<i className={`fas fa-${boardInfo.icon || \"comments\"} board-icon`} />\r\n\t\t\t\t\t<div className=\"board-title\">\r\n\t\t\t\t\t\t{boardInfo.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"create-thread btn btn-theme\"\r\n\t\t\t\t\tonClick={onCreateThreadClick}\r\n\t\t\t\t\tdisabled={!user.perms.createThread}>\r\n\t\t\t\t\t<i className=\"fas fa-plus\" />\r\n\t\t\t\t\tCreate Thread\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{pinnedThreads.length > 0 &&\r\n\t\t\t\t<div className=\"threads pinned-threads span-panel\">\r\n\t\t\t\t\t{pinnedThreads}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t<PageNav\r\n\t\t\t\tinverted\r\n\t\t\t\tpage={boardPage}\r\n\t\t\t\tonNav={onBoardPageNav} />\r\n\t\t\t<div className=\"threads span-panel\">\r\n\t\t\t\t{threads.length > 0 &&\r\n\t\t\t\t\tthreads\r\n\t\t\t\t}\r\n\t\t\t\t{threads.length == 0 &&\r\n\t\t\t\t\t\"No threads yet\"\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<PageNav\r\n\t\t\t\tinverted\r\n\t\t\t\tpage={boardPage}\r\n\t\t\t\tonNav={onBoardPageNav} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction CreateThreadModal(props) {\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst header = \"Create Thread\";\r\n\r\n\tconst content = (\r\n\t\t<div className=\"form\">\r\n\t\t\t<div className=\"field-wrapper thread-title\">\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tTitle\r\n\t\t\t\t</div>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={props.threadTitle}\r\n\t\t\t\t\tonChange={onTitleChange} />\r\n\t\t\t</div>\r\n\t\t\t<TextEditor\r\n\t\t\t\tvalue={props.threadContent}\r\n\t\t\t\tonChange={props.setThreadContent} />\r\n\t\t</div>\r\n\t);\r\n\r\n\tconst footer = (\r\n\t\t<div className=\"control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"post btn btn-theme\"\r\n\t\t\t\tonClick={onPostThread}>\r\n\t\t\t\tPost\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={onCancel}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tfunction onTitleChange(e) {\r\n\t\tprops.setThreadTitle(e.target.value);\r\n\t}\r\n\r\n\tfunction onCancel() {\r\n\t\tprops.setShow(false);\r\n\t}\r\n\r\n\tfunction onPostThread() {\r\n\t\taxios.post(\"/forums/thread\", {\r\n\t\t\tboard: props.boardId,\r\n\t\t\ttitle: props.threadTitle,\r\n\t\t\tcontent: props.threadContent\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tprops.setShow(false);\r\n\t\t\t\tprops.setRedirect(`/community/forums/thread/${res.data}`);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\tclassName=\"create-thread\"\r\n\t\t\tshow={props.show}\r\n\t\t\tonBgClick={onCancel}\r\n\t\t\theader={header}\r\n\t\t\tcontent={content}\r\n\t\t\tfooter={footer} />\r\n\t);\r\n}","import React, { useState, useEffect, useRef, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Redirect, Link, useParams, useLocation } from \"react-router-dom\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { VoteWidget } from \"./Forums\";\r\nimport { NameWithAvatar } from \"../../User/User\";\r\nimport { Time, filterProfanity } from \"../../../components/Basic\";\r\nimport { PageNav } from \"../../../components/Nav\";\r\nimport { TextEditor } from \"../../../components/Form\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nexport default function Thread(props) {\r\n\tconst [threadInfo, setThreadInfo] = useState({});\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [redirect, setRedirect] = useState();\r\n\tconst [showReplyForm, setShowReplyForm] = useState(false);\r\n\tconst [replyContent, setReplyContent] = useState(\"\");\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [scrolled, setScrolled] = useState(false);\r\n\r\n\tconst replyFormRef = useRef();\r\n\tconst { threadId } = useParams();\r\n\tconst location = useLocation();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tconst params = new URLSearchParams(location.search);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Forums | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.get(`/forums/thread/${threadId}?reply=${params.get(\"reply\") || \"\"}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tres.data.content = filterProfanity(res.data.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tfor (let reply of res.data.replies)\r\n\t\t\t\t\treply.content = filterProfanity(reply.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tsetThreadInfo(res.data);\r\n\t\t\t\tsetPage(res.data.page);\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\t\ttype: \"thread\",\r\n\t\t\t\t\tboardId: res.data.board.id,\r\n\t\t\t\t\tboardName: res.data.board.name,\r\n\t\t\t\t\tthreadId: res.data.id,\r\n\t\t\t\t\tthreadTitle: res.data.title\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t\tsetRedirect(\"/community/forums\");\r\n\t\t\t});\r\n\t}, [threadId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (loaded) {\r\n\t\t\tprops.updateForumNavInfo({\r\n\t\t\t\taction: \"boardAndThread\",\r\n\t\t\t\tboardId: threadInfo.board.id,\r\n\t\t\t\tboardName: threadInfo.board.name,\r\n\t\t\t\tthreadId: threadInfo.id,\r\n\t\t\t\tthreadTitle: threadInfo.title\r\n\t\t\t});\r\n\r\n\t\t\tif (scrolled || !params.get(\"reply\"))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar reply = document.getElementById(`reply-${params.get(\"reply\")}`);\r\n\t\t\tsetScrolled(true);\r\n\r\n\t\t\tif (reply)\r\n\t\t\t\treply.scrollIntoView();\r\n\t\t}\r\n\t}, [loaded, threadInfo]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (showReplyForm)\r\n\t\t\treplyFormRef.current.scrollIntoView();\r\n\t}, [showReplyForm]);\r\n\r\n\tfunction onReplyClick(reply) {\r\n\t\tif (threadInfo.locked && !user.perms.postInLocked)\r\n\t\t\treturn;\r\n\r\n\t\tsetShowReplyForm(true);\r\n\r\n\t\tif (reply) {\r\n\t\t\tvar newContent = `${replyContent}\\n\\n> ##### @${reply.author.name}:\\n`;\r\n\t\t\tvar quotedContent = reply.content.split(\"\\n\");\r\n\r\n\t\t\tfor (let i = 0; i < quotedContent.length; i++)\r\n\t\t\t\tquotedContent[i] = `> ${quotedContent[i]}`;\r\n\r\n\t\t\tnewContent = `${newContent}${quotedContent.join(\"\\n\")}\\n\\n`;\r\n\t\t\tsetReplyContent(newContent);\r\n\t\t}\r\n\r\n\t\tif (showReplyForm)\r\n\t\t\treplyFormRef.current.scrollIntoView();\r\n\t}\r\n\r\n\tfunction onPostReply() {\r\n\t\taxios.post(`/forums/reply`, {\r\n\t\t\tthread: threadInfo.id,\r\n\t\t\tcontent: replyContent\r\n\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tonThreadPageNav(Number(res.data));\r\n\t\t\t\tsetReplyContent(\"\");\r\n\t\t\t\tsetShowReplyForm(false);\r\n\r\n\t\t\t\tdocument.body.scrollTop = document.body.scrollHeight;\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostCancel() {\r\n\t\tsetShowReplyForm(false);\r\n\t\tsetReplyContent(\"\");\r\n\t}\r\n\r\n\tfunction onThreadPageNav(page) {\r\n\t\taxios.get(`/forums/thread/${threadId}?page=${page}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tres.data.content = filterProfanity(res.data.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tfor (let reply of res.data.replies)\r\n\t\t\t\t\treply.content = filterProfanity(reply.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\tsetPage(page);\r\n\t\t\t\tsetThreadInfo(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onThreadDeleted() {\r\n\t\tsetRedirect(`/community/forums/board/${threadInfo.board.id}`);\r\n\t}\r\n\r\n\tfunction onNotifyToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\treplyNotify: {\r\n\t\t\t\t$set: !threadInfo.replyNotify\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tfunction onPinToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\tpinned: {\r\n\t\t\t\t$set: !threadInfo.pinned\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tfunction onLockToggled() {\r\n\t\tsetThreadInfo(update(threadInfo, {\r\n\t\t\tlocked: {\r\n\t\t\t\t$set: !threadInfo.locked\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tif (redirect)\r\n\t\treturn <Redirect to={redirect} />;\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tconst replies = threadInfo.replies.map(reply => (\r\n\t\t<Post\r\n\t\t\tclassName={`reply ${reply.id == params.get(\"reply\") ? \"sel\" : \"\"}`}\r\n\t\t\tid={`reply-${reply.id}`}\r\n\t\t\tkey={reply.id}\r\n\t\t\tpostInfo={reply}\r\n\t\t\titemType=\"reply\"\r\n\t\t\tvoteItem={reply}\r\n\t\t\tvoteItemHolder={threadInfo}\r\n\t\t\tsetVoteItemHolder={setThreadInfo}\r\n\t\t\titemKey=\"replies\"\r\n\t\t\tlocked={threadInfo.locked}\r\n\t\t\tpermaLink={`/community/forums/thread/${threadId}?reply=${reply.id}`}\r\n\t\t\tonReplyClick={() => onReplyClick(reply)}\r\n\t\t\tonDelete={() => onThreadPageNav(page)}\r\n\t\t\tonRestore={() => onThreadPageNav(page)}\r\n\t\t\tonEdit={() => onThreadPageNav(page)} />\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"thread-wrapper\">\r\n\t\t\t<Post\r\n\t\t\t\tpostInfo={threadInfo}\r\n\t\t\t\titemType=\"thread\"\r\n\t\t\t\tvoteItem={threadInfo}\r\n\t\t\t\tsetVoteItemHolder={setThreadInfo}\r\n\t\t\t\tlocked={threadInfo.locked}\r\n\t\t\t\tonReplyClick={() => onReplyClick()}\r\n\t\t\t\tonDelete={onThreadDeleted}\r\n\t\t\t\tonRestore={() => onThreadPageNav(page)}\r\n\t\t\t\tonEdit={() => onThreadPageNav(page)}\r\n\t\t\t\tonNotifyToggled={onNotifyToggled}\r\n\t\t\t\tonPinToggled={onPinToggled}\r\n\t\t\t\tonLockToggled={onLockToggled}\r\n\t\t\t\thasTitle />\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"reply-form-wrapper\"\r\n\t\t\t\tref={replyFormRef}>\r\n\t\t\t\t{showReplyForm &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"reply-form span-panel\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={replyContent}\r\n\t\t\t\t\t\t\tonChange={setReplyContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onPostReply}>\r\n\t\t\t\t\t\t\t\tPost\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onPostCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"replies-wrapper\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tmaxPage={threadInfo.pageCount}\r\n\t\t\t\t\tonNav={onThreadPageNav} />\r\n\t\t\t\t<div className=\"replies\">\r\n\t\t\t\t\t{replies.length == 0 &&\r\n\t\t\t\t\t\t\"No replies yet\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{replies}\r\n\t\t\t\t</div>\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tmaxPage={threadInfo.pageCount}\r\n\t\t\t\t\tonNav={onThreadPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Post(props) {\r\n\tconst id = props.id;\r\n\tconst postInfo = props.postInfo;\r\n\tconst itemType = props.itemType;\r\n\tconst voteItem = props.voteItem;\r\n\tconst voteItemHolder = props.voteItemHolder;\r\n\tconst setVoteItemHolder = props.setVoteItemHolder;\r\n\tconst itemKey = props.itemKey;\r\n\tconst hasTitle = props.hasTitle;\r\n\tconst permaLink = props.permaLink;\r\n\tconst locked = props.locked;\r\n\tconst onReplyClick = props.onReplyClick;\r\n\tconst onDelete = props.onDelete;\r\n\tconst onRestore = props.onRestore;\r\n\tconst onEdit = props.onEdit;\r\n\tconst onNotifyToggled = props.onNotifyToggled;\r\n\tconst onPinToggled = props.onPinToggled;\r\n\tconst onLockToggled = props.onLockToggled;\r\n\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [editContent, setEditContent] = useState(postInfo.content);\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete this?\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(`/forums/${itemType}/delete`, { [itemType]: postInfo.id })\r\n\t\t\t.then(onDelete)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRestoreClick() {\r\n\t\taxios.post(`/forums/${itemType}/restore`, { [itemType]: postInfo.id })\r\n\t\t\t.then(onRestore)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onEditClick() {\r\n\t\tsetEditing(true);\r\n\t}\r\n\r\n\tfunction onEditSave() {\r\n\t\taxios.post(`/forums/${itemType}/edit`, {\r\n\t\t\t[itemType]: postInfo.id,\r\n\t\t\tcontent: editContent\r\n\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tsetEditing(false);\r\n\t\t\t\tonEdit();\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onEditCancel() {\r\n\t\tsetEditing(false);\r\n\t}\r\n\r\n\tfunction onPermaLinkClick() {\r\n\t\tnavigator.clipboard.writeText(window.location.origin + permaLink);\r\n\t}\r\n\r\n\tfunction onNotifyClick() {\r\n\t\taxios.post(`/forums/thread/notify`, { thread: postInfo.id })\r\n\t\t\t.then(onNotifyToggled)\r\n\t\t\t.catch(() => { });\r\n\t}\r\n\r\n\tfunction onTogglePinnedClick() {\r\n\t\taxios.post(`/forums/thread/togglePinned`, { thread: postInfo.id })\r\n\t\t\t.then(onPinToggled)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onToggleLockedClick() {\r\n\t\taxios.post(`/forums/thread/toggleLocked`, { thread: postInfo.id })\r\n\t\t\t.then(onLockToggled)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tvar content = postInfo.content;\r\n\r\n\tif (postInfo.deleted && user.settings.hideDeleted)\r\n\t\tcontent = \"*deleted*\";\r\n\r\n\treturn (\r\n\t\t<div className={`post span-panel ${postInfo.deleted ? \"deleted\" : \"\"} ${props.className}`} id={id}>\r\n\t\t\t<div className=\"vote-wrapper\">\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={voteItem}\r\n\t\t\t\t\titemType={itemType}\r\n\t\t\t\t\titemHolder={voteItemHolder}\r\n\t\t\t\t\tsetItemHolder={setVoteItemHolder}\r\n\t\t\t\t\titemKey={itemKey} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"main-wrapper\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t<div className=\"heading-left\">\r\n\t\t\t\t\t\t{hasTitle &&\r\n\t\t\t\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t\t\t\t{locked &&\r\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{postInfo.pinned &&\r\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-thumbtack\" />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{postInfo.title}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"post-info\">\r\n\t\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\t\tid={postInfo.author.id}\r\n\t\t\t\t\t\t\t\tname={postInfo.author.name}\r\n\t\t\t\t\t\t\t\tavatar={postInfo.author.avatar} />\r\n\t\t\t\t\t\t\t<div className=\"post-date\">\r\n\t\t\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\t\t\tmillisec={Date.now() - postInfo.postDate} />\r\n\t\t\t\t\t\t\t\t{\" ago\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"btns-wrapper\">\r\n\t\t\t\t\t\t{!postInfo.deleted &&\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && user.perms.pinThreads &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fas fa-thumbtack ${postInfo.pinned ? \"fa-rotate-180\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onTogglePinnedClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && user.perms.lockThreads &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fas fa-lock${postInfo.locked ? \"-open\" : \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onToggleLockedClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{(user.perms.deleteAnyPost || (user.perms.deleteOwnPost && postInfo.author.id == user.id)) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"fas fa-trash\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onDeleteClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{user.perms.editPost && postInfo.author.id == user.id && (!locked || user.perms.postInLocked) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"fas fa-pencil-alt\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onEditClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{itemType == \"thread\" && postInfo.author.id == user.id &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName={`fa${postInfo.replyNotify ? \"s\" : \"r\"} fa-bell`}\r\n\t\t\t\t\t\t\t\t\t\tonClick={onNotifyClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{permaLink &&\r\n\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\tto={permaLink}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => onPermaLinkClick()}>\r\n\t\t\t\t\t\t\t\t\t\t<i className=\"fas fa-link\" />\r\n\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t{user.perms.postReply && (!locked || user.perms.postInLocked) &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"reply-btn fas fa-reply\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={onReplyClick} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{postInfo.deleted && user.perms.restoreDeleted &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash-restore\"\r\n\t\t\t\t\t\t\t\tonClick={onRestoreClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{!editing &&\r\n\t\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t\t<ReactMarkdown source={content} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{editing &&\r\n\t\t\t\t\t<div className=\"edit-wrapper\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={editContent}\r\n\t\t\t\t\t\t\tonChange={setEditContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onEditSave}>\r\n\t\t\t\t\t\t\t\tSave\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-third\"\r\n\t\t\t\t\t\t\t\tonClick={onEditCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useReducer, useContext } from \"react\";\r\nimport { NavLink, Switch, Route, Redirect, useParams, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport Categories from \"./Categories\";\r\nimport Board from \"./Board\";\r\nimport Thread from \"./Thread\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { UserContext } from \"../../../Contexts\";\r\n\r\nimport \"../../../css/forums.css\";\r\n\r\nexport default function Forums() {\r\n\tconst [forumNavInfo, updateForumNavInfo] = useForumNavInfo();\r\n\r\n\treturn (\r\n\t\t<div className=\"forums\">\r\n\t\t\t<ForumNav forumNavInfo={forumNavInfo} />\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route exact path=\"/community/forums\" render={() => <Categories updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route exact path=\"/community/forums/board/:boardId\" render={() => <Board updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route exact path=\"/community/forums/thread/:threadId\" render={() => <Thread updateForumNavInfo={updateForumNavInfo} />} />\r\n\t\t\t\t<Route render={() => <Redirect to=\"/community/forums\" />} />\r\n\t\t\t</Switch>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ForumNav(props) {\r\n\tconst forumNavInfo = props.forumNavInfo;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel\">\r\n\t\t\t<div className=\"forum-nav\">\r\n\t\t\t\t<div className=\"path\">\r\n\t\t\t\t\t<NavLink to=\"/community/forums\">\r\n\t\t\t\t\t\t<i className=\"fas fa-home home\" />\r\n\t\t\t\t\t\tForums\r\n\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t{forumNavInfo.board &&\r\n\t\t\t\t\t\t<NavLink to={`/community/forums/board/${forumNavInfo.board.id}`}>\r\n\t\t\t\t\t\t\t<i className=\"fas fa-chevron-right separator\" />\r\n\t\t\t\t\t\t\t{forumNavInfo.board.name}\r\n\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{forumNavInfo.thread &&\r\n\t\t\t\t\t\t<NavLink to={`/community/forums/thread/${forumNavInfo.thread.id}`}>\r\n\t\t\t\t\t\t\t<i className=\"fas fa-chevron-right separator\" />\r\n\t\t\t\t\t\t\t{forumNavInfo.thread.title}\r\n\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction useForumNavInfo() {\r\n\treturn useReducer((info, action) => {\r\n\t\tvar newInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"board\":\r\n\t\t\t\tnewInfo = {\r\n\t\t\t\t\tboard: {\r\n\t\t\t\t\t\tid: action.id,\r\n\t\t\t\t\t\tname: action.name\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"thread\":\r\n\t\t\t\tnewInfo = {\r\n\t\t\t\t\tboard: {\r\n\t\t\t\t\t\tid: action.boardId,\r\n\t\t\t\t\t\tname: action.boardName\r\n\t\t\t\t\t},\r\n\t\t\t\t\tthread: {\r\n\t\t\t\t\t\tid: action.threadId,\r\n\t\t\t\t\t\ttitle: action.threadTitle\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"home\":\r\n\t\t\t\tnewInfo = {};\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newInfo || info;\r\n\t}, {});\r\n}\r\n\r\nexport function VoteWidget(props) {\r\n\tconst item = props.item;\r\n\tconst itemType = props.itemType;\r\n\tconst itemHolder = props.itemHolder;\r\n\tconst setItemHolder = props.setItemHolder;\r\n\tconst itemKey = props.itemKey;\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction updateItemVoteCount(direction, newDirection) {\r\n\t\tvar voteCount = item.voteCount;\r\n\r\n\t\tif (item.vote == 0)\r\n\t\t\tvoteCount += direction;\r\n\t\telse if (item.vote == direction)\r\n\t\t\tvoteCount += -1 * direction;\r\n\t\telse\r\n\t\t\tvoteCount += 2 * direction;\r\n\r\n\t\treturn update(item, {\r\n\t\t\tvote: {\r\n\t\t\t\t$set: newDirection\r\n\t\t\t},\r\n\t\t\tvoteCount: {\r\n\t\t\t\t$set: voteCount\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onVote(itemId, direction) {\r\n\t\tif (!user.perms.vote)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(\"/forums/vote\", {\r\n\t\t\titem: itemId,\r\n\t\t\titemType,\r\n\t\t\tdirection\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tvar newDirection = Number(res.data);\r\n\t\t\t\tvar newItem = updateItemVoteCount(direction, newDirection);\r\n\t\t\t\tvar items;\r\n\r\n\t\t\t\tif (itemHolder == null) {\r\n\t\t\t\t\tsetItemHolder(newItem);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (itemKey)\r\n\t\t\t\t\titems = itemHolder[itemKey];\r\n\t\t\t\telse\r\n\t\t\t\t\titems = itemHolder;\r\n\r\n\t\t\t\tfor (let i in items) {\r\n\t\t\t\t\tif (items[i].id == itemId) {\r\n\t\t\t\t\t\tvar newItems = items.slice();\r\n\t\t\t\t\t\tnewItems[i] = newItem;\r\n\r\n\t\t\t\t\t\tif (itemKey) {\r\n\t\t\t\t\t\t\tsetItemHolder(update(itemHolder, {\r\n\t\t\t\t\t\t\t\t[itemKey]: {\r\n\t\t\t\t\t\t\t\t\t$set: newItems\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tsetItemHolder(newItems);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"vote-widget\">\r\n\t\t\t<i\r\n\t\t\t\tclassName={`fas fa-arrow-up ${item.vote == 1 && \"sel\"}`}\r\n\t\t\t\tonClick={() => onVote(item.id, 1)} />\r\n\t\t\t{item.voteCount || 0}\r\n\t\t\t<i className={`fas fa-arrow-down ${item.vote == -1 && \"sel\"}`}\r\n\t\t\t\tonClick={() => onVote(item.id, -1)} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ViewsAndReplies(props) {\r\n\tconst viewCount = props.viewCount;\r\n\tconst replyCount = props.replyCount;\r\n\r\n\tconst viewsPlural = viewCount != 1;\r\n\tconst repliesPlural = replyCount != 1;\r\n\r\n\treturn `${viewCount} view${viewsPlural ? \"s\" : \"\"}, ${replyCount} repl${repliesPlural ? \"ies\" : \"y\"}`;\r\n}","import React, { useState, useContext, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { VoteWidget } from \"./Forums/Forums\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\nimport { Time, filterProfanity } from \"../../components/Basic\";\r\nimport { PageNav } from \"../../components/Nav\";\r\nimport { TextEditor } from \"../../components/Form\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport LoadingPage from \"../Loading\";\r\n\r\nimport \"../../css/forums.css\";\r\nimport \"../../css/comments.css\";\r\n\r\nexport default function Comments(props) {\r\n\tconst location = props.location;\r\n\r\n\tconst [page, setPage] = useState(1);\r\n\tconst [comments, setComments] = useState([]);\r\n\tconst [showInput, setShowInput] = useState(false);\r\n\tconst [postContent, setPostContent] = useState(\"\");\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tsetComments([]);\r\n\t\tonCommentsPageNav(1);\r\n\t}, [location]);\r\n\r\n\tfunction onCommentsPageNav(_page) {\r\n\t\tvar filterArg;\r\n\r\n\t\tif (_page == 1)\r\n\t\t\tfilterArg = \"last=Infinity\";\r\n\t\telse if (_page < page && comments.length != 0)\r\n\t\t\tfilterArg = `first=${comments[0].date}`;\r\n\t\telse if (_page > page && comments.length != 0)\r\n\t\t\tfilterArg = `last=${comments[comments.length - 1].date}`;\r\n\t\telse\r\n\t\t\treturn;\r\n\r\n\t\taxios.get(`/comment?location=${location}&${filterArg}`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetLoaded(true);\r\n\r\n\t\t\t\tif (res.data.length > 0) {\r\n\t\t\t\t\tfor (let comment of res.data)\r\n\t\t\t\t\t\tcomment.content = filterProfanity(comment.content, user.settings, \"\\\\*\");\r\n\r\n\t\t\t\t\tsetComments(res.data);\r\n\t\t\t\t\tsetPage(_page);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostSubmit() {\r\n\t\taxios.post(\"/comment\", { content: postContent, location })\r\n\t\t\t.then(() => {\r\n\t\t\t\tonCommentsPageNav(1);\r\n\t\t\t\tsetPostContent(\"\");\r\n\t\t\t\tsetShowInput(false);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onPostCancel() {\r\n\t\tsetShowInput(false);\r\n\t}\r\n\r\n\tconst commentRows = comments.map(comment => (\r\n\t\t<Comment\r\n\t\t\tcomment={comment}\r\n\t\t\tcomments={comments}\r\n\t\t\tsetComments={setComments}\r\n\t\t\tonDelete={() => onCommentsPageNav(page)}\r\n\t\t\tonRestore={() => onCommentsPageNav(page)}\r\n\t\t\tkey={comment.id} />\r\n\t));\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage className=\"under\" />;\r\n\r\n\treturn (\r\n\t\t<div className=\"comments-wrapper thread-wrapper\">\r\n\t\t\t<div className=\"comments-input-wrapper\">\r\n\t\t\t\t{!showInput && user.loggedIn && user.perms.postReply &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme\"\r\n\t\t\t\t\t\tonClick={() => setShowInput(true)}>\r\n\t\t\t\t\t\tPost Comment\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{showInput &&\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"reply-form span-panel\">\r\n\t\t\t\t\t\t<TextEditor\r\n\t\t\t\t\t\t\tvalue={postContent}\r\n\t\t\t\t\t\t\tonChange={setPostContent} />\r\n\t\t\t\t\t\t<div className=\"post-btn-wrapper\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"post-reply btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onPostSubmit}>\r\n\t\t\t\t\t\t\t\tPost\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn-theme-sec\"\r\n\t\t\t\t\t\t\t\tonClick={onPostCancel}>\r\n\t\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"comments-page\">\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onCommentsPageNav} />\r\n\t\t\t\t{comments.length == 0 &&\r\n\t\t\t\t\t\"No comments yet\"\r\n\t\t\t\t}\r\n\t\t\t\t{commentRows}\r\n\t\t\t\t<PageNav\r\n\t\t\t\t\tinverted\r\n\t\t\t\t\tpage={page}\r\n\t\t\t\t\tonNav={onCommentsPageNav} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Comment(props) {\r\n\tconst comment = props.comment;\r\n\tconst comments = props.comments;\r\n\tconst setComments = props.setComments;\r\n\tconst onDelete = props.onDelete;\r\n\tconst onRestore = props.onRestore;\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tconst shouldDelete = window.confirm(\"Are you sure you wish to delete this?\");\r\n\r\n\t\tif (!shouldDelete)\r\n\t\t\treturn;\r\n\r\n\t\taxios.post(`/comment/delete`, { comment: comment.id })\r\n\t\t\t.then(onDelete)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onRestoreClick() {\r\n\t\taxios.post(`/comment/restore`, { comment: comment.id })\r\n\t\t\t.then(onRestore)\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tvar content = comment.content;\r\n\r\n\tif (comment.deleted && user.settings.hideDeleted)\r\n\t\tcontent = \"*deleted*\";\r\n\r\n\treturn (\r\n\t\t<div className={`post ${comment.deleted ? \"deleted\" : \"\"} ${props.className || \"\"}`}>\r\n\t\t\t<div className=\"vote-wrapper\">\r\n\t\t\t\t<VoteWidget\r\n\t\t\t\t\titem={comment}\r\n\t\t\t\t\titemHolder={comments}\r\n\t\t\t\t\tsetItemHolder={setComments}\r\n\t\t\t\t\titemType=\"comment\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"main-wrapper\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\t<div className=\"heading-left\">\r\n\t\t\t\t\t\t<div className=\"post-info\">\r\n\t\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\t\tid={comment.author.id}\r\n\t\t\t\t\t\t\t\tname={comment.author.name}\r\n\t\t\t\t\t\t\t\tavatar={comment.author.avatar} />\r\n\t\t\t\t\t\t\t<div className=\"post-date\">\r\n\t\t\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\t\t\tminSec\r\n\t\t\t\t\t\t\t\t\tmillisec={Date.now() - comment.date} />\r\n\t\t\t\t\t\t\t\t{\" ago\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"btns-wrapper\">\r\n\t\t\t\t\t\t{!comment.deleted && (user.perms.deleteAnyPost || (user.perms.deleteOwnPost && comment.author.id == user.id)) &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash\"\r\n\t\t\t\t\t\t\t\tonClick={onDeleteClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{comment.deleted && user.perms.restoreDeleted &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"fas fa-trash-restore\"\r\n\t\t\t\t\t\t\t\tonClick={onRestoreClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"md-content\">\r\n\t\t\t\t\t<ReactMarkdown source={content} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useContext, useRef } from \"react\";\r\nimport { Link, Redirect, useLocation, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, PopoverContext, SiteInfoContext } from \"../../Contexts\"\r\nimport Setup from \"../../components/Setup\"\r\nimport { ButtonGroup, PageNav, SubNav } from \"../../components/Nav\"\r\nimport { ItemList } from \"../../components/Basic\"\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { camelCase } from \"../../utils\"\r\nimport LoadingPage from \"../Loading\";\r\nimport LandingPage from \"../Landing\";\r\nimport Comments from \"../Community/Comments\";\r\nimport { Lobbies } from \"../../Constants\";\r\n\r\nimport \"../../css/join.css\";\r\nimport { TopBarLink } from \"./Play\";\r\n\r\nexport default function Join(props) {\r\n    const defaultLobby = \"Main\";\r\n    const gameListButtons = [\"All\", \"Open\", \"In Progress\", \"Finished\"];\r\n\r\n    const [listType, setListType] = useState(\"All\");\r\n    const [page, setPage] = useState(1);\r\n    const [games, setGames] = useState([]);\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n\r\n    const user = useContext(UserContext);\r\n    const errorAlert = useErrorAlert();\r\n    const params = new URLSearchParams(location.search);\r\n    const [lobby, setLobby] = useState(params.get(\"lobby\") || localStorage.getItem(\"lobby\") || defaultLobby);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(\"lobby\", lobby);\r\n\r\n        if (params.get(\"lobby\") != lobby)\r\n            history.push(location.pathname + `?lobby=${lobby}`);\r\n\r\n        document.title = `Play (${lobby}) | BeyondMafia`;\r\n        getGameList(listType, 1);\r\n    }, [location.pathname, lobby]);\r\n\r\n    function getGameList(_listType, _page) {\r\n        var filterArg;\r\n\r\n        if (_page == 1)\r\n            filterArg = \"last=Infinity&page=1\";\r\n        else if (_page < page && games.length != 0)\r\n            filterArg = `first=${games[0].endTime}&page=${_page}`;\r\n        else if (_page > page && games.length != 0)\r\n            filterArg = `last=${games[games.length - 1].endTime}&page=${_page}`;\r\n        else\r\n            return;\r\n\r\n        axios.get(`/game/list?list=${camelCase(_listType)}&lobby=${lobby}&${filterArg}`)\r\n            .then(res => {\r\n                if (res.data.length > 0 || _page == 1) {\r\n                    setListType(_listType);\r\n                    setPage(_page);\r\n                    setGames(res.data);\r\n                }\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    if (Lobbies.indexOf(lobby) == -1)\r\n        setLobby(defaultLobby);\r\n\r\n    if (!user.loaded)\r\n        return <LoadingPage />;\r\n\r\n    if (user.loaded && !user.loggedIn)\r\n        return <LandingPage />;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"span-panel main join\">\r\n                <div className=\"left-panel\">\r\n\r\n                </div>\r\n                <div className=\"right-panel\">\r\n                    <div className=\"top-bar lobby-list\">\r\n                        <TopBarLink\r\n                            text=\"Main\"\r\n                            sel={lobby}\r\n                            onClick={() => setLobby(\"Main\")} />\r\n                        <TopBarLink\r\n                            text=\"Sandbox\"\r\n                            sel={lobby}\r\n                            onClick={() => setLobby(\"Sandbox\")} />\r\n                        <TopBarLink\r\n                            text=\"Competitive\"\r\n                            sel={lobby}\r\n                            onClick={() => setLobby(\"Competitive\")} />\r\n                        <TopBarLink\r\n                            text=\"Games\"\r\n                            sel={lobby}\r\n                            onClick={() => setLobby(\"Games\")} />\r\n                    </div>\r\n                    <ItemList\r\n                        className=\"games\"\r\n                        items={games}\r\n                        map={game => (\r\n                            <GameRow\r\n                                game={game}\r\n                                lobby={lobby}\r\n                                refresh={() => getGameList(listType, page)}\r\n                                odd={games.indexOf(game) % 2 == 1}\r\n                                key={game.id} />\r\n                        )}\r\n                        empty=\"No games\" />\r\n                    <PageNav\r\n                        page={page}\r\n                        onNav={(page) => getGameList(listType, page)} />\r\n                </div>\r\n            </div>\r\n            <Comments location={lobby == \"Main\" ? \"lobby\" : `lobby-${lobby}`} />\r\n        </>\r\n    );\r\n}\r\n\r\nexport function GameRow(props) {\r\n    const [redirect, setRedirect] = useState(false);\r\n    const [reserved, setReserved] = useState(props.game.reserved);\r\n\r\n    const infoRef = useRef();\r\n    const user = useContext(UserContext);\r\n    const popover = useContext(PopoverContext);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n\r\n    function onInfoClick(e) {\r\n        e.stopPropagation();\r\n        popover.onClick(\r\n            `/game/${props.game.id}/info`,\r\n            \"game\",\r\n            infoRef.current,\r\n            `Game ${props.game.id}`,\r\n        );\r\n    }\r\n\r\n    var linkPath, buttonText;\r\n    var buttonClass = \"btn \";\r\n\r\n    switch (props.game.status) {\r\n        case \"Open\":\r\n            linkPath = `/game/${props.game.id}`;\r\n            buttonClass += \"btn-join\";\r\n\r\n            if (props.game.scheduled <= Date.now())\r\n                buttonText = \"Join\";\r\n            break;\r\n        case \"In Progress\":\r\n            if (props.game.spectating || user.perms.canSpectateAny) {\r\n                linkPath = `/game/${props.game.id}`;\r\n                buttonClass += \"btn-spectate\";\r\n                buttonText = \"Spectate\";\r\n            }\r\n            else {\r\n                linkPath = \"/play\";\r\n                buttonClass += \"btn-in-progress\";\r\n                buttonText = \"In Progress\";\r\n            }\r\n            break;\r\n        case \"Finished\":\r\n            linkPath = `/game/${props.game.id}/review`;\r\n            buttonClass += \"btn-review\";\r\n            buttonText = \"Review\";\r\n            break;\r\n    }\r\n\r\n    function onRehostClick() {\r\n        var stateLengths = {};\r\n\r\n        for (let stateName in props.game.stateLengths)\r\n            stateLengths[stateName] = props.game.stateLengths[stateName] / 60000;\r\n\r\n        axios.post(\"/game/host\", {\r\n            gameType: props.game.type,\r\n            setup: props.game.setup.id,\r\n            lobby: props.lobby,\r\n            guests: props.game.guests,\r\n            private: false,\r\n            ranked: props.game.ranked,\r\n            spectating: props.game.spectating,\r\n            voiceChat: props.game.voiceChat,\r\n            readyCheck: props.game.readyCheck,\r\n            stateLengths: stateLengths,\r\n            ...JSON.parse(props.game.gameTypeOptions)\r\n        })\r\n            .then(res => setRedirect(`/game/${res.data}`))\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onReserve() {\r\n        axios.post(\"/game/reserve\", { gameId: props.game.id })\r\n            .then(res => {\r\n                setReserved(!reserved);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    function onUnreserve() {\r\n        axios.post(\"/game/unreserve\", { gameId: props.game.id })\r\n            .then(res => {\r\n                setReserved(!reserved);\r\n                siteInfo.showAlert(res.data, \"success\");\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n    function onCancel() {\r\n        axios.post(\"/game/cancel\", { gameId: props.game.id })\r\n            .then(res => {\r\n                siteInfo.showAlert(res.data, \"success\");\r\n                props.refresh();\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    if (!props.game.setup)\r\n        return <></>;\r\n\r\n    return (\r\n        <div className={`row ${props.odd ? \"odd\" : \"\"}`}>\r\n            <div className=\"btns-wrapper\">\r\n                {(user.loggedIn || props.type == \"Finished\") && !props.game.broken && !props.game.private && buttonText &&\r\n                    <Link\r\n                        to={linkPath}\r\n                        className={buttonClass}\r\n                        disabled={props.type == \"In Progress\" && !props.game.spectating}>\r\n                        {buttonText}\r\n                    </Link>\r\n                }\r\n                {user.loggedIn && props.game.scheduled > Date.now() && !reserved &&\r\n                    <div\r\n                        className=\"btn btn-theme\"\r\n                        onClick={onReserve}>\r\n                        Reserve\r\n                    </div>\r\n                }\r\n                {user.loggedIn && props.game.scheduled > Date.now() && reserved &&\r\n                    <div\r\n                        className=\"btn btn-theme\"\r\n                        onClick={onUnreserve}>\r\n                        Unreserve\r\n                    </div>\r\n                }\r\n                {props.game.scheduled > Date.now() && user.id == props.game.hostId &&\r\n                    <div\r\n                        className=\"btn btn-theme-sec\"\r\n                        onClick={onCancel}>\r\n                        Cancel\r\n                    </div>\r\n                }\r\n                {props.game.broken &&\r\n                    <i className=\"fas fa-car-crash review-icon\" title=\"Broken\" />\r\n                }\r\n                {props.game.private &&\r\n                    <i className=\"fas fa-lock review-icon\" title=\"Private\" />\r\n                }\r\n            </div>\r\n            <div className=\"player-count-wrapper\">\r\n                {props.type != \"Finished\" &&\r\n                    <PlayerCount game={props.game} />\r\n                }\r\n                {props.type == \"Finished\" && user.loggedIn && !props.smallSetup &&\r\n                    <div\r\n                        className=\"btn btn-rehost\"\r\n                        onClick={onRehostClick}>\r\n                        Rehost\r\n                    </div>\r\n                }\r\n            </div>\r\n            <div className=\"setup-wrapper\">\r\n                <Setup\r\n                    setup={props.game.setup}\r\n                    maxRolesCount={props.smallSetup ? 3 : 5} />\r\n            </div>\r\n            {!props.smallSetup &&\r\n                <div className=\"setup-name\">\r\n                    {props.game.setup.name}\r\n                </div>\r\n            }\r\n            <div className=\"game-infos\">\r\n                {props.game.ranked &&\r\n                    <i\r\n                        className=\"ranked fas fa-chart-bar\"\r\n                        title=\"Ranked game\" />\r\n                }\r\n                {props.game.voiceChat &&\r\n                    <i\r\n                        className=\"voice-chat fas fa-microphone\"\r\n                        title=\"Voice chat game\" />\r\n                }\r\n                {props.game.status == \"Finished\" && user.loggedIn && !props.smallSetup &&\r\n                    <i\r\n                        className=\"rehost fas fa-redo\"\r\n                        title=\"Rehost\"\r\n                        onClick={onRehostClick} />\r\n                }\r\n                <i\r\n                    className=\"game-info fas fa-info-circle\"\r\n                    ref={infoRef}\r\n                    onClick={onInfoClick} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction PlayerCount(props) {\r\n    const game = props.game;\r\n    const circles = [];\r\n\r\n    for (let i = 0; i < game.setup.total; i++) {\r\n        circles.push(\r\n            <div\r\n                className={`player-circle ${i < game.players ? \"filled\" : \"\"}`}\r\n                key={i} />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"player-count\">\r\n            {circles}\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useLocation, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../../Contexts\";\r\nimport { ButtonGroup, PageNav, SearchBar } from \"../../../components/Nav\";\r\nimport Setup from \"../../../components/Setup\";\r\nimport Form from \"../../../components/Form\";\r\nimport { ItemList, filterProfanity } from \"../../../components/Basic\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { camelCase } from \"../../../utils\";\r\n\r\nimport \"../../../css/host.css\";\r\nimport { TopBarLink } from \"../Play\";\r\n\r\nexport default function Host(props) {\r\n    const gameType = props.gameType;\r\n    const selSetup = props.selSetup;\r\n    const setSelSetup = props.setSelSetup;\r\n    const formFields = props.formFields;\r\n    const updateFormFields = props.updateFormFields;\r\n    const onHostGame = props.onHostGame;\r\n\r\n    const [listType, setListType] = useState(\"featured\");\r\n    const [page, setPage] = useState(1);\r\n    const [pageCount, setPageCount] = useState(1);\r\n    const [searchVal, setSearchVal] = useState(\"\");\r\n    const [setups, setSetups] = useState([]);\r\n\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n    const errorAlert = useErrorAlert();\r\n\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(location.search);\r\n\r\n        if (params.get(\"setup\")) {\r\n            getSetupList(\"id\", 1, params.get(\"setup\"));\r\n\r\n            axios.get(`/setup/${params.get(\"setup\")}`)\r\n                .then(res => {\r\n                    res.data.name = filterProfanity(res.data.name, user.settings);\r\n                    setSelSetup(res.data);\r\n                })\r\n                .catch(errorAlert);\r\n        }\r\n        else\r\n            getSetupList(listType, page)\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        updateFormFields({\r\n            ref: \"setup\",\r\n            prop: \"value\",\r\n            value: selSetup.name\r\n        });\r\n    }, [selSetup]);\r\n\r\n    function getSetupList(listType, page, query) {\r\n        axios.get(`/setup/${camelCase(listType)}?gameType=${props.gameType}&page=${page}&query=${query || \"\"}`)\r\n            .then(res => {\r\n                setListType(listType);\r\n                setPage(page);\r\n                setSetups(res.data.setups);\r\n                setPageCount(res.data.pages);\r\n            });\r\n    }\r\n\r\n    function onHostNavClick(listType) {\r\n        setSearchVal(\"\");\r\n        getSetupList(listType, 1);\r\n    }\r\n\r\n    function onSearchInput(query) {\r\n        setSearchVal(query);\r\n\r\n        if (query.length)\r\n            getSetupList(\"search\", 1, query);\r\n        else\r\n            getSetupList(\"featured\", 1);\r\n    }\r\n\r\n    function onPageNav(page) {\r\n        var args = [listType, page];\r\n\r\n        if (searchVal.length)\r\n            args.append(searchVal);\r\n\r\n        getSetupList(...args);\r\n    }\r\n\r\n    function onFavSetup(favSetup) {\r\n        axios.post(\"/setup/favorite\", { id: favSetup.id })\r\n            .catch(errorAlert);\r\n\r\n        var newSetups = [...setups];\r\n\r\n        for (let i in setups) {\r\n            if (setups[i].id == favSetup.id) {\r\n                newSetups[i].favorite = !setups[i].favorite;\r\n                break;\r\n            }\r\n        }\r\n\r\n        setSetups(newSetups);\r\n    }\r\n\r\n    function onEditSetup(setup) {\r\n        history.push(`/play/create?edit=${setup.id}`);\r\n    }\r\n\r\n    function onDelSetup(setup) {\r\n        axios.post(\"/setup/delete\", { id: setup.id })\r\n            .then(() => {\r\n                getSetupList(listType, page);\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    const hostButtonLabels = [\"Featured\", \"Popular\", \"Favorites\", \"Yours\"];\r\n    const hostButtons = hostButtonLabels.map(label => (\r\n        <TopBarLink\r\n            text={label}\r\n            sel={listType}\r\n            onClick={() => onHostNavClick(label)}\r\n            key={label} />\r\n    ));\r\n\r\n    return (\r\n        <div className=\"span-panel main host\">\r\n            <div className=\"top-bar\">\r\n                {hostButtons}\r\n                <SearchBar value={searchVal} placeholder=\"Setup Name\" onInput={onSearchInput} />\r\n            </div>\r\n            <ItemList\r\n                items={setups}\r\n                map={setup => (\r\n                    <SetupRow\r\n                        setup={setup}\r\n                        sel={selSetup}\r\n                        listType={listType}\r\n                        onSelect={setSelSetup}\r\n                        onFav={onFavSetup}\r\n                        onEdit={onEditSetup}\r\n                        onDel={onDelSetup}\r\n                        odd={setups.indexOf(setup) % 2 == 1}\r\n                        key={setup.id} />\r\n                )}\r\n                empty=\"No setups\" />\r\n            <PageNav\r\n                page={page}\r\n                maxPage={pageCount}\r\n                onNav={onPageNav} />\r\n            {user.loggedIn &&\r\n                <Form\r\n                    fields={formFields}\r\n                    onChange={updateFormFields}\r\n                    submitText=\"Host\"\r\n                    onSubmit={onHostGame} />\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nfunction SetupRow(props) {\r\n    const user = useContext(UserContext);\r\n\r\n    let selIconFormat = \"far\";\r\n    let favIconFormat = \"far\";\r\n\r\n    if (props.sel.id == props.setup.id)\r\n        selIconFormat = \"fas\";\r\n\r\n    if (props.setup.favorite)\r\n        favIconFormat = \"fas\";\r\n\r\n    return (\r\n        <div className={`row ${props.odd ? \"odd\" : \"\"}`}>\r\n            {user.loggedIn &&\r\n                <i\r\n                    className={`select-setup fa-circle ${selIconFormat}`}\r\n                    onClick={() => props.onSelect(props.setup)} />\r\n            }\r\n            <div className=\"setup-wrapper\">\r\n                <Setup setup={props.setup} />\r\n            </div>\r\n            <div className=\"setup-name\">\r\n                {props.setup.name}\r\n            </div>\r\n            {user.loggedIn &&\r\n                <i\r\n                    className={`setup-btn fav-setup fa-star ${favIconFormat}`}\r\n                    onClick={() => props.onFav(props.setup)} />\r\n            }\r\n            {user.loggedIn && props.listType == \"Yours\" &&\r\n                <i\r\n                    className={`setup-btn edit-setup fa-pen-square fas`}\r\n                    onClick={() => props.onEdit(props.setup)} />\r\n            }\r\n            {user.loggedIn && props.listType == \"Yours\" &&\r\n                <i\r\n                    className={`setup-btn del-setup fa-times-circle fas`}\r\n                    onClick={() => props.onDel(props.setup)} />\r\n            }\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostMafia() {\r\n    const gameType = \"Mafia\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\",\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\",\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Ranked\",\r\n            ref: \"ranked\",\r\n            type: \"boolean\",\r\n            showIf: [\"!private\", \"!spectating\", \"!voiceChat\", \"!guests\"]\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\",\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Voice Chat\",\r\n            ref: \"voiceChat\",\r\n            type: \"boolean\",\r\n            showIf: \"!ranked\"\r\n        },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Day Length (minutes)\",\r\n            ref: \"dayLength\",\r\n            type: \"number\",\r\n            value: 10,\r\n            min: 1,\r\n            max: 30\r\n        },\r\n        {\r\n            label: \"Night Length (minutes)\",\r\n            ref: \"nightLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 10\r\n        },\r\n        {\r\n            label: \"Extension Length (minutes)\",\r\n            ref: \"extendLength\",\r\n            type: \"number\",\r\n            value: 3,\r\n            min: 1,\r\n            max: 5\r\n        }\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Mafia | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = getFormFieldValue(\"scheduled\");\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                ranked: getFormFieldValue(\"ranked\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Day\": getFormFieldValue(\"dayLength\"),\r\n                    \"Night\": getFormFieldValue(\"nightLength\")\r\n                },\r\n                extendLength: getFormFieldValue(\"extendLength\"),\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useState, useEffect, useReducer, useContext } from \"react\";\r\nimport { Redirect, useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../../Contexts\";\r\nimport { RoleCount, RoleSearch } from \"../../../components/Roles\";\r\nimport Form from \"../../../components/Form\";\r\nimport LoadingPage from \"../../Loading\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nimport \"../../../css/createSetup.css\";\r\n\r\nexport default function CreateSetup(props) {\r\n\tconst gameType = props.gameType;\r\n\tconst formFields = props.formFields;\r\n\tconst updateFormFields = props.updateFormFields;\r\n\tconst closedField = props.closedField;\r\n\tconst resetFormFields = props.resetFormFields;\r\n\tconst formFieldValueMods = props.formFieldValueMods;\r\n\tconst onCreateSetup = props.onCreateSetup;\r\n\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [selRoleSet, setSelRoleSet] = useState(0);\r\n\tconst [redirect, setRedirect] = useState(\"\");\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [modifier, setModifier] = useState(\"None\");\r\n\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tconst [roleData, updateRoleData] = useReducer((roleData, action) => {\r\n\t\tvar newRoleData = { ...roleData };\r\n\r\n\t\tif (action.type != \"reset\" && action.type != \"setClosed\") {\r\n\t\t\tnewRoleData.roles = roleData.roles.slice();\r\n\r\n\t\t\tfor (let i in roleData.roles)\r\n\t\t\t\tnewRoleData.roles[i] = { ...roleData.roles[i] }\r\n\t\t}\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"reset\":\r\n\t\t\t\tnewRoleData.roles = [{}];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setClosed\":\r\n\t\t\t\tnewRoleData.closed = action.closed;\r\n\r\n\t\t\t\tif (action.closed)\r\n\t\t\t\t\tnewRoleData.roles = newRoleData.roles.slice(0, 1);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addRole\":\r\n\t\t\t\tvar roleSet = newRoleData.roles[selRoleSet];\r\n\r\n\t\t\t\tif (!roleSet[action.role])\r\n\t\t\t\t\troleSet[action.role] = 0;\r\n\r\n\t\t\t\troleSet[action.role]++;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeRole\":\r\n\t\t\t\tvar roleSet = newRoleData.roles[selRoleSet];\r\n\r\n\t\t\t\tif (roleSet[action.role])\r\n\t\t\t\t\troleSet[action.role]--;\r\n\r\n\t\t\t\tif (roleSet[action.role] < 1)\r\n\t\t\t\t\tdelete roleSet[action.role];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addRoleSet\":\r\n\t\t\t\tnewRoleData.roles.push({});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeRoleSet\":\r\n\t\t\t\tnewRoleData.roles.splice(action.index, 1);\r\n\r\n\t\t\t\tif (action.index == selRoleSet)\r\n\t\t\t\t\tsetSelRoleSet(0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setFromSetup\":\r\n\t\t\t\tnewRoleData.closed = action.closed;\r\n\t\t\t\tnewRoleData.roles = action.roles;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newRoleData;\r\n\t}, { roles: [{}], closed: false });\r\n\r\n\tconst user = useContext(UserContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdateRoleData({ type: \"setClosed\", closed: closedField.value });\r\n\t}, [closedField.value]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (params.get(\"edit\")) {\r\n\t\t\taxios.get(`/setup/${params.get(\"edit\")}`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tvar setup = res.data;\r\n\r\n\t\t\t\t\tsetEditing(true);\r\n\r\n\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\ttype: \"setFromSetup\",\r\n\t\t\t\t\t\troles: JSON.parse(setup.roles),\r\n\t\t\t\t\t\tclosed: setup.closed\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar formFieldChanges = [];\r\n\r\n\t\t\t\t\tfor (let field of formFields) {\r\n\t\t\t\t\t\tif (setup[field.ref]) {\r\n\t\t\t\t\t\t\tlet value = setup[field.ref];\r\n\r\n\t\t\t\t\t\t\tif (formFieldValueMods[field.ref])\r\n\t\t\t\t\t\t\t\tfor (let valueMod of formFieldValueMods[field.ref])\r\n\t\t\t\t\t\t\t\t\tvalue = valueMod(value);\r\n\r\n\t\t\t\t\t\t\tformFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: field.ref,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: value\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (setup.closed) {\r\n\t\t\t\t\t\tfor (let alignment in setup.count) {\r\n\t\t\t\t\t\t\tformFieldChanges.push({\r\n\t\t\t\t\t\t\t\tref: `count-${alignment}`,\r\n\t\t\t\t\t\t\t\tprop: \"value\",\r\n\t\t\t\t\t\t\t\tvalue: setup.count[alignment]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tupdateFormFields(formFieldChanges);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(errorAlert);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tfunction onAddRole(role) {\r\n\t\tupdateRoleData({\r\n\t\t\ttype: \"addRole\",\r\n\t\t\trole: `${role.name}:${modifier != \"None\" ? modifier : \"\"}`,\r\n\t\t\talignment: role.alignment\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onModifierChange(e) {\r\n\t\tvar modifier = e.target.value;\r\n\t\tsetModifier(modifier);\r\n\t}\r\n\r\n\tif (editing && !params.get(\"edit\")) {\r\n\t\tsetEditing(false);\r\n\t\tresetFormFields();\r\n\t\tupdateRoleData({ type: \"reset\" });\r\n\t}\r\n\r\n\tvar roleSets;\r\n\r\n\troleSets = roleData.roles.map((roleSet, i) => {\r\n\t\tlet roles = [];\r\n\r\n\t\tfor (let role in roleSet) {\r\n\t\t\troles.push(\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\trole={role}\r\n\t\t\t\t\tcount={roleSet[role]}\r\n\t\t\t\t\tgameType={gameType}\r\n\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\t\t\ttype: \"removeRole\",\r\n\t\t\t\t\t\t\t\trole: role\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkey={role} />\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<RoleSetRow\r\n\t\t\t\troles={roles}\r\n\t\t\t\tindex={i}\r\n\t\t\t\tsel={selRoleSet}\r\n\t\t\t\tonClick={() => setSelRoleSet(i)}\r\n\t\t\t\tonDelete={\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tupdateRoleData({\r\n\t\t\t\t\t\t\ttype: \"removeRoleSet\",\r\n\t\t\t\t\t\t\tindex: i\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tkey={i} />\r\n\t\t);\r\n\t});\r\n\r\n\tvar modifiers = siteInfo.roles ? siteInfo.roles[\"Modifiers\"][gameType] : [];\r\n\r\n\tmodifiers = modifiers.map(modifier => (\r\n\t\t<option value={modifier} key={modifier}>\r\n\t\t\t{modifier}\r\n\t\t</option>\r\n\t));\r\n\r\n\tmodifiers.unshift((\r\n\t\t<option value=\"None\" key={\"None\"}>\r\n\t\t\tNone\r\n\t\t</option>\r\n\t));\r\n\r\n\tif ((params.get(\"edit\") && !editing))\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main create-setup\">\r\n\t\t\t<RoleSearch\r\n\t\t\t\tonAddClick={onAddRole}\r\n\t\t\t\tgameType={gameType} />\r\n\t\t\t{user.loggedIn &&\r\n\t\t\t\t(\r\n\t\t\t\t\t<div className=\"creation-options\">\r\n\t\t\t\t\t\t<Form\r\n\t\t\t\t\t\t\tfields={formFields}\r\n\t\t\t\t\t\t\tonChange={updateFormFields}\r\n\t\t\t\t\t\t\tsubmitText={editing ? \"Edit\" : \"Create\"}\r\n\t\t\t\t\t\t\tonSubmit={() => onCreateSetup(roleData, editing, setRedirect)} />\r\n\t\t\t\t\t\t<div className=\"rolesets-wrapper\">\r\n\t\t\t\t\t\t\t<div className=\"form\">\r\n\t\t\t\t\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\t\t\t\t\tRole Modifier\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tvalue={modifier}\r\n\t\t\t\t\t\t\t\t\t\tonChange={onModifierChange}>\r\n\t\t\t\t\t\t\t\t\t\t{modifiers}\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"rolesets\">\r\n\t\t\t\t\t\t\t\t{roleSets}\r\n\t\t\t\t\t\t\t\t{!roleData.closed && roleData.roles.length < 10 &&\r\n\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"add-roleset fa-plus-circle fas\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => updateRoleData({ type: \"addRoleSet\" })} />\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\r\n\t\t\t}\r\n\t\t\t{redirect &&\r\n\t\t\t\t<Redirect to={`/play/host/?setup=${redirect}`} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction RoleSetRow(props) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`roleset ${props.sel == props.index ? \"sel\" : \"\"}`}\r\n\t\t\tonClick={props.onClick}>\r\n\t\t\t{props.roles}\r\n\t\t\t{props.index > 0 &&\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName=\"del-roleset fa-times-circle fas\"\r\n\t\t\t\t\tonClick={props.onDelete} />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateMafiaSetup() {\r\n\tconst gameType = \"Mafia\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Day Start\",\r\n\t\t\tref: \"startState\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Dawn\",\r\n\t\t\tref: \"dawn\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Last Wills\",\r\n\t\t\tref: \"lastWill\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Must Act\",\r\n\t\t\tref: \"mustAct\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"No Reveal\",\r\n\t\t\tref: \"noReveal\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Votes Invisible\",\r\n\t\t\tref: \"votesInvisible\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Village Count\",\r\n\t\t\tref: \"count-Village\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"7\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Mafia Count\",\r\n\t\t\tref: \"count-Mafia\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Monsters Count\",\r\n\t\t\tref: \"count-Monsters\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"0\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\r\n\tconst formFieldValueMods = {\r\n\t\tstartState: [\r\n\t\t\tvalue => value == \"Day\"\r\n\t\t]\r\n\t};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Mafia Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: formFields[1].value ? \"Day\" : \"Night\",\r\n\t\t\tdawn: formFields[2].value,\r\n\t\t\twhispers: formFields[3].value,\r\n\t\t\tleakPercentage: Number(formFields[4].value),\r\n\t\t\tlastWill: formFields[5].value,\r\n\t\t\tmustAct: formFields[6].value,\r\n\t\t\tnoReveal: formFields[7].value,\r\n\t\t\tvotesInvisible: formFields[8].value,\r\n\t\t\tunique: formFields[10].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Village\": Number(formFields[11].value),\r\n\t\t\t\t\"Mafia\": Number(formFields[12].value),\r\n\t\t\t\t\"Monsters\": Number(formFields[13].value),\r\n\t\t\t\t\"Independent\": Number(formFields[14].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[9]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\";\r\n\r\nexport default function LearnMafia(props) {\r\n\tconst gameType = \"Mafia\";\r\n\r\n\tvar items = [\r\n\t\t{\r\n\t\t\tname: \"Gun\",\r\n\t\t\ttext: \"Can be shot once during the day to kill a specific player.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Armor\",\r\n\t\t\ttext: \"Saves a player from being killed one time, not including being executed.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Bomb\",\r\n\t\t\ttext: \"When a player is killed while holding a bomb, the player who killed them will also die.\"\r\n\t\t},\r\n\t];\r\n\r\n\tvar mechanics = [\r\n\t\t{\r\n\t\t\tname: \"Whispers\",\r\n\t\t\ttext: \"Allow players to privately contact another player in the town meeting. If the whisper leaks then everyone will see it.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Last Wills\",\r\n\t\t\ttext: \"Allow players to write a message that will be revealed when they die.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Must Act\",\r\n\t\t\ttext: \"Players cannot select 'no one' for their actions.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"No Reveal\",\r\n\t\t\ttext: \"The roles of dead players are not revealed.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Closed Roles\",\r\n\t\t\ttext: \"Roles for each alignment are randomly chosen from the pool of roles in the setup.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Dawn\",\r\n\t\t\ttext: \"No actions can be taken the first night.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Full Moon\",\r\n\t\t\ttext: \"When a Lycan or Werewolf is present in the game, full moons will occur on odd nights.\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Eclipse\",\r\n\t\t\ttext: \"Occurs during the day due to certain roles, making all votes and speech anonymous.\"\r\n\t\t},\r\n\t];\r\n\r\n\tvar modifiers = [\r\n\t\t{\r\n\t\t\tname: \"Armed\",\r\n\t\t\ttext: \"Starts with a gun.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Armed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Explosive\",\r\n\t\t\ttext: \"Starts with a bomb.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Explosive\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Armored\",\r\n\t\t\ttext: \"Starts with armor.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Armored\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Exposed\",\r\n\t\t\ttext: \"Starts revealed to everyone.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Exposed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Lizard\",\r\n\t\t\ttext: \"Appears as a Villager to investigative roles.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Lizard\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Humble\",\r\n\t\t\ttext: \"Appears as Villager to self with no modifier.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Humble\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Lone\",\r\n\t\t\ttext: \"Does not attend the Mafia or Monsters meeting.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Lone\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Delayed\",\r\n\t\t\ttext: \"Cannot attend secondary meetings for the first day and night.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Delayed\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Even\",\r\n\t\t\ttext: \"Can only attend secondary meetings on even days and nights.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Even\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Odd\",\r\n\t\t\ttext: \"Can only attend secondary meetings on odd days and nights.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-Odd\" />\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"One Shot\",\r\n\t\t\ttext: \"Can only perform actions once.\",\r\n\t\t\ticon: <div className=\"icon modifier modifier-Mafia-One-Shot\" />\r\n\t\t},\r\n\t];\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Mafia | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tMafia is a game of social deception where an informed minority (the Mafia) compete against the uniformed majority (the Village).\r\n\t\t\t\t\t\tThe Mafia choose one player to kill each night, and they win the game if they successfully outnumber the non-mafia players at any point.\r\n\t\t\t\t\t\tEveryone votes to execute one person during the day, with the Village aiming to eliminate all mafia members.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn addition to the Village and the Mafia, there are two other alignments: Independent and Monsters. Independents are not aligned with a side and usually have their own unique win condition.\r\n\t\t\t\t\t\tMonsters meet together and win if they reach the majority just like the mafia, but they do not vote to kill someone each night.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAt the beginning of a game, each player is given a role. This role may grant the player special abilities, usually in the form of actions they can take to aid their side.\r\n\t\t\t\t\t\tA list of all roles and their abilities can be found below.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tItems\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={items} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tMechanics\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={mechanics} />\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tModifiers\r\n\t\t\t\t</div>\r\n\t\t\t\t<PanelGrid panels={modifiers} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostSplitDecision() {\r\n    const gameType = \"Split Decision\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Voice Chat\",\r\n            ref: \"voiceChat\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Initial Round Length (minutes)\",\r\n            ref: \"initRoundLength\",\r\n            type: \"number\",\r\n            value: 3,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        {\r\n            label: \"Hostage Swap Length (minutes)\",\r\n            ref: \"hostageSwapLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 1,\r\n            step: 0.1\r\n        },\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Split Decision | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                ranked: getFormFieldValue(\"ranked\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Initial Round\": getFormFieldValue(\"initialRoundLength\"),\r\n                    \"Hostage Swap\": getFormFieldValue(\"hostageSwapLength\")\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateSplitDecisionSetup() {\r\n\tconst gameType = \"Split Decision\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Initial Swap Amount\",\r\n\t\t\tref: \"swapAmt\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"1\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"24\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Round Amount\",\r\n\t\t\tref: \"aroundAmt\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: 3,\r\n\t\t\tmin: 2,\r\n\t\t\tmax: 10\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Blue Count\",\r\n\t\t\tref: \"count-Blue\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Red Count\",\r\n\t\t\tref: \"count-Red\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"1\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\tconst formFieldValueMods = {};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Split Decision Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: \"Round\",\r\n\t\t\tswapAmt: Number(formFields[1].value),\r\n\t\t\troundAmt: Number(formFields[2].value),\r\n\t\t\twhispers: formFields[3].value,\r\n\t\t\tleakPercentage: Number(formFields[4].value),\r\n\t\t\tunique: formFields[6].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Red\": Number(formFields[7].value),\r\n\t\t\t\t\"Blue\": Number(formFields[8].value),\r\n\t\t\t\t\"Independent\": Number(formFields[9].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[5]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnSplitDecision(props) {\r\n\tconst gameType = \"Split Decision\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Split Decision | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on the card game <a href=\"https://www.tuesdayknightgames.com/tworoomsandaboom\" target=\"_blank\">2 Rooms and a Boom</a> by Tudesday Knight Games.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn Split Decision, all players are randomly a split among two rooms, as well as split among two teams: Red and Blue. One player is assigned the role of President, and another is the Bomber.\r\n\t\t\t\t\t\tThe game plays over a series of rounds, and in each round each room will elect a leader. Those leaders will then meet together and choose one or more players (the hostages) to swap between the rooms for the next round.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAs the game progresses the rounds will get shorter and the number of players swapped between rooms will decrease.\r\n\t\t\t\t\t\tIt is the goal of the Red team for the President and the Bomber to end up in the same room after the last round.\r\n\t\t\t\t\t\tIt is the goal of the Blue team for them to end up in different rooms.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostResistance() {\r\n    const gameType = \"Resistance\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Voice Chat\",\r\n            ref: \"voiceChat\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Team Selection Length (minutes)\",\r\n            ref: \"teamSelLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        {\r\n            label: \"Team Approval Length (minutes)\",\r\n            ref: \"teamApprovalLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 2,\r\n            step: 0.1\r\n        },\r\n        {\r\n            label: \"Mission Length (minutes)\",\r\n            ref: \"missionLength\",\r\n            type: \"number\",\r\n            value: 0.5,\r\n            min: 0.1,\r\n            max: 1,\r\n            step: 0.1\r\n        },\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host Resistance | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Team Selection\": getFormFieldValue(\"teamSelLength\"),\r\n                    \"Team Approval\": getFormFieldValue(\"teamApprovalLength\"),\r\n                    \"Mission\": getFormFieldValue(\"missionLength\"),\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`)\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateResistanceSetup() {\r\n\tconst gameType = \"Resistance\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"First Team Size\",\r\n\t\t\tref: \"firstTeamSize\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Last Team Size\",\r\n\t\t\tref: \"lastTeamSize\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"4\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Number of Missions\",\r\n\t\t\tref: \"numMissions\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"10\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Team Formation Attempts\",\r\n\t\t\tref: \"teamFailLimit\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"49\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Resistance Count\",\r\n\t\t\tref: \"count-Resistance\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"49\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Spies Count\",\r\n\t\t\tref: \"count-Spies\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"1\",\r\n\t\t\tmax: \"49\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t]);\r\n\tconst formFieldValueMods = {};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create Resistance Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\tstartState: \"Team Selection\",\r\n\t\t\tfirstTeamSize: Number(formFields[1].value),\r\n\t\t\tlastTeamSize: Number(formFields[2].value),\r\n\t\t\tnumMissions: Number(formFields[3].value),\r\n\t\t\tteamFailLimit: Number(formFields[4].value),\r\n\t\t\twhispers: formFields[5].value,\r\n\t\t\tleakPercentage: Number(formFields[6].value),\r\n\t\t\tunique: formFields[8].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Resistance\": Number(formFields[9].value),\r\n\t\t\t\t\"Spies\": Number(formFields[10].value),\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[7]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnResistance(props) {\r\n\tconst gameType = \"Resistance\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn Resistance | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on the card game <a href=\"https://www.boardgamegeek.com/boardgame/41114/resistance\" target=\"_blank\">The Resistance</a> by Don Eskridge.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tIn Resistance, a group of rebels is trying to overthrow the government by completing a series of missions.\r\n\t\t\t\t\t\tHowever, the government has caught word of the plan and has recruited spies to inflitrate the resistance and sabotage the missions.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tAt the beginning of each mission a player is selected as the leader and must recruit several group members to the team.\r\n\t\t\t\t\t\tAll players vote on the selected team and if the majority approve then the mission will proceed. Otherwise, a new leader is chosen to make a new team.\r\n\t\t\t\t\t\tIf several leaders are unable to form a team then that mission automatically fails.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tDuring a mission the members of the teams who are spies can choose to either make the mission succeed or fail.\r\n\t\t\t\t\t\tIf at least one team member opts for it to fail then the entire mission will fail, otherwise it will succeed.\r\n\t\t\t\t\t\tThe game continues until a certain number of missions succeed or fail, with the Resistance and the Spies winning respectively.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport Host from \"./Host\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { Lobbies } from \"../../../Constants\";\r\n\r\nimport \"../../../css/host.css\"\r\n\r\nexport default function HostMafia() {\r\n    const gameType = \"One Night\";\r\n    const [selSetup, setSelSetup] = useState({});\r\n    const [redirect, setRedirect] = useState(false);\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const errorAlert = useErrorAlert();\r\n    const [formFields, updateFormFields] = useForm([\r\n        {\r\n            label: \"Setup\",\r\n            ref: \"setup\",\r\n            type: \"text\",\r\n            disabled: true,\r\n        },\r\n        {\r\n            label: \"Lobby\",\r\n            ref: \"lobby\",\r\n            type: \"select\",\r\n            value: localStorage.getItem(\"lobby\") || \"Main\",\r\n            options: Lobbies.map(lobby => ({ label: lobby, value: lobby })),\r\n        },\r\n        {\r\n            label: \"Private\",\r\n            ref: \"private\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Allow Guests\",\r\n            ref: \"guests\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Spectating\",\r\n            ref: \"spectating\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Voice Chat\",\r\n            ref: \"voiceChat\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Scheduled\",\r\n            ref: \"scheduled\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Ready Check\",\r\n            ref: \"readyCheck\",\r\n            type: \"boolean\"\r\n        },\r\n        {\r\n            label: \"Start Date\",\r\n            ref: \"startDate\",\r\n            type: \"datetime-local\",\r\n            showIf: \"scheduled\",\r\n            value: Date.now() + (6 * 60 * 1000),\r\n            min: Date.now() + (6 * 60 * 1000),\r\n            max: Date.now() + (4 * 7 * 24 * 60 * 60 * 1000)\r\n        },\r\n        {\r\n            label: \"Day Length (minutes)\",\r\n            ref: \"dayLength\",\r\n            type: \"number\",\r\n            value: 10,\r\n            min: 1,\r\n            max: 30\r\n        },\r\n        {\r\n            label: \"Night Length (minutes)\",\r\n            ref: \"nightLength\",\r\n            type: \"number\",\r\n            value: 2,\r\n            min: 1,\r\n            max: 10\r\n        }\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        document.title = \"Host One Night | BeyondMafia\";\r\n    }, []);\r\n\r\n    function onHostGame() {\r\n        var scheduled = formFields[6].value;\r\n\r\n        if (selSetup.id)\r\n            axios.post(\"/game/host\", {\r\n                gameType: gameType,\r\n                setup: selSetup.id,\r\n                lobby: getFormFieldValue(\"lobby\"),\r\n                private: getFormFieldValue(\"private\"),\r\n                guests: getFormFieldValue(\"guests\"),\r\n                spectating: getFormFieldValue(\"spectating\"),\r\n                voiceChat: getFormFieldValue(\"voiceChat\"),\r\n                scheduled: scheduled && (new Date(getFormFieldValue(\"startDate\"))).getTime(),\r\n                readyCheck: getFormFieldValue(\"readyCheck\"),\r\n                stateLengths: {\r\n                    \"Day\": getFormFieldValue(\"dayLength\"),\r\n                    \"Night\": getFormFieldValue(\"nightLength\")\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (scheduled) {\r\n                        siteInfo.showAlert(`Game scheduled.`, \"success\");\r\n                        setRedirect(\"/\");\r\n                    }\r\n                    else\r\n                        setRedirect(`/game/${res.data}`);\r\n                })\r\n                .catch(errorAlert);\r\n        else\r\n            errorAlert(\"You must choose a setup\");\r\n    }\r\n\r\n    function getFormFieldValue(ref) {\r\n        for (let field of formFields)\r\n            if (field.ref == ref)\r\n                return field.value;\r\n    }\r\n\r\n    if (redirect)\r\n        return <Redirect to={redirect} />\r\n\r\n    return (\r\n        <Host\r\n            gameType={gameType}\r\n            selSetup={selSetup}\r\n            setSelSetup={setSelSetup}\r\n            formFields={formFields}\r\n            updateFormFields={updateFormFields}\r\n            onHostGame={onHostGame} />\r\n    );\r\n}","import React, { useContext, useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport CreateSetup from \"./CreateSetup\";\r\nimport { SiteInfoContext } from \"../../../Contexts\";\r\nimport { useForm } from \"../../../components/Form\";\r\nimport { useErrorAlert } from \"../../../components/Alerts\";\r\n\r\nexport default function CreateOneNightSetup() {\r\n\tconst gameType = \"One Night\";\r\n\tconst location = useLocation();\r\n\tconst params = new URLSearchParams(location.search);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst [formFields, updateFormFields, resetFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Setup Name\",\r\n\t\t\tref: \"name\",\r\n\t\t\ttype: \"text\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whispers\",\r\n\t\t\tref: \"whispers\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Whisper Leak Percentage\",\r\n\t\t\tref: \"leakPercentage\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"5\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"100\",\r\n\t\t\tshowIf: \"whispers\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Must Act\",\r\n\t\t\tref: \"mustAct\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Votes Invisible\",\r\n\t\t\tref: \"votesInvisible\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Excess Roles\",\r\n\t\t\tref: \"excessRoles\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"3\",\r\n\t\t\tmin: \"2\",\r\n\t\t\tmax: \"10\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Closed Roles\",\r\n\t\t\tref: \"closed\",\r\n\t\t\ttype: \"boolean\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Unique Roles\",\r\n\t\t\tref: \"unique\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Village Count\",\r\n\t\t\tref: \"count-Village\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"7\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Werewolves Count\",\r\n\t\t\tref: \"count-Werewolves\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"0\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Independent Count\",\r\n\t\t\tref: \"count-Independent\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: \"2\",\r\n\t\t\tmin: \"0\",\r\n\t\t\tmax: \"50\",\r\n\t\t\tshowIf: \"closed\"\r\n\t\t}\r\n\t]);\r\n\tconst formFieldValueMods = {\r\n\t\tstartState: [\r\n\t\t\tvalue => value == \"Day\"\r\n\t\t]\r\n\t};\r\n\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Create One Night Setup | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tfunction onCreateSetup(roleData, editing, setRedirect) {\r\n\t\taxios.post(\"/setup/create\", {\r\n\t\t\tgameType: gameType,\r\n\t\t\troles: roleData.roles,\r\n\t\t\tclosed: roleData.closed,\r\n\t\t\tname: formFields[0].value,\r\n\t\t\twhispers: formFields[1].value,\r\n\t\t\tleakPercentage: Number(formFields[2].value),\r\n\t\t\tmustAct: formFields[3].value,\r\n\t\t\tvotesInvisible: formFields[4].value,\r\n\t\t\texcessRoles: formFields[5].value,\r\n\t\t\tunique: formFields[7].value,\r\n\t\t\tcount: {\r\n\t\t\t\t\"Village\": Number(formFields[8].value),\r\n\t\t\t\t\"Werewolves\": Number(formFields[9].value),\r\n\t\t\t\t\"Independent\": Number(formFields[10].value)\r\n\t\t\t},\r\n\t\t\tediting: editing,\r\n\t\t\tid: params.get(\"edit\")\r\n\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsiteInfo.showAlert(`${editing ? \"Edited\" : \"Created\"} setup '${formFields[0].value}'`, \"success\");\r\n\t\t\t\tsetRedirect(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<CreateSetup\r\n\t\t\tgameType={gameType}\r\n\t\t\tformFields={formFields}\r\n\t\t\tupdateFormFields={updateFormFields}\r\n\t\t\tresetFormFields={resetFormFields}\r\n\t\t\tclosedField={formFields[6]}\r\n\t\t\tformFieldValueMods={formFieldValueMods}\r\n\t\t\tonCreateSetup={onCreateSetup} />\r\n\t);\r\n}","\r\nimport React, { useEffect } from \"react\";\r\n\r\nimport { RoleSearch } from \"../../../components/Roles\";\r\nimport { PanelGrid } from \"../../../components/Basic\";\r\n\r\nimport \"../../../css/learn.css\"\r\n\r\nexport default function LearnOneNight(props) {\r\n\tconst gameType = \"One Night\";\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Learn One Night | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main\">\r\n\t\t\t<div className=\"learn\">\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tSynopsis\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"paragraphs\">\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tBased on <a href=\"https://beziergames.com/collections/one-night-ultimate-werewolf\" target=\"_blank\">One Night Ultimate Werewolf</a> by Bezier Games.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tOne Night is a game of logical deduction similar to Mafia, but with only one Night and one Day phase.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t\t\tThe Village side must kill one of the Werewolves to win, and Werewolves must kill one of the village.\r\n\t\t\t\t\t\tThe one night is typically eventful; the role you are given at the beginning of the night may not be the card you end up with.\r\n\t\t\t\t\t\tActions will all take place at once at the end of the night. The order of events is given by times in the role descriptions.\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"heading\">\r\n\t\t\t\t\tRoles\r\n\t\t\t\t</div>\r\n\t\t\t\t<RoleSearch gameType={gameType} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n","import React, { useState, useContext, useEffect } from \"react\";\r\nimport { Route, Switch, Redirect, useLocation, useHistory } from \"react-router-dom\";\r\n\r\nimport Join from \"./Join\";\r\n\r\nimport HostMafia from \"./Host/HostMafia\";\r\nimport CreateMafiaSetup from \"./CreateSetup/CreateMafiaSetup\";\r\nimport LearnMafia from \"./Learn/LearnMafia\";\r\n\r\nimport HostSplitDecision from \"./Host/HostSplitDecision\";\r\nimport CreateSplitDecisionSetup from \"./CreateSetup/CreateSplitDecisionSetup\";\r\nimport LearnSplitDecision from \"./Learn/LearnSplitDecision\";\r\n\r\nimport HostResistance from \"./Host/HostResistance\";\r\nimport CreateResistanceSetup from \"./CreateSetup/CreateResistanceSetup\";\r\nimport LearnResistance from \"./Learn/LearnResistance\";\r\n\r\nimport HostOneNight from \"./Host/HostOneNight\";\r\nimport CreateOneNightSetup from \"./CreateSetup/CreateOneNightSetup\";\r\nimport LearnOneNight from \"./Learn/LearnOneNight\";\r\n\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport { GameTypes } from \"../../Constants\";\r\nimport { UserContext } from \"../../Contexts\";\r\n\r\nimport \"../../css/play.css\";\r\n\r\nexport default function Play(props) {\r\n    const defaultGameType = \"Mafia\";\r\n\r\n    const user = useContext(UserContext);\r\n    const location = useLocation();\r\n    const history = useHistory();\r\n    const params = new URLSearchParams(location.search);\r\n    const inLobby = location.pathname == \"/play\";\r\n    const [gameType, setGameType] = useState(params.get(\"game\") || localStorage.getItem(\"gameType\") || defaultGameType);\r\n\r\n    const links = [\r\n        {\r\n            text: \"Play\",\r\n            path: \"/play\",\r\n            exact: true\r\n        },\r\n        {\r\n            text: \"Host\",\r\n            path: `/play/host`,\r\n            hide: !user.loggedIn\r\n        },\r\n        {\r\n            text: \"Create Setup\",\r\n            path: `/play/create`,\r\n            hide: !user.loggedIn\r\n        },\r\n        {\r\n            text: \"Learn\",\r\n            path: `/play/learn`\r\n        }\r\n    ];\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(\"gameType\", gameType);\r\n\r\n        if (!inLobby && !params.get(\"edit\") && params.get(\"game\") != gameType)\r\n            history.push(location.pathname + `?game=${gameType}`);\r\n    }, [location.pathname, gameType]);\r\n\r\n    function onFilterGameType(gameType) {\r\n        setGameType(gameType);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <SubNav\r\n                links={links}\r\n                showFilter={!inLobby}\r\n                filterSel={gameType}\r\n                filterOptions={GameTypes}\r\n                onFilter={onFilterGameType}\r\n                filterIcon={<i className=\"fas fa-gamepad\" />} />\r\n            <div className=\"inner-content play\">\r\n                <Switch>\r\n                    <Route exact path=\"/play\" render={() => <Join />} />\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/host\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <HostMafia />;\r\n                                    case \"Split Decision\":\r\n                                        return <HostSplitDecision />;\r\n                                    case \"Resistance\":\r\n                                        return <HostResistance />;\r\n                                    case \"One Night\":\r\n                                        return <HostOneNight />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/create\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <CreateMafiaSetup />;\r\n                                    case \"Split Decision\":\r\n                                        return <CreateSplitDecisionSetup />;\r\n                                    case \"Resistance\":\r\n                                        return <CreateResistanceSetup />;\r\n                                    case \"One Night\":\r\n                                        return <CreateOneNightSetup />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/play/learn\"\r\n                        render={\r\n                            () => {\r\n                                switch (gameType) {\r\n                                    case \"Mafia\":\r\n                                        return <LearnMafia />;\r\n                                    case \"Split Decision\":\r\n                                        return <LearnSplitDecision />;\r\n                                    case \"Resistance\":\r\n                                        return <LearnResistance />;\r\n                                    case \"One Night\":\r\n                                        return <LearnOneNight />;\r\n                                    default:\r\n                                        setGameType(defaultGameType);\r\n                                        return <></>;\r\n                                }\r\n                            }\r\n                        } />\r\n\r\n                    <Route render={() => <Redirect to=\"/play\" />} />\r\n                </Switch>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport function TopBarLink(props) {\r\n    const active = props.sel.toLowerCase() == props.text.toLowerCase();\r\n\r\n    return (\r\n        <div\r\n            className={`top-link ${active ? \"active\" : \"\"}`}\r\n            onClick={props.onClick}>\r\n            {props.text}\r\n        </div>\r\n    );\r\n}","import React, { useState, useContext, useRef } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext, PopoverContext } from \"../Contexts\";\r\nimport { ButtonGroup, SearchBar } from \"./Nav\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\nimport { hyphenDelimit } from \"../utils\";\r\nimport { Alignments } from \"../Constants\";\r\nimport LoadingPage from \"../pages/Loading\";\r\nimport { TopBarLink } from \"../pages/Play/Play\";\r\n\r\nexport function RoleCount(props) {\r\n\tconst roleRef = useRef();\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tvar roleName, modifier;\r\n\r\n\tif (typeof props.role == \"string\") {\r\n\t\troleName = props.role.split(\":\")[0];\r\n\t\tmodifier = props.role.split(\":\")[1];\r\n\t}\r\n\telse if (props.role) {\r\n\t\troleName = props.role.name;\r\n\t\tmodifier = props.role.modifier;\r\n\t}\r\n\r\n\tfunction onRoleClick() {\r\n\t\tif (props.onClick)\r\n\t\t\tprops.onClick();\r\n\r\n\t\tif (!roleName || !props.showPopover)\r\n\t\t\treturn;\r\n\r\n\t\tpopover.onClick(\r\n\t\t\t`/roles/${props.gameType}/${roleName}`,\r\n\t\t\t\"role\",\r\n\t\t\troleRef.current,\r\n\t\t\troleName\r\n\t\t);\r\n\t}\r\n\r\n\tif (!props.closed) {\r\n\t\tconst roleClass = roleName ? `${hyphenDelimit(props.gameType)}-${hyphenDelimit(roleName)}` : \"null\";\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"role-count-wrap\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={`role role-${roleClass} ${props.small ? \"small\" : \"\"} ${props.bg ? \"bg\" : \"\"}`}\r\n\t\t\t\t\ttitle={`${roleName || \"\"} ${modifier ? `(${modifier})` : \"\"}`}\r\n\t\t\t\t\tonClick={onRoleClick}\r\n\t\t\t\t\tref={roleRef}>\r\n\t\t\t\t\t{modifier &&\r\n\t\t\t\t\t\t<div className={`modifier modifier-${props.gameType}-${hyphenDelimit(modifier)}`} />\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{props.count > 0 &&\r\n\t\t\t\t\t<div className=\"super\">{props.count}</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse if (props.count > 0 || props.hideCount) {\r\n\t\treturn (\r\n\t\t\t<div className=\"role-count-wrap\">\r\n\t\t\t\t<i\r\n\t\t\t\t\tclassName={`fas fa-question i-${props.alignment}`}\r\n\t\t\t\t\tonClick={props.onClick} />\r\n\t\t\t\t{!props.hideCount &&\r\n\t\t\t\t\t<div className=\"super\">{props.count}</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse {\r\n\t\treturn <></>;\r\n\t}\r\n}\r\n\r\nexport function RoleSearch(props) {\r\n\tconst [roleListType, setRoleListType] = useState(Alignments[props.gameType][0]);\r\n\tconst [searchVal, setSearchVal] = useState(\"\");\r\n\tconst roleCellRefs = useRef([]);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst user = useContext(UserContext);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tfunction onAlignNavClick(alignment) {\r\n\t\tsetSearchVal(\"\");\r\n\t\tsetRoleListType(alignment);\r\n\t}\r\n\r\n\tfunction onSearchInput(query) {\r\n\t\tsetSearchVal(query.toLowerCase());\r\n\r\n\t\tif (query != \"\" && roleListType.length > 0)\r\n\t\t\tsetRoleListType(\"\");\r\n\t\telse if (query == \"\" && roleListType.length == 0)\r\n\t\t\tsetRoleListType(Alignments[props.gameType][0]);\r\n\t}\r\n\r\n\tfunction onRoleCellClick(roleCellEl, role) {\r\n\t\tpopover.onClick(\r\n\t\t\t`/roles/${props.gameType}/${role.name}`,\r\n\t\t\t\"role\",\r\n\t\t\troleCellEl,\r\n\t\t\trole.name\r\n\t\t);\r\n\t}\r\n\r\n\tconst alignButtons = Alignments[props.gameType].map(type => (\r\n\t\t<TopBarLink\r\n\t\t\ttext={type}\r\n\t\t\tsel={roleListType}\r\n\t\t\tonClick={() => onAlignNavClick(type)}\r\n\t\t\tkey={type} />\r\n\t));\r\n\r\n\tif (!siteInfo.roles)\r\n\t\treturn <LoadingPage className=\"roles-loading\" />;\r\n\r\n\tconst roleCells = siteInfo.roles[props.gameType].map((role, i) => {\r\n\t\tif (\r\n\t\t\trole.alignment == roleListType ||\r\n\t\t\t(searchVal.length > 0 && role.name.toLowerCase().indexOf(searchVal) != -1)\r\n\t\t) {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"role-cell\" key={role.name}>\r\n\t\t\t\t\t{user.loggedIn && props.onAddClick &&\r\n\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\tclassName=\"add-role fa-plus-circle fas\"\r\n\t\t\t\t\t\t\tonClick={e => {\r\n\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\tprops.onAddClick(role);\r\n\t\t\t\t\t\t\t}} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"role-cell-content\"\r\n\t\t\t\t\t\tonClick={() => onRoleCellClick(roleCellRefs.current[i], role)}\r\n\t\t\t\t\t\tref={el => roleCellRefs.current[i] = el}>\r\n\t\t\t\t\t\t<RoleCount\r\n\t\t\t\t\t\t\trole={role.name}\r\n\t\t\t\t\t\t\tgameType={props.gameType} />\r\n\t\t\t\t\t\t{role.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"role-list-container\">\r\n\t\t\t<div className=\"top-bar\">\r\n\t\t\t\t{alignButtons}\r\n\t\t\t\t<SearchBar\r\n\t\t\t\t\tvalue={searchVal}\r\n\t\t\t\t\tplaceholder=\"Role Name\"\r\n\t\t\t\t\tonInput={onSearchInput} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"role-list\">\r\n\t\t\t\t{roleCells}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useContext, useRef } from \"react\";\r\n\r\nimport { PopoverContext, UserContext } from \"../Contexts\";\r\nimport { RoleCount } from \"./Roles\";\r\nimport { Alignments } from \"../Constants\";\r\nimport { filterProfanity } from \"./Basic\";\r\nimport { hyphenDelimit } from \"../utils\";\r\n\r\nimport \"../css/setup.css\"\r\nimport \"../css/roles.css\"\r\n\r\nexport default function Setup(props) {\r\n\tconst user = useContext(UserContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\tconst setupRef = useRef();\r\n\tconst maxRolesCount = props.maxRolesCount || 5;\r\n\r\n\tvar roleCounts, multi;\r\n\tvar overSize = false;\r\n\r\n\tif (typeof props.setup.roles == \"string\")\r\n\t\tprops.setup.roles = JSON.parse(props.setup.roles);\r\n\r\n\tif (props.setup.closed) {\r\n\t\troleCounts = [];\r\n\r\n\t\tfor (let alignment of Alignments[props.setup.gameType]) {\r\n\t\t\troleCounts.push(\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\tclosed\r\n\t\t\t\t\talignment={alignment}\r\n\t\t\t\t\tcount={props.setup.count[alignment]}\r\n\t\t\t\t\tgameType={props.setup.gameType}\r\n\t\t\t\t\tkey={alignment} />\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tlet roleNames = Object.keys(props.setup.roles[0]);\r\n\t\tmulti = props.setup.roles.length > 1;\r\n\r\n\t\troleCounts = roleNames.map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\tsmall\r\n\t\t\t\trole={role}\r\n\t\t\t\tcount={props.setup.roles[0][role]}\r\n\t\t\t\tgameType={props.setup.gameType}\r\n\t\t\t\tkey={role} />\r\n\t\t));\r\n\r\n\t\tif (roleCounts.length > maxRolesCount) {\r\n\t\t\troleCounts = roleCounts.slice(0, maxRolesCount);\r\n\t\t\toverSize = true;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClick() {\r\n\t\tpopover.onClick(\r\n\t\t\t`/setup/${props.setup.id}`,\r\n\t\t\t\"setup\",\r\n\t\t\tsetupRef.current,\r\n\t\t\tfilterProfanity(props.setup.name, user.settings),\r\n\t\t\tdata => data.roles = JSON.parse(data.roles)\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"setup\" ref={setupRef} onClick={onClick}>\r\n\t\t\t<GameIcon gameType={props.setup.gameType} />\r\n\t\t\t{multi &&\r\n\t\t\t\t<i className=\"multi-setup-icon fas fa-list-alt\" />\r\n\t\t\t}\r\n\t\t\t{roleCounts}\r\n\t\t\t{overSize &&\r\n\t\t\t\t<i className=\"fas fa-ellipsis-h\" />\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function SmallRoleList(props) {\r\n\tvar roles;\r\n\r\n\tif (Array.isArray(props.roles))\r\n\t\troles = props.roles.map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\tsmall\r\n\t\t\t\trole={role}\r\n\t\t\t\tkey={role}\r\n\t\t\t\tgameType={props.gameType} />\r\n\t\t));\r\n\telse\r\n\t\troles = Object.keys(props.roles).map(role => (\r\n\t\t\t<RoleCount\r\n\t\t\t\trole={role}\r\n\t\t\t\tcount={props.roles[role]}\r\n\t\t\t\tsmall={true}\r\n\t\t\t\tgameType={props.gameType}\r\n\t\t\t\tkey={role} />\r\n\t\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"small-role-list\">{roles}</div>\r\n\t);\r\n}\r\n\r\nexport function GameIcon(props) {\r\n\tconst gameType = hyphenDelimit(props.gameType);\r\n\treturn <div className={`game-icon ${gameType}`}></div>;\r\n}\r\n\r\nexport function GameStateIcon(props) {\r\n\tvar iconName;\r\n\r\n\tif (props.state == \"Day\")\r\n\t\ticonName = \"sun\";\r\n\telse if (props.state == \"Night\")\r\n\t\ticonName = \"moon\";\r\n\r\n\treturn <i className={`fa-${iconName} fas state-icon`} />\r\n}\r\n","const PING_INTERVAL = 10000;\r\n\r\nclass Socket {\r\n\r\n\tconstructor(socket) {\r\n\t\tthis.listeners = {};\r\n\t\tthis.sendQueue = [];\r\n\t\tthis.received = [];\r\n\r\n\t\tthis.setSocket(socket);\r\n\t}\r\n\r\n\tsetSocket(socket) {\r\n\t\tthis.socket = socket;\r\n\r\n\t\tthis.configureListeners();\r\n\r\n\t\tthis.socket.addEventListener(\"open\", () => {\r\n\t\t\tthis.received = [];\r\n\r\n\t\t\tfor (let message of this.sendQueue)\r\n\t\t\t\tthis.socket.send(message);\r\n\t\t});\r\n\r\n\t\tthis.socket.addEventListener(\"close\", () => {\r\n\t\t\tthis.triggerEvent(\"disconnected\");\r\n\t\t});\r\n\r\n\t\tthis.socket.addEventListener(\"error\", () => {\r\n\t\t\tthis.terminate();\r\n\t\t});\r\n\t}\r\n\r\n\tconfigureListeners() {\r\n\t\tthis.socket.addEventListener(\"message\", message => {\r\n\t\t\tconst [eventName, data] = parseMessage(message.data);\r\n\t\t\tthis.triggerEvent(eventName, data);\r\n\t\t\tthis.received.push({ eventName, data });\r\n\t\t});\r\n\t}\r\n\r\n\ttriggerEvent(eventName, data) {\r\n\t\tconst actions = this.listeners[eventName];\r\n\r\n\t\tif (!actions)\r\n\t\t\treturn;\r\n\r\n\t\tfor (let i = 0; i < actions.length; i++)\r\n\t\t\tactions[i](data);\r\n\t}\r\n\r\n\ton(eventName, action) {\r\n\t\tif (!this.listeners[eventName])\r\n\t\t\tthis.listeners[eventName] = [];\r\n\r\n\t\taction = action.bind(this);\r\n\t\tthis.listeners[eventName].push(action);\r\n\r\n\t\tfor (let message of this.received)\r\n\t\t\tif (message.eventName == eventName)\r\n\t\t\t\taction(message.data);\r\n\t}\r\n\r\n\tsend(eventName, data) {\r\n\t\tconst message = stringifyMessage(eventName, data);\r\n\r\n\t\tif (this.socket.readyState == 0)\r\n\t\t\tthis.sendQueue.push(message);\r\n\t\telse if (this.socket.readyState == 1)\r\n\t\t\tthis.socket.send(message);\r\n\t}\r\n\r\n\tclearListeners() {\r\n\t\tvar newListeners = {};\r\n\t\tnewListeners[\"p\"] = this.listeners[\"p\"];\r\n\t\tthis.listeners = newListeners;\r\n\t}\r\n\r\n\tterminate() {\r\n\t\tthis.socket.close();\r\n\t}\r\n\r\n\tget readyState() {\r\n\t\tif (this.socket)\r\n\t\t\treturn this.socket.readyState;\r\n\t\telse \r\n\t\t\treturn 3;\r\n\t}\r\n\r\n}\r\n\r\nexport class ClientSocket extends Socket {\r\n\r\n\tconstructor(path, persistent) {\r\n\t\tsuper(new WebSocket(path));\r\n\r\n\t\tthis.path = path;\r\n\t\tthis.persistent = persistent;\r\n\r\n\t\tthis.configurePing();\r\n\t\tthis.configureClose();\r\n\t}\r\n\r\n\treconnect() {\r\n\t\tsuper.setSocket(new WebSocket(this.path));\r\n\t\tthis.heartbeat();\r\n\t\tthis.configureClose();\r\n\t}\r\n\r\n\tconfigurePing() {\r\n\t\tthis.heartbeat();\r\n\t\tthis.on(\"p\", () => this.heartbeat());\r\n\t}\r\n\r\n\theartbeat() {\r\n\t\tclearTimeout(this.pingTimeout);\r\n\t\tthis.send(\"p\");\r\n\r\n\t\tthis.pingTimeout = setTimeout(() => {\r\n\t\t\tthis.socket.close();\r\n\t\t}, PING_INTERVAL + 1000);\r\n\t}\r\n\r\n\tconfigureClose() {\r\n\t\tthis.socket.addEventListener(\"close\", () => {\r\n\t\t\tif (this.persistent)\r\n\t\t\t\tthis.reconnect();\r\n\t\t});\r\n\t}\r\n\r\n\tclear() {\r\n\t\tclearTimeout(this.pingTimeout);\r\n\r\n\t\tthis.persistent = false;\r\n\t\tthis.listeners = {};\r\n\t\tthis.sendQueue = [];\r\n\r\n\t\tif (this.socket)\r\n\t\t\tthis.socket.close();\r\n\r\n\t\tthis.socket = null;\r\n\t}\r\n\r\n}\r\n\r\nexport function stringifyMessage(eventName, data) {\r\n\tconst type = typeof data;\r\n\r\n\tif (type == \"undefined\")\r\n\t\treturn eventName;\r\n\r\n\tif (type == \"object\")\r\n\t\tdata = JSON.stringify(data);\r\n\telse if (type != \"string\")\r\n\t\tdata = String(data);\r\n\r\n\treturn `${eventName}:${type}:${data}`;\r\n}\r\n\r\nexport function parseMessage(message) {\r\n\tvar split = message.split(/:(.*)/s);\r\n\tconst eventName = split[0];\r\n\r\n\tif (split.length < 2)\r\n\t\treturn [eventName];\r\n\r\n\tsplit = split[1].split(/:(.*)/s);\r\n\r\n\tif (split.length < 2)\r\n\t\treturn;\r\n\r\n\tconst type = split[0];\r\n\tvar data = split[1];\r\n\r\n\tswitch (type) {\r\n\t\tcase \"number\":\r\n\t\t\tdata = Number(data);\r\n\t\t\tbreak;\r\n\t\tcase \"boolean\":\r\n\t\t\tdata = data != \"false\";\r\n\t\t\tbreak;\r\n\t\tcase \"object\":\r\n\t\t\ttry {\r\n\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn [eventName, data];\r\n}","import React, { useState, useEffect, useLayoutEffect, useReducer, useContext, useRef } from \"react\";\r\nimport { useParams, Switch, Route, Redirect } from \"react-router-dom\";\r\nimport update from \"immutability-helper\";\r\nimport axios from \"axios\";\r\nimport AgoraRTC from \"agora-rtc-sdk-ng\";\r\nimport ReactLoading from \"react-loading\";\r\n\r\nimport { filterProfanity, linkify, UserText } from \"../../components/Basic\";\r\nimport LoadingPage from \"../Loading\";\r\nimport MafiaGame from \"./MafiaGame\";\r\nimport SplitDecisionGame from \"./SplitDecisionGame\";\r\nimport ResistanceGame from \"./ResistanceGame\";\r\nimport OneNightGame from \"./OneNightGame\";\r\nimport { GameContext, PopoverContext, SiteInfoContext, UserContext } from \"../../Contexts\";\r\nimport Dropdown, { useDropdown } from \"../../components/Dropdown\";\r\nimport Setup from \"../../components/Setup\";\r\nimport { NameWithAvatar } from \"../User/User\";\r\nimport { ClientSocket as Socket } from \"../../Socket\";\r\nimport { RoleCount } from \"../../components/Roles\";\r\nimport Form, { useForm } from \"../../components/Form\";\r\nimport { Modal } from \"../../components/Modal\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { MaxGameMessageLength, MaxWillLength } from \"../../Constants\";\r\n\r\nimport \"../../css/game.css\";\r\n\r\nexport default function Game() {\r\n\treturn (\r\n\t\t<Switch>\r\n\t\t\t<Route exact path=\"/game/:gameId\" render={(props) => <GameWrapper key={props.match.params.gameId} />} />\r\n\t\t\t<Route exact path=\"/game/:gameId/review\" render={() => <GameWrapper review />} />\r\n\t\t\t<Redirect to=\"/play\" />\r\n\t\t</Switch>\r\n\t);\r\n}\r\n\r\nfunction GameWrapper(props) {\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\tconst [leave, setLeave] = useState(false);\r\n\tconst [finished, setFinished] = useState(false);\r\n\tconst [port, setPort] = useState();\r\n\tconst [gameType, setGameType] = useState();\r\n\tconst [token, setToken] = useState();\r\n\tconst [socket, setSocket] = useState({});\r\n\tconst [connected, setConnected] = useState(0);\r\n\tconst [setup, setSetup] = useState();\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [emojis, setEmojis] = useState({});\r\n\tconst [history, updateHistory] = useHistoryReducer();\r\n\tconst [stateViewing, updateStateViewing] = useStateViewingReducer(history);\r\n\tconst [players, updatePlayers] = usePlayersReducer();\r\n\tconst [spectatorCount, setSpectatorCount] = useState(0);\r\n\tconst [isSpectator, setIsSpectator] = useState(false);\r\n\tconst [self, setSelf] = useState();\r\n\tconst [lastWill, setLastWill] = useState(\"\");\r\n\tconst [timers, updateTimers] = useTimersReducer();\r\n\tconst [settings, updateSettings] = useSettingsReducer();\r\n\tconst [showSettingsModal, setShowSettingsModal] = useState(false);\r\n\tconst [showFirstGameModal, setShowFirstGameModal] = useState(false);\r\n\tconst [speechFilters, setSpeechFilters] = useState({ from: \"\", contains: \"\" });\r\n\tconst [activeVoiceChannel, setActiveVoiceChannel] = useState();\r\n\tconst [muted, setMuted] = useState(false);\r\n\tconst [deafened, setDeafened] = useState(false);\r\n\tconst [rehostId, setRehostId] = useState();\r\n\tconst [dev, setDev] = useState(false);\r\n\r\n\tconst playersRef = useRef();\r\n\tconst selfRef = useRef();\r\n\tconst agoraClient = useRef();\r\n\tconst localAudioTrack = useRef();\r\n\r\n\tconst [activity, updateActivity] = useActivity(agoraClient, localAudioTrack);\r\n\tconst [playAudio, loadAudioFiles, stopAudio, stopAudios, setVolume] = useAudio(settings);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst { gameId } = useParams();\r\n\r\n\tconst audioFileNames = [\"bell\", \"ping\", \"tick\"];\r\n\tconst audioLoops = [false, false, false];\r\n\tconst audioOverrides = [false, false, false];\r\n\tconst audioVolumes = [1, 1, 1];\r\n\r\n\tuseEffect(() => {\r\n\t\tif (token == null)\r\n\t\t\treturn;\r\n\r\n\t\tvar socketURL;\r\n\r\n\t\tif (process.env.REACT_APP_USE_PORT == \"true\")\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}:${port}`;\r\n\t\telse\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}/${port}`;\r\n\r\n\t\tvar newSocket = new Socket(socketURL);\r\n\t\tnewSocket.on(\"connected\", () => setConnected(connected + 1));\r\n\t\tnewSocket.on(\"disconnected\", () => setConnected(connected - 1));\r\n\t\tsetSocket(newSocket);\r\n\r\n\t\treturn () => {\r\n\t\t\tif (newSocket)\r\n\t\t\t\tnewSocket.clear();\r\n\t\t};\r\n\t}, [token]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (finished) {\r\n\t\t\tsocket.clear();\r\n\t\t\tsetSocket({ send: () => { } });\r\n\t\t}\r\n\t}, [finished]);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdateSettings({ type: \"load\" });\r\n\r\n\t\tif (!props.review) {\r\n\t\t\tdocument.title = `Game ${gameId} | BeyondMafia`;\r\n\t\t\tloadAudioFiles(audioFileNames, audioLoops, audioOverrides, audioVolumes);\r\n\t\t\trequestNotificationAccess();\r\n\r\n\t\t\tvar timerInterval = setInterval(() => {\r\n\t\t\t\tupdateTimers({\r\n\t\t\t\t\ttype: \"updateAll\",\r\n\t\t\t\t\tplayAudio\r\n\t\t\t\t});\r\n\t\t\t}, 1000);\r\n\r\n\t\t\tfunction onKeydown() {\r\n\t\t\t\tvar speechInput = document.getElementById(\"speechInput\");\r\n\t\t\t\tvar activeElName = document.activeElement.tagName;\r\n\r\n\t\t\t\tif (speechInput && activeElName != \"INPUT\" && activeElName != \"TEXTAREA\")\r\n\t\t\t\t\tspeechInput.focus();\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener(\"keydown\", onKeydown);\r\n\r\n\t\t\treturn () => {\r\n\t\t\t\twindow.removeEventListener(\"keydown\", onKeydown);\r\n\r\n\t\t\t\tclearInterval(timerInterval);\r\n\t\t\t\tstopAudio();\r\n\t\t\t\tagoraDisconnect();\r\n\r\n\t\t\t\tif (localAudioTrack.current)\r\n\t\t\t\t\tlocalAudioTrack.current.close();\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.title = `Review Game ${gameId} | BeyondMafia`;\r\n\r\n\t\t\taxios.get(`/game/${gameId}/review/data`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tvar data = res.data;\r\n\r\n\t\t\t\t\tif (data.broken) {\r\n\t\t\t\t\t\tsetLeave(true);\r\n\t\t\t\t\t\terrorAlert(\"Game not found.\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetGameType(data.type);\r\n\t\t\t\t\tsetSetup(data.setup);\r\n\r\n\t\t\t\t\tsetOptions({\r\n\t\t\t\t\t\tranked: data.ranked,\r\n\t\t\t\t\t\tspectating: data.spectating,\r\n\t\t\t\t\t\tprivate: false\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tupdateHistory({\r\n\t\t\t\t\t\ttype: \"set\",\r\n\t\t\t\t\t\thistory: JSON.parse(data.history)\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar players = {};\r\n\r\n\t\t\t\t\tfor (let i in data.players) {\r\n\t\t\t\t\t\tplayers[data.players[i]] = {\r\n\t\t\t\t\t\t\tid: data.players[i],\r\n\t\t\t\t\t\t\tname: data.names[i],\r\n\t\t\t\t\t\t\tuserId: data.users[i] ? data.users[i].id : \"\",\r\n\t\t\t\t\t\t\tavatar: data.users[i] ? data.users[i].avatar : false,\r\n\t\t\t\t\t\t\ttextColor: data.users[i] && data.users[i].settings.textColor,\r\n\t\t\t\t\t\t\tnameColor: data.users[i] && data.users[i].settings.nameColor,\r\n\t\t\t\t\t\t\tleft: data.left.indexOf(data.players[i]) != -1\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tupdatePlayers({\r\n\t\t\t\t\t\ttype: \"set\",\r\n\t\t\t\t\t\tplayers\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsetLoaded(true);\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\tsetLeave(true);\r\n\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tselfRef.current = self;\r\n\t}, [self]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (stateViewing == null)\r\n\t\t\tupdateStateViewing({ type: \"current\" });\r\n\t}, [history.currentState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tplayersRef.current = players;\r\n\t}, [players]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!options.voiceChat || props.review)\r\n\t\t\treturn;\r\n\r\n\t\tif (!activeVoiceChannel) {\r\n\t\t\tagoraDisconnect();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar state = history.states[history.currentState];\r\n\t\tvar meeting = state && state.meetings[activeVoiceChannel];\r\n\t\tvar vcToken = meeting && meeting.vcToken;\r\n\r\n\t\tif (vcToken)\r\n\t\t\tagoraConnect(activeVoiceChannel, vcToken);\r\n\t}, [activeVoiceChannel]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (socket.readyState != 1) {\r\n\t\t\tif (\r\n\t\t\t\t(socket.readyState == null || socket.readyState == 3) &&\r\n\t\t\t\t!leave &&\r\n\t\t\t\t!finished &&\r\n\t\t\t\t!props.review) {\r\n\t\t\t\tgetConnectionInfo();\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (token)\r\n\t\t\tsocket.send(\"auth\", token);\r\n\t\telse\r\n\t\t\tsocket.send(\"join\", { gameId, guestId: window.localStorage.getItem(\"cacheVal\") });\r\n\r\n\t\tsocket.on(\"authSuccess\", () => {\r\n\t\t\tsocket.send(\"join\", {\r\n\t\t\t\tgameId,\r\n\t\t\t\tisBot: window.location.search == \"?bot\"\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"loaded\", () => {\r\n\t\t\tsetLoaded(true);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"setup\", data => {\r\n\t\t\tsetSetup(data);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"options\", options => {\r\n\t\t\tsetOptions(options);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"emojis\", emojis => {\r\n\t\t\tsetEmojis(emojis);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"state\", state => {\r\n\t\t\tupdateHistory({ type: \"addState\", state: state });\r\n\t\t});\r\n\r\n\t\tsocket.on(\"history\", history => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\thistory\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"players\", players => {\r\n\t\t\tupdatePlayers({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tplayers\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"playerJoin\", player => {\r\n\t\t\tupdatePlayers({\r\n\t\t\t\ttype: \"add\",\r\n\t\t\t\tplayer\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"playerLeave\", playerId => {\r\n\t\t\tupdatePlayers({\r\n\t\t\t\ttype: \"remove\",\r\n\t\t\t\tplayerId\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"spectatorCount\", count => {\r\n\t\t\tsetSpectatorCount(count);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"self\", playerId => {\r\n\t\t\tsetSelf(playerId);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"reveal\", info => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"reveal\",\r\n\t\t\t\tplayerId: info.playerId,\r\n\t\t\t\trole: info.role\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"death\", playerId => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"death\",\r\n\t\t\t\tplayerId,\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"revival\", playerId => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"revival\",\r\n\t\t\t\tplayerId,\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"meeting\", meeting => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"addMeeting\",\r\n\t\t\t\tmeeting\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"members\", info => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"meetingMembers\",\r\n\t\t\t\tmeetingId: info.meetingId,\r\n\t\t\t\tmembers: info.members\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"leftMeeting\", meetingId => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"removeMeeting\",\r\n\t\t\t\tmeetingId\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"stateEvents\", stateEvents => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"stateEvents\",\r\n\t\t\t\tstateEvents\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"message\", message => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"addMessage\",\r\n\t\t\t\tmessage\r\n\t\t\t});\r\n\r\n\t\t\tconst pings = message.content.match(/@[\\w-]*/gm) || [];\r\n\r\n\t\t\tif (\r\n\t\t\t\tselfRef.current && playersRef.current[selfRef.current] &&\r\n\t\t\t\t(\r\n\t\t\t\t\tpings.indexOf(\"@\" + playersRef.current[selfRef.current].name) != -1 ||\r\n\t\t\t\t\tpings.indexOf(\"@everyone\") != -1\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\tplayAudio(\"ping\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"quote\", quote => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"addQuote\",\r\n\t\t\t\tquote\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"vote\", vote => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"vote\",\r\n\t\t\t\tvote\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"unvote\", info => {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"unvote\",\r\n\t\t\t\tinfo\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"lastWill\", will => {\r\n\t\t\tsetLastWill(will);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"firstGame\", () => {\r\n\t\t\tsetShowFirstGameModal(true);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"timerInfo\", info => {\r\n\t\t\tupdateTimers({\r\n\t\t\t\ttype: \"create\",\r\n\t\t\t\ttimer: info\r\n\t\t\t});\r\n\r\n\t\t\tif (\r\n\t\t\t\tinfo.name == \"pregameCountdown\" &&\r\n\t\t\t\tNotification &&\r\n\t\t\t\tNotification.permission == \"granted\" &&\r\n\t\t\t\t!document.hasFocus()\r\n\t\t\t) {\r\n\t\t\t\tnew Notification(\"Your game is starting!\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"clearTimer\", name => {\r\n\t\t\tupdateTimers({\r\n\t\t\t\ttype: \"clear\",\r\n\t\t\t\tname\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"time\", info => {\r\n\t\t\tupdateTimers({\r\n\t\t\t\ttype: \"update\",\r\n\t\t\t\tname: info.name,\r\n\t\t\t\ttime: info.time\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"typing\", info => {\r\n\t\t\tupdateActivity({\r\n\t\t\t\ttype: \"typing\",\r\n\t\t\t\tplayerId: info.playerId,\r\n\t\t\t\tmeetingId: info.meetingId\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"isSpectator\", () => {\r\n\t\t\tsetIsSpectator(true);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"left\", () => {\r\n\t\t\tsetLeave(true);\r\n\t\t\tsiteInfo.hideAllAlerts();\r\n\t\t});\r\n\r\n\t\tsocket.on(\"finished\", () => {\r\n\t\t\tsetFinished(true);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"error\", error => {\r\n\t\t\tsetLeave(true);\r\n\t\t\terrorAlert(error);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"dev\", () => {\r\n\t\t\tsetDev(true);\r\n\t\t});\r\n\t}, [connected]);\r\n\r\n\tfunction getConnectionInfo() {\r\n\t\taxios.get(`/game/${gameId}/connect`)\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetGameType(res.data.type);\r\n\t\t\t\tsetPort(res.data.port);\r\n\t\t\t\tsetToken(res.data.token || false);\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tsetLeave(true);\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction createAgoraClient() {\r\n\t\tif (agoraClient.current)\r\n\t\t\treturn;\r\n\r\n\t\tagoraClient.current = AgoraRTC.createClient({ mode: \"rtc\", codec: \"vp8\" });\r\n\r\n\t\tagoraClient.current.on(\"user-published\", async (user, mediaType) => {\r\n\t\t\tif (mediaType != \"audio\")\r\n\t\t\t\treturn;\r\n\r\n\t\t\tawait agoraClient.current.subscribe(user, mediaType);\r\n\r\n\t\t\tif (deafened)\r\n\t\t\t\tuser.audioTrack.setVolume(0);\r\n\r\n\t\t\tuser.audioTrack.play();\r\n\t\t});\r\n\r\n\t\tagoraClient.current.on(\"user-unpublished\", user => {\r\n\t\t\tvar audioContainer = document.getElementById(user.uid);\r\n\r\n\t\t\tif (audioContainer)\r\n\t\t\t\taudioContainer.remove();\r\n\t\t});\r\n\t}\r\n\r\n\tasync function agoraConnect(meetingId, token) {\r\n\t\ttry {\r\n\t\t\tif (!agoraClient.current)\r\n\t\t\t\tcreateAgoraClient();\r\n\t\t\telse\r\n\t\t\t\tawait agoraDisconnect();\r\n\r\n\t\t\tawait agoraClient.current.join(process.env.REACT_APP_AGORA_ID, meetingId, token, self);\r\n\r\n\t\t\tif (!localAudioTrack.current) {\r\n\t\t\t\tlocalAudioTrack.current = await AgoraRTC.createMicrophoneAudioTrack();\r\n\r\n\t\t\t\tif (muted)\r\n\t\t\t\t\tlocalAudioTrack.current.setVolume(0);\r\n\t\t\t}\r\n\r\n\t\t\tawait agoraClient.current.publish([localAudioTrack.current]);\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tasync function agoraDisconnect() {\r\n\t\tif (!agoraClient.current)\r\n\t\t\treturn;\r\n\r\n\t\tagoraClient.current.remoteUsers.forEach(user => {\r\n\t\t\tlet audioContainer = document.getElementById(user.uid);\r\n\r\n\t\t\tif (audioContainer)\r\n\t\t\t\taudioContainer.remove();\r\n\t\t});\r\n\r\n\t\tawait agoraClient.current.leave();\r\n\t}\r\n\r\n\tif (leave)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\telse if (rehostId)\r\n\t\treturn <Redirect to={`/game/${rehostId}`} />;\r\n\telse if (!loaded || stateViewing == null)\r\n\t\treturn (\r\n\t\t\t<div className=\"game\">\r\n\t\t\t\t<LoadingPage />\r\n\t\t\t</div>\r\n\t\t);\r\n\telse {\r\n\t\tconst context = {\r\n\t\t\tsocket: socket,\r\n\t\t\treview: props.review,\r\n\t\t\tsetup: setup,\r\n\t\t\thistory: history,\r\n\t\t\tupdateHistory: updateHistory,\r\n\t\t\tstateViewing: stateViewing,\r\n\t\t\tupdateStateViewing: updateStateViewing,\r\n\t\t\tself: self,\r\n\t\t\tisSpectator: isSpectator,\r\n\t\t\tplayers: players,\r\n\t\t\tupdatePlayers: updatePlayers,\r\n\t\t\ttimers: timers,\r\n\t\t\toptions: options,\r\n\t\t\tspectatorCount: spectatorCount,\r\n\t\t\tlastWill: lastWill,\r\n\t\t\temojis: emojis,\r\n\t\t\tsetLeave: setLeave,\r\n\t\t\tfinished: finished,\r\n\t\t\tsettings: settings,\r\n\t\t\tupdateSettings: updateSettings,\r\n\t\t\tsetShowSettingsModal: setShowSettingsModal,\r\n\t\t\tspeechFilters: speechFilters,\r\n\t\t\tsetSpeechFilters: setSpeechFilters,\r\n\t\t\tloadAudioFiles: loadAudioFiles,\r\n\t\t\tplayAudio: playAudio,\r\n\t\t\tstopAudio: stopAudio,\r\n\t\t\tstopAudios: stopAudios,\r\n\t\t\tsetRehostId: setRehostId,\r\n\t\t\tagoraClient: agoraClient,\r\n\t\t\tlocalAudioTrack: localAudioTrack,\r\n\t\t\tsetActiveVoiceChannel: setActiveVoiceChannel,\r\n\t\t\tactivity: activity,\r\n\t\t\tmuted: muted,\r\n\t\t\tsetMuted: setMuted,\r\n\t\t\tdeafened: deafened,\r\n\t\t\tsetDeafened: setDeafened,\r\n\t\t\tdev: dev,\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<GameContext.Provider value={context}>\r\n\t\t\t\t<div className=\"game no-highlight\">\r\n\t\t\t\t\t<SettingsModal\r\n\t\t\t\t\t\tshowModal={showSettingsModal}\r\n\t\t\t\t\t\tsetShowModal={setShowSettingsModal}\r\n\t\t\t\t\t\tsettings={settings}\r\n\t\t\t\t\t\tupdateSettings={updateSettings} />\r\n\t\t\t\t\t<FirstGameModal\r\n\t\t\t\t\t\tshowModal={showFirstGameModal}\r\n\t\t\t\t\t\tsetShowModal={setShowFirstGameModal} />\r\n\t\t\t\t\t{gameType == \"Mafia\" &&\r\n\t\t\t\t\t\t<MafiaGame />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{gameType == \"Resistance\" &&\r\n\t\t\t\t\t\t<ResistanceGame />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{gameType == \"Split Decision\" &&\r\n\t\t\t\t\t\t<SplitDecisionGame />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{gameType == \"One Night\" &&\r\n\t\t\t\t\t\t<OneNightGame />\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t</GameContext.Provider>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport function useSocketListeners(listeners, socket) {\r\n\tuseEffect(() => {\r\n\t\tif (!socket.on)\r\n\t\t\treturn;\r\n\r\n\t\tlisteners(socket);\r\n\t}, [socket]);\r\n}\r\n\r\nexport function TopBar(props) {\r\n\tconst { gameId } = useParams();\r\n\tconst infoRef = useRef();\r\n\tconst errorAlert = useErrorAlert();\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst popover = useContext(PopoverContext);\r\n\r\n\tfunction onInfoClick(e) {\r\n\t\te.stopPropagation();\r\n\t\tpopover.onClick(\r\n\t\t\t`/game/${gameId}/info`,\r\n\t\t\t\"game\",\r\n\t\t\tinfoRef.current,\r\n\t\t\t`Game ${gameId}`,\r\n\t\t);\r\n\t}\r\n\r\n\tfunction onSettingsClick() {\r\n\t\tprops.setShowSettingsModal(true);\r\n\t}\r\n\r\n\tfunction onTestClick() {\r\n\t\tfor (let i = 0; i < props.setup.total - 1; i++)\r\n\t\t\twindow.open(window.location + \"?bot\");\r\n\t}\r\n\r\n\tfunction onLeaveGameClick() {\r\n\t\tconst shouldLeave = props.finished || props.review || window.confirm(\"Are you sure you wish to leave?\");\r\n\r\n\t\tif (!shouldLeave)\r\n\t\t\treturn;\r\n\r\n\t\tif (props.finished)\r\n\t\t\tsiteInfo.hideAllAlerts();\r\n\r\n\t\tif (props.socket.on)\r\n\t\t\tprops.socket.send(\"leave\");\r\n\t\telse\r\n\t\t\tprops.setLeave(true);\r\n\t}\r\n\r\n\tfunction onRehostGameClick() {\r\n\t\tvar stateLengths = {};\r\n\r\n\t\tfor (let stateName in props.options.stateLengths)\r\n\t\t\tstateLengths[stateName] = props.options.stateLengths[stateName] / 60000;\r\n\r\n\t\taxios.post(\"/game/host\", {\r\n\t\t\trehost: gameId,\r\n\t\t\tgameType: props.gameType,\r\n\t\t\tsetup: props.setup.id,\r\n\t\t\tlobby: props.options.lobby,\r\n\t\t\tprivate: props.options.private,\r\n\t\t\tspectating: props.options.spectating,\r\n\t\t\tguests: props.options.guests,\r\n\t\t\tranked: props.options.ranked,\r\n\t\t\tstateLengths: stateLengths,\r\n\t\t\t...props.options.gameTypeOptions\r\n\t\t})\r\n\t\t\t.then(res => props.setRehostId(res.data))\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"top\">\r\n\t\t\t<div className=\"game-name-wrapper\">\r\n\t\t\t\t{props.gameName}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"state-wrapper\">\r\n\t\t\t\t<StateSwitcher\r\n\t\t\t\t\thistory={props.history}\r\n\t\t\t\t\tstateViewing={props.stateViewing}\r\n\t\t\t\t\tupdateStateViewing={props.updateStateViewing} />\r\n\t\t\t\t{props.timer}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"misc-wrapper\">\r\n\t\t\t\t<div className=\"misc-left\">\r\n\t\t\t\t\t<div className=\"misc-buttons\">\r\n\t\t\t\t\t\t{props.options.voiceChat &&\r\n\t\t\t\t\t\t\t<i className=\"misc-icon fas fa-microphone\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\tclassName=\"misc-icon fas fa-info-circle\"\r\n\t\t\t\t\t\t\tref={infoRef}\r\n\t\t\t\t\t\t\tonClick={onInfoClick} />\r\n\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\tclassName=\"misc-icon fas fa-cog\"\r\n\t\t\t\t\t\t\tonClick={onSettingsClick} />\r\n\t\t\t\t\t\t{props.dev &&\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName=\"misc-icon fas fa-vial\"\r\n\t\t\t\t\t\t\t\tonClick={onTestClick} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"options\">\r\n\t\t\t\t\t\t{!props.options.private && !props.review &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-lock-open\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{props.options.private && !props.review &&\r\n\t\t\t\t\t\t\t<i className=\"fas fa-lock\" />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{!props.review &&\r\n\t\t\t\t\t\t\t<div className=\"player-count\">\r\n\t\t\t\t\t\t\t\t<i className=\"fas fa-users\" />\r\n\t\t\t\t\t\t\t\t{Object.values(props.players).filter(p => !p.left).length} / {props.setup.total}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{!props.options.spectating && !props.review &&\r\n\t\t\t\t\t\t\t<div className=\"no-spectator\">\r\n\t\t\t\t\t\t\t\t<i className=\"fas fa-eye-slash\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{props.options.spectating && !props.review &&\r\n\t\t\t\t\t\t\t<div className=\"spectator-count\">\r\n\t\t\t\t\t\t\t\t<i className=\"fas fa-eye\" />\r\n\t\t\t\t\t\t\t\t{props.spectatorCount}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{props.setup &&\r\n\t\t\t\t\t<Setup setup={props.setup} />\r\n\t\t\t\t}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"btn btn-theme leave-game\"\r\n\t\t\t\t\tonClick={onLeaveGameClick}>\r\n\t\t\t\t\tLeave\r\n\t\t\t\t</div>\r\n\t\t\t\t{!props.review && props.history.currentState == -2 &&\r\n\t\t\t\t\t< div\r\n\t\t\t\t\t\tclassName=\"btn btn-theme-sec rehost-game\"\r\n\t\t\t\t\t\tonClick={onRehostGameClick}>\r\n\t\t\t\t\t\tRehost\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function ThreePanelLayout(props) {\r\n\treturn (\r\n\t\t<div className=\"main\">\r\n\t\t\t<div className=\"left-panel panel\">\r\n\t\t\t\t{props.leftPanelContent}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"center-panel panel\">\r\n\t\t\t\t{props.centerPanelContent}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"right-panel panel\">\r\n\t\t\t\t{props.rightPanelContent}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function TextMeetingLayout(props) {\r\n\tconst history = props.history;\r\n\tconst players = props.players;\r\n\tconst stateViewing = props.stateViewing;\r\n\tconst updateHistory = props.updateHistory;\r\n\tconst setActiveVoiceChannel = props.setActiveVoiceChannel;\r\n\tconst stateInfo = history.states[stateViewing];\r\n\tconst meetings = stateInfo ? stateInfo.meetings : {};\r\n\tconst alerts = stateInfo ? stateInfo.alerts : [];\r\n\tconst selTab = stateInfo && stateInfo.selTab;\r\n\r\n\tconst [autoScroll, setAutoScroll] = useState(true);\r\n\tconst [mouseMoved, setMouseMoved] = useState(false);\r\n\tconst speechDisplayRef = useRef();\r\n\r\n\tconst speechMeetings = Object.values(meetings).filter(meeting => meeting.speech);\r\n\r\n\tuseLayoutEffect(() => doAutoScroll());\r\n\r\n\tuseEffect(() => {\r\n\t\tif (stateViewing != null && !selTab && speechMeetings.length) {\r\n\t\t\tupdateHistory({\r\n\t\t\t\ttype: \"selTab\",\r\n\t\t\t\tstate: stateViewing,\r\n\t\t\t\tmeetingId: speechMeetings[0].id\r\n\t\t\t});\r\n\t\t}\r\n\t}, [stateViewing, speechMeetings]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (stateViewing == history.currentState)\r\n\t\t\tsetAutoScroll(true);\r\n\t\telse\r\n\t\t\tsetAutoScroll(false);\r\n\t}, [stateViewing]);\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction onMouseMove() {\r\n\t\t\tsetMouseMoved(true);\r\n\t\t\tdocument.removeEventListener(\"mousemove\", onMouseMove);\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener(\"mousemove\", onMouseMove);\r\n\r\n\t\treturn () => document.removeEventListener(\"mousemove\", onMouseMove);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!selTab || !meetings[selTab] || !meetings[selTab].vcToken)\r\n\t\t\tsetActiveVoiceChannel(null);\r\n\r\n\t\tsetActiveVoiceChannel(selTab);\r\n\t}, [selTab, meetings]);\r\n\r\n\tfunction doAutoScroll() {\r\n\t\tif (autoScroll && speechDisplayRef.current)\r\n\t\t\tspeechDisplayRef.current.scrollTop = speechDisplayRef.current.scrollHeight;\r\n\t}\r\n\r\n\tfunction onTabClick(tabId) {\r\n\t\tupdateHistory({\r\n\t\t\ttype: \"selTab\",\r\n\t\t\tstate: stateViewing,\r\n\t\t\tmeetingId: tabId\r\n\t\t});\r\n\r\n\t\tsetAutoScroll(true);\r\n\t}\r\n\r\n\tfunction onMessageQuote(message) {\r\n\t\tif (!props.review && message.senderId != \"server\" && !message.isQuote && message.quotable) {\r\n\t\t\tprops.socket.send(\"quote\", {\r\n\t\t\t\tmessageId: message.id,\r\n\t\t\t\ttoMeetingId: history.states[history.currentState].selTab,\r\n\t\t\t\tfromMeetingId: message.meetingId,\r\n\t\t\t\tfromState: stateViewing\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onSpeechScroll() {\r\n\t\tif (!mouseMoved) {\r\n\t\t\tdoAutoScroll();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar speech = speechDisplayRef.current;\r\n\r\n\t\tif (Math.round(speech.scrollTop + speech.clientHeight) >= Math.round(speech.scrollHeight))\r\n\t\t\tsetAutoScroll(true);\r\n\t\telse\r\n\t\t\tsetAutoScroll(false);\r\n\t}\r\n\r\n\tconst tabs = speechMeetings.map(meeting => {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`tab ${selTab == meeting.id ? \"sel\" : \"\"}`}\r\n\t\t\t\tkey={meeting.id}\r\n\t\t\t\tonClick={() => onTabClick(meeting.id)}>\r\n\t\t\t\t{meeting.name}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tvar messages = getMessagesToDisplay(meetings, alerts, selTab, players, props.settings, props.filters);\r\n\tmessages = messages.map((message, i) => {\r\n\t\treturn (\r\n\t\t\t<Message\r\n\t\t\t\tmessage={message}\r\n\t\t\t\thistory={history}\r\n\t\t\t\tplayers={players}\r\n\t\t\t\tkey={message.id || message.messageId + message.time || i}\r\n\t\t\t\tonMessageQuote={onMessageQuote}\r\n\t\t\t\tsettings={props.settings} />\r\n\t\t);\r\n\t});\r\n\r\n\tvar canSpeak = selTab;\r\n\tcanSpeak = canSpeak && (meetings[selTab].members.length > 1 || history.currentState == -1);\r\n\tcanSpeak = canSpeak && stateViewing == history.currentState && meetings[selTab].amMember && meetings[selTab].canTalk;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"meeting-tabs\">\r\n\t\t\t\t{tabs.length > 0 &&\r\n\t\t\t\t\ttabs\r\n\t\t\t\t}\r\n\t\t\t\t{tabs.length == 0 &&\r\n\t\t\t\t\t<div className=\"tab sel\">\r\n\t\t\t\t\t\t{stateInfo && stateInfo.name}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"speech-wrapper\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"speech-display\"\r\n\t\t\t\t\tonScroll={onSpeechScroll}\r\n\t\t\t\t\tref={speechDisplayRef}>\r\n\t\t\t\t\t{messages}\r\n\t\t\t\t</div>\r\n\t\t\t\t{canSpeak &&\r\n\t\t\t\t\t<SpeechInput\r\n\t\t\t\t\t\tmeetings={meetings}\r\n\t\t\t\t\t\tselTab={selTab}\r\n\t\t\t\t\t\tplayers={players}\r\n\t\t\t\t\t\toptions={props.options}\r\n\t\t\t\t\t\tsocket={props.socket}\r\n\t\t\t\t\t\tsetAutoScroll={setAutoScroll}\r\n\t\t\t\t\t\tagoraClient={props.agoraClient}\r\n\t\t\t\t\t\tlocalAudioTrack={props.localAudioTrack}\r\n\t\t\t\t\t\tmuted={props.muted}\r\n\t\t\t\t\t\tsetMuted={props.setMuted}\r\n\t\t\t\t\t\tdeafened={props.deafened}\r\n\t\t\t\t\t\tsetDeafened={props.setDeafened} />\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nfunction getMessagesToDisplay(meetings, alerts, selTab, players, settings, filters) {\r\n\tvar messages;\r\n\r\n\tif (selTab)\r\n\t\tmessages = [...meetings[selTab].messages];\r\n\telse\r\n\t\tmessages = [];\r\n\r\n\tif (filters && (filters.from || filters.contains))\r\n\t\tmessages = messages.filter(m => {\r\n\t\t\tvar content = m.content || \"\";\r\n\t\t\tvar matches = content.toLowerCase().indexOf(filters.contains.toLowerCase()) != -1;\r\n\r\n\t\t\tvar playerName = players[m.senderId].name;\r\n\t\t\tmatches = matches && playerName.toLowerCase().indexOf(filters.from.toLowerCase()) != -1;\r\n\r\n\t\t\treturn matches;\r\n\t\t});\r\n\r\n\tfor (let alert of alerts) {\r\n\t\tfor (let i = 0; i <= messages.length; i++) {\r\n\t\t\tif (i == messages.length) {\r\n\t\t\t\tmessages.push(alert);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\telse if (alert.time < messages[i].time) {\r\n\t\t\t\tmessages.splice(i, 0, alert);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (!settings.votingLog)\r\n\t\treturn messages;\r\n\r\n\tvar voteRecord;\r\n\r\n\tif (selTab)\r\n\t\tvoteRecord = meetings[selTab].voteRecord;\r\n\telse\r\n\t\tvoteRecord = [];\r\n\r\n\tfor (let meetingId in meetings)\r\n\t\tif (!meetings[meetingId].speech)\r\n\t\t\tvoteRecord = voteRecord.concat(meetings[meetingId].voteRecord);\r\n\r\n\tfor (let vote of voteRecord) {\r\n\t\tlet isUnvote = vote.type == \"unvote\";\r\n\t\tlet voter = players[vote.voterId];\r\n\t\tlet voterName = voter ? voter.name : \"Anonymous\";\r\n\t\tlet target = vote.target;\r\n\r\n\t\tif (!isUnvote) {\r\n\t\t\tif (target != \"*\" && players[target])\r\n\t\t\t\ttarget = players[target].name;\r\n\t\t\telse if (target == \"*\")\r\n\t\t\t\ttarget = \"no one\";\r\n\t\t}\r\n\r\n\t\tlet voteMsg = {\r\n\t\t\tsenderId: \"vote\",\r\n\t\t\tcontent: `${voterName} ${isUnvote ? \"unvotes\" : \"votes\"} ${isUnvote ? \"\" : target}`,\r\n\t\t\ttime: vote.time\r\n\t\t};\r\n\r\n\t\tfor (let i = 0; i <= messages.length; i++) {\r\n\t\t\tif (i == messages.length) {\r\n\t\t\t\tmessages.push(voteMsg);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\telse if (vote.time < messages[i].time) {\r\n\t\t\t\tmessages.splice(i, 0, voteMsg);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn messages;\r\n}\r\n\r\nfunction Message(props) {\r\n\tconst history = props.history;\r\n\tconst players = props.players;\r\n\tconst user = useContext(UserContext);\r\n\r\n\tvar message = props.message;\r\n\tvar player, quotedMessage;\r\n\tvar contentClass = \"content \";\r\n\tvar isMe = false;\r\n\r\n\tif (\r\n\t\tmessage.senderId != \"server\" &&\r\n\t\tmessage.senderId != \"vote\" &&\r\n\t\tmessage.senderId != \"anonymous\"\r\n\t) {\r\n\t\tplayer = players[message.senderId];\r\n\t}\r\n\r\n\tif (message.isQuote) {\r\n\t\tvar state = history.states[message.fromState];\r\n\r\n\t\tif (!state)\r\n\t\t\treturn;\r\n\r\n\t\tvar meeting = state.meetings[message.fromMeetingId];\r\n\r\n\t\tif (!meeting)\r\n\t\t\treturn;\r\n\r\n\t\tfor (let msg of meeting.messages) {\r\n\t\t\tif (msg.id == message.messageId) {\r\n\t\t\t\tquotedMessage = { ...msg };\r\n\t\t\t\tquotedMessage.meetingName = meeting.name;\r\n\r\n\t\t\t\tif (msg.senderId == \"anonymous\")\r\n\t\t\t\t\tquotedMessage.senderName = \"Anonymous\";\r\n\t\t\t\telse\r\n\t\t\t\t\tquotedMessage.senderName = players[msg.senderId].name;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (message.isQuote && !quotedMessage)\r\n\t\treturn <></>;\r\n\r\n\tif ((player || message.senderId == \"anonymous\") && !message.isQuote)\r\n\t\tcontentClass += \"clickable \";\r\n\r\n\tif (!message.isQuote && message.content.indexOf(\"/me \") == 0) {\r\n\t\tisMe = true;\r\n\t\tmessage = { ...message };\r\n\t\tmessage.content = message.content.replace(\"/me \", \"\");\r\n\t}\r\n\r\n\tif (message.isQuote)\r\n\t\tcontentClass += \"quote \";\r\n\telse if (message.senderId == \"server\")\r\n\t\tcontentClass += \"server \";\r\n\telse if (message.senderId == \"vote\")\r\n\t\tcontentClass += \"vote-record \";\r\n\telse if (isMe)\r\n\t\tcontentClass += \"me \";\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"message\"\r\n\t\t\tonDoubleClick={() => props.onMessageQuote(message)}>\r\n\t\t\t<div className=\"sender\">\r\n\t\t\t\t{props.settings.timestamps &&\r\n\t\t\t\t\t<Timestamp time={message.time} />\r\n\t\t\t\t}\r\n\t\t\t\t{player &&\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tid={player.userId}\r\n\t\t\t\t\t\tname={player.name}\r\n\t\t\t\t\t\tavatar={player.avatar}\r\n\t\t\t\t\t\tcolor={player.nameColor}\r\n\t\t\t\t\t\tnoLink\r\n\t\t\t\t\t\tsmall />\r\n\t\t\t\t}\r\n\t\t\t\t{message.senderId == \"anonymous\" &&\r\n\t\t\t\t\t<div className=\"name-with-avatar\">\r\n\t\t\t\t\t\tAnonymous\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div className={contentClass} style={player && player.textColor ? { color: player.textColor } : {}}>\r\n\t\t\t\t{!message.isQuote &&\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t{message.prefix &&\r\n\t\t\t\t\t\t\t<div className=\"prefix\">\r\n\t\t\t\t\t\t\t\t({message.prefix})\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<UserText\r\n\t\t\t\t\t\t\ttext={message.content}\r\n\t\t\t\t\t\t\tsettings={user.settings}\r\n\t\t\t\t\t\t\tfilterProfanity\r\n\t\t\t\t\t\t\tlinkify\r\n\t\t\t\t\t\t\temotify />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\t{message.isQuote &&\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<i className=\"fas fa-quote-left\" />\r\n\t\t\t\t\t\t<Timestamp time={quotedMessage.time} />\r\n\t\t\t\t\t\t<div className=\"quote-info\">\r\n\t\t\t\t\t\t\t{`${quotedMessage.senderName} in ${quotedMessage.meetingName}: `}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"quote-content\">\r\n\t\t\t\t\t\t\t<UserText\r\n\t\t\t\t\t\t\t\ttext={quotedMessage.content}\r\n\t\t\t\t\t\t\t\tsettings={user.settings}\r\n\t\t\t\t\t\t\t\tfilterProfanity\r\n\t\t\t\t\t\t\t\tlinkify\r\n\t\t\t\t\t\t\t\temotify />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<i className=\"fas fa-quote-right\" />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function Timestamp(props) {\r\n\tconst time = new Date(props.time);\r\n\tvar hours = String(time.getHours()).padStart(2, \"0\");\r\n\tvar minutes = String(time.getMinutes()).padStart(2, \"0\");\r\n\tvar seconds = String(time.getSeconds()).padStart(2, \"0\");\r\n\r\n\treturn (\r\n\t\t<div className=\"time\">\r\n\t\t\t{hours}:{minutes}:{seconds}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction SpeechInput(props) {\r\n\tconst socket = props.socket;\r\n\tconst meetings = props.meetings;\r\n\tconst selTab = props.selTab;\r\n\tconst players = props.players;\r\n\tconst options = props.options;\r\n\tconst agoraClient = props.agoraClient;\r\n\tconst localAudioTrack = props.localAudioTrack;\r\n\tconst muted = props.muted;\r\n\tconst setMuted = props.setMuted;\r\n\tconst deafened = props.deafened;\r\n\tconst setDeafened = props.setDeafened;\r\n\r\n\tconst [speechInput, setSpeechInput] = useState(\"\");\r\n\tconst [speechDropdownOptions, setSpeechDropdownOptions] = useState([]);\r\n\tconst [speechDropdownValue, setSpeechDropdownValue] = useState(\"Say\");\r\n\tconst [lastTyped, setLastTyped] = useState(0);\r\n\tconst [typingIn, setTypingIn] = useState();\r\n\tconst [clearTyping, setClearTyping] = useState();\r\n\r\n\tvar placeholder = \"\";\r\n\r\n\tfor (let option of speechDropdownOptions) {\r\n\t\tif (speechDropdownValue == option.id) {\r\n\t\t\tplaceholder = option.placeholder || \"\";\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!selTab)\r\n\t\t\treturn;\r\n\r\n\t\tconst speechAbilities = meetings[selTab].speechAbilities;\r\n\t\tconst newDropdownOptions = [{ label: \"Say\", id: \"Say\", placeholder: \"to everyone\" }];\r\n\r\n\t\tfor (let ability of speechAbilities) {\r\n\t\t\tnewDropdownOptions.push(\"divider\");\r\n\r\n\t\t\tfor (let target of ability.targets) {\r\n\t\t\t\tlet targetDisplay = target;\r\n\r\n\t\t\t\tif (ability.targetType == \"player\")\r\n\t\t\t\t\ttargetDisplay = players[target].name;\r\n\r\n\t\t\t\tnewDropdownOptions.push({\r\n\t\t\t\t\tlabel: ability.name,\r\n\t\t\t\t\tplaceholder: `${ability.verb} ${targetDisplay}`,\r\n\t\t\t\t\tid: `${ability.name}:${target}`\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetSpeechDropdownOptions(newDropdownOptions);\r\n\t}, [selTab]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (lastTyped > 0) {\r\n\t\t\tclearTimeout(clearTyping);\r\n\t\t\tsetClearTyping(setTimeout(() => setLastTyped(0), 1000));\r\n\r\n\t\t\tif (typingIn != selTab) {\r\n\t\t\t\tsetTypingIn(selTab);\r\n\r\n\t\t\t\tif (typingIn != null)\r\n\t\t\t\t\tsocket.send(\"typing\", { meetingId: typingIn, isTyping: false });\r\n\r\n\t\t\t\tsocket.send(\"typing\", { meetingId: selTab, isTyping: true });\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (typingIn != null) {\r\n\t\t\tsetTypingIn(null);\r\n\t\t\tsocket.send(\"typing\", { meetingId: typingIn, isTyping: false });\r\n\t\t}\r\n\r\n\t}, [lastTyped]);\r\n\r\n\tfunction onSpeechDropdownChange(value) {\r\n\t\tsetSpeechDropdownValue(value);\r\n\t}\r\n\r\n\tfunction onSpeechType(e) {\r\n\t\tsetSpeechInput(e.target.value);\r\n\t\tsetLastTyped(Date.now());\r\n\t}\r\n\r\n\tfunction onSpeechSubmit(e) {\r\n\t\tif (e.key == \"Enter\" && selTab && speechInput.length) {\r\n\t\t\tconst abilityInfo = speechDropdownValue.split(\":\");\r\n\t\t\tvar abilityName = abilityInfo[0];\r\n\t\t\tvar abilityTarget = abilityInfo[1];\r\n\r\n\t\t\tif (abilityName == \"Say\")\r\n\t\t\t\tabilityName = null;\r\n\r\n\t\t\tsocket.send(\"speak\", {\r\n\t\t\t\tcontent: speechInput,\r\n\t\t\t\tmeetingId: selTab,\r\n\t\t\t\tabilityName,\r\n\t\t\t\tabilityTarget\r\n\t\t\t});\r\n\r\n\t\t\tsetSpeechInput(\"\");\r\n\t\t\tprops.setAutoScroll(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onMute() {\r\n\t\tif (localAudioTrack.current) {\r\n\t\t\tvar volume = muted ? 100 : 0;\r\n\r\n\t\t\tlocalAudioTrack.current.setVolume(volume);\r\n\t\t\tsetMuted(!muted);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onDeafen() {\r\n\t\tif (agoraClient.current) {\r\n\t\t\tvar volume = deafened ? 100 : 0;\r\n\r\n\t\t\tagoraClient.current.remoteUsers.forEach(user => {\r\n\t\t\t\tuser.audioTrack && user.audioTrack.setVolume(volume);\r\n\t\t\t});\r\n\r\n\t\t\tsetDeafened(!deafened);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"speech-input-area\">\r\n\t\t\t<div className=\"speech-input-wrapper\">\r\n\t\t\t\t<Dropdown\r\n\t\t\t\t\tclassName=\"speech-dropdown\"\r\n\t\t\t\t\toptions={speechDropdownOptions}\r\n\t\t\t\t\tonChange={onSpeechDropdownChange}\r\n\t\t\t\t\tvalue={speechDropdownValue} />\r\n\t\t\t\t<input\r\n\t\t\t\t\tid=\"speechInput\"\r\n\t\t\t\t\tclassName=\"speech-input\"\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tautoComplete=\"off\"\r\n\t\t\t\t\tvalue={speechInput}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tmaxLength={MaxGameMessageLength}\r\n\t\t\t\t\tonChange={onSpeechType}\r\n\t\t\t\t\tonKeyPress={onSpeechSubmit} />\r\n\t\t\t</div>\r\n\t\t\t{options.voiceChat &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<i className={`fas fa-microphone ${muted ? \"disabled\" : \"\"}`} onClick={onMute} />\r\n\t\t\t\t\t<i className={`fas fa-headphones ${deafened ? \"disabled\" : \"\"}`} onClick={onDeafen} />\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function StateSwitcher(props) {\r\n\tconst history = props.history;\r\n\tconst stateViewing = props.stateViewing;\r\n\tconst stateName = history.states[stateViewing] ? history.states[stateViewing].name : \"\";\r\n\r\n\tconst leftArrowVisible = props.stateViewing != -1;\r\n\tconst rigthArrowVisible =\r\n\t\tprops.stateViewing < history.currentState ||\r\n\t\t(history.currentState == -2 && props.stateViewing != history.currentState);\r\n\r\n\tfunction onStateNameClick() {\r\n\t\tprops.updateStateViewing({ type: \"current\" });\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"state-nav\">\r\n\t\t\t<i\r\n\t\t\t\tclassName={`hist-arrow fas fa-caret-left ${leftArrowVisible ? \"\" : \"invisible\"}`}\r\n\t\t\t\tonClick={() => props.updateStateViewing({ type: \"backward\" })} />\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"state-name\"\r\n\t\t\t\tonClick={onStateNameClick}>\r\n\t\t\t\t{stateName.toUpperCase()}\r\n\t\t\t</div>\r\n\t\t\t<i\r\n\t\t\t\tclassName={`hist-arrow fas fa-caret-right ${rigthArrowVisible ? \"\" : \"invisible\"}`}\r\n\t\t\t\tonClick={() => props.updateStateViewing({ type: \"forward\" })} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function formatTimerTime(time) {\r\n\tif (time > 0)\r\n\t\ttime = Math.round(time / 1000);\r\n\telse\r\n\t\ttime = 0;\r\n\r\n\tconst minutes = String(Math.floor(time / 60)).padStart(2, \"0\");\r\n\tconst seconds = String(time % 60).padStart(2, \"0\");\r\n\r\n\treturn `${minutes}:${seconds}`;\r\n}\r\n\r\nexport function SideMenu(props) {\r\n\treturn (\r\n\t\t<div className={`side-menu ${props.scrollable ? \"scrollable\" : \"\"}`}>\r\n\t\t\t<div className=\"side-menu-title\">\r\n\t\t\t\t{props.title}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"side-menu-content\">\r\n\t\t\t\t{props.content}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function PlayerRows(props) {\r\n\tconst history = props.history;\r\n\tconst players = props.players;\r\n\tconst activity = props.activity;\r\n\tconst stateViewingInfo = history.states[props.stateViewing];\r\n\tconst selTab = stateViewingInfo && stateViewingInfo.selTab;\r\n\r\n\tconst rows = players.map(player => (\r\n\t\t<div\r\n\t\t\tclassName={`player ${props.className ? props.className : \"\"}`}\r\n\t\t\tkey={player.id}>\r\n\t\t\t{props.stateViewing != -1 &&\r\n\t\t\t\t<RoleCount\r\n\t\t\t\t\trole={stateViewingInfo.roles[player.id]}\r\n\t\t\t\t\tgameType={props.gameType}\r\n\t\t\t\t\tshowPopover />\r\n\t\t\t}\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={player.userId}\r\n\t\t\t\tname={player.name}\r\n\t\t\t\tavatar={player.avatar}\r\n\t\t\t\tcolor={player.nameColor}\r\n\t\t\t\tactive={activity.speaking[player.id]}\r\n\t\t\t\tnewTab />\r\n\t\t\t{selTab && activity.typing[player.id] == selTab &&\r\n\t\t\t\t<ReactLoading\r\n\t\t\t\t\tclassName={`typing-icon ${props.stateViewing != -1 ? \"has-role\" : \"\"}`}\r\n\t\t\t\t\ttype=\"bubbles\"\r\n\t\t\t\t\tcolor=\"white\"\r\n\t\t\t\t\twidth=\"20\"\r\n\t\t\t\t\theight=\"20\" />\r\n\t\t\t}\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn rows;\r\n}\r\n\r\nexport function PlayerList(props) {\r\n\tconst history = props.history;\r\n\tconst stateViewingInfo = history.states[props.stateViewing];\r\n\tconst alivePlayers = Object.values(props.players).filter(p => !stateViewingInfo.dead[p.id] && !p.left);\r\n\tconst deadPlayers = Object.values(props.players).filter(p => stateViewingInfo.dead[p.id] && !p.left);\r\n\r\n\treturn (\r\n\t\t<SideMenu\r\n\t\t\ttitle=\"Players\"\r\n\t\t\tscrollable\r\n\t\t\tcontent={\r\n\t\t\t\t<div className=\"player-list\">\r\n\t\t\t\t\t<PlayerRows\r\n\t\t\t\t\t\tplayers={alivePlayers}\r\n\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\tgameType={props.gameType}\r\n\t\t\t\t\t\tstateViewing={props.stateViewing}\r\n\t\t\t\t\t\tactivity={props.activity} />\r\n\t\t\t\t\t{deadPlayers.length > 0 &&\r\n\t\t\t\t\t\t<div className=\"section-title\">\r\n\t\t\t\t\t\t\t<i className=\"fas fa-skull\" />\r\n\t\t\t\t\t\t\tGraveyard\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<PlayerRows\r\n\t\t\t\t\t\tplayers={deadPlayers}\r\n\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\tgameType={props.gameType}\r\n\t\t\t\t\t\tstateViewing={props.stateViewing}\r\n\t\t\t\t\t\tactivity={props.activity}\r\n\t\t\t\t\t\tclassName=\"dead\" />\r\n\t\t\t\t</div>\r\n\t\t\t} />\r\n\t);\r\n}\r\n\r\nexport function ActionList(props) {\r\n\tconst actions = Object.values(props.meetings).reduce((actions, meeting) => {\r\n\t\tif (meeting.voting) {\r\n\t\t\tvar action;\r\n\r\n\t\t\tswitch (meeting.inputType) {\r\n\t\t\t\tcase \"player\":\r\n\t\t\t\tcase \"boolean\":\r\n\t\t\t\tcase \"alignment\":\r\n\t\t\t\tcase \"select\":\r\n\t\t\t\t\taction =\r\n\t\t\t\t\t\t<ActionSelect\r\n\t\t\t\t\t\t\tkey={meeting.id}\r\n\t\t\t\t\t\t\tsocket={props.socket}\r\n\t\t\t\t\t\t\tmeeting={meeting}\r\n\t\t\t\t\t\t\tplayers={props.players}\r\n\t\t\t\t\t\t\tself={props.self}\r\n\t\t\t\t\t\t\thistory={props.history}\r\n\t\t\t\t\t\t\tstateViewing={props.stateViewing} />;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"button\":\r\n\t\t\t\t\taction =\r\n\t\t\t\t\t\t<ActionButton\r\n\t\t\t\t\t\t\tkey={meeting.id}\r\n\t\t\t\t\t\t\tsocket={props.socket}\r\n\t\t\t\t\t\t\tmeeting={meeting}\r\n\t\t\t\t\t\t\tplayers={props.players}\r\n\t\t\t\t\t\t\tself={props.self}\r\n\t\t\t\t\t\t\thistory={props.history}\r\n\t\t\t\t\t\t\tstateViewing={props.stateViewing} />;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\t\taction =\r\n\t\t\t\t\t\t<ActionText\r\n\t\t\t\t\t\t\tkey={meeting.id}\r\n\t\t\t\t\t\t\tsocket={props.socket}\r\n\t\t\t\t\t\t\tmeeting={meeting}\r\n\t\t\t\t\t\t\tplayers={props.players}\r\n\t\t\t\t\t\t\tself={props.self}\r\n\t\t\t\t\t\t\thistory={props.history}\r\n\t\t\t\t\t\t\tstateViewing={props.stateViewing} />;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tactions.push(action);\r\n\t\t}\r\n\t\treturn actions;\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{actions.length > 0 &&\r\n\t\t\t\t<SideMenu\r\n\t\t\t\t\tscrollable\r\n\t\t\t\t\ttitle=\"Actions\"\r\n\t\t\t\t\tcontent={\r\n\t\t\t\t\t\t<div className=\"action-list\">\r\n\t\t\t\t\t\t\t{actions}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t} />\r\n\t\t\t}\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nfunction ActionSelect(props) {\r\n\tconst [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n\tconst [menuVisible, setMenuVisible, dropdownContainerRef, dropdownMenuRef] = useDropdown();\r\n\r\n\tconst targets = meeting.targets.map(target => {\r\n\t\tvar targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"target dropdown-menu-option\"\r\n\t\t\t\tkey={target}\r\n\t\t\t\tonClick={() => onSelectVote(target)}>\r\n\t\t\t\t{targetDisplay}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tconst votes = Object.values(meeting.members).filter(member => member.canVote).map(member => {\r\n\t\tvar selection = meeting.votes[member.id];\r\n\t\tvar player = props.players[member.id];\r\n\t\tselection = getTargetDisplay(selection, meeting, props.players);\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`vote ${meeting.multi ? \"multi\" : \"\"}`}\r\n\t\t\t\tkey={member.id}>\r\n\t\t\t\t<div className=\"voter\">\r\n\t\t\t\t\t{(player && player.name) || \"Anonymous\"}\r\n\t\t\t\t</div>\r\n\t\t\t\t{\r\n\t\t\t\t\tselection.length > 0 &&\r\n\t\t\t\t\t<div className=\"italic\">\r\n\t\t\t\t\t\tvotes\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"selection\">\r\n\t\t\t\t\t{selection.join(\", \")}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tfunction onSelectVote(sel) {\r\n\t\tsetMenuVisible(false);\r\n\t\tonVote(sel);\r\n\t}\r\n\r\n\tfunction onActionClick() {\r\n\t\tif (!notClickable)\r\n\t\t\tsetMenuVisible(!menuVisible);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"action\">\r\n\t\t\t<div\r\n\t\t\t\tclassName={`action-name dropdown-control ${notClickable ? \"not-clickable\" : \"\"}`}\r\n\t\t\t\tref={dropdownContainerRef}\r\n\t\t\t\tonClick={onActionClick}>\r\n\t\t\t\t{meeting.actionName}\r\n\t\t\t\t<i className=\"fas fa-angle-down dropdown-arrow\" />\r\n\t\t\t</div>\r\n\t\t\t{menuVisible &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"targets dropdown-menu\"\r\n\t\t\t\t\tref={dropdownMenuRef}>\r\n\t\t\t\t\t{targets}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t<div className=\"votes\">\r\n\t\t\t\t{votes}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ActionButton(props) {\r\n\tconst [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n\tconst votes = { ...meeting.votes };\r\n\r\n\tfor (let playerId in votes)\r\n\t\tvotes[playerId] = getTargetDisplay(votes[playerId], meeting, props.players);\r\n\r\n\tconst buttons = meeting.targets.map(target => {\r\n\t\tvar targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`btn btn-theme ${votes[props.self] == targetDisplay ? \"sel\" : \"\"}`}\r\n\t\t\t\tkey={target}\r\n\t\t\t\tdisabled={votes[props.self] && !meeting.canUnvote}\r\n\t\t\t\tonClick={() => onVote(target)}>\r\n\t\t\t\t{targetDisplay}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"action\">\r\n\t\t\t<div className=\"action-name\">\r\n\t\t\t\t{meeting.actionName}\r\n\t\t\t</div>\r\n\t\t\t{buttons}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ActionText(props) {\r\n\tconst [meeting, history, stateViewing, isCurrentState, notClickable, onVote] = useAction(props);\r\n\tconst [inputValue, setInputValue] = useState(\"\");\r\n\tconst votes = { ...meeting.votes };\r\n\r\n\tif (inputValue.length == 0 && votes[props.self])\r\n\t\tsetInputValue(votes[props.self]);\r\n\r\n\tconst buttons = meeting.targets.map(target => {\r\n\t\tvar targetDisplay = getTargetDisplay(target, meeting, props.players);\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`btn btn-theme ${votes[props.self] == targetDisplay ? \"sel\" : \"\"}`}\r\n\t\t\t\tkey={target}\r\n\t\t\t\tonClick={() => onVote(target)}>\r\n\t\t\t\t{targetDisplay}\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tfunction onInputChange(e) {\r\n\t\tonVote(e.target.value);\r\n\t\tsetInputValue(e.target.value);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"action\">\r\n\t\t\t<input\r\n\t\t\t\tvalue={inputValue}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction useAction(props) {\r\n\tconst meeting = props.meeting;\r\n\tconst history = props.history;\r\n\tconst stateViewing = props.stateViewing;\r\n\tconst isCurrentState = stateViewing == history.currentState;\r\n\tconst notClickable = !isCurrentState || !meeting.amMember || !meeting.canVote || (meeting.instant && meeting.votes[props.self]);\r\n\r\n\tfunction onVote(sel) {\r\n\t\tvar isUnvote;\r\n\r\n\t\tif (!Array.isArray(meeting.votes[props.self]))\r\n\t\t\tisUnvote = sel == meeting.votes[props.self];\r\n\t\telse\r\n\t\t\tisUnvote = meeting.votes[props.self].indexOf(sel) != -1;\r\n\r\n\t\tif (!isUnvote) {\r\n\t\t\tprops.socket.send(\"vote\", {\r\n\t\t\t\tmeetingId: meeting.id,\r\n\t\t\t\tselection: sel\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tprops.socket.send(\"unvote\", {\r\n\t\t\t\tmeetingId: meeting.id,\r\n\t\t\t\tselection: sel\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn [meeting, history, stateViewing, isCurrentState, notClickable, onVote];\r\n}\r\n\r\nfunction getTargetDisplay(targets, meeting, players) {\r\n\tif (!Array.isArray(targets) && targets)\r\n\t\ttargets = [targets];\r\n\telse if (!targets)\r\n\t\ttargets = [];\r\n\telse\r\n\t\ttargets = [...targets];\r\n\r\n\tfor (let i in targets) {\r\n\t\tlet target = targets[i];\r\n\r\n\t\tswitch (meeting.inputType) {\r\n\t\t\tcase \"player\":\r\n\t\t\t\tif (target == \"*\")\r\n\t\t\t\t\ttarget = \"no one\";\r\n\t\t\t\telse if (target)\r\n\t\t\t\t\ttarget = players[target].name;\r\n\t\t\t\telse\r\n\t\t\t\t\ttarget = \"\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"boolean\":\r\n\t\t\t\tif (target == \"*\")\r\n\t\t\t\t\ttarget = \"No\";\r\n\t\t\t\telse if (!target)\r\n\t\t\t\t\ttarget = \"\";\r\n\t\t\tdefault:\r\n\t\t\t\tif (target == \"*\")\r\n\t\t\t\t\ttarget = \"None\";\r\n\t\t\t\telse if (!target)\r\n\t\t\t\t\ttarget = \"\";\r\n\t\t}\r\n\r\n\t\ttargets[i] = target;\r\n\t}\r\n\r\n\treturn targets;\r\n}\r\n\r\nexport function Timer(props) {\r\n\tvar timerName;\r\n\r\n\tif (props.history.currentState == -1)\r\n\t\ttimerName = \"pregameCountdown\";\r\n\telse if (props.timers[\"secondary\"])\r\n\t\ttimerName = \"secondary\";\r\n\telse\r\n\t\ttimerName = \"main\";\r\n\r\n\tconst timer = props.timers[timerName];\r\n\r\n\tif (!timer)\r\n\t\treturn <div className=\"state-timer\"></div>;\r\n\r\n\tvar time = timer.delay - timer.time;\r\n\ttime = formatTimerTime(time);\r\n\r\n\treturn (\r\n\t\t<div className=\"state-timer\">\r\n\t\t\t{time}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function LastWillEntry(props) {\r\n\tconst [lastWill, setLastWill] = useState(props.lastWill);\r\n\r\n\tfunction onWillChange(e) {\r\n\t\tvar newWill = e.target.value.slice(0, MaxWillLength);\r\n\t\tsetLastWill(newWill);\r\n\t\tprops.socket.send(\"lastWill\", newWill);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<SideMenu\r\n\t\t\ttitle=\"Last Will\"\r\n\t\t\tcontent={\r\n\t\t\t\t<div className=\"last-will-wrapper\">\r\n\t\t\t\t\t<textarea\r\n\t\t\t\t\t\tclassName=\"last-will-entry\"\r\n\t\t\t\t\t\tvalue={lastWill}\r\n\t\t\t\t\t\tonChange={onWillChange} />\r\n\t\t\t\t</div>\r\n\t\t\t} />\r\n\t);\r\n}\r\n\r\nfunction SettingsModal(props) {\r\n\tconst settings = props.settings;\r\n\tconst updateSettings = props.updateSettings;\r\n\tconst showModal = props.showModal;\r\n\tconst setShowModal = props.setShowModal;\r\n\tconst [formFields, updateFormFields] = useForm([\r\n\t\t{\r\n\t\t\tlabel: \"Voting Log\",\r\n\t\t\tref: \"votingLog\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tvalue: settings.votingLog\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Timestamps\",\r\n\t\t\tref: \"timestamps\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tvalue: settings.timestamps\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Sounds\",\r\n\t\t\tref: \"sounds\",\r\n\t\t\ttype: \"boolean\",\r\n\t\t\tvalue: settings.sounds\r\n\t\t},\r\n\t\t{\r\n\t\t\tlabel: \"Volume\",\r\n\t\t\tref: \"volume\",\r\n\t\t\ttype: \"range\",\r\n\t\t\tmin: 0,\r\n\t\t\tmax: 1,\r\n\t\t\tstep: 0.1,\r\n\t\t\tvalue: settings.volume\r\n\t\t},\r\n\t]);\r\n\r\n\tconst modalHeader = \"Settings\";\r\n\r\n\tconst modalContent = (\r\n\t\t<Form\r\n\t\t\tfields={formFields}\r\n\t\t\tonChange={updateFormFields} />\r\n\t);\r\n\r\n\tconst modalFooter = (\r\n\t\t<div className=\"settings-control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"settings-save btn btn-theme\"\r\n\t\t\t\tonClick={saveSettings}>\r\n\t\t\t\tSave\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"settings-cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={cancel}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\tfunction cancel() {\r\n\t\tfor (let field of formFields) {\r\n\t\t\tupdateFormFields({\r\n\t\t\t\tref: field.ref,\r\n\t\t\t\tprop: \"value\",\r\n\t\t\t\tvalue: settings[field.ref]\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tsetShowModal(false);\r\n\t}\r\n\r\n\tfunction saveSettings() {\r\n\t\tvar newSettings = {};\r\n\r\n\t\tfor (let field of formFields)\r\n\t\t\tnewSettings[field.ref] = field.value;\r\n\r\n\t\tupdateSettings({\r\n\t\t\ttype: \"set\",\r\n\t\t\tsettings: newSettings\r\n\t\t});\r\n\r\n\t\tsetShowModal(false);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\tclassName=\"settings\"\r\n\t\t\tshow={showModal}\r\n\t\t\theader={modalHeader}\r\n\t\t\tcontent={modalContent}\r\n\t\t\tfooter={modalFooter}\r\n\t\t\tonBgClick={cancel} />\r\n\t);\r\n}\r\n\r\nfunction FirstGameModal(props) {\r\n\tconst showModal = props.showModal;\r\n\tconst setShowModal = props.setShowModal;\r\n\r\n\tconst modalHeader = \"Welcome to BeyondMafia\";\r\n\r\n\tconst modalContent = (\r\n\t\t<>\r\n\t\t\t<div className=\"paragraph\">\r\n\t\t\t\tTo keep games fun and competitive for all, please don't:\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"paragraph\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Communicate with other players using anything which isn't part of the game.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Form alliances or other out-of-game arrangements with other users.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Attempt to play a game using more than one account.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Send screenshots or \"prove\" anything with images or video.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Copy exactly any system messages you recieve (blue text).\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Try to lose the game on purpose.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Give up or leave partway through the game.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t- Issue out-of-game bribes or threats to sway other players, including threatening to leave.\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"paragraph\">\r\n\t\t\t\tBreaking game conduct may result in necessary action being taken against your account.\r\n\t\t\t</div>\r\n\t\t\t<div className=\"paragraph\">\r\n\t\t\t\tA full description of these rules as well as site and community rules is found <a>here</a>.\r\n\t\t\t</div>\r\n\t\t\t<div className=\"paragraph\">\r\n\t\t\t\tYou can also find tutorials, tips, and strategy guides <a href=\"/community/forums/board/SLsDA_SI2\">here</a>. Good luck, and have fun!\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n\r\n\tconst modalFooter = (\r\n\t\t<div\r\n\t\t\tclassName=\"btn btn-theme\"\r\n\t\t\tonClick={cancel}>\r\n\t\t\tClose\r\n\t\t</div>\r\n\t);\r\n\r\n\tfunction cancel() {\r\n\t\tsetShowModal(false);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\tclassName=\"first-game\"\r\n\t\t\tshow={showModal}\r\n\t\t\theader={modalHeader}\r\n\t\t\tcontent={modalContent}\r\n\t\t\tfooter={modalFooter}\r\n\t\t\tonBgClick={cancel} />\r\n\t);\r\n}\r\n\r\nexport function SpeechFilter(props) {\r\n\tconst filters = props.filters;\r\n\tconst setFilters = props.setFilters;\r\n\tconst stateViewing = props.stateViewing;\r\n\r\n\tfunction onFilter(type, value) {\r\n\t\tsetFilters(update(filters, {\r\n\t\t\t[type]: {\r\n\t\t\t\t$set: value\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\tif (stateViewing < 0)\r\n\t\treturn <></>;\r\n\r\n\treturn (\r\n\t\t<SideMenu\r\n\t\t\ttitle=\"Speech Filters\"\r\n\t\t\tcontent={\r\n\t\t\t\t<div className=\"speech-filters\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder=\"From user\"\r\n\t\t\t\t\t\tvalue={filters.from}\r\n\t\t\t\t\t\tonChange={(e) => onFilter(\"from\", e.target.value)} />\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder=\"Contains\"\r\n\t\t\t\t\t\tvalue={filters.contains}\r\n\t\t\t\t\t\tonChange={(e) => onFilter(\"contains\", e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t} />\r\n\t);\r\n}\r\n\r\nexport function Notes(props) {\r\n\tconst stateViewing = props.stateViewing;\r\n\tconst [notes, setNotes] = useState(\"\");\r\n\tconst { gameId } = useParams();\r\n\r\n\tuseEffect(() => {\r\n\t\tvar notesData = window.localStorage.getItem(\"notesData\");\r\n\r\n\t\tif (notesData) {\r\n\t\t\tnotesData = JSON.parse(notesData);\r\n\r\n\t\t\tif (notesData.game != gameId)\r\n\t\t\t\twindow.localStorage.removeItem(\"notesData\");\r\n\t\t\telse\r\n\t\t\t\tsetNotes(notesData.notes);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tfunction onNotesUpdate(_notes) {\r\n\t\tsetNotes(_notes);\r\n\t\twindow.localStorage.setItem(\"notesData\", JSON.stringify({ game: gameId, notes: _notes }));\r\n\t}\r\n\r\n\tif (stateViewing < 0)\r\n\t\treturn <></>;\r\n\r\n\treturn (\r\n\t\t<SideMenu\r\n\t\t\ttitle=\"Notes\"\r\n\t\t\tcontent={\r\n\t\t\t\t<div className=\"notes-wrapper\">\r\n\t\t\t\t\t<textarea\r\n\t\t\t\t\t\tclassName=\"notes-entry\"\r\n\t\t\t\t\t\tvalue={notes}\r\n\t\t\t\t\t\tonChange={(e) => onNotesUpdate(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t} />\r\n\t);\r\n}\r\n\r\nfunction useHistoryReducer() {\r\n\treturn useReducer((history, action) => {\r\n\t\tvar newHistory;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tvar stateIds = Object.keys(action.history).sort((a, b) => a - b);\r\n\t\t\t\tnewHistory = { states: action.history };\r\n\r\n\t\t\t\tif (stateIds[0] == -2)\r\n\t\t\t\t\tnewHistory.currentState = -2;\r\n\t\t\t\telse\r\n\t\t\t\t\tnewHistory.currentState = stateIds[stateIds.length - 1];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addState\":\r\n\t\t\t\tif (!history.states[action.state.id]) {\r\n\t\t\t\t\tvar prevState;\r\n\r\n\t\t\t\t\tif (action.state.id != -2)\r\n\t\t\t\t\t\tprevState = action.state.id - 1;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tprevState = Object.keys(history.states).sort((a, b) => b - a)[0];\r\n\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[action.state.id]: {\r\n\t\t\t\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\t\t\tname: action.state.name,\r\n\t\t\t\t\t\t\t\t\tmeetings: {},\r\n\t\t\t\t\t\t\t\t\talerts: [],\r\n\t\t\t\t\t\t\t\t\tstateEvents: [],\r\n\t\t\t\t\t\t\t\t\troles: { ...history.states[prevState].roles },\r\n\t\t\t\t\t\t\t\t\tdead: { ...history.states[prevState].dead }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcurrentState: {\r\n\t\t\t\t\t\t\t$set: action.state.id\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tnewHistory = history;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addMeeting\":\r\n\t\t\t\tvar state = history.states[history.currentState];\r\n\r\n\t\t\t\tif (state) {\r\n\t\t\t\t\tif (!state.meetings) {\r\n\t\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t\t$set: {}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnewHistory = update(newHistory || history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t[action.meeting.id]: {\r\n\t\t\t\t\t\t\t\t\t\t$set: action.meeting\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"meetingMembers\":\r\n\t\t\t\tif (\r\n\t\t\t\t\thistory.states[history.currentState] &&\r\n\t\t\t\t\thistory.states[history.currentState].meetings[action.meetingId]\r\n\t\t\t\t) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t[action.meetingId]: {\r\n\t\t\t\t\t\t\t\t\t\tmembers: {\r\n\t\t\t\t\t\t\t\t\t\t\t$set: action.members\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"removeMeeting\":\r\n\t\t\t\tif (history.states[history.currentState]) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t$unset: [action.meetingId]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (newHistory.states[history.currentState].selTab == action.meetingId) {\r\n\t\t\t\t\t\tnewHistory = update(newHistory, {\r\n\t\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\t\t$unset: [\"selTab\"]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addMessage\":\r\n\t\t\t\tif (history.states[history.currentState]) {\r\n\t\t\t\t\tif (action.message.meetingId) {\r\n\t\t\t\t\t\tif (history.states[history.currentState].meetings[action.message.meetingId]) {\r\n\t\t\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t\t\t[action.message.meetingId]: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$push: [action.message]\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\t\talerts: {\r\n\t\t\t\t\t\t\t\t\t\t$push: [action.message]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addQuote\":\r\n\t\t\t\tif (\r\n\t\t\t\t\thistory.states[history.currentState] &&\r\n\t\t\t\t\thistory.states[history.currentState].meetings[action.quote.toMeetingId]\r\n\t\t\t\t) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t[action.quote.toMeetingId]: {\r\n\t\t\t\t\t\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t\t\t\t\t\t$push: [action.quote]\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"vote\":\r\n\t\t\t\tvar target = action.vote.target;\r\n\t\t\t\tvar state = history.states[history.currentState];\r\n\t\t\t\tvar meeting = state && state.meetings[action.vote.meetingId];\r\n\r\n\t\t\t\tif (meeting) {\r\n\t\t\t\t\tif (meeting.multi)\r\n\t\t\t\t\t\ttarget = [...(meeting.votes[action.vote.voterId] || []), target];\r\n\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t[action.vote.meetingId]: {\r\n\t\t\t\t\t\t\t\t\t\tvotes: {\r\n\t\t\t\t\t\t\t\t\t\t\t[action.vote.voterId]: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t$set: target\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (!action.vote.noLog) {\r\n\t\t\t\t\t\tnewHistory = update(newHistory, {\r\n\t\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t\t[action.vote.meetingId]: {\r\n\t\t\t\t\t\t\t\t\t\t\tvoteRecord: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t$push: [{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"vote\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvoterId: action.vote.voterId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttarget: action.vote.target,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttime: Date.now()\r\n\t\t\t\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"unvote\":\r\n\t\t\t\tvar target = undefined;\r\n\t\t\t\tvar state = history.states[history.currentState];\r\n\t\t\t\tvar meeting = state && state.meetings[action.info.meetingId];\r\n\r\n\t\t\t\tif (meeting) {\r\n\t\t\t\t\tif (meeting.multi)\r\n\t\t\t\t\t\ttarget = (meeting.votes[action.info.voterId] || []).filter(t => t != action.info.target);\r\n\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tmeetings: {\r\n\t\t\t\t\t\t\t\t\t[action.info.meetingId]: {\r\n\t\t\t\t\t\t\t\t\t\tvotes: {\r\n\t\t\t\t\t\t\t\t\t\t\t[action.info.voterId]: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t$set: target\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tvoteRecord: {\r\n\t\t\t\t\t\t\t\t\t\t\t$push: [{\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"unvote\",\r\n\t\t\t\t\t\t\t\t\t\t\t\tvoterId: action.info.voterId,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttime: Date.now()\r\n\t\t\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"stateEvents\":\r\n\t\t\t\tif (history.states[history.currentState]) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tstateEvents: {\r\n\t\t\t\t\t\t\t\t\t$set: action.stateEvents\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"selTab\":\r\n\t\t\t\tif (history.states[action.state]) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[action.state]: {\r\n\t\t\t\t\t\t\t\tselTab: {\r\n\t\t\t\t\t\t\t\t\t$set: action.meetingId\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"reveal\":\r\n\t\t\t\tif (history.states[history.currentState]) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\troles: {\r\n\t\t\t\t\t\t\t\t\t[action.playerId]: {\r\n\t\t\t\t\t\t\t\t\t\t$set: action.role\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"death\":\r\n\t\t\t\tif (history.states[history.currentState]) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tdead: {\r\n\t\t\t\t\t\t\t\t\t[action.playerId]: {\r\n\t\t\t\t\t\t\t\t\t\t$set: true\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"revival\":\r\n\t\t\t\tif (history.states[history.currentState]) {\r\n\t\t\t\t\tnewHistory = update(history, {\r\n\t\t\t\t\t\tstates: {\r\n\t\t\t\t\t\t\t[history.currentState]: {\r\n\t\t\t\t\t\t\t\tdead: {\r\n\t\t\t\t\t\t\t\t\t[action.playerId]: {\r\n\t\t\t\t\t\t\t\t\t\t$set: false\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newHistory || history;\r\n\t}, { states: {} });\r\n}\r\n\r\nexport function useStateViewingReducer(history) {\r\n\treturn useReducer((state, action) => {\r\n\t\tvar newState;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"backward\":\r\n\t\t\t\tif (state > -2)\r\n\t\t\t\t\tnewState = state - 1;\r\n\t\t\t\telse\r\n\t\t\t\t\tnewState = Math.max(...Object.keys(history.states));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"forward\":\r\n\t\t\t\tif (history.states[state + 1])\r\n\t\t\t\t\tnewState = state + 1;\r\n\t\t\t\telse\r\n\t\t\t\t\tnewState = -2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"current\":\r\n\t\t\t\tnewState = history.currentState;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"first\":\r\n\t\t\t\tnewState = -1;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tnewState = state;\r\n\t\t}\r\n\r\n\t\tif (history.states[newState])\r\n\t\t\treturn newState;\r\n\t\telse\r\n\t\t\treturn state;\r\n\t}, history.currentState);\r\n}\r\n\r\nexport function useTimersReducer() {\r\n\treturn useReducer((timers, action) => {\r\n\t\tvar newTimers = { ...timers };\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"create\":\r\n\t\t\t\tnewTimers[action.timer.name] = {\r\n\t\t\t\t\tdelay: action.timer.delay,\r\n\t\t\t\t\ttime: 0\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"clear\":\r\n\t\t\t\tdelete newTimers[action.name];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"update\":\r\n\t\t\t\tnewTimers[action.name].time = action.time;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"updateAll\":\r\n\t\t\t\tfor (var timerName in newTimers)\r\n\t\t\t\t\tnewTimers[timerName].time += 1000;\r\n\r\n\t\t\t\tconst timer = newTimers[\"pregameCountdown\"] || newTimers[\"secondary\"] || newTimers[\"main\"];\r\n\r\n\t\t\t\tif (!timer)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tconst intTime = Math.round((timer.delay - timer.time) / 1000);\r\n\r\n\t\t\t\tif (intTime < 6 && intTime > 0)\r\n\t\t\t\t\taction.playAudio(\"tick\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newTimers;\r\n\t}, {});\r\n}\r\n\r\nexport function usePlayersReducer() {\r\n\treturn useReducer((players, action) => {\r\n\t\tvar newPlayers;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tnewPlayers = action.players;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"add\":\r\n\t\t\t\tif (!players[action.player.id]) {\r\n\t\t\t\t\tnewPlayers = update(players, {\r\n\t\t\t\t\t\t[action.player.id]: {\r\n\t\t\t\t\t\t\t$set: action.player\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tnewPlayers = update(players, {\r\n\t\t\t\t\t\t[action.player.id]: {\r\n\t\t\t\t\t\t\t$unset: [\"left\"]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"remove\":\r\n\t\t\t\tnewPlayers = update(players, {\r\n\t\t\t\t\t[action.playerId]: {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\t$set: true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setProp\":\r\n\t\t\t\tnewPlayers = update(players, {\r\n\t\t\t\t\t[action.playerId]: {\r\n\t\t\t\t\t\t[action.propName]: {\r\n\t\t\t\t\t\t\t$set: action.propVal\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newPlayers || players;\r\n\t}, {});\r\n}\r\n\r\nexport function useSettingsReducer() {\r\n\tconst defaultSettings = {\r\n\t\tvotingLog: false,\r\n\t\ttimestamps: true,\r\n\t\tsounds: true,\r\n\t\tvolume: 1,\r\n\t};\r\n\r\n\treturn useReducer((settings, action) => {\r\n\t\tvar newSettings;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"load\":\r\n\t\t\t\ttry {\r\n\t\t\t\t\tnewSettings = window.localStorage.getItem(\"gameSettings\");\r\n\t\t\t\t\tnewSettings = JSON.parse(newSettings);\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tnewSettings = settings;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"set\":\r\n\t\t\t\tnewSettings = action.settings;\r\n\t\t\t\twindow.localStorage.setItem(\"gameSettings\", JSON.stringify(newSettings));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setProp\":\r\n\t\t\t\tnewSettings = update(settings, {\r\n\t\t\t\t\t[action.propName]: {\r\n\t\t\t\t\t\t$set: action.propval\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\twindow.localStorage.setItem(\"gameSettings\", JSON.stringify(newSettings));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newSettings || settings;\r\n\t}, defaultSettings);\r\n}\r\n\r\nexport function useActivity(agoraClient, localAudioTrack) {\r\n\tconst volumeThreshold = 0.001;\r\n\tconst [activity, updateActivity] = useReducer((activity, action) => {\r\n\t\tvar newActivity;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"typing\":\r\n\t\t\t\tnewActivity = update(activity, {\r\n\t\t\t\t\ttyping: {\r\n\t\t\t\t\t\t[action.playerId]: {\r\n\t\t\t\t\t\t\t$set: action.meetingId\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"speaking\":\r\n\t\t\t\tvar newSpeaking = action.players.reduce((speaking, playerId) => {\r\n\t\t\t\t\tspeaking[playerId] = true;\r\n\t\t\t\t\treturn speaking;\r\n\t\t\t\t}, {});\r\n\r\n\t\t\t\tnewActivity = update(activity, {\r\n\t\t\t\t\tspeaking: {\r\n\t\t\t\t\t\t$set: newSpeaking\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newActivity || activity;\r\n\t}, { typing: {}, speaking: {} });\r\n\r\n\tuseEffect(() => {\r\n\t\tvar activityInterval = setInterval(() => {\r\n\t\t\tif (agoraClient.current) {\r\n\t\t\t\tvar speaking = [];\r\n\r\n\t\t\t\tif (localAudioTrack.current && localAudioTrack.current.getVolumeLevel() > volumeThreshold) {\r\n\t\t\t\t\tspeaking.push(agoraClient.current.uid);\r\n\t\t\t\t\tconsole.log(localAudioTrack.current.getVolumeLevel());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tagoraClient.current.remoteUsers.forEach(user => {\r\n\t\t\t\t\tif (user.audioTrack && user.audioTrack.getVolumeLevel() > volumeThreshold)\r\n\t\t\t\t\t\tspeaking.push(user.uid);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tupdateActivity({\r\n\t\t\t\t\ttype: \"speaking\",\r\n\t\t\t\t\tplayers: speaking\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}, 50);\r\n\r\n\t\treturn () => clearInterval(activityInterval);\r\n\t});\r\n\r\n\treturn [activity, updateActivity];\r\n}\r\n\r\nexport function useAudio(settings) {\r\n\tconst audioRef = useRef({});\r\n\r\n\tconst [audioInfo, updateAudio] = useReducer((audioInfo, action) => {\r\n\t\tvar newAudioInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"play\":\r\n\t\t\t\tif (!settings.sounds)\r\n\t\t\t\t\treturn audioInfo;\r\n\r\n\t\t\t\tif (audioInfo.overrides[action.audioName])\r\n\t\t\t\t\tfor (let audioName in audioInfo.overrides)\r\n\t\t\t\t\t\tif (audioInfo.overrides[audioName] && audioRef.current[audioName])\r\n\t\t\t\t\t\t\taudioRef.current[audioName].pause();\r\n\r\n\t\t\t\tif (audioRef.current[action.audioName]) {\r\n\t\t\t\t\taudioRef.current[action.audioName].currentTime = 0;\r\n\t\t\t\t\taudioRef.current[action.audioName].play().catch(e => { });\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"load\":\r\n\t\t\t\tnewAudioInfo = {\r\n\t\t\t\t\toverrides: { ...audioInfo.overrides },\r\n\t\t\t\t\tvolumes: { ...audioInfo.volumes }\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfor (let i in action.files) {\r\n\t\t\t\t\tlet fileName = action.files[i];\r\n\r\n\t\t\t\t\tif (!audioRef.current[fileName]) {\r\n\t\t\t\t\t\taudioRef.current[fileName] = new Audio(`/audio/${fileName}.mp3`);\r\n\t\t\t\t\t\taudioRef.current[fileName].load();\r\n\t\t\t\t\t\taudioRef.current[fileName].loop = action.loops[i];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnewAudioInfo.overrides[fileName] = action.overrides[i];\r\n\t\t\t\t\tnewAudioInfo.volumes[fileName] = action.volumes[i];\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"volume\":\r\n\t\t\t\tfor (let audioName in audioRef.current) {\r\n\t\t\t\t\tif (audioInfo.volumes[audioName])\r\n\t\t\t\t\t\taudioRef.current[audioName].volume = audioInfo.volumes[audioName] * action.volume;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newAudioInfo || audioInfo;\r\n\t}, { overrides: {}, volumes: {} });\r\n\r\n\tuseEffect(() => {\r\n\t\tupdateAudio({\r\n\t\t\ttype: \"volume\",\r\n\t\t\tvolume: settings.volume\r\n\t\t});\r\n\t}, [settings.volume, audioInfo]);\r\n\r\n\tfunction playAudio(audioName) {\r\n\t\tupdateAudio({\r\n\t\t\ttype: \"play\",\r\n\t\t\taudioName\r\n\t\t});\r\n\t}\r\n\r\n\tfunction loadAudioFiles(files, loops, overrides, volumes) {\r\n\t\tupdateAudio({\r\n\t\t\ttype: \"load\",\r\n\t\t\tfiles,\r\n\t\t\tloops,\r\n\t\t\toverrides,\r\n\t\t\tvolumes\r\n\t\t});\r\n\t}\r\n\r\n\tfunction stopAudio() {\r\n\t\tfor (let audioName in audioRef.current)\r\n\t\t\taudioRef.current[audioName].pause();\r\n\t}\r\n\r\n\tfunction stopAudios(audios) {\r\n\t\tfor (let audioName of audios)\r\n\t\t\taudioRef.current[audioName].pause();\r\n\t}\r\n\r\n\tfunction setVolume(volume) {\r\n\t\tupdateAudio({\r\n\t\t\ttype: \"volume\",\r\n\t\t\tvolume\r\n\t\t});\r\n\t}\r\n\r\n\treturn [playAudio, loadAudioFiles, stopAudio, stopAudios, setVolume];\r\n}\r\n\r\nasync function requestNotificationAccess() {\r\n\tif (!Notification)\r\n\t\treturn;\r\n\r\n\tawait Notification.requestPermission();\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { UserContext, SiteInfoContext } from \"../../Contexts\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\n\r\nimport \"../../css/userSearch.css\";\r\n\r\nexport default function Settings(props) {\r\n\tconst [userList, setUserList] = useState([]);\r\n\tconst [searchVal, setSearchVal] = useState(\"\");\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Users | BeyondMafia\";\r\n\r\n\t\taxios.get(\"/user/online\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetUserList(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(useErrorAlert);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchVal.length > 0) {\r\n\t\t\taxios.get(`/user/searchName?query=${searchVal}`)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetUserList(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(useErrorAlert);\r\n\t\t}\r\n\t\telse {\r\n\t\t\taxios.get(\"/user/online\")\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tsetUserList(res.data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(useErrorAlert);\r\n\t\t}\r\n\t}, [searchVal]);\r\n\r\n\tconst users = userList.map(user => (\r\n\t\t<div className=\"user-cell\">\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tid={user.id}\r\n\t\t\t\tname={user.name}\r\n\t\t\t\tavatar={user.avatar} />\r\n\t\t\t<StatusIcon status={user.status} />\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main user-search-page\">\r\n\t\t\t<div className=\"form\">\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tplaceholder=\"Username\"\r\n\t\t\t\t\tvalue={searchVal}\r\n\t\t\t\t\tonChange={(e) => setSearchVal(e.target.value)} />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"users\">\r\n\t\t\t\t{users}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { SearchSelect, UserSearchSelect } from \"../../components/Form\";\r\nimport { SiteInfoContext, UserContext } from \"../../Contexts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\nimport LoadingPage from \"../Loading\";\r\nimport { MaxBoardNameLength, MaxCategoryNameLength, MaxGroupNameLength, MaxBoardDescLength } from \"../../Constants\";\r\n\r\nimport \"../../css/moderation.css\";\r\n\r\nexport default function Moderation() {\r\n\tconst [groups, setGroups] = useState([]);\r\n\tconst [loaded, setLoaded] = useState(false);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Moderation | BeyondMafia\";\r\n\r\n\t\taxios.get(\"/mod/groups\")\r\n\t\t\t.then((res) => {\r\n\t\t\t\tsetGroups(res.data.sort((a, b) => b.rank - a.rank));\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t})\r\n\t\t\t.catch((e) => {\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t\terrorAlert(e);\r\n\t\t\t});\r\n\t}, []);\r\n\r\n\tconst groupsPanels = groups.map(group => {\r\n\t\tconst members = group.members.map(member => (\r\n\t\t\t<div className=\"member user-cell\" key={member.id}>\r\n\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\tid={member.id}\r\n\t\t\t\t\tname={member.name}\r\n\t\t\t\t\tavatar={member.avatar} />\r\n\t\t\t\t<StatusIcon status={member.status} />\r\n\t\t\t</div>\r\n\t\t));\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"span-panel group-panel\" key={group.name}>\r\n\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t{group.name + \"s\"}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"members\">\r\n\t\t\t\t\t{members}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tif (!loaded)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"moderation\">\r\n\t\t\t{user.perms.viewModActions &&\r\n\t\t\t\t<div className=\"span-panel action-panel\">\r\n\t\t\t\t\t<div className=\"title\">\r\n\t\t\t\t\t\tDo Action\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<ModCommands />\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t{groupsPanels}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ModCommands() {\r\n\tconst [command, setCommand] = useState();\r\n\tconst [argValues, setArgValues] = useState({});\r\n\tconst modCommands = useModCommands(argValues, commandRan);\r\n\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tvar options = [];\r\n\tvar args = [];\r\n\r\n\tfor (let commandName in modCommands)\r\n\t\tif (user.perms[modCommands[commandName].perm])\r\n\t\t\toptions.push(commandName);\r\n\r\n\tif (command) {\r\n\t\targs = modCommands[command].args.map(arg => {\r\n\t\t\tvar placeholder = arg.label;\r\n\r\n\t\t\tif (arg.default != null)\r\n\t\t\t\tplaceholder = `${placeholder} (${arg.default})`;\r\n\t\t\telse if (arg.optional)\r\n\t\t\t\tplaceholder = `[${placeholder}]`;\r\n\r\n\t\t\tif (arg.type == \"user_search\") {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<UserSearchSelect\r\n\t\t\t\t\t\tvalue={argValues[arg.name] || \"\"}\r\n\t\t\t\t\t\tsetValue={(value) => updateArgValue(arg.name, value, arg.isArray)}\r\n\t\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\t\tkey={arg.name} />\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<input\r\n\t\t\t\t\tclassName=\"arg\"\r\n\t\t\t\t\ttype={arg.type}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tmaxLength={arg.maxlength}\r\n\t\t\t\t\tonChange={(e) => updateArgValue(arg.name, e.target.value, arg.isArray)}\r\n\t\t\t\t\tkey={arg.name} />\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction updateArgValue(name, value, isArray) {\r\n\t\tif (isArray)\r\n\t\t\tvalue = value.split(/ *, */);\r\n\r\n\t\tsetArgValues(\r\n\t\t\tupdate(argValues, {\r\n\t\t\t\t[name]: {\r\n\t\t\t\t\t$set: value\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction commandRan() {\r\n\t\tsetCommand(null);\r\n\t\tsetArgValues({});\r\n\t}\r\n\r\n\tfunction onRunClick() {\r\n\t\tfor (let arg of modCommands[command].args) {\r\n\t\t\tif (argValues[arg.name] == null) {\r\n\t\t\t\tif (arg.default != null)\r\n\t\t\t\t\targValues[arg.name] = arg.default;\r\n\t\t\t\telse if (!arg.optional) {\r\n\t\t\t\t\terrorAlert(\"Missing arguments.\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmodCommands[command].run();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"mod-commands\">\r\n\t\t\t<div className=\"inputs\">\r\n\t\t\t\t<SearchSelect\r\n\t\t\t\t\toptions={options}\r\n\t\t\t\t\tvalue={command}\r\n\t\t\t\t\tsetValue={setCommand} />\r\n\t\t\t\t{args}\r\n\t\t\t</div>\r\n\t\t\t{command &&\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"btn btn-theme-sec submit\"\r\n\t\t\t\t\tonClick={onRunClick}>\r\n\t\t\t\t\tRun\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction useModCommands(argValues, commandRan) {\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\treturn {\r\n\t\t\"Create Group\": {\r\n\t\t\tperm: \"createGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\tdefault: 0\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Permissions\",\r\n\t\t\t\t\tname: \"permissions\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true,\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/group\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Group created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Group\": {\r\n\t\t\tperm: \"deleteGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/group/delete\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Group deleted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Create Category\": {\r\n\t\t\tperm: \"createCategory\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxCategoryNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Position\",\r\n\t\t\t\t\tname: \"position\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\tdefault: 0\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/category\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Category created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Create Board\": {\r\n\t\t\tperm: \"createBoard\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Category\",\r\n\t\t\t\t\tname: \"category\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxCategoryNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Description\",\r\n\t\t\t\t\tname: \"description\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardDescLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Icon\",\r\n\t\t\t\t\tname: \"icon\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Position\",\r\n\t\t\t\t\tname: \"position\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/board\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Board created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Update Group Permissions\": {\r\n\t\t\tperm: \"updateGroupPerms\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Group Name\",\r\n\t\t\t\t\tname: \"groupName\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Permissions to Add\",\r\n\t\t\t\t\tname: \"addPermissions\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true,\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Permissions to Remove\",\r\n\t\t\t\t\tname: \"removePermissions\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\toptional: true,\r\n\t\t\t\t\tisArray: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/groupPerms\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Group permissions updated.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Add User to Group\": {\r\n\t\t\tperm: \"giveGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Group Name\",\r\n\t\t\t\t\tname: \"groupName\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/addToGroup\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User added to group.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Remove User from Group\": {\r\n\t\t\tperm: \"removeFromGroup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Group Name\",\r\n\t\t\t\t\tname: \"groupName\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/removeFromGroup\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User removed from group.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get Group Permissions\": {\r\n\t\t\tperm: \"viewPerms\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxGroupNameLength\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/groupPerms?name=${argValues.name}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.join(\", \"), \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get User Permissions\": {\r\n\t\t\tperm: \"viewPerms\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/userPerms?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.join(\", \"), \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Board\": {\r\n\t\t\tperm: \"deleteBoard\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardNameLength\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/board/delete\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Board deleted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Move Thread\": {\r\n\t\t\tperm: \"moveThread\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Thread ID\",\r\n\t\t\t\t\tname: \"thread\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Board Name\",\r\n\t\t\t\t\tname: \"board\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/forums/thread/move\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Thread moved.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Create Chat Room\": {\r\n\t\t\tperm: \"createRoom\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tmaxlength: MaxBoardNameLength\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Position\",\r\n\t\t\t\t\tname: \"position\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Rank\",\r\n\t\t\t\t\tname: \"rank\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\toptional: true\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/chat/room\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Room created.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Delete Chat Room\": {\r\n\t\t\tperm: \"deleteRoom\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Room Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/chat/room/delete\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Room deleted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Forum Ban\": {\r\n\t\t\tperm: \"forumBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/forumBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User forum banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Chat Ban\": {\r\n\t\t\tperm: \"chatBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/chatBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User chat banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Game Ban\": {\r\n\t\t\tperm: \"gameBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/gameBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User game banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Host Ranked Ban\": {\r\n\t\t\tperm: \"hostRankedBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/hostRankedBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User host ranked banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Site Ban\": {\r\n\t\t\tperm: \"siteBan\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Length\",\r\n\t\t\t\t\tname: \"length\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/siteBan\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User site banned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Force Sign Out\": {\r\n\t\t\tperm: \"forceSignOut\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/logout\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User logged out.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Forum Unban\": {\r\n\t\t\tperm: \"forumUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/forumUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User forum unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Chat Unban\": {\r\n\t\t\tperm: \"chatUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/chatUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User chat unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Game Unban\": {\r\n\t\t\tperm: \"gameUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/gameUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User game unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Site Unban\": {\r\n\t\t\tperm: \"siteUnban\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/siteUnban\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User site unbanned.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get Alt Accounts\": {\r\n\t\t\tperm: \"viewAlts\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/alts?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.join(\", \"));\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Get Bans\": {\r\n\t\t\tperm: \"viewBans\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.get(`/mod/bans?userId=${argValues.userId}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\talert(res.data.map(ban => `Type: ${ban.type}, mod: ${ban.modId}, expires: ${(new Date(ban.expires)).toLocaleString()}`).join(\"\\n\"));\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Setup Name\": {\r\n\t\t\tperm: \"clearSetupName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Setup Id\",\r\n\t\t\t\t\tname: \"setupId\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearSetupName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Setup name cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Bio\": {\r\n\t\t\tperm: \"clearBio\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearBio\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Bio cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Account Display\": {\r\n\t\t\tperm: \"clearAccountDisplay\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAccountDisplay\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Account display cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Name\": {\r\n\t\t\tperm: \"clearName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Name cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear Avatar\": {\r\n\t\t\tperm: \"clearAvi\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAvi\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Avatar cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear All User Content\": {\r\n\t\t\tperm: \"clearAllUserContent\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAllContent\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User content cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Change Name\": {\r\n\t\t\tperm: \"changeName\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"New Name\",\r\n\t\t\t\t\tname: \"name\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/changeName\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Name changed.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Give Coins\": {\r\n\t\t\tperm: \"giveCoins\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Amount\",\r\n\t\t\t\t\tname: \"amount\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/giveCoins\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Coins given.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Break Game\": {\r\n\t\t\tperm: \"breakGame\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Game Id\",\r\n\t\t\t\t\tname: \"gameId\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/breakGame\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Game broken.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Toggle Featured Setup\": {\r\n\t\t\tperm: \"featureSetup\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"Setup Id\",\r\n\t\t\t\t\tname: \"setupId\",\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/setup/feature\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Setup feature toggled.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Clear All IPs\": {\r\n\t\t\tperm: \"clearAllIPs\",\r\n\t\t\targs: [],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/clearAllIPs\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"IPs cleared.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Whitelist User\": {\r\n\t\t\tperm: \"whitelist\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"User Name\",\r\n\t\t\t\t\tname: \"userId\",\r\n\t\t\t\t\ttype: \"user_search\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/whitelist\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"User whitelisted.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"Schedule Restart\": {\r\n\t\t\tperm: \"scheduleRestart\",\r\n\t\t\targs: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: \"When\",\r\n\t\t\t\t\tname: \"when\",\r\n\t\t\t\t\ttype: \"text\"\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\trun: function () {\r\n\t\t\t\taxios.post(\"/mod/scheduleRestart\", argValues)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsiteInfo.showAlert(\"Restart scheduled.\", \"success\");\r\n\t\t\t\t\t\tcommandRan();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(errorAlert);\r\n\t\t\t}\r\n\t\t},\r\n\t};\r\n}","import React from \"react\";\r\nimport { Route, Switch, Redirect } from \"react-router-dom\";\r\n\r\nimport Forums from \"./Forums/Forums\";\r\nimport UserSearch from \"./UserSearch\";\r\nimport Moderation from \"./Moderation\";\r\nimport { SubNav } from \"../../components/Nav\";\r\n\r\nexport default function Community() {\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Forums\",\r\n\t\t\tpath: `/community/forums`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Users\",\r\n\t\t\tpath: `/community/users`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Moderation\",\r\n\t\t\tpath: `/community/moderation`\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route path=\"/community/forums\" render={() => <Forums />} />\r\n\t\t\t\t\t<Route path=\"/community/users\" render={() => <UserSearch />} />\r\n\t\t\t\t\t<Route path=\"/community/moderation\" render={() => <Moderation />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/community/forums\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, sendEmailVerification } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { Modal } from \"../../components/Modal\";\r\nimport { SiteInfoContext } from \"../../Contexts\";\r\n\r\nexport default function LogIn() {\r\n\tconst [email, setEmail] = useState(\"\");\r\n\tconst [password, setPassword] = useState(\"\");\r\n\tconst [submitDisabled, setSubmitDisabled] = useState(true);\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [showResetPw, setShowResetPw] = useState(false);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Log In | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetSubmitDisabled(email.length == 0 || password.length == 0);\r\n\t}, [email, password]);\r\n\r\n\tasync function onSubmit(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (submitDisabled)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tsetLoading(true);\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tconst userCred = await signInWithEmailAndPassword(auth, email, password);\r\n\t\t\tconst idToken = await userCred.user.getIdToken(true);\r\n\t\t\taxios.post(\"/auth\", { idToken })\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\terrorAlert(e);\r\n\t\t\t\t\tsetLoading(false);\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (e.response && e.response.status == 403)\r\n\t\t\t\t\t\t\tsendEmailVerification(userCred.user);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tsetLoading(false);\r\n\r\n\t\t\tif (e.message.indexOf(\"(auth/wrong-password)\") != -1)\r\n\t\t\t\terrorAlert(\"Incorrect password.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/invalid-email)\") != -1)\r\n\t\t\t\terrorAlert(\"Invalid email.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/user-not-found)\") != -1)\r\n\t\t\t\terrorAlert(\"Account does not exist.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/too-many-requests)\") != -1)\r\n\t\t\t\terrorAlert(\"Too many login attempts on this account. Please try again later.\");\r\n\t\t\telse\r\n\t\t\t\terrorAlert(\"Error logging in.\");\r\n\t\t}\r\n\t}\r\n\r\n\tasync function onResetPw(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetShowResetPw(false);\r\n\t\t\tsetLoading(true);\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tawait sendPasswordResetEmail(auth, email);\r\n\r\n\t\t\tsiteInfo.showAlert(\"Password reset email sent.\", \"success\");\r\n\t\t\tsetLoading(false);\r\n\t\t} catch (e) {\r\n\t\t\terrorAlert(\"Error resetting password.\");\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}\r\n\r\n\tconst modalContent = (\r\n\t\t<form className=\"form\" onSubmit={onResetPw}>\r\n\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tEmail\r\n\t\t\t\t</div>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={email}\r\n\t\t\t\t\tonChange={(e) => setEmail(e.target.value)} />\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t);\r\n\tconst modalFooter = (\r\n\t\t<div className=\"control\">\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"reset btn btn-theme\"\r\n\t\t\t\tonClick={onResetPw}>\r\n\t\t\t\tReset\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"cancel btn btn-theme-third\"\r\n\t\t\t\tonClick={() => setShowResetPw(false)}>\r\n\t\t\t\tCancel\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tif (loading)\r\n\t\treturn <LoadingPage />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main login\">\r\n\t\t\t<form className=\"form\" onSubmit={onSubmit}>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tEmail\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={e => setEmail(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tPassword\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\t\tvalue={password}\r\n\t\t\t\t\t\tonChange={e => setPassword(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<a\r\n\t\t\t\t\tclassName=\"forgot-pw\"\r\n\t\t\t\t\thref=\"#\"\r\n\t\t\t\t\tonClick={() => setShowResetPw(true)}>\r\n\t\t\t\t\tForgot password?\r\n\t\t\t\t</a>\r\n\t\t\t\t<input className={`auth-btn ${submitDisabled ? \"disabled\" : \"\"}`} type=\"submit\" value=\"Log In\" />\r\n\t\t\t</form>\r\n\t\t\t<div className=\"legal\">\r\n\t\t\t\tBy logging in you agree to follow our <Link to=\"/legal/tos\">Terms of Service </Link>\r\n\t\t\t\tand accept our <Link to=\"/legal/privacy\">Privacy Policy</Link>.\r\n\t\t\t</div>\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"reset-pw\"\r\n\t\t\t\tshow={showResetPw}\r\n\t\t\t\tonBgClick={() => setShowResetPw(false)}\r\n\t\t\t\theader={\"Reset Password\"}\r\n\t\t\t\tcontent={modalContent}\r\n\t\t\t\tfooter={modalFooter} />\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link, Redirect } from \"react-router-dom\";\r\nimport { createUserWithEmailAndPassword, getAuth, sendEmailVerification } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LoadingPage from \"../Loading\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { SiteInfoContext } from \"../../Contexts\";\r\n\r\nexport default function SignUp() {\r\n\tconst [email, setEmail] = useState(\"\");\r\n\tconst [password, setPassword] = useState(\"\");\r\n\tconst [passwordConf, setPasswordConf] = useState(\"\");\r\n\tconst [submitDisabled, setSubmitDisabled] = useState(true);\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [signedUp, setSignedUp] = useState(false);\r\n\tconst siteInfo = useContext(SiteInfoContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Sign Up | BeyondMafia\";\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetSubmitDisabled(email.length == 0 || password.length == 0 || password != passwordConf);\r\n\t}, [email, password, passwordConf]);\r\n\r\n\tasync function onSubmit(e) {\r\n\t\ttry {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (submitDisabled)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tsetLoading(true);\r\n\r\n\t\t\tconst auth = getAuth();\r\n\t\t\tconst userCred = await createUserWithEmailAndPassword(auth, email, password);\r\n\t\t\tawait sendEmailVerification(userCred.user);\r\n\r\n\t\t\tsiteInfo.showAlert(\"Account created. Please click the verification link in your email before logging in. Be sure to check your spam folder.\", \"success\");\r\n\t\t\tsetSignedUp(true);\r\n\t\t\tsetLoading(false);\r\n\t\t} catch (e) {\r\n\t\t\tsetLoading(false);\r\n\r\n\t\t\tif (e.message.indexOf(\"(auth/invalid-email)\") != -1)\r\n\t\t\t\terrorAlert(\"Invalid email.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/weak-password)\") != -1)\r\n\t\t\t\terrorAlert(\"Password should be at least 6 characters.\");\r\n\t\t\telse if (e.message.indexOf(\"(auth/email-already-in-use)\") != -1)\r\n\t\t\t\terrorAlert(\"Email already in use.\");\r\n\t\t\telse\r\n\t\t\t\terrorAlert(\"Error signing up.\");\r\n\t\t}\r\n\t}\r\n\r\n\tif (loading)\r\n\t\treturn <LoadingPage />;\r\n\r\n\tif (signedUp)\r\n\t\treturn <Redirect to=\"/auth/login\" />;\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main login\">\r\n\t\t\t<form className=\"form\" onSubmit={onSubmit}>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tEmail\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={e => setEmail(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tPassword\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\t\tvalue={password}\r\n\t\t\t\t\t\tonChange={e => setPassword(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"field-wrapper\">\r\n\t\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\t\tConfirm Password\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\t\tvalue={passwordConf}\r\n\t\t\t\t\t\tonChange={e => setPasswordConf(e.target.value)} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<input className={`auth-btn ${submitDisabled ? \"disabled\" : \"\"}`} type=\"submit\" value=\"Sign Up\" />\r\n\t\t\t</form>\r\n\t\t\t<div className=\"legal\">\r\n\t\t\t\tBy signing up you agree to follow our <Link to=\"/legal/tos\">Terms of Service </Link>\r\n\t\t\t\tand accept our <Link to=\"/legal/privacy\">Privacy Policy</Link>, and that you are at least 13 years of age.\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useContext, useEffect } from \"react\";\r\nimport { Redirect, Switch, Route, useLocation } from \"react-router-dom\";\r\nimport { initializeApp } from \"firebase/app\";\r\nimport { getAuth, inMemoryPersistence } from \"firebase/auth\";\r\nimport axios from \"axios\";\r\n\r\nimport LogIn from \"./LogIn\";\r\nimport SignUp from \"./SignUp\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport { SubNav } from \"../../components/Nav\";\r\nimport LoadingPage from \"../Loading\";\r\n\r\nimport \"../../css/auth.css\"\r\n\r\nexport default function Auth() {\r\n\tconst user = useContext(UserContext);\r\n\tconst location = useLocation();\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Log In\",\r\n\t\t\tpath: \"/auth/login\",\r\n\t\t\texact: true\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Sign Up\",\r\n\t\t\tpath: \"/auth/signup\",\r\n\t\t\texact: true\r\n\t\t}\r\n\t];\r\n\r\n\tuseEffect(() => {\r\n\t\tconst params = new URLSearchParams(location.search);\r\n\r\n\t\tif (params.get(\"ref\"))\r\n\t\t\twindow.localStorage.setItem(\"referrer\", params.get(\"ref\"));\r\n\r\n\t\tconst fbConfig = {\r\n\t\t\tapiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n\t\t\tauthDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n\t\t\tprojectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\r\n\t\t\tstorageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n\t\t\tmessagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n\t\t\tappId: process.env.REACT_APP_FIREBASE_APP_ID,\r\n\t\t\tmeasurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\r\n\t\t};\r\n\t\tinitializeApp(fbConfig);\r\n\t\tgetAuth().setPersistence(inMemoryPersistence);\r\n\t}, []);\r\n\r\n\tif (!user.loaded)\r\n\t\treturn <LoadingPage />;\r\n\telse if (user.loggedIn)\r\n\t\treturn <Redirect to=\"/play\" />;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"auth inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/auth/login\">\r\n\t\t\t\t\t\t<LogIn />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route exact path=\"/auth/signup\">\r\n\t\t\t\t\t\t<SignUp />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/auth/login\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import React, { useEffect } from \"react\";\r\n\r\nexport default function PrivacyPolicy() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Privacy Policy | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>Privacy Policy of BeyondMafia</h1>\r\n\t\t\t<p>BeyondMafia operates the BeyondMafia.org website, which provides the SERVICE.</p>\r\n\t\t\t<p>This page is used to inform website visitors regarding our policies with the collection, use, and disclosure of Personal Information if anyone decided to use our Service, the BeyondMafia website.</p>\r\n\t\t\t<p>If you choose to use our Service, then you agree to the collection and use of information in relation with this policy. The Personal Information that we collect are used for providing and improving the Service. We will not use or share your information with anyone except as described in this Privacy Policy.</p>\t\t\t<p>The terms used in this Privacy Policy have the same meanings as in our Terms and Conditions, which is accessible at BeyondMafia.org, unless otherwise defined in this Privacy Policy. Our Privacy Policy was created with the help of the <a href=\"https://www.privacypolicytemplate.net\">Privacy Policy Template</a> and the <a href=\"https://www.disclaimer-template.net\">Disclaimer Template</a>.</p>\r\n\t\t\t<h2>Information Collection and Use</h2>\r\n\t\t\t<p>For a better experience while using our Service, we may require you to provide us with certain personally identifiable information, including but not limited to your email address and usernames on other services. You may also voluntarily upload any of your own personal information you wish for your profile, including but not limited to photos and textual data.</p>\r\n\t\t\t<h2>Log Data</h2>\r\n\t\t\t<p>We want to inform you that whenever you visit our Service, we collect information that your browser sends to us that is called Log Data. This Log Data may include information such as your computers Internet Protocol (\"IP\") address, browser version, pages of our Service that you visit, the time and date of your visit, the time spent on those pages, and other statistics.</p>\r\n\t\t\t<h2>Cookies</h2>\r\n\t\t\t<p>Cookies are files with small amount of data that is commonly used an anonymous unique identifier. These are sent to your browser from the website that you visit and are stored on your computers hard drive.</p>\r\n\t\t\t<p>Our website uses these \"cookies\" to collection information and to improve our Service. You have the option to either accept or refuse these cookies by either loggin in or choosing not to log in. If you choose to refuse our cookies, you may not be able to use some portions of our Service, which includes any features that require a user to be signed in.</p>\r\n\t\t\t<h2>Service Providers</h2>\r\n\t\t\t<p>We may employ third-party companies and individuals due to the following reasons:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>To facilitate our Service;</li>\r\n\t\t\t\t<li>To provide the Service on our behalf;</li>\r\n\t\t\t\t<li>To perform Service-related services; or</li>\r\n\t\t\t\t<li>To assist us in analyzing how our Service is used.</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>We want to inform our Service users that these third parties have access to your Personal Information. The reason is to perform the tasks assigned to them on our behalf. However, they are obligated not to disclose or use the information for any other purpose.</p>\r\n\t\t\t<h2>Security</h2>\r\n\t\t\t<p>We value your trust in providing us your Personal Information, thus we are striving to use commercially acceptable means of protecting it. But remember that no method of transmission over the internet, or method of electronic storage is 100% secure and reliable, and we cannot guarantee its absolute security.</p>\r\n\t\t\t<h2>Links to Other Sites</h2>\r\n\t\t\t<p>Our Service may contain links to other sites. If you click on a third-party link, you will be directed to that site. Note that these external sites are not operated by us. Therefore, we strongly advise you to review the Privacy Policy of these websites. We have no control over, and assume no responsibility for the content, privacy policies, or practices of any third-party sites or services.</p>\r\n\t\t\t<p>Childrens Privacy</p>\r\n\t\t\t<p>Our Services do not address anyone under the age of 13. We do not knowingly collect personal identifiable information from children under 13. In the case we discover that a child under 13 has provided us with personal information, we immediately delete this from our servers. If you are a parent or guardian and you are aware that your child has provided us with personal information, please contact us so that we will be able to do necessary actions.</p>\r\n\t\t\t<h2>Changes to This Privacy Policy</h2>\r\n\t\t\t<p>We may update our Privacy Policy from time to time. Thus, we advise you to review this page periodically for any changes. We will notify you of any changes by posting the new Privacy Policy on this page. These changes are effective immediately, after they are posted on this page.</p>\r\n\t\t\t<h2>Contact Us</h2>\r\n\t\t\t<p>If you have any questions or suggestions about our Privacy Policy, do not hesitate to contact us.</p>\r\n\t\t</div>\r\n\t);\r\n}","import React, { useEffect } from \"react\";\r\n\r\nexport default function PrivacyPolicy() {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Terms of Service | BeyondMafia\";\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div className=\"span-panel main legal\">\r\n\t\t\t<h1>BeyondMafia Terms and Conditions of Use</h1>\r\n\t\t\t<h2>1. Terms</h2>\r\n\t\t\t<p>By accessing this Website, accessible from BeyondMafia.org, you are agreeing to be bound by these Website Terms and Conditions of Use and agree that you are responsible for the agreement with any applicable local laws. If you disagree with any of these terms, you are prohibited from accessing this site. The materials contained in this Website are protected by copyright and trade mark law. These Terms of Service has been created with the help of the <a href=\"https://www.termsofservicegenerator.net\">Terms of Service Generator</a> and the <a href=\"https://www.termsconditionsexample.com\">Terms & Conditions Example</a>.</p>\r\n\t\t\t<h2>2. Use License</h2>\r\n\t\t\t<p>Permission is granted to temporarily download one copy of the materials on BeyondMafia's Website for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title, and under this license you may not:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>modify or copy the materials;</li>\r\n\t\t\t\t<li>use the materials for any commercial purpose or for any public display;</li>\r\n\t\t\t\t<li>attempt to reverse engineer any software contained on BeyondMafia's Website;</li>\r\n\t\t\t\t<li>remove any copyright or other proprietary notations from the materials; or</li>\r\n\t\t\t\t<li>transferring the materials to another person or \"mirror\" the materials on any other server.</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>This will let BeyondMafia to terminate upon violations of any of these restrictions. Upon termination, your viewing right will also be terminated and you should destroy any downloaded materials in your possession whether it is printed or electronic format.</p>\r\n\t\t\t<h2>3. Disclaimer</h2>\r\n\t\t\t<p>All the materials on BeyondMafias Website are provided \"as is\". BeyondMafia makes no warranties, may it be expressed or implied, therefore negates all other warranties. Furthermore, BeyondMafia does not make any representations concerning the accuracy or reliability of the use of the materials on its Website or otherwise relating to such materials or any sites linked to this Website.</p>\r\n\t\t\t<h2>4. Limitations</h2>\r\n\t\t\t<p>BeyondMafia or its suppliers will not be hold accountable for any damages that will arise with the use or inability to use the materials on BeyondMafias Website, even if BeyondMafia or an authorize representative of this Website has been notified, orally or written, of the possibility of such damage. Some jurisdiction does not allow limitations on implied warranties or limitations of liability for incidental damages, these limitations may not apply to you.</p>\r\n\t\t\t<h2>5. Revisions and Errata</h2>\r\n\t\t\t<p>The materials appearing on BeyondMafias Website may include technical, typographical, or photographic errors. BeyondMafia will not promise that any of the materials in this Website are accurate, complete, or current. BeyondMafia may change the materials contained on its Website at any time without notice. BeyondMafia does not make any commitment to update the materials.</p>\r\n\t\t\t<h2>6. Links</h2>\r\n\t\t\t<p>BeyondMafia has not reviewed all of the sites linked to its Website and is not responsible for the contents of any such linked site. The presence of any link does not imply endorsement by BeyondMafia of the site. The use of any linked website is at the users own risk.</p>\r\n\t\t\t<h2>7. Site Terms of Use Modifications</h2>\r\n\t\t\t<p>BeyondMafia may revise these Terms of Use for its Website at any time without prior notice. By using this Website, you are agreeing to be bound by the current version of these Terms and Conditions of Use.</p>\r\n\t\t\t<h2>8. Your Privacy</h2>\r\n\t\t\t<p>Please read <a href=\"/legal/privacy\">our Privacy Policy</a>.</p>\r\n\t\t\t<h2>9. Governing Law</h2>\r\n\t\t\t<p>Any claim related to BeyondMafia's Website shall be governed by the laws of us without regards to its conflict of law provisions.</p>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { Route, Switch, Redirect } from \"react-router-dom\";\r\n\r\nimport PrivacyPolicy from \"./PrivacyPolicy\";\r\nimport TermsOfService from \"./TermsOfService\";\r\nimport { SubNav } from \"../../components/Nav\";\r\n\r\nimport \"../../css/legal.css\";\r\n\r\nexport default function Legal(props) {\r\n\tconst links = [\r\n\t\t{\r\n\t\t\ttext: \"Terms of Service\",\r\n\t\t\tpath: \"/legal/tos\",\r\n\t\t\texact: true\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"Privacy Policy\",\r\n\t\t\tpath: \"/legal/privacy\",\r\n\t\t\texact: true\r\n\t\t}\r\n\t];\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SubNav links={links} />\r\n\t\t\t<div className=\"inner-content\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/legal/tos\" render={() => <TermsOfService />} />\r\n\t\t\t\t\t<Route exact path=\"/legal/privacy\" render={() => <PrivacyPolicy />} />\r\n\t\t\t\t\t<Route render={() => <Redirect to=\"/legal/tos\" />} />\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}","import React, { useState, useContext, useRef, useEffect, useLayoutEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport { PopoverContext, SiteInfoContext } from \"../Contexts\";\r\nimport { Time } from \"./Basic\";\r\nimport { SmallRoleList, GameStateIcon } from \"./Setup\";\r\nimport { NameWithAvatar } from \"../pages/User/User\";\r\nimport { useErrorAlert } from \"./Alerts\";\r\nimport { GameStates, Alignments } from \"../Constants\";\r\nimport { useOnOutsideClick } from \"./Basic\";\r\n\r\nimport \"../css/popover.css\";\r\n\r\nexport default function Popover() {\r\n\tconst popover = useContext(PopoverContext);\r\n\tconst popoverRef = useRef();\r\n\tconst triangleRef = useRef();\r\n\r\n\tuseOnOutsideClick(\r\n\t\t[\r\n\t\t\t{ current: popover.boundingEl },\r\n\t\t\tpopoverRef\r\n\t\t],\r\n\t\t() => {\r\n\t\t\tif (!popover.loadingRef.current) {\r\n\t\t\t\tpopover.setVisible(false);\r\n\t\t\t\tpopover.setBoundingEl(null);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!popover.visible)\r\n\t\t\treturn;\r\n\r\n\t\tconst boundingRect = popover.boundingEl.getBoundingClientRect();\r\n\t\tconst popoverRect = popoverRef.current.getBoundingClientRect();\r\n\r\n\t\tvar triangleLeft = boundingRect.left + boundingRect.width;\r\n\t\tvar triangleTop = boundingRect.top - 10 + (boundingRect.height / 2) + window.scrollY;\r\n\r\n\t\tvar popoverLeft = boundingRect.left + boundingRect.width + 10;\r\n\t\tvar popoverTop = boundingRect.top - (popoverRect.height / 2) + (boundingRect.height / 2) + window.scrollY;\r\n\t\tvar popoverHorzShift = window.innerWidth - (popoverLeft + popoverRect.width);\r\n\r\n\t\tif (popoverTop < window.scrollY)\r\n\t\t\tpopoverTop = window.scrollY;\r\n\r\n\t\tif (popoverHorzShift < 0) {\r\n\t\t\tif (popoverLeft + popoverHorzShift < 0)\r\n\t\t\t\tpopoverHorzShift -= (popoverLeft + popoverHorzShift);\r\n\t\t}\r\n\t\telse\r\n\t\t\tpopoverHorzShift = 0;\r\n\r\n\t\tpopoverLeft += popoverHorzShift;\r\n\t\ttriangleLeft += popoverHorzShift;\r\n\r\n\t\ttriangleRef.current.style.left = triangleLeft + \"px\";\r\n\t\ttriangleRef.current.style.top = triangleTop + \"px\";\r\n\t\ttriangleRef.current.style.visibility = \"visible\";\r\n\r\n\t\tpopoverRef.current.style.top = popoverTop + \"px\";\r\n\t\tpopoverRef.current.style.left = popoverLeft + \"px\";\r\n\t\tpopoverRef.current.style.visibility = \"visible\";\r\n\t});\r\n\r\n\treturn (\r\n\t\tpopover.visible &&\r\n\t\t<>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"triangle triangle-left\"\r\n\t\t\t\tref={triangleRef} />\r\n\t\t\t<div\r\n\t\t\t\tclassName={`popover-window`}\r\n\t\t\t\tref={popoverRef}>\r\n\t\t\t\t<div className=\"popover-title\">\r\n\t\t\t\t\t{popover.title}\r\n\t\t\t\t</div>\r\n\t\t\t\t{!popover.loading &&\r\n\t\t\t\t\t<div className=\"popover-content\">\r\n\t\t\t\t\t\t{popover.content}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport function usePopover(siteInfo) {\r\n\tconst [visible, setVisible] = useState(false);\r\n\tconst [boundingEl, setBoundingEl] = useState();\r\n\tconst [title, setTitle] = useState(\"\");\r\n\tconst [content, setContent] = useState(\"\");\r\n\tconst [loading, setLoading] = useState(false);\r\n\r\n\tconst loadingRef = useRef();\r\n\tconst errorAlert = useErrorAlert(siteInfo);\r\n\r\n\tfunction onClick(path, type, _boundingEl, title, dataMod) {\r\n\t\tif (_boundingEl == boundingEl) {\r\n\t\t\tsetVisible(false);\r\n\t\t\tsetBoundingEl(null);\r\n\t\t}\r\n\t\telse\r\n\t\t\tload(path, type, _boundingEl, title, dataMod);\r\n\t}\r\n\r\n\tfunction open(boundingEl, title) {\r\n\t\tsetBoundingEl(boundingEl);\r\n\t\tsetTitle(title);\r\n\t\tsetLoading(true);\r\n\t\tsetVisible(true);\r\n\r\n\t\tloadingRef.current = true;\r\n\t}\r\n\r\n\tfunction ready(content, type) {\r\n\t\tswitch (type) {\r\n\t\t\tcase \"setup\":\r\n\t\t\t\tcontent = parseSetupPopover(content, siteInfo.roles);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"role\":\r\n\t\t\t\tcontent = parseRolePopover(content);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"game\":\r\n\t\t\t\tcontent = parseGamePopover(content);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tsetContent(content);\r\n\t\tsetLoading(false);\r\n\t}\r\n\r\n\tfunction load(path, type, boundingEl, title, dataMod) {\r\n\t\topen(boundingEl, title);\r\n\r\n\t\taxios.get(path)\r\n\t\t\t.then(res => {\r\n\t\t\t\tif (dataMod)\r\n\t\t\t\t\tdataMod(res.data);\r\n\r\n\t\t\t\tloadingRef.current = false;\r\n\t\t\t\tready(res.data, type)\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\treturn {\r\n\t\tvisible,\r\n\t\tsetVisible,\r\n\t\tboundingEl,\r\n\t\tsetBoundingEl,\r\n\t\ttitle,\r\n\t\tsetTitle,\r\n\t\tcontent,\r\n\t\tsetContent,\r\n\t\tloading,\r\n\t\tsetLoading,\r\n\t\tonClick,\r\n\t\topen,\r\n\t\tready,\r\n\t\tload,\r\n\t\tloadingRef\r\n\t};\r\n}\r\n\r\nfunction InfoRow(props) {\r\n\treturn (\r\n\t\t<div className=\"info-row\">\r\n\t\t\t<div className=\"title\">{props.title}</div>\r\n\t\t\t<div className=\"content\">{props.content}</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function parseSetupPopover(setup, roleData) {\r\n\tconst result = [];\r\n\r\n\t// ID\r\n\tresult.push(<InfoRow title=\"ID\" content={setup.id} key={-2} />);\r\n\r\n\t//Creator\r\n\tif (setup.creator) {\r\n\t\tconst name =\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tsmall\r\n\t\t\t\tid={setup.creator.id}\r\n\t\t\t\tname={setup.creator.name}\r\n\t\t\t\tavatar={setup.creator.avatar} />\r\n\t\tresult.push(<InfoRow title=\"Created By\" content={name} key={-1} />);\r\n\t}\r\n\r\n\t//Total\r\n\tresult.push(<InfoRow title=\"Players\" content={setup.total} key={0} />);\r\n\r\n\t//Whispers\r\n\tconst whisperContent = [];\r\n\twhisperContent.push(<div key={0}>{setup.whispers ? \"Yes\" : \"No\"}</div>);\r\n\r\n\tif (setup.whispers)\r\n\t\twhisperContent.push(<div key={1}>{setup.leakPercentage}% leak rate</div>);\r\n\r\n\tresult.push(<InfoRow title=\"Whispers\" content={whisperContent} key={1} />);\r\n\r\n\t//Must act\r\n\tresult.push(<InfoRow title=\"Must Act\" content={setup.mustAct ? \"Yes\" : \"No\"} key={2} />);\r\n\r\n\t//Game settings\r\n\tswitch (setup.gameType) {\r\n\t\tcase \"Mafia\":\r\n\t\t\t//Starting state\r\n\t\t\tresult.push(<InfoRow title=\"Starting State\" content={<GameStateIcon state={setup.startState} />} key={3} />);\r\n\r\n\t\t\t//Dawn\r\n\t\t\tresult.push(<InfoRow title=\"Dawn\" content={setup.dawn ? \"Yes\" : \"No\"} key={\"dawn\"} />);\r\n\r\n\t\t\t//Last will\r\n\t\t\tresult.push(<InfoRow title=\"Last Will\" content={setup.lastWill ? \"Yes\" : \"No\"} key={4} />);\r\n\r\n\t\t\t//No reveal\r\n\t\t\tresult.push(<InfoRow title=\"No Reveal\" content={setup.noReveal ? \"Yes\" : \"No\"} key={5} />);\r\n\r\n\t\t\t//Votes invisible\r\n\t\t\tresult.push(<InfoRow title=\"Votes Invisible\" content={setup.votesInvisible ? \"Yes\" : \"No\"} key={6} />);\r\n\t\t\tbreak;\r\n\t\tcase \"Split Decision\":\r\n\t\t\t//Initial swap amount\r\n\t\t\tresult.push(<InfoRow title=\"Initial Swap Amount\" content={setup.swapAmt} key={3} />);\r\n\r\n\t\t\t//Round amount\r\n\t\t\tresult.push(<InfoRow title=\"Round Amount\" content={setup.roundAmt} key={4} />);\r\n\t\t\tbreak;\r\n\t\tcase \"Resistance\":\r\n\t\t\t//First team size\r\n\t\t\tresult.push(<InfoRow title=\"First Team Size\" content={setup.firstTeamSize} key={3} />);\r\n\r\n\t\t\t//Last team size\r\n\t\t\tresult.push(<InfoRow title=\"Last Team Size\" content={setup.lastTeamSize} key={4} />);\r\n\r\n\t\t\t//Number of Missions\r\n\t\t\tresult.push(<InfoRow title=\"Number of Missions\" content={setup.numMissions} key={5} />);\r\n\r\n\t\t\t//Team Formation Attempts\r\n\t\t\tresult.push(<InfoRow title=\"Team Formation Attempts\" content={setup.teamFailLimit} key={6} />);\r\n\t\t\tbreak;\r\n\t\tcase \"One Night\":\r\n\t\t\t//Votes invisible\r\n\t\t\tresult.push(<InfoRow title=\"Votes Invisible\" content={setup.votesInvisible ? \"Yes\" : \"No\"} key={3} />);\r\n\r\n\t\t\t//Excess roles\r\n\t\t\tresult.push(<InfoRow title=\"Excess Roles\" content={setup.excessRoles} key={4} />);\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\t//Roles\r\n\tif (setup.closed) {\r\n\t\tresult.push(<InfoRow title=\"Unique Roles\" content={setup.unique ? \"Yes\" : \"No\"} key={7} />);\r\n\r\n\t\tconst roleset = setup.roles[0];\r\n\t\tvar rolesByAlignment = {};\r\n\r\n\t\tfor (let role in roleset) {\r\n\t\t\tlet roleName = role.split(\":\")[0];\r\n\r\n\t\t\tfor (let roleObj of roleData[setup.gameType]) {\r\n\t\t\t\tif (roleObj.name == roleName) {\r\n\t\t\t\t\tlet alignment = roleObj.alignment;\r\n\r\n\t\t\t\t\tif (!rolesByAlignment[alignment])\r\n\t\t\t\t\t\trolesByAlignment[alignment] = {};\r\n\r\n\t\t\t\t\trolesByAlignment[alignment][role] = roleset[role];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let alignment in rolesByAlignment) {\r\n\t\t\tresult.push(\r\n\t\t\t\t<InfoRow\r\n\t\t\t\t\ttitle={`${alignment} roles`}\r\n\t\t\t\t\tcontent={\r\n\t\t\t\t\t\t<SmallRoleList\r\n\t\t\t\t\t\t\troles={rolesByAlignment[alignment]}\r\n\t\t\t\t\t\t\tgameType={setup.gameType} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkey={alignment} />\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tconst rolesets = [];\r\n\t\tconst sectionName = setup.roles.length > 1 ? \"Role Sets\" : \"Roles\";\r\n\r\n\t\tfor (let i in setup.roles) {\r\n\t\t\tlet roleset = setup.roles[i];\r\n\t\t\trolesets.push(\r\n\t\t\t\t<SmallRoleList\r\n\t\t\t\t\troles={roleset}\r\n\t\t\t\t\tgameType={setup.gameType}\r\n\t\t\t\t\tkey={i} />\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tresult.push(<InfoRow title={sectionName} content={rolesets} key={7} />);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function parseGamePopover(game) {\r\n\tconst result = [];\r\n\r\n\t//Scheduled\r\n\tif (game.settings.scheduled)\r\n\t\tresult.push(<InfoRow title=\"Scheduled For\" content={(new Date(game.settings.scheduled)).toLocaleString()} key={-1} />);\r\n\r\n\t//Players\r\n\tconst playerList = [];\r\n\r\n\tfor (let i = 0; i < game.players.length; i++) {\r\n\t\tplayerList.push(\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tsmall\r\n\t\t\t\tid={game.players[i].id}\r\n\t\t\t\tname={game.players[i].name}\r\n\t\t\t\tavatar={game.players[i].avatar}\r\n\t\t\t\tkey={game.players[i].id} />\r\n\t\t);\r\n\t}\r\n\r\n\twhile (playerList.length < game.totalPlayers) {\r\n\t\tplayerList.push(\r\n\t\t\t<NameWithAvatar\r\n\t\t\t\tsmall\r\n\t\t\t\tname=\"[Guest]\"\r\n\t\t\t\tkey={playerList.length} />\r\n\t\t);\r\n\t}\r\n\r\n\tresult.push(<InfoRow title=\"Players\" content={playerList} key=\"players\" />);\r\n\r\n\t//State lengths\r\n\tconst stateLengths = [];\r\n\r\n\tfor (let stateName of GameStates[game.type]) {\r\n\t\tstateLengths.push(<div key={stateName}>{stateName}: <Time millisec={game.settings.stateLengths[stateName]} /></div>);\r\n\t}\r\n\r\n\tresult.push(<InfoRow title=\"State Lengths\" content={stateLengths} key=\"stateLengths\" />);\r\n\r\n\t//Ranked\r\n\tresult.push(<InfoRow title=\"Ranked\" content={game.settings.ranked ? \"Yes\" : \"No\"} key=\"ranked\" />);\r\n\r\n\t//Spectating\r\n\tresult.push(<InfoRow title=\"Spectating\" content={game.settings.spectating ? \"Yes\" : \"No\"} key=\"spectating\" />);\r\n\r\n\t//Guests\r\n\tresult.push(<InfoRow title=\"Guests Allowed\" content={game.settings.guests ? \"Yes\" : \"No\"} key=\"guests\" />);\r\n\r\n\t//Guests\r\n\tresult.push(<InfoRow title=\"Ready Check\" content={game.settings.readyCheck ? \"Yes\" : \"No\"} key=\"readyCheck\" />);\r\n\r\n\tswitch (game.type) {\r\n\t\tcase \"Mafia\":\r\n\t\t\tvar extendLength = game.settings.gameTypeOptions.extendLength || 3;\r\n\t\t\tresult.push(<InfoRow title=\"Extension Length\" content={<Time millisec={extendLength * 60 * 1000} />} key=\"extendLength\" />);\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\t//Created at\r\n\tif (game.createTime)\r\n\t\tresult.push(<InfoRow title=\"Created At\" content={(new Date(game.createTime)).toLocaleString()} key=\"createdAt\" />);\r\n\r\n\t//Started at\r\n\tif (game.startTime)\r\n\t\tresult.push(<InfoRow title=\"Started At\" content={(new Date(game.startTime)).toLocaleString()} key=\"startedAt\" />);\r\n\r\n\t//Ended at\r\n\tif (game.endTime)\r\n\t\tresult.push(<InfoRow title=\"Ended At\" content={(new Date(game.endTime)).toLocaleString()} key=\"endedAt\" />);\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function parseRolePopover(role) {\r\n\tconst result = [];\r\n\r\n\t//Alignment\r\n\tresult.push(<InfoRow title=\"Alignment\" content={role.alignment} key={0} />);\r\n\r\n\t//Description\r\n\tconst descLines = [];\r\n\r\n\tfor (let i in role.description)\r\n\t\tdescLines.push(<li key={i}>{role.description[i]}</li>);\r\n\r\n\tresult.push(<InfoRow title=\"Description\" content={<ul>{descLines}</ul>} key={1} />);\r\n\r\n\treturn result;\r\n}","import React, { useState, useEffect, useLayoutEffect, useRef, useReducer, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { ClientSocket as Socket } from \"../../Socket\";\r\nimport { useErrorAlert } from \"../../components/Alerts\";\r\nimport { NameWithAvatar, StatusIcon } from \"../User/User\";\r\nimport { UserContext } from \"../../Contexts\";\r\nimport { MaxChatMessageLength } from \"../../Constants\";\r\nimport { Time, UserText } from \"../../components/Basic\";\r\nimport { NotificationHolder, filterProfanity, useOnOutsideClick } from \"../../components/Basic\";\r\n\r\nimport \"../../css/chat.css\";\r\n\r\nexport default function Chat() {\r\n\tconst [showWindow, setShowWindow] = useState(false);\r\n\tconst [connected, setConnected] = useState(0);\r\n\tconst [token, setToken] = useState(\"\");\r\n\tconst [socket, setSocket] = useState({});\r\n\tconst [chatInfo, updateChatInfo] = useChatInfoReducer();\r\n\tconst [currentTab, setCurrentTab] = useState(\"rooms\");\r\n\tconst [currentChannelId, setCurrentChannelId] = useState();\r\n\tconst [channel, updateChannel] = useChannelReducer();\r\n\tconst [newDMUsers, setNewDMUsers] = useState({});\r\n\tconst [textInput, setTextInput] = useState(\"\");\r\n\tconst [autoScroll, setAutoScroll] = useState(true);\r\n\tconst [userSearchVal, setUserSearchVal] = useState(\"\");\r\n\r\n\tconst messageListRef = useRef();\r\n\tconst oldScrollHeight = useRef();\r\n\tconst user = useContext(UserContext);\r\n\tconst errorAlert = useErrorAlert();\r\n\r\n\tuseLayoutEffect(() => manageScroll());\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!user.loggedIn && token)\r\n\t\t\tsetToken(\"\");\r\n\t}, [user.loggedIn]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token)\r\n\t\t\treturn;\r\n\r\n\t\tvar socketURL;\r\n\r\n\t\tif (process.env.REACT_APP_USE_PORT == \"true\")\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}:2999`;\r\n\t\telse\r\n\t\t\tsocketURL = `${process.env.REACT_APP_SOCKET_PROTOCOL}://${process.env.REACT_APP_SOCKET_URI}/chatSocket`;\r\n\r\n\t\tvar newSocket = new Socket(socketURL);\r\n\t\tnewSocket.on(\"connected\", () => setConnected(connected + 1));\r\n\t\tnewSocket.on(\"disconnected\", () => setConnected(connected - 1));\r\n\t\tsetSocket(newSocket);\r\n\r\n\t\treturn () => {\r\n\t\t\tif (newSocket)\r\n\t\t\t\tnewSocket.clear();\r\n\t\t};\r\n\t}, [token]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (socket.readyState != 1) {\r\n\t\t\tif (socket.readyState == null || socket.readyState == 3)\r\n\t\t\t\tgetToken();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsocket.send(\"auth\", token);\r\n\r\n\t\tsocket.on(\"chatInfo\", chatInfo => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tchatInfo\r\n\t\t\t});\r\n\r\n\t\t\tif (chatInfo.rooms && chatInfo.rooms.length > 0) {\r\n\t\t\t\tif (!currentChannelId) {\r\n\t\t\t\t\tvar roomId = chatInfo.rooms[0].id;\r\n\t\t\t\t\tsetCurrentChannelId(roomId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"channel\", channel => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"set\",\r\n\t\t\t\tchannel\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"message\", message => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"message\",\r\n\t\t\t\tmessage\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"oldMessages\", messages => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"oldMessages\",\r\n\t\t\t\tmessages,\r\n\t\t\t\tmessageListRef\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"users\", users => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"users\",\r\n\t\t\t\tusers\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"newDirectChannel\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"directs\",\r\n\t\t\t\tchannel: info.channel\r\n\t\t\t});\r\n\r\n\t\t\tif (info.focus) {\r\n\t\t\t\tsetCurrentTab(\"directs\");\r\n\t\t\t\tsetCurrentChannelId(info.channel.id);\r\n\t\t\t\tsocket.send(\"getChannel\", info.channel.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on(\"openDM\", channelId => {\r\n\t\t\tsetCurrentTab(\"directs\");\r\n\t\t\tsetCurrentChannelId(channelId);\r\n\t\t\tsocket.send(\"getChannel\", channelId);\r\n\t\t});\r\n\r\n\t\tsocket.on(\"dateUpdate\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"date\",\r\n\t\t\t\tchannelId: info.channel,\r\n\t\t\t\tdate: info.date\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"newNotif\", info => {\r\n\t\t\tupdateChatInfo({\r\n\t\t\t\ttype: \"addNotif\",\r\n\t\t\t\tchannelId: info.notif.channelId\r\n\t\t\t});\r\n\r\n\t\t\tif (document.hidden && document.title.indexOf(\"\") == -1)\r\n\t\t\t\tdocument.title = document.title + \"\";\r\n\t\t});\r\n\r\n\t\tsocket.on(\"messageDeleted\", messageId => {\r\n\t\t\tupdateChannel({\r\n\t\t\t\ttype: \"deleteMessage\",\r\n\t\t\t\tmessageId\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.on(\"error\", error => {\r\n\t\t\terrorAlert(error);\r\n\t\t});\r\n\t}, [connected]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!channel.id)\r\n\t\t\treturn;\r\n\r\n\t\tif (chatInfo.notifs.byChannel[channel.id])\r\n\t\t\tsocket.send(\"readNotifsInChannel\", channel.id);\r\n\r\n\t\tupdateChatInfo({\r\n\t\t\ttype: \"readNotifs\",\r\n\t\t\tchannelId: channel.id\r\n\t\t});\r\n\t}, [channel]);\r\n\r\n\tfunction getToken() {\r\n\t\taxios.get(\"/chat/connect\")\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetToken(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(errorAlert);\r\n\t}\r\n\r\n\tfunction onTopBarClick() {\r\n\t\tsetShowWindow(!showWindow);\r\n\t\tsetAutoScroll(true);\r\n\r\n\t\tif (!showWindow) {\r\n\t\t\tif (currentChannelId)\r\n\t\t\t\tsocket.send(\"getChannel\", currentChannelId);\r\n\r\n\t\t\tif (currentChannelId) {\r\n\t\t\t\tif (chatInfo.notifs.byChannel[currentChannelId])\r\n\t\t\t\t\tsocket.send(\"readNotifsInChannel\", currentChannelId);\r\n\r\n\t\t\t\tupdateChatInfo({\r\n\t\t\t\t\ttype: \"readNotifs\",\r\n\t\t\t\t\tchannelId: currentChannelId\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t\tsocket.send(\"closedChat\");\r\n\t}\r\n\r\n\tfunction onTabClick(type) {\r\n\t\tsetCurrentTab(type);\r\n\r\n\t\tif (type == \"users\")\r\n\t\t\tsocket.send(\"getUsers\", userSearchVal);\r\n\t}\r\n\r\n\tfunction onChannelClick(id) {\r\n\t\tif (currentTab != \"users\") {\r\n\t\t\tsocket.send(\"getChannel\", id);\r\n\r\n\t\t\tsetCurrentChannelId(id);\r\n\t\t\tsetAutoScroll(true);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!newDMUsers[id]) {\r\n\t\t\t\tsetNewDMUsers(update(newDMUsers, {\r\n\t\t\t\t\t[id]: {\r\n\t\t\t\t\t\t$set: true\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsetNewDMUsers(update(newDMUsers, {\r\n\t\t\t\t\t$unset: [id]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onSendMessage(e) {\r\n\t\tif (e.key == \"Enter\" && textInput.length) {\r\n\t\t\tconst message = e.target.value;\r\n\t\t\tsocket.send(\"sendMessage\", message);\r\n\t\t\tsetTextInput(\"\");\r\n\t\t\tsetAutoScroll(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onMessagesScroll() {\r\n\t\tvar messageList = messageListRef.current;\r\n\r\n\t\tif (Math.round(messageList.scrollTop + messageList.clientHeight) >= Math.round(messageList.scrollHeight))\r\n\t\t\tsetAutoScroll(true);\r\n\t\telse {\r\n\t\t\tsetAutoScroll(false);\r\n\r\n\t\t\tif (messageList.scrollTop == 0)\r\n\t\t\t\tsocket.send(\"getOldMessages\", channel.messages[0].date);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction manageScroll() {\r\n\t\tif (messageListRef.current) {\r\n\t\t\tif (oldScrollHeight.current == null)\r\n\t\t\t\toldScrollHeight.current = messageListRef.current.scrollHeight;\r\n\t\t\telse if (oldScrollHeight.current != messageListRef.current.scrollHeight) {\r\n\t\t\t\tif (messageListRef.current.scrollTop == 0) {\r\n\t\t\t\t\tvar scrollTo = messageListRef.current.scrollHeight * (1 - (oldScrollHeight.current / messageListRef.current.scrollHeight));\r\n\t\t\t\t\tmessageListRef.current.scrollTop = scrollTo - 5;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toldScrollHeight.current = messageListRef.current.scrollHeight;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (autoScroll && messageListRef.current)\r\n\t\t\tmessageListRef.current.scrollTop = messageListRef.current.scrollHeight;\r\n\t}\r\n\r\n\tfunction onUserSearch(e) {\r\n\t\tconst query = e.target.value;\r\n\t\tsetUserSearchVal(query);\r\n\t\tsocket.send(\"getUsers\", query);\r\n\t}\r\n\r\n\tfunction onCreateDM() {\r\n\t\tvar users = Object.keys(newDMUsers);\r\n\t\tsocket.send(\"newDMChannel\", users);\r\n\t\tsetNewDMUsers({});\r\n\t}\r\n\r\n\tfunction onCloseDM(channelId) {\r\n\t\tsocket.send(\"closeDM\", channelId);\r\n\r\n\t\tsetCurrentChannelId(null);\r\n\t\tupdateChannel({ type: \"clear\" });\r\n\t\tupdateChatInfo({\r\n\t\t\ttype: \"remove\",\r\n\t\t\tchannelType: currentTab,\r\n\t\t\tchannelId\r\n\t\t});\r\n\t}\r\n\r\n\tvar channels = chatInfo[currentTab];\r\n\r\n\tif (currentTab == \"directs\")\r\n\t\tchannels = channels.sort(sortDMs);\r\n\r\n\tchannels = channels.reduce((channels, channel) => {\r\n\t\tif (currentTab == \"users\" && channel.id == user.id)\r\n\t\t\treturn channels;\r\n\r\n\t\tvar className = \"channel\";\r\n\r\n\t\tif (currentTab != \"users\" && channel.id == currentChannelId)\r\n\t\t\tclassName += \" sel\";\r\n\t\telse if (currentTab == \"users\" && newDMUsers[channel.id])\r\n\t\t\tclassName += \" sel\";\r\n\r\n\t\tchannels.push(\r\n\t\t\t<NotificationHolder\r\n\t\t\t\tclassName={className}\r\n\t\t\t\tkey={channel.id}\r\n\t\t\t\tnotifCount={chatInfo.notifs.byChannel[channel.id]}\r\n\t\t\t\tonClick={() => onChannelClick(channel.id)}>\r\n\t\t\t\t<ChannelName\r\n\t\t\t\t\tshort\r\n\t\t\t\t\tchannelType={currentTab}\r\n\t\t\t\t\tchannel={channel}\r\n\t\t\t\t\tuser={user} />\r\n\t\t\t</NotificationHolder>\r\n\t\t);\r\n\r\n\t\treturn channels;\r\n\t}, []);\r\n\r\n\tconst messages = channel.messages.map(message => (\r\n\t\t<Message\r\n\t\t\tmessage={message}\r\n\t\t\tsocket={socket}\r\n\t\t\tkey={message.id} />\r\n\t));\r\n\r\n\treturn (\r\n\t\ttoken &&\r\n\t\t<NotificationHolder\r\n\t\t\tclassName=\"chat-wrapper\"\r\n\t\t\tnotifCount={chatInfo.notifs.all}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"top-bar\"\r\n\t\t\t\tonClick={onTopBarClick}>\r\n\t\t\t\t<i className=\"fas fa-comment\" />\r\n\t\t\t\t<div className=\"label\">\r\n\t\t\t\t\tChat\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{showWindow &&\r\n\t\t\t\t<div className=\"window\">\r\n\t\t\t\t\t<div className=\"left-panel\">\r\n\t\t\t\t\t\t<div className=\"channel-type-nav\">\r\n\t\t\t\t\t\t\t<NotificationHolder\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"rooms\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tnotifCount={chatInfo.notifs.byChannelType[\"rooms\"]}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"rooms\")}>\r\n\t\t\t\t\t\t\t\tRooms\r\n\t\t\t\t\t\t\t</NotificationHolder>\r\n\t\t\t\t\t\t\t<NotificationHolder\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"directs\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tnotifCount={chatInfo.notifs.byChannelType[\"directs\"]}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"directs\")}>\r\n\t\t\t\t\t\t\t\tDirects\r\n\t\t\t\t\t\t\t</NotificationHolder>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName={`channel-type ${currentTab == \"users\" ? \"sel\" : \"\"}`}\r\n\t\t\t\t\t\t\t\tonClick={() => onTabClick(\"users\")}>\r\n\t\t\t\t\t\t\t\tUsers\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{currentTab == \"users\" &&\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\tclassName=\"user-search\"\r\n\t\t\t\t\t\t\t\tvalue={userSearchVal}\r\n\t\t\t\t\t\t\t\tplaceholder={\"Search\"}\r\n\t\t\t\t\t\t\t\tonChange={onUserSearch} />\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<div className=\"channel-list\">\r\n\t\t\t\t\t\t\t{channels}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{currentTab == \"users\" && Object.keys(newDMUsers).length > 0 &&\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"create-dm-btn btn btn-theme\"\r\n\t\t\t\t\t\t\t\tonClick={onCreateDM}>\r\n\t\t\t\t\t\t\t\t<i className=\"fas fa-plus\" />\r\n\t\t\t\t\t\t\t\tCreate DM ({Object.keys(newDMUsers).length})\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"right-panel\">\r\n\t\t\t\t\t\t{channel.id &&\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t<div className=\"channel-top\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"channel-name\">\r\n\t\t\t\t\t\t\t\t\t\t<ChannelName\r\n\t\t\t\t\t\t\t\t\t\t\tchannelType={channel.public ? \"rooms\" : \"directs\"}\r\n\t\t\t\t\t\t\t\t\t\t\tchannel={channel}\r\n\t\t\t\t\t\t\t\t\t\t\tuser={user} />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{!channel.public &&\r\n\t\t\t\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"close-dm fas fa-times\"\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => onCloseDM(channel.id)} />\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName=\"channel-messages\"\r\n\t\t\t\t\t\t\t\t\tref={messageListRef}\r\n\t\t\t\t\t\t\t\t\tonScroll={onMessagesScroll}>\r\n\t\t\t\t\t\t\t\t\t{messages}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"channel-input-wrapper\">\r\n\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"channel-input\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={textInput}\r\n\t\t\t\t\t\t\t\t\t\tmaxLength={MaxChatMessageLength}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setTextInput(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\tonKeyPress={onSendMessage} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</NotificationHolder>\r\n\t);\r\n}\r\n\r\nfunction Message(props) {\r\n\tconst message = props.message;\r\n\tconst socket = props.socket;\r\n\r\n\tconst [showContextMenu, setShowContextMenu] = useState(false);\r\n\tconst [clickCoords, setClickCoords] = useState({});\r\n\r\n\tconst messageRef = useRef();\r\n\tconst contextMenuRef = useRef();\r\n\tconst user = useContext(UserContext);\r\n\tconst isSelf = message.sender.id == user.id;\r\n\tconst age = Date.now() - message.date;\r\n\r\n\tuseOnOutsideClick(messageRef, () => setShowContextMenu(false));\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!contextMenuRef.current)\r\n\t\t\treturn;\r\n\r\n\t\tconst messageRect = messageRef.current.getBoundingClientRect();\r\n\r\n\t\tcontextMenuRef.current.style.top = (clickCoords.y - messageRect.top) + \"px\";\r\n\r\n\t\tif (!isSelf)\r\n\t\t\tcontextMenuRef.current.style.left = (clickCoords.x - messageRect.left) + \"px\";\r\n\t\telse\r\n\t\t\tcontextMenuRef.current.style.right = (messageRect.right - clickCoords.x) + \"px\";\r\n\r\n\t\tcontextMenuRef.current.style.visibility = \"visible\";\r\n\t}, [clickCoords]);\r\n\r\n\tfunction onMessageClick(e) {\r\n\t\tif (e.type == \"contextmenu\") {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetShowContextMenu(true);\r\n\t\t\tsetClickCoords({ x: e.clientX, y: e.clientY });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onDeleteClick() {\r\n\t\tsocket.send(\"deleteMessage\", message.id);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className={`message ${isSelf ? \"self\" : \"\"}`}>\r\n\t\t\t<div className=\"info\">\r\n\t\t\t\t{!isSelf &&\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tid={message.sender.id}\r\n\t\t\t\t\t\tname={message.sender.name}\r\n\t\t\t\t\t\tavatar={message.sender.avatar}\r\n\t\t\t\t\t\tcolor={message.sender.settings && message.sender.settings.nameColor} />\r\n\t\t\t\t}\r\n\t\t\t\t{age > 1000 * 60 &&\r\n\t\t\t\t\t<div className=\"timestamp\">\r\n\t\t\t\t\t\t<Time\r\n\t\t\t\t\t\t\tmillisec={age}\r\n\t\t\t\t\t\t\tsuffix=\" ago\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"content\"\r\n\t\t\t\tstyle={message.sender.settings && message.sender.settings.textColor ? { color: message.sender.settings.textColor } : {}}\r\n\t\t\t\tonContextMenu={onMessageClick}\r\n\t\t\t\tref={messageRef}>\r\n\t\t\t\t{/* {linkify(message.content)} */}\r\n\t\t\t\t<UserText\r\n\t\t\t\t\ttext={message.content}\r\n\t\t\t\t\tsettings={user.settings}\r\n\t\t\t\t\tfilterProfanity\r\n\t\t\t\t\tlinkify\r\n\t\t\t\t\temotify />\r\n\t\t\t</div>\r\n\t\t\t{showContextMenu && (user.id == message.sender.id || user.perms.deleteChatMessage) &&\r\n\t\t\t\t<div className=\"context\" ref={contextMenuRef}>\r\n\t\t\t\t\t<div className=\"item\" onClick={onDeleteClick}>\r\n\t\t\t\t\t\tDelete\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction ChannelName(props) {\r\n\tconst channelType = props.channelType;\r\n\tconst channel = props.channel;\r\n\tconst user = props.user;\r\n\tconst short = props.short;\r\n\r\n\tswitch (channelType) {\r\n\t\tcase \"rooms\":\r\n\t\t\treturn channel.name;\r\n\t\tcase \"directs\":\r\n\t\t\tif (short) {\r\n\t\t\t\tvar memberNames = channel.members.filter(m => m.id != user.id).map(m => m.name);\r\n\t\t\t\tvar name = memberNames.join(\", \");\r\n\r\n\t\t\t\tif (memberNames.length > 1 && name.length > 20)\r\n\t\t\t\t\tname = name.slice(0, 17) + \"...\";\r\n\r\n\t\t\t\treturn name;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar members = channel.members.filter(m => m.id != user.id);\r\n\t\t\t\treturn members.map(\r\n\t\t\t\t\tm => (\r\n\t\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\t\tid={m.id}\r\n\t\t\t\t\t\t\tname={m.name}\r\n\t\t\t\t\t\t\tavatar={m.avatar}\r\n\t\t\t\t\t\t\tkey={m.id} />\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\tcase \"users\":\r\n\t\t\treturn (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<NameWithAvatar\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t\tnoLink\r\n\t\t\t\t\t\tid={channel.id}\r\n\t\t\t\t\t\tname={channel.name}\r\n\t\t\t\t\t\tavatar={channel.avatar} />\r\n\t\t\t\t\t<StatusIcon status={channel.status} />\r\n\t\t\t\t</>\r\n\t\t\t);\r\n\t}\r\n}\r\n\r\nfunction sortDMs(a, b) {\r\n\treturn b.lastMessageDate - a.lastMessageDate;\r\n}\r\n\r\nfunction useChatInfoReducer() {\r\n\treturn useReducer((chatInfo, action) => {\r\n\t\tvar newChatInfo = chatInfo;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tvar notifsArray = action.chatInfo.notifs;\r\n\t\t\t\tvar notifsTotal = 0;\r\n\t\t\t\tvar notifsByChannelType = { rooms: 0, directs: 0 };\r\n\t\t\t\tvar notifsByChannel = {};\r\n\r\n\t\t\t\tfor (let notif of notifsArray) {\r\n\t\t\t\t\tif (!notifsByChannel[notif.channelId])\r\n\t\t\t\t\t\tnotifsByChannel[notif.channelId] = 0;\r\n\r\n\t\t\t\t\tlet channelType = notif.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\r\n\t\t\t\t\tnotifsTotal += 1;\r\n\t\t\t\t\tnotifsByChannelType[channelType] += 1;\r\n\t\t\t\t\tnotifsByChannel[notif.channelId] += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewChatInfo = { ...action.chatInfo, notifs: chatInfo.notifs };\r\n\t\t\t\tnewChatInfo = update(newChatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: notifsTotal\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t$set: notifsByChannelType\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t$set: notifsByChannel\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"directs\":\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tdirects: {\r\n\t\t\t\t\t\t$unshift: [action.channel]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"users\":\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tusers: {\r\n\t\t\t\t\t\t$set: action.users\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"remove\":\r\n\t\t\t\tvar newChannels = chatInfo[action.channelType];\r\n\t\t\t\tnewChannels = newChannels.filter(channel => channel.id != action.channelId);\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\t[action.channelType]: {\r\n\t\t\t\t\t\t$set: newChannels\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"date\":\r\n\t\t\t\tvar newDirects = chatInfo.directs.map(channel => {\r\n\t\t\t\t\tif (channel.id == action.channelId)\r\n\t\t\t\t\t\tchannel.lastMessageDate = action.date;\r\n\r\n\t\t\t\t\treturn channel;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tdirects: {\r\n\t\t\t\t\t\t$set: newDirects\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addNotif\":\r\n\t\t\t\tvar channelType = action.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\t\t\t\tvar newAll = chatInfo.notifs.all + 1;\r\n\t\t\t\tvar newByChannelType = chatInfo.notifs[channelType] ? chatInfo.notifs[channelType] + 1 : 1;\r\n\t\t\t\tvar newByChannel = chatInfo.notifs[action.channelId] ? chatInfo.notifs[action.channelId] + 1 : 1;\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: newAll\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t[channelType]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannelType\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t[action.channelId]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannel\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"readNotifs\":\r\n\t\t\t\tvar amt = chatInfo.notifs.byChannel[action.channelId] || 0;\r\n\t\t\t\tvar channelType = action.channelId.length == 32 ? \"directs\" : \"rooms\";\r\n\t\t\t\tvar newAll = chatInfo.notifs.all - amt;\r\n\t\t\t\tvar newByChannelType = chatInfo.notifs.byChannelType[channelType] - amt;\r\n\r\n\t\t\t\tnewChatInfo = update(chatInfo, {\r\n\t\t\t\t\tnotifs: {\r\n\t\t\t\t\t\tall: {\r\n\t\t\t\t\t\t\t$set: newAll\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannelType: {\r\n\t\t\t\t\t\t\t[channelType]: {\r\n\t\t\t\t\t\t\t\t$set: newByChannelType\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbyChannel: {\r\n\t\t\t\t\t\t\t[action.channelId]: {\r\n\t\t\t\t\t\t\t\t$set: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newChatInfo;\r\n\t}, { rooms: [], directs: [], users: [], notifs: { all: 0, byChannelType: {}, byChannel: {} } });\r\n}\r\n\r\nfunction useChannelReducer() {\r\n\treturn useReducer((channel, action) => {\r\n\t\tvar newChannel = channel;\r\n\r\n\t\tswitch (action.type) {\r\n\t\t\tcase \"set\":\r\n\t\t\t\tnewChannel = action.channel;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"message\":\r\n\t\t\t\tif (action.message.channel != channel.id)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t$push: [action.message]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"deleteMessage\":\r\n\t\t\t\tvar index = -1;\r\n\r\n\t\t\t\tfor (let i in channel.messages) {\r\n\t\t\t\t\tlet message = channel.messages[i];\r\n\r\n\t\t\t\t\tif (message.id == action.messageId) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index != -1) {\r\n\t\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t\t$splice: [[index, 1]]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"oldMessages\":\r\n\t\t\t\tnewChannel = update(channel, {\r\n\t\t\t\t\tmessages: {\r\n\t\t\t\t\t\t$unshift: action.messages\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"clear\":\r\n\t\t\t\tnewChannel = { messages: [] };\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn newChannel;\r\n\t}, { messages: [] });\r\n}","import React, { useState, useContext, useRef, useEffect, useLayoutEffect } from \"react\";\r\nimport { Route, Link, NavLink, Switch, Redirect, useHistory } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport update from \"immutability-helper\";\r\n\r\nimport { UserContext, SiteInfoContext, PopoverContext, useSiteInfo } from \"./Contexts\";\r\nimport { AlertList, useErrorAlert } from \"./components/Alerts\";\r\nimport { NotificationHolder, useOnOutsideClick, Time } from \"./components/Basic\";\r\nimport { Nav } from \"./components/Nav\";\r\nimport Game from \"./pages/Game/Game\";\r\nimport Play from \"./pages/Play/Play\";\r\nimport Community from \"./pages/Community/Community\";\r\nimport Auth from \"./pages/Auth/Auth\";\r\nimport User, { Avatar, useUser } from \"./pages/User/User\";\r\nimport Legal from \"./pages/Legal/Legal\";\r\nimport Popover, { usePopover } from \"./components/Popover\";\r\nimport Chat from \"./pages/Chat/Chat\";\r\n\r\nimport \"./css/main.css\";\r\nimport { useReducer } from \"react\";\r\n\r\nfunction Main() {\r\n    var cacheVal = window.localStorage.getItem(\"cacheVal\");\r\n\r\n    if (!cacheVal) {\r\n        cacheVal = Date.now();\r\n        window.localStorage.setItem(\"cacheVal\", cacheVal);\r\n    }\r\n\r\n    const user = useUser();\r\n    const siteInfo = useSiteInfo({\r\n        alerts: [],\r\n        cacheVal\r\n    });\r\n    const popover = usePopover(siteInfo);\r\n    const errorAlert = useErrorAlert(siteInfo);\r\n\r\n    function onGameLeave(index) {\r\n        axios.post(\"/game/leave\")\r\n            .then(() => {\r\n                siteInfo.hideAlert(index);\r\n            })\r\n            .catch(errorAlert);\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function getInfo() {\r\n            try {\r\n                var res = await axios.get(\"/user/info\");\r\n\r\n                if (res.data.id) {\r\n                    axios.defaults.headers.common['x-csrf'] = res.data.csrf;\r\n                    axios.post(\"/user/online\");\r\n\r\n                    res.data.loggedIn = true;\r\n                    res.data.loaded = true;\r\n                    res.data.rank = Number(res.data.rank);\r\n                    user.set(res.data);\r\n\r\n                    var referrer = window.localStorage.getItem(\"referrer\");\r\n\r\n                    if (referrer) {\r\n                        axios.post(\"/user/referred\", { referrer });\r\n                        window.localStorage.removeItem(\"referrer\");\r\n                    }\r\n                }\r\n                else\r\n                    user.clear();\r\n\r\n                if (res.data.nameChanged == false) {\r\n                    siteInfo.showAlert(() => (\r\n                        <div>\r\n                            New account created, you can change your username once in your <Link to={`/user/settings`}>settings</Link>.\r\n                        </div>\r\n                    ), \"basic\", true);\r\n                }\r\n\r\n                if (res.data.inGame) {\r\n                    siteInfo.showAlert(index => (\r\n                        <div>\r\n                            Return to game <Link to={`/game/${res.data.inGame}`}>{res.data.inGame}</Link> or <a onClick={() => onGameLeave(index)}>leave</a>.\r\n                        </div>\r\n                    ), \"basic\", true);\r\n                }\r\n\r\n                res = await axios.get(\"/roles/all\");\r\n                siteInfo.update(\"roles\", res.data);\r\n            }\r\n            catch (e) {\r\n                errorAlert(e);\r\n            }\r\n\r\n        }\r\n\r\n        getInfo();\r\n\r\n        var onlineInterval = setInterval(() => {\r\n            axios.post(\"/user/online\");\r\n        }, 1000 * 30);\r\n\r\n        return () => {\r\n            clearInterval(onlineInterval);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <UserContext.Provider value={user}>\r\n            <SiteInfoContext.Provider value={siteInfo}>\r\n                <PopoverContext.Provider value={popover}>\r\n                    <Switch>\r\n                        <Route path=\"/game\">\r\n                            <Game />\r\n                        </Route>\r\n                        <Route path=\"/\">\r\n                            <div className=\"site-wrapper\">\r\n                                <div className=\"main-container\">\r\n                                    <Header />\r\n                                    <div className=\"inner-container\">\r\n                                        <Switch>\r\n                                            <Route path=\"/play\" render={() => <Play />} />\r\n                                            <Route path=\"/community\" render={() => <Community />} />\r\n                                            <Route path=\"/auth\" render={() => <Auth />} />\r\n                                            <Route path=\"/user\" render={() => <User />} />\r\n                                            <Route path=\"/legal\" render={() => <Legal />} />\r\n                                            <Route render={() => <Redirect to=\"/play\" />} />\r\n                                        </Switch>\r\n                                    </div>\r\n                                    <Footer />\r\n                                    <AlertList />\r\n                                    <Chat />\r\n                                </div>\r\n                            </div>\r\n                        </Route>\r\n                    </Switch>\r\n                    <Popover />\r\n                </PopoverContext.Provider>\r\n            </SiteInfoContext.Provider>\r\n        </UserContext.Provider>\r\n    );\r\n}\r\n\r\nfunction Header(props) {\r\n    const user = useContext(UserContext);\r\n\r\n    return (\r\n        <div className=\"header\">\r\n            <div className=\"nav-wrapper left\">\r\n                <Nav>\r\n                    <NavLink to=\"/play\">Lobby</NavLink>\r\n                    <NavLink to=\"/community\">Community</NavLink>\r\n                </Nav>\r\n            </div>\r\n            <Link to=\"/\" className=\"logo-wrapper\">\r\n                <div className=\"logo\" />\r\n            </Link>\r\n            <div className=\"nav-wrapper right\">\r\n                <Nav>\r\n                    <a href=\"https://beyondmafia.fandom.com\">Wiki</a>\r\n                    {!user.loggedIn &&\r\n                        <NavLink to=\"/auth\" className=\"nav-link\">Log In</NavLink>\r\n                    }\r\n                    {user.loggedIn &&\r\n                        <div className=\"user-wrapper\">\r\n                            <SiteNotifs />\r\n                            <Link to=\"/user\" className=\"profile-link\">\r\n                                <Avatar\r\n                                    id={user.id}\r\n                                    name={user.name}\r\n                                    hasImage={user.avatar} />\r\n                            </Link>\r\n                        </div>\r\n\r\n                    }\r\n                </Nav>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SiteNotifs() {\r\n    const [showNotifList, setShowNotifList] = useState(false);\r\n    const [notifInfo, updateNotifInfo] = useNotifInfoReducer();\r\n    const [nextRestart, setNextRestart] = useState();\r\n    const siteInfo = useContext(SiteInfoContext);\r\n    const history = useHistory();\r\n\r\n    const bellRef = useRef();\r\n    const notifListRef = useRef();\r\n\r\n    useOnOutsideClick([bellRef, notifListRef], () => setShowNotifList(false));\r\n\r\n    useEffect(() => {\r\n        getNotifs();\r\n        var notifGetInterval = setInterval(() => getNotifs(), 10 * 1000);\r\n        return () => clearInterval(notifGetInterval);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (showNotifList)\r\n            viewedNotifs();\r\n    }, [notifInfo.notifs]);\r\n\r\n    useEffect(() => {\r\n        if (nextRestart && nextRestart > Date.now()) {\r\n            var restartMinutes = Math.ceil((nextRestart - Date.now()) / 1000 / 60);\r\n            siteInfo.showAlert(`The server will be restarting in ${restartMinutes} minutes.`, \"basic\", true);\r\n        }\r\n    }, [nextRestart]);\r\n\r\n    useLayoutEffect(() => {\r\n        if (!showNotifList)\r\n            return;\r\n\r\n        const listRect = notifListRef.current.getBoundingClientRect();\r\n        const listRight = listRect.left + listRect.width;\r\n\r\n        if (listRight > window.innerWidth)\r\n            notifListRef.current.style.left = (window.innerWidth - listRight) + \"px\";\r\n\r\n        notifListRef.current.style.visibility = \"visible\";\r\n    });\r\n\r\n    function getNotifs() {\r\n        axios.get(\"/notifs\")\r\n            .then(res => {\r\n                var nextRestart = res.data[0];\r\n                var notifs = res.data.slice(1);\r\n\r\n                setNextRestart(nextRestart);\r\n\r\n                updateNotifInfo({\r\n                    type: \"add\",\r\n                    notifs: notifs\r\n                });\r\n            })\r\n            .catch(() => { });\r\n    }\r\n\r\n    function viewedNotifs() {\r\n        axios.post(\"/notifs/viewed\")\r\n            .then(() => {\r\n                updateNotifInfo({ type: \"viewed\" });\r\n            })\r\n            .catch(() => { });\r\n    }\r\n\r\n    function onShowNotifsClick() {\r\n        setShowNotifList(!showNotifList);\r\n\r\n        if (!showNotifList && notifInfo.unread > 0)\r\n            viewedNotifs();\r\n    }\r\n\r\n    function onNotifClick(e, notif) {\r\n        if (!notif.link)\r\n            e.preventDefault();\r\n        else if (window.location.pathname == notif.link.split(\"?\")[0])\r\n            history.go(0);\r\n    }\r\n\r\n    const notifs = notifInfo.notifs.map(notif => (\r\n        <Link\r\n            className=\"notif\"\r\n            key={notif.id}\r\n            to={notif.link}\r\n            onClick={e => onNotifClick(e, notif)}>\r\n            {notif.icon &&\r\n                <i className={`fas fa-${notif.icon}`} />\r\n            }\r\n            <div className=\"info\">\r\n                <div className=\"time\">\r\n                    <Time\r\n                        millisec={Date.now() - notif.date}\r\n                        suffix=\" ago\" />\r\n                </div>\r\n                <div className=\"content\">\r\n                    {notif.content}\r\n                </div>\r\n            </div>\r\n        </Link>\r\n    ));\r\n\r\n    return (\r\n        <div className=\"notifs-wrapper\">\r\n            <NotificationHolder\r\n                lOffset\r\n                notifCount={notifInfo.unread}\r\n                onClick={onShowNotifsClick}\r\n                fwdRef={bellRef}>\r\n                <i className=\"fas fa-bell\" />\r\n            </NotificationHolder>\r\n            {showNotifList &&\r\n                <div\r\n                    className=\"notif-list\"\r\n                    ref={notifListRef}>\r\n                    {notifs}\r\n                    {notifs.length == 0 &&\r\n                        \"No unread notifications\"\r\n                    }\r\n                </div>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction useNotifInfoReducer() {\r\n    return useReducer((notifInfo, action) => {\r\n        var newNotifInfo;\r\n\r\n        switch (action.type) {\r\n            case \"add\":\r\n                var existingNotifIds = notifInfo.notifs.map(notif => notif.id);\r\n                var newNotifs = action.notifs.filter(notif => existingNotifIds.indexOf(notif.id) == -1);\r\n\r\n                newNotifInfo = update(notifInfo, {\r\n                    notifs: {\r\n                        $set: newNotifs.concat(notifInfo.notifs)\r\n                    },\r\n                    unread: {\r\n                        $set: notifInfo.unread + newNotifs.length\r\n                    }\r\n                });\r\n\r\n                // if (newNotifs.length > 0 && document.hidden && document.title.indexOf(\"\") == -1)\r\n                //     document.title = document.title + \"\";\r\n                break;\r\n            case \"viewed\":\r\n                newNotifInfo = update(notifInfo, {\r\n                    unread: {\r\n                        $set: 0\r\n                    }\r\n                });\r\n                break;\r\n        }\r\n\r\n        return newNotifInfo || notifInfo;\r\n    }, { notifs: [], unread: 0 });\r\n}\r\n\r\nfunction Footer() {\r\n    let year = (new Date()).getYear() + 1900;\r\n\r\n    return (\r\n        <div className=\"footer\">\r\n            <div className=\"footer-inner\">\r\n                <p> {year} BeyondMafia</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Main;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\n\r\nimport Main from \"./Main\";\r\n\r\nReactDOM.render((\r\n    <Router>\r\n        <Main />\r\n    </Router>\r\n), document.getElementById(\"root\"));"],"sourceRoot":""}